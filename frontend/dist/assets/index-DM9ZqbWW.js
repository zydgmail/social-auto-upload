import{b as X,ax as De,r as O,c as A,o as r,R as e,J as t,al as m,a as l,K as he,S as $e,u as I,p as pe,ay as Fe,P as S,O as v,I as J,L as G,az as xe,t as Ce,X as Oe,ar as Re,E as ne,Q as te,a6 as le,W as Be,a4 as qe,w as Ne,aA as Ke,aB as je,aC as He,au as We}from"./vue-CbZdtcPO.js";import{h as Xe,u as Pe,p as Ge,a as me,m as Je,d as Se,f as Qe,b as Ye,l as Ze,c as et,e as tt,t as lt,E as k,g as fe,r as re,i as at,j as st,k as ot,n as Me,o as nt,q as it,s as ut,v as dt,w as rt}from"./elementPlus-CSqc6bT9.js";import{a as ct}from"./utils-NIGUFBhG.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const _ of document.querySelectorAll('link[rel="modulepreload"]'))p(_);new MutationObserver(_=>{for(const b of _)if(b.type==="childList")for(const u of b.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&p(u)}).observe(document,{childList:!0,subtree:!0});function n(_){const b={};return _.integrity&&(b.integrity=_.integrity),_.referrerPolicy&&(b.referrerPolicy=_.referrerPolicy),_.crossOrigin==="use-credentials"?b.credentials="include":_.crossOrigin==="anonymous"?b.credentials="omit":b.credentials="same-origin",b}function p(_){if(_.ep)return;_.ep=!0;const b=n(_);fetch(_.href,b)}})();const pt="/vite.svg",ee=(a,i)=>{const n=a.__vccOpts||a;for(const[p,_]of i)n[p]=_;return n},mt={id:"app"},ft={class:"sidebar"},vt={class:"logo"},_t={src:pt,alt:"Logo",class:"logo-img"},gt={class:"header-content"},yt={class:"header-left"},ht={__name:"App",setup(a){const i=De(),n=X(()=>i.path),p=O(!1),_=()=>{p.value=!p.value};return(b,u)=>{const $=m("el-icon"),C=m("el-menu-item"),M=m("el-menu"),T=m("el-aside"),L=m("el-header"),q=m("router-view"),V=m("el-main"),o=m("el-container");return r(),A("div",mt,[e(o,null,{default:t(()=>[e(T,{width:p.value?"64px":"200px"},{default:t(()=>[l("div",ft,[l("div",vt,[he(l("img",_t,null,512),[[$e,p.value]]),he(l("h2",null,"自媒体自动化运营系统",512),[[$e,!p.value]])]),e(M,{router:!0,"default-active":n.value,collapse:p.value,class:"sidebar-menu","background-color":"#001529","text-color":"#fff","active-text-color":"#409EFF"},{default:t(()=>[e(C,{index:"/"},{default:t(()=>[e($,null,{default:t(()=>[e(I(Xe))]),_:1}),u[0]||(u[0]=l("span",null,"首页",-1))]),_:1}),e(C,{index:"/account-management"},{default:t(()=>[e($,null,{default:t(()=>[e(I(Pe))]),_:1}),u[1]||(u[1]=l("span",null,"账号管理",-1))]),_:1}),e(C,{index:"/material-management"},{default:t(()=>[e($,null,{default:t(()=>[e(I(Ge))]),_:1}),u[2]||(u[2]=l("span",null,"素材管理",-1))]),_:1}),e(C,{index:"/publish-center"},{default:t(()=>[e($,null,{default:t(()=>[e(I(me))]),_:1}),u[3]||(u[3]=l("span",null,"发布中心",-1))]),_:1}),e(C,{index:"/website"},{default:t(()=>[e($,null,{default:t(()=>[e(I(Je))]),_:1}),u[4]||(u[4]=l("span",null,"网站",-1))]),_:1}),e(C,{index:"/data"},{default:t(()=>[e($,null,{default:t(()=>[e(I(Se))]),_:1}),u[5]||(u[5]=l("span",null,"数据",-1))]),_:1})]),_:1},8,["default-active","collapse"])])]),_:1},8,["width"]),e(o,null,{default:t(()=>[e(L,null,{default:t(()=>[l("div",gt,[l("div",yt,[e($,{class:"toggle-sidebar",onClick:_},{default:t(()=>[e(I(Qe))]),_:1})]),u[6]||(u[6]=l("div",{class:"header-right"},null,-1))])]),_:1}),e(V,null,{default:t(()=>[e(q)]),_:1})]),_:1})]),_:1})])}}},bt=ee(ht,[["__scopeId","data-v-176fbaed"]]),$t={class:"dashboard"},wt={class:"dashboard-content"},kt={class:"stat-card-content"},Vt={class:"stat-icon"},Ct={class:"stat-info"},At={class:"stat-value"},Tt={class:"stat-footer"},xt={class:"stat-detail"},Pt={class:"stat-card-content"},St={class:"stat-icon platform-icon"},Mt={class:"stat-info"},Ut={class:"stat-value"},Lt={class:"stat-footer"},It={class:"stat-detail"},Et={class:"stat-card-content"},zt={class:"stat-icon task-icon"},Dt={class:"stat-info"},Ft={class:"stat-value"},Ot={class:"stat-footer"},Rt={class:"stat-detail"},Bt={class:"stat-card-content"},qt={class:"stat-icon content-icon"},Nt={class:"stat-info"},Kt={class:"stat-value"},jt={class:"stat-footer"},Ht={class:"stat-detail"},Wt={class:"quick-actions"},Xt={class:"action-icon"},Gt={class:"action-icon"},Jt={class:"action-icon"},Qt={class:"action-icon"},Yt={class:"recent-tasks"},Zt={class:"section-header"},el={__name:"Dashboard",setup(a){const i=Fe(),n=pe({total:12,normal:10,abnormal:2}),p=pe({total:4,kuaishou:3,douyin:4,channels:2,xiaohongshu:3}),_=pe({total:24,completed:18,inProgress:5,failed:1}),b=pe({total:36,published:30,draft:6}),u=O([{id:1,title:"快手视频自动发布",platform:"快手",account:"快手账号1",createTime:"2024-05-01 10:30:00",status:"已完成"},{id:2,title:"抖音视频定时发布",platform:"抖音",account:"抖音账号1",createTime:"2024-05-01 11:15:00",status:"进行中"},{id:3,title:"视频号内容上传",platform:"视频号",account:"视频号账号1",createTime:"2024-05-01 14:20:00",status:"待执行"},{id:4,title:"小红书图文发布",platform:"小红书",account:"小红书账号1",createTime:"2024-05-01 16:45:00",status:"已失败"},{id:5,title:"快手短视频批量上传",platform:"快手",account:"快手账号2",createTime:"2024-05-02 09:10:00",status:"待执行"}]),$=V=>({快手:"success",抖音:"danger",视频号:"warning",小红书:"info"})[V]||"info",C=V=>({已完成:"success",进行中:"warning",待执行:"info",已失败:"danger"})[V]||"info",M=V=>{i.push(V)},T=V=>{k.info(`查看任务: ${V.title}`)},L=V=>{fe.confirm(`确定要执行任务 ${V.title} 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(()=>{const o=u.value.findIndex(E=>E.id===V.id);o!==-1&&(u.value[o].status="进行中"),k({type:"success",message:"任务已开始执行"})}).catch(()=>{})},q=V=>{fe.confirm(`确定要取消任务 ${V.title} 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const o=u.value.findIndex(E=>E.id===V.id);o!==-1&&(u.value[o].status="已取消"),k({type:"success",message:"任务已取消"})}).catch(()=>{})};return(V,o)=>{const E=m("el-icon"),D=m("el-card"),h=m("el-col"),W=m("el-tag"),P=m("el-tooltip"),z=m("el-row"),K=m("el-button"),H=m("el-table-column"),U=m("el-table");return r(),A("div",$t,[o[19]||(o[19]=l("div",{class:"page-header"},[l("h1",null,"自媒体自动化运营系统")],-1)),l("div",wt,[e(z,{gutter:20},{default:t(()=>[e(h,{span:6},{default:t(()=>[e(D,{class:"stat-card"},{default:t(()=>[l("div",kt,[l("div",Vt,[e(E,null,{default:t(()=>[e(I(Pe))]),_:1})]),l("div",Ct,[l("div",At,S(n.total),1),o[1]||(o[1]=l("div",{class:"stat-label"},"账号总数",-1))])]),l("div",Tt,[l("div",xt,[l("span",null,"正常: "+S(n.normal),1),l("span",null,"异常: "+S(n.abnormal),1)])])]),_:1})]),_:1}),e(h,{span:6},{default:t(()=>[e(D,{class:"stat-card"},{default:t(()=>[l("div",Pt,[l("div",St,[e(E,null,{default:t(()=>[e(I(Ye))]),_:1})]),l("div",Mt,[l("div",Ut,S(p.total),1),o[2]||(o[2]=l("div",{class:"stat-label"},"平台总数",-1))])]),l("div",Lt,[l("div",It,[e(P,{content:"快手账号",placement:"top"},{default:t(()=>[e(W,{size:"small",type:"success"},{default:t(()=>[v(S(p.kuaishou),1)]),_:1})]),_:1}),e(P,{content:"抖音账号",placement:"top"},{default:t(()=>[e(W,{size:"small",type:"danger"},{default:t(()=>[v(S(p.douyin),1)]),_:1})]),_:1}),e(P,{content:"视频号账号",placement:"top"},{default:t(()=>[e(W,{size:"small",type:"warning"},{default:t(()=>[v(S(p.channels),1)]),_:1})]),_:1}),e(P,{content:"小红书账号",placement:"top"},{default:t(()=>[e(W,{size:"small",type:"info"},{default:t(()=>[v(S(p.xiaohongshu),1)]),_:1})]),_:1})])])]),_:1})]),_:1}),e(h,{span:6},{default:t(()=>[e(D,{class:"stat-card"},{default:t(()=>[l("div",Et,[l("div",zt,[e(E,null,{default:t(()=>[e(I(Ze))]),_:1})]),l("div",Dt,[l("div",Ft,S(_.total),1),o[3]||(o[3]=l("div",{class:"stat-label"},"任务总数",-1))])]),l("div",Ot,[l("div",Rt,[l("span",null,"完成: "+S(_.completed),1),l("span",null,"进行中: "+S(_.inProgress),1),l("span",null,"失败: "+S(_.failed),1)])])]),_:1})]),_:1}),e(h,{span:6},{default:t(()=>[e(D,{class:"stat-card"},{default:t(()=>[l("div",Bt,[l("div",qt,[e(E,null,{default:t(()=>[e(I(et))]),_:1})]),l("div",Nt,[l("div",Kt,S(b.total),1),o[4]||(o[4]=l("div",{class:"stat-label"},"内容总数",-1))])]),l("div",jt,[l("div",Ht,[l("span",null,"已发布: "+S(b.published),1),l("span",null,"草稿: "+S(b.draft),1)])])]),_:1})]),_:1})]),_:1}),l("div",Wt,[o[13]||(o[13]=l("h2",null,"快捷操作",-1)),e(z,{gutter:20},{default:t(()=>[e(h,{span:6},{default:t(()=>[e(D,{class:"action-card",onClick:o[0]||(o[0]=d=>M("/account-management"))},{default:t(()=>[l("div",Xt,[e(E,null,{default:t(()=>[e(I(tt))]),_:1})]),o[5]||(o[5]=l("div",{class:"action-title"},"账号管理",-1)),o[6]||(o[6]=l("div",{class:"action-desc"},"管理所有平台账号",-1))]),_:1})]),_:1}),e(h,{span:6},{default:t(()=>[e(D,{class:"action-card"},{default:t(()=>[l("div",Gt,[e(E,null,{default:t(()=>[e(I(me))]),_:1})]),o[7]||(o[7]=l("div",{class:"action-title"},"内容上传",-1)),o[8]||(o[8]=l("div",{class:"action-desc"},"上传视频和图文内容",-1))]),_:1})]),_:1}),e(h,{span:6},{default:t(()=>[e(D,{class:"action-card"},{default:t(()=>[l("div",Jt,[e(E,null,{default:t(()=>[e(I(lt))]),_:1})]),o[9]||(o[9]=l("div",{class:"action-title"},"定时发布",-1)),o[10]||(o[10]=l("div",{class:"action-desc"},"设置内容发布时间",-1))]),_:1})]),_:1}),e(h,{span:6},{default:t(()=>[e(D,{class:"action-card"},{default:t(()=>[l("div",Qt,[e(E,null,{default:t(()=>[e(I(Se))]),_:1})]),o[11]||(o[11]=l("div",{class:"action-title"},"数据分析",-1)),o[12]||(o[12]=l("div",{class:"action-desc"},"查看内容数据分析",-1))]),_:1})]),_:1})]),_:1})]),l("div",Yt,[l("div",Zt,[o[15]||(o[15]=l("h2",null,"最近任务",-1)),e(K,{text:""},{default:t(()=>[...o[14]||(o[14]=[v("查看全部",-1)])]),_:1})]),e(U,{data:u.value,style:{width:"100%"}},{default:t(()=>[e(H,{prop:"title",label:"任务名称",width:"250"}),e(H,{prop:"platform",label:"平台",width:"120"},{default:t(d=>[e(W,{type:$(d.row.platform),effect:"plain"},{default:t(()=>[v(S(d.row.platform),1)]),_:2},1032,["type"])]),_:1}),e(H,{prop:"account",label:"账号",width:"150"}),e(H,{prop:"createTime",label:"创建时间",width:"180"}),e(H,{prop:"status",label:"状态",width:"120"},{default:t(d=>[e(W,{type:C(d.row.status),effect:"plain"},{default:t(()=>[v(S(d.row.status),1)]),_:2},1032,["type"])]),_:1}),e(H,{label:"操作"},{default:t(d=>[e(K,{size:"small",onClick:F=>T(d.row)},{default:t(()=>[...o[16]||(o[16]=[v("查看",-1)])]),_:1},8,["onClick"]),d.row.status==="待执行"?(r(),J(K,{key:0,size:"small",type:"primary",onClick:F=>L(d.row)},{default:t(()=>[...o[17]||(o[17]=[v(" 执行 ",-1)])]),_:1},8,["onClick"])):G("",!0),d.row.status!=="已完成"&&d.row.status!=="已失败"?(r(),J(K,{key:1,size:"small",type:"danger",onClick:F=>q(d.row)},{default:t(()=>[...o[18]||(o[18]=[v(" 取消 ",-1)])]),_:1},8,["onClick"])):G("",!0)]),_:1})]),_:1},8,["data"])])])])}}},tl=ee(el,[["__scopeId","data-v-db5c2d61"]]),ce=ct.create({baseURL:"http://localhost:5409",headers:{"Content-Type":"application/json"}});ce.interceptors.request.use(a=>{const i=localStorage.getItem("token");return i&&(a.headers.Authorization=`Bearer ${i}`),a},a=>(console.error("请求错误:",a),Promise.reject(a)));ce.interceptors.response.use(a=>{const{data:i}=a;return i.code===200||i.success?i:(k.error(i.message||"请求失败"),Promise.reject(new Error(i.message||"请求失败")))},a=>{if(console.error("响应错误:",a),a.response){const{status:i}=a.response;switch(i){case 401:k.error("未授权，请重新登录");break;case 403:k.error("拒绝访问");break;case 404:k.error("请求地址不存在");break;case 500:k.error("服务器内部错误");break;default:k.error("网络错误")}}else k.error("网络连接失败");return Promise.reject(a)});const ie={get(a,i){return ce.get(a,{params:i})},post(a,i,n={}){return ce.post(a,i,n)},put(a,i,n={}){return ce.put(a,i,n)},delete(a,i){return ce.delete(a,{params:i})},upload(a,i){return ce.post(a,i,{headers:{"Content-Type":"multipart/form-data"}})}},ye={getValidAccounts(a){return ie.get("/getValidAccounts",a)},addAccount(a){return ie.post("/account",a)},updateAccount(a){return ie.post("/updateUserinfo",a)},deleteAccount(a){return ie.get(`/deleteAccount?id=${a}`)},openAccounts(a){return ie.post("/openAccounts",{ids:a})}},Ae=xe("account",()=>{const a=O([]),i={1:"小红书",2:"视频号",3:"抖音",4:"快手"};return{accounts:a,setAccounts:$=>{a.value=$.map(C=>({id:C[0],type:C[1],filePath:C[2],name:C[3],status:C[4]===1?"正常":"异常",platform:i[C[1]]||"未知",avatar:"/vite.svg"}))},addAccount:$=>{a.value.push($)},updateAccount:($,C)=>{const M=a.value.findIndex(T=>T.id===$);M!==-1&&(a.value[M]={...a.value[M],...C})},deleteAccount:$=>{a.value=a.value.filter(C=>C.id!==$)},getAccountsByPlatform:$=>a.value.filter(C=>C.platform===$)}}),be=xe("app",()=>{const a=O(!0),i=O(!0),n=O(!1),p=O([]);return{isFirstTimeAccountManagement:a,isFirstTimeMaterialManagement:i,isAccountRefreshing:n,materials:p,setAccountManagementVisited:()=>{a.value=!1},setMaterialManagementVisited:()=>{i.value=!1},resetVisitStatus:()=>{a.value=!0,i.value=!0},setMaterials:L=>{p.value=L},addMaterial:L=>{p.value.push(L)},removeMaterial:L=>{const q=p.value.findIndex(V=>V.id===L);q>-1&&p.value.splice(q,1)},setAccountRefreshing:L=>{n.value=L}}}),ll={class:"account-management","element-loading-text":"正在验证账号..."},al={class:"account-tabs"},sl={class:"account-list-container"},ol={class:"account-search"},nl={class:"action-buttons"},il={class:"refresh-text"},ul={key:0,class:"account-list"},dl={key:1,class:"empty-data"},rl={class:"account-list-container"},cl={class:"account-search"},pl={class:"action-buttons"},ml={class:"refresh-text"},fl={key:0,class:"account-list"},vl={key:1,class:"empty-data"},_l={class:"account-list-container"},gl={class:"account-search"},yl={class:"action-buttons"},hl={class:"refresh-text"},bl={key:0,class:"account-list"},$l={key:1,class:"empty-data"},wl={class:"account-list-container"},kl={class:"account-search"},Vl={class:"action-buttons"},Cl={class:"refresh-text"},Al={key:0,class:"account-list"},Tl={key:1,class:"empty-data"},xl={class:"account-list-container"},Pl={class:"account-search"},Sl={class:"action-buttons"},Ml={class:"refresh-text"},Ul={key:0,class:"account-list"},Ll={key:1,class:"empty-data"},Il={key:0,class:"qrcode-container"},El={key:0,class:"qrcode-wrapper"},zl=["src"],Dl={key:1,class:"loading-wrapper"},Fl={key:2,class:"success-wrapper"},Ol={key:3,class:"error-wrapper"},Rl={class:"dialog-footer"},Bl={__name:"AccountManagement",setup(a){const i=Ae(),n=be(),p=O("all"),_=O(""),b=async(y=!1)=>{if(!n.isAccountRefreshing){n.setAccountRefreshing(!0);try{const s=await ye.getValidAccounts({validate:y?1:0});s.code===200&&s.data?(i.setAccounts(s.data),y&&k.success("账号验证完成"),n.isFirstTimeAccountManagement&&n.setAccountManagementVisited()):k.error("获取账号数据失败")}catch(s){console.error("获取账号数据失败:",s),k.error("获取账号数据失败")}finally{n.setAccountRefreshing(!1)}}};Ce(()=>{n.isFirstTimeAccountManagement&&b(!1)});const u=y=>({快手:"success",抖音:"danger",视频号:"warning",小红书:"info"})[y]||"info",$=X(()=>_.value?i.accounts.filter(y=>y.name.includes(_.value)):i.accounts),C=O([]),M=y=>{C.value=y.map(s=>s.id)},T=async()=>{var y;if(C.value.length)try{const s=await ye.openAccounts(C.value);s.code===200?k.success(`已打开 ${((y=s.data)==null?void 0:y.opened)??C.value.length} 个标签页`):k.error(s.msg||"打开失败")}catch{k.error("打开失败")}},L=X(()=>$.value.filter(y=>y.platform==="快手")),q=X(()=>$.value.filter(y=>y.platform==="抖音")),V=X(()=>$.value.filter(y=>y.platform==="视频号")),o=X(()=>$.value.filter(y=>y.platform==="小红书")),E=()=>{},D=O(!1),h=O("add"),W=O(null),P=pe({id:null,name:"",platform:"",status:"正常"}),z={platform:[{required:!0,message:"请选择平台",trigger:"change"}],name:[{required:!0,message:"请输入账号名称",trigger:"blur"}]},K=O(!1),H=O(""),U=O(""),d=()=>{h.value="add",Object.assign(P,{id:null,name:"",platform:"",status:"正常"}),K.value=!1,H.value="",U.value="",D.value=!0},F=y=>{fe.confirm(`确定要删除账号 ${y.name} 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const s=await ye.deleteAccount(y.id);s.code===200?(i.deleteAccount(y.id),k({type:"success",message:"删除成功"})):k.error(s.msg||"删除失败")}catch(s){console.error("删除账号失败:",s),k.error("删除账号失败")}}).catch(()=>{})};let j=null;const Y=()=>{j&&(j.close(),j=null)},ae=(y,s,R=null)=>{Y(),K.value=!0,H.value="",U.value="";const N={小红书:"1",视频号:"2",抖音:"3",快手:"4"}[y]||"1",f="http://localhost:5409",B=new URLSearchParams({type:N,id:s});R&&(B.append("update","1"),B.append("record_id",String(R)));const Z=`${f}/login?${B.toString()}`;j=new EventSource(Z),j.onmessage=se=>{const Q=se.data;if(console.log("SSE消息:",Q),!H.value&&Q.length>100)try{Q.startsWith("data:image")?H.value=Q:H.value=`data:image/png;base64,${Q}`,console.log("设置二维码数据，长度:",Q.length)}catch(de){console.error("处理二维码数据出错:",de)}else(Q==="200"||Q==="500")&&(U.value=Q,Q==="200"?setTimeout(()=>{Y(),setTimeout(()=>{D.value=!1,K.value=!1,k.success(R?"账号更新成功":"账号添加成功"),k({type:"info",message:"正在同步账号信息...",duration:0}),b().then(()=>{k.closeAll(),k.success("账号信息已更新")})},1e3)},1e3):(Y(),setTimeout(()=>{K.value=!1,H.value="",U.value=""},2e3)))},j.onerror=se=>{console.error("SSE连接错误:",se),k.error("连接服务器失败，请稍后再试"),Y(),K.value=!1}},g=()=>{W.value.validate(async y=>{if(y)h.value==="add"?ae(P.platform,P.name,P.id):k.info("编辑功能已取消，请删除后重新添加");else return!1})},w=y=>{h.value="add",Object.assign(P,{id:y.id,platform:y.platform,name:y.name,status:"正常"}),K.value=!1,H.value="",U.value="",D.value=!0};return Oe(()=>{Y()}),(y,s)=>{const R=m("el-input"),x=m("el-button"),N=m("el-icon"),f=m("el-table-column"),B=m("el-avatar"),Z=m("el-tag"),se=m("el-table"),Q=m("el-empty"),de=m("el-tab-pane"),Ue=m("el-tabs"),ge=m("el-option"),Le=m("el-select"),Te=m("el-form-item"),Ie=m("el-form"),Ee=m("el-dialog"),ze=Re("loading");return he((r(),A("div",ll,[s[36]||(s[36]=l("div",{class:"page-header"},[l("h1",null,"账号管理")],-1)),l("div",al,[e(Ue,{modelValue:p.value,"onUpdate:modelValue":s[10]||(s[10]=c=>p.value=c),class:"account-tabs-nav"},{default:t(()=>[e(de,{label:"全部",name:"all"},{default:t(()=>[l("div",sl,[l("div",ol,[e(R,{modelValue:_.value,"onUpdate:modelValue":s[0]||(s[0]=c=>_.value=c),placeholder:"输入名称或账号搜索","prefix-icon":"Search",clearable:"",onClear:E,onInput:E},null,8,["modelValue"]),l("div",nl,[e(x,{type:"primary",onClick:d},{default:t(()=>[...s[15]||(s[15]=[v("添加账号",-1)])]),_:1}),e(x,{type:"success",onClick:T,disabled:C.value.length===0},{default:t(()=>[...s[16]||(s[16]=[v("作品查看",-1)])]),_:1},8,["disabled"]),e(x,{type:"info",onClick:s[1]||(s[1]=()=>b(!0))},{default:t(()=>[e(N,{class:ne({"is-loading":I(n).isAccountRefreshing,"refresh-icon":!0})},{default:t(()=>[e(I(re))]),_:1},8,["class"]),l("span",il,S(I(n).isAccountRefreshing?"验证中...":"过期验证"),1)]),_:1})])]),$.value.length>0?(r(),A("div",ul,[e(se,{data:$.value,style:{width:"100%"},onSelectionChange:M},{default:t(()=>[e(f,{type:"selection",width:"55"}),e(f,{label:"头像",width:"80"},{default:t(c=>[e(B,{src:c.row.avatar,size:40},null,8,["src"])]),_:1}),e(f,{prop:"name",label:"名称",width:"180"}),e(f,{prop:"platform",label:"平台"},{default:t(c=>[e(Z,{type:u(c.row.platform),effect:"plain"},{default:t(()=>[v(S(c.row.platform),1)]),_:2},1032,["type"])]),_:1}),e(f,{prop:"status",label:"状态"},{default:t(c=>[e(Z,{type:c.row.status==="正常"?"success":"danger",effect:"plain"},{default:t(()=>[v(S(c.row.status),1)]),_:2},1032,["type"])]),_:1}),e(f,{label:"操作"},{default:t(c=>[c.row.status!=="正常"?(r(),J(x,{key:0,size:"small",type:"warning",onClick:oe=>w(c.row)},{default:t(()=>[...s[17]||(s[17]=[v("重新添加",-1)])]),_:1},8,["onClick"])):G("",!0),e(x,{size:"small",type:"danger",onClick:oe=>F(c.row)},{default:t(()=>[...s[18]||(s[18]=[v("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(r(),A("div",dl,[e(Q,{description:"暂无账号数据"})]))])]),_:1}),e(de,{label:"快手",name:"kuaishou"},{default:t(()=>[l("div",rl,[l("div",cl,[e(R,{modelValue:_.value,"onUpdate:modelValue":s[2]||(s[2]=c=>_.value=c),placeholder:"输入名称或账号搜索","prefix-icon":"Search",clearable:"",onClear:E,onInput:E},null,8,["modelValue"]),l("div",pl,[e(x,{type:"primary",onClick:d},{default:t(()=>[...s[19]||(s[19]=[v("添加账号",-1)])]),_:1}),e(x,{type:"info",onClick:s[3]||(s[3]=()=>b(!0))},{default:t(()=>[e(N,{class:ne({"is-loading":I(n).isAccountRefreshing,"refresh-icon":!0})},{default:t(()=>[e(I(re))]),_:1},8,["class"]),l("span",ml,S(I(n).isAccountRefreshing?"验证中...":"手动过期验证"),1)]),_:1})])]),L.value.length>0?(r(),A("div",fl,[e(se,{data:L.value,style:{width:"100%"}},{default:t(()=>[e(f,{label:"头像",width:"80"},{default:t(c=>[e(B,{src:c.row.avatar,size:40},null,8,["src"])]),_:1}),e(f,{prop:"name",label:"名称",width:"180"}),e(f,{prop:"platform",label:"平台"},{default:t(c=>[e(Z,{type:u(c.row.platform),effect:"plain"},{default:t(()=>[v(S(c.row.platform),1)]),_:2},1032,["type"])]),_:1}),e(f,{prop:"status",label:"状态"},{default:t(c=>[e(Z,{type:c.row.status==="正常"?"success":"danger",effect:"plain"},{default:t(()=>[v(S(c.row.status),1)]),_:2},1032,["type"])]),_:1}),e(f,{label:"操作"},{default:t(c=>[c.row.status!=="正常"?(r(),J(x,{key:0,size:"small",type:"warning",onClick:oe=>w(c.row)},{default:t(()=>[...s[20]||(s[20]=[v("重新添加",-1)])]),_:1},8,["onClick"])):G("",!0),e(x,{size:"small",type:"danger",onClick:oe=>F(c.row)},{default:t(()=>[...s[21]||(s[21]=[v("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(r(),A("div",vl,[e(Q,{description:"暂无快手账号数据"})]))])]),_:1}),e(de,{label:"抖音",name:"douyin"},{default:t(()=>[l("div",_l,[l("div",gl,[e(R,{modelValue:_.value,"onUpdate:modelValue":s[4]||(s[4]=c=>_.value=c),placeholder:"输入名称或账号搜索","prefix-icon":"Search",clearable:"",onClear:E,onInput:E},null,8,["modelValue"]),l("div",yl,[e(x,{type:"primary",onClick:d},{default:t(()=>[...s[22]||(s[22]=[v("添加账号",-1)])]),_:1}),e(x,{type:"info",onClick:s[5]||(s[5]=()=>b(!0))},{default:t(()=>[e(N,{class:ne({"is-loading":I(n).isAccountRefreshing,"refresh-icon":!0})},{default:t(()=>[e(I(re))]),_:1},8,["class"]),l("span",hl,S(I(n).isAccountRefreshing?"验证中...":"手动过期验证"),1)]),_:1})])]),q.value.length>0?(r(),A("div",bl,[e(se,{data:q.value,style:{width:"100%"}},{default:t(()=>[e(f,{label:"头像",width:"80"},{default:t(c=>[e(B,{src:c.row.avatar,size:40},null,8,["src"])]),_:1}),e(f,{prop:"name",label:"名称",width:"180"}),e(f,{prop:"platform",label:"平台"},{default:t(c=>[e(Z,{type:u(c.row.platform),effect:"plain"},{default:t(()=>[v(S(c.row.platform),1)]),_:2},1032,["type"])]),_:1}),e(f,{prop:"status",label:"状态"},{default:t(c=>[e(Z,{type:c.row.status==="正常"?"success":"danger",effect:"plain"},{default:t(()=>[v(S(c.row.status),1)]),_:2},1032,["type"])]),_:1}),e(f,{label:"操作"},{default:t(c=>[c.row.status!=="正常"?(r(),J(x,{key:0,size:"small",type:"warning",onClick:oe=>w(c.row)},{default:t(()=>[...s[23]||(s[23]=[v("重新添加",-1)])]),_:1},8,["onClick"])):G("",!0),e(x,{size:"small",type:"danger",onClick:oe=>F(c.row)},{default:t(()=>[...s[24]||(s[24]=[v("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(r(),A("div",$l,[e(Q,{description:"暂无抖音账号数据"})]))])]),_:1}),e(de,{label:"视频号",name:"channels"},{default:t(()=>[l("div",wl,[l("div",kl,[e(R,{modelValue:_.value,"onUpdate:modelValue":s[6]||(s[6]=c=>_.value=c),placeholder:"输入名称或账号搜索","prefix-icon":"Search",clearable:"",onClear:E,onInput:E},null,8,["modelValue"]),l("div",Vl,[e(x,{type:"primary",onClick:d},{default:t(()=>[...s[25]||(s[25]=[v("添加账号",-1)])]),_:1}),e(x,{type:"info",onClick:s[7]||(s[7]=()=>b(!0))},{default:t(()=>[e(N,{class:ne({"is-loading":I(n).isAccountRefreshing,"refresh-icon":!0})},{default:t(()=>[e(I(re))]),_:1},8,["class"]),l("span",Cl,S(I(n).isAccountRefreshing?"验证中...":"手动过期验证"),1)]),_:1})])]),V.value.length>0?(r(),A("div",Al,[e(se,{data:V.value,style:{width:"100%"}},{default:t(()=>[e(f,{label:"头像",width:"80"},{default:t(c=>[e(B,{src:c.row.avatar,size:40},null,8,["src"])]),_:1}),e(f,{prop:"name",label:"名称",width:"180"}),e(f,{prop:"platform",label:"平台"},{default:t(c=>[e(Z,{type:u(c.row.platform),effect:"plain"},{default:t(()=>[v(S(c.row.platform),1)]),_:2},1032,["type"])]),_:1}),e(f,{prop:"status",label:"状态"},{default:t(c=>[e(Z,{type:c.row.status==="正常"?"success":"danger",effect:"plain"},{default:t(()=>[v(S(c.row.status),1)]),_:2},1032,["type"])]),_:1}),e(f,{label:"操作"},{default:t(c=>[c.row.status!=="正常"?(r(),J(x,{key:0,size:"small",type:"warning",onClick:oe=>w(c.row)},{default:t(()=>[...s[26]||(s[26]=[v("重新添加",-1)])]),_:1},8,["onClick"])):G("",!0),e(x,{size:"small",type:"danger",onClick:oe=>F(c.row)},{default:t(()=>[...s[27]||(s[27]=[v("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(r(),A("div",Tl,[e(Q,{description:"暂无视频号账号数据"})]))])]),_:1}),e(de,{label:"小红书",name:"xiaohongshu"},{default:t(()=>[l("div",xl,[l("div",Pl,[e(R,{modelValue:_.value,"onUpdate:modelValue":s[8]||(s[8]=c=>_.value=c),placeholder:"输入名称或账号搜索","prefix-icon":"Search",clearable:"",onClear:E,onInput:E},null,8,["modelValue"]),l("div",Sl,[e(x,{type:"primary",onClick:d},{default:t(()=>[...s[28]||(s[28]=[v("添加账号",-1)])]),_:1}),e(x,{type:"info",onClick:s[9]||(s[9]=()=>b(!0))},{default:t(()=>[e(N,{class:ne({"is-loading":I(n).isAccountRefreshing,"refresh-icon":!0})},{default:t(()=>[e(I(re))]),_:1},8,["class"]),l("span",Ml,S(I(n).isAccountRefreshing?"验证中...":"手动过期验证"),1)]),_:1})])]),o.value.length>0?(r(),A("div",Ul,[e(se,{data:o.value,style:{width:"100%"}},{default:t(()=>[e(f,{label:"头像",width:"80"},{default:t(c=>[e(B,{src:c.row.avatar,size:40},null,8,["src"])]),_:1}),e(f,{prop:"name",label:"名称",width:"180"}),e(f,{prop:"platform",label:"平台"},{default:t(c=>[e(Z,{type:u(c.row.platform),effect:"plain"},{default:t(()=>[v(S(c.row.platform),1)]),_:2},1032,["type"])]),_:1}),e(f,{prop:"status",label:"状态"},{default:t(c=>[e(Z,{type:c.row.status==="正常"?"success":"danger",effect:"plain"},{default:t(()=>[v(S(c.row.status),1)]),_:2},1032,["type"])]),_:1}),e(f,{label:"操作"},{default:t(c=>[c.row.status!=="正常"?(r(),J(x,{key:0,size:"small",type:"warning",onClick:oe=>w(c.row)},{default:t(()=>[...s[29]||(s[29]=[v("重新添加",-1)])]),_:1},8,["onClick"])):G("",!0),e(x,{size:"small",type:"danger",onClick:oe=>F(c.row)},{default:t(()=>[...s[30]||(s[30]=[v("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(r(),A("div",Ll,[e(Q,{description:"暂无小红书账号数据"})]))])]),_:1})]),_:1},8,["modelValue"])]),e(Ee,{modelValue:D.value,"onUpdate:modelValue":s[14]||(s[14]=c=>D.value=c),title:h.value==="add"?"添加账号":"编辑账号",width:"500px","close-on-click-modal":!1,"close-on-press-escape":!K.value,"show-close":!K.value},{footer:t(()=>[l("span",Rl,[e(x,{onClick:s[13]||(s[13]=c=>D.value=!1)},{default:t(()=>[...s[35]||(s[35]=[v("取消",-1)])]),_:1}),e(x,{type:"primary",onClick:g,loading:K.value,disabled:K.value},{default:t(()=>[v(S(K.value?"请求中":"确认"),1)]),_:1},8,["loading","disabled"])])]),default:t(()=>[e(Ie,{model:P,"label-width":"80px",rules:z,ref_key:"accountFormRef",ref:W},{default:t(()=>[e(Te,{label:"平台",prop:"platform"},{default:t(()=>[e(Le,{modelValue:P.platform,"onUpdate:modelValue":s[11]||(s[11]=c=>P.platform=c),placeholder:"请选择平台",style:{width:"100%"},disabled:h.value==="edit"||K.value},{default:t(()=>[e(ge,{label:"快手",value:"快手"}),e(ge,{label:"抖音",value:"抖音"}),e(ge,{label:"视频号",value:"视频号"}),e(ge,{label:"小红书",value:"小红书"})]),_:1},8,["modelValue","disabled"])]),_:1}),e(Te,{label:"名称",prop:"name"},{default:t(()=>[e(R,{modelValue:P.name,"onUpdate:modelValue":s[12]||(s[12]=c=>P.name=c),placeholder:"请输入账号名称",disabled:K.value},null,8,["modelValue","disabled"])]),_:1}),K.value?(r(),A("div",Il,[H.value&&!U.value?(r(),A("div",El,[s[31]||(s[31]=l("p",{class:"qrcode-tip"},"请使用对应平台APP扫描二维码登录",-1)),l("img",{src:H.value,alt:"登录二维码",class:"qrcode-image"},null,8,zl)])):!H.value&&!U.value?(r(),A("div",Dl,[e(N,{class:"is-loading"},{default:t(()=>[e(I(re))]),_:1}),s[32]||(s[32]=l("span",null,"请求中...",-1))])):U.value==="200"?(r(),A("div",Fl,[e(N,null,{default:t(()=>[e(I(at))]),_:1}),s[33]||(s[33]=l("span",null,"添加成功",-1))])):U.value==="500"?(r(),A("div",Ol,[e(N,null,{default:t(()=>[e(I(st))]),_:1}),s[34]||(s[34]=l("span",null,"添加失败，请稍后再试",-1))])):G("",!0)])):G("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title","close-on-press-escape","show-close"])])),[[ze,I(n).isAccountRefreshing]])}}},ql=ee(Bl,[["__scopeId","data-v-54a06a1f"]]),ue={getAllMaterials:()=>ie.get("/getFiles"),uploadMaterial:a=>ie.upload("/uploadSave",a),deleteMaterial:a=>ie.get(`/deleteFile?id=${a}`),downloadMaterial:a=>`http://localhost:5409/download/${a}`,getMaterialPreviewUrl:a=>`http://localhost:5409/getFile?filename=${a}`},Nl={class:"material-management"},Kl={class:"material-list-container"},jl={class:"material-search"},Hl={class:"action-buttons"},Wl={key:0},Xl={key:0,class:"material-list"},Gl={key:1,class:"empty-data"},Jl={class:"upload-form"},Ql={class:"dialog-footer"},Yl={key:0,class:"preview-container"},Zl={key:0,class:"video-preview"},ea={controls:"",style:{"max-width":"100%","max-height":"60vh"}},ta=["src"],la={key:1,class:"image-preview"},aa=["src"],sa={key:2,class:"file-info"},oa={__name:"MaterialManagement",setup(a){const i=be(),n=O(""),p=O(!1),_=O(!1),b=O(!1),u=O(!1),$=O(null),C=O([]),M=O(""),T=async()=>{p.value=!0;try{const U=await ue.getAllMaterials();U.code===200?(i.setMaterials(U.data),k.success("刷新成功")):k.error("获取素材列表失败")}catch(U){console.error("获取素材列表出错:",U),k.error("获取素材列表失败")}finally{p.value=!1}},L=X(()=>{if(!n.value)return i.materials;const U=n.value.toLowerCase();return i.materials.filter(d=>d.filename.toLowerCase().includes(U))}),q=()=>{},V=()=>{C.value=[],M.value="",b.value=!0},o=()=>{C.value=[],M.value=""},E=(U,d)=>{console.log("选择的文件:",U),U.raw&&(C.value=[U])},D=async()=>{if(C.value.length===0){k.warning("请选择要上传的文件");return}const U=C.value[0];if(!U||!U.raw){k.warning("文件对象无效，请重新选择文件");return}_.value=!0;try{const d=new FormData;console.log("上传文件对象:",U.raw),d.append("file",U.raw),M.value.trim()&&(d.append("filename",M.value.trim()),console.log("自定义文件名:",M.value.trim()));const F=await ue.uploadMaterial(d);F.code===200?(k.success("上传成功"),b.value=!1,await T()):k.error(F.msg||"上传失败")}catch(d){console.error("上传素材出错:",d),k.error("上传失败: "+(d.message||"未知错误"))}finally{_.value=!1}},h=async U=>{$.value=null,u.value=!0,k.info("加载中...");try{await new Promise(d=>setTimeout(d,100)),$.value=U}catch(d){console.error("预览素材出错:",d),k.error("预览加载失败"),u.value=!1}},W=U=>{fe.confirm(`确定要删除素材 ${U.filename} 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const d=await ue.deleteMaterial(U.id);d.code===200?(i.removeMaterial(U.id),k.success("删除成功")):k.error(d.msg||"删除失败")}catch(d){console.error("删除素材出错:",d),k.error("删除失败")}}).catch(()=>{})},P=U=>{const d=U.split("/").pop();return ue.getMaterialPreviewUrl(d)},z=U=>{const d=ue.downloadMaterial(U.file_path);window.open(d,"_blank")},K=U=>[".mp4",".avi",".mov",".wmv",".flv",".mkv"].some(F=>U.toLowerCase().endsWith(F)),H=U=>[".jpg",".jpeg",".png",".gif",".bmp",".webp"].some(F=>U.toLowerCase().endsWith(F));return Ce(()=>{i.materials.length===0&&T()}),(U,d)=>{const F=m("el-input"),j=m("el-button"),Y=m("el-icon"),ae=m("el-table-column"),g=m("el-table"),w=m("el-empty"),y=m("el-form-item"),s=m("el-upload"),R=m("el-form"),x=m("el-dialog");return r(),A("div",Nl,[d[14]||(d[14]=l("div",{class:"page-header"},[l("h1",null,"素材管理")],-1)),l("div",Kl,[l("div",jl,[e(F,{modelValue:n.value,"onUpdate:modelValue":d[0]||(d[0]=N=>n.value=N),placeholder:"输入文件名搜索","prefix-icon":"Search",clearable:"",onClear:q,onInput:q},null,8,["modelValue"]),l("div",Hl,[e(j,{type:"primary",onClick:V},{default:t(()=>[...d[6]||(d[6]=[v("上传素材",-1)])]),_:1}),e(j,{type:"info",onClick:T,loading:!1},{default:t(()=>[e(Y,{class:ne({"is-loading":p.value})},{default:t(()=>[e(I(re))]),_:1},8,["class"]),p.value?(r(),A("span",Wl,"刷新中")):G("",!0)]),_:1})])]),L.value.length>0?(r(),A("div",Xl,[e(g,{data:L.value,style:{width:"100%"}},{default:t(()=>[e(ae,{prop:"filename",label:"文件名",width:"300"}),e(ae,{prop:"filesize",label:"文件大小",width:"120"},{default:t(N=>[v(S(N.row.filesize)+" MB ",1)]),_:1}),e(ae,{prop:"upload_time",label:"上传时间",width:"180"}),e(ae,{label:"操作"},{default:t(N=>[e(j,{size:"small",onClick:f=>h(N.row)},{default:t(()=>[...d[7]||(d[7]=[v("预览",-1)])]),_:1},8,["onClick"]),e(j,{size:"small",type:"danger",onClick:f=>W(N.row)},{default:t(()=>[...d[8]||(d[8]=[v("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(r(),A("div",Gl,[e(w,{description:"暂无素材数据"})]))]),e(x,{modelValue:b.value,"onUpdate:modelValue":d[3]||(d[3]=N=>b.value=N),title:"上传素材",width:"40%",onClose:o},{footer:t(()=>[l("div",Ql,[e(j,{onClick:d[2]||(d[2]=N=>b.value=!1)},{default:t(()=>[...d[11]||(d[11]=[v("取消",-1)])]),_:1}),e(j,{type:"primary",onClick:D,loading:_.value},{default:t(()=>[v(S(_.value?"上传中":"确认上传"),1)]),_:1},8,["loading"])])]),default:t(()=>[l("div",Jl,[e(R,{"label-width":"80px"},{default:t(()=>[e(y,{label:"文件名称:"},{default:t(()=>[e(F,{modelValue:M.value,"onUpdate:modelValue":d[1]||(d[1]=N=>M.value=N),placeholder:"选填",clearable:""},null,8,["modelValue"])]),_:1}),e(y,{label:"选择文件"},{default:t(()=>[e(s,{class:"upload-demo",drag:"","auto-upload":!1,"on-change":E,"file-list":C.value,limit:1},{tip:t(()=>[...d[9]||(d[9]=[l("div",{class:"el-upload__tip"}," 支持视频、图片等格式文件，只能上传一个文件 ",-1)])]),default:t(()=>[e(Y,{class:"el-icon--upload"},{default:t(()=>[e(I(me))]),_:1}),d[10]||(d[10]=l("div",{class:"el-upload__text"},[v(" 将文件拖到此处，或"),l("em",null,"点击上传")],-1))]),_:1},8,["file-list"])]),_:1})]),_:1})])]),_:1},8,["modelValue"]),e(x,{modelValue:u.value,"onUpdate:modelValue":d[5]||(d[5]=N=>u.value=N),title:"素材预览",width:"50%",top:"10vh"},{default:t(()=>[$.value?(r(),A("div",Yl,[K($.value.filename)?(r(),A("div",Zl,[l("video",ea,[l("source",{src:P($.value.file_path),type:"video/mp4"},null,8,ta),d[12]||(d[12]=v(" 您的浏览器不支持视频播放 ",-1))])])):H($.value.filename)?(r(),A("div",la,[l("img",{src:P($.value.file_path),style:{"max-width":"100%","max-height":"60vh"}},null,8,aa)])):(r(),A("div",sa,[l("p",null,"文件名: "+S($.value.filename),1),l("p",null,"文件大小: "+S($.value.filesize)+" MB",1),l("p",null,"上传时间: "+S($.value.upload_time),1),e(j,{type:"primary",onClick:d[4]||(d[4]=N=>z($.value))},{default:t(()=>[...d[13]||(d[13]=[v("下载文件",-1)])]),_:1})]))])):G("",!0)]),_:1},8,["modelValue"])])}}},na=ee(oa,[["__scopeId","data-v-3d75da5e"]]),we={DOUYIN:{key:3,name:"抖音",titleLimit:30,topicLimit:5,titlePlaceholder:"请输入标题（最多30字）",topicPlaceholder:"最多可添加5个话题"},KUAISHOU:{key:4,name:"快手",titleLimit:30,topicLimit:3,titlePlaceholder:"请输入标题（最多30字）",topicPlaceholder:"最多可添加3个话题"},WEIXIN:{key:2,name:"视频号",titleLimit:16,topicLimit:20,titlePlaceholder:"请输入标题（最多16字）",topicPlaceholder:"最多可添加20个话题"},XIAOHONGSHU:{key:1,name:"小红书",titleLimit:20,topicLimit:10,titlePlaceholder:"请输入标题（最多20字）",topicPlaceholder:"最多可添加10个话题"}};function ve(a){return Object.values(we).find(i=>i.key===a)||we.XIAOHONGSHU}function ia(){return Object.values(we)}function ke(a,i){const n=ve(i);return!a||!a.trim()?{valid:!1,message:"请输入标题"}:a.length>n.titleLimit?{valid:!1,message:`标题不能超过${n.titleLimit}字，当前${a.length}字`}:{valid:!0,message:""}}function Ve(a,i){const n=ve(i);return Array.isArray(a)?a.length>n.topicLimit?{valid:!1,message:`最多只能添加${n.topicLimit}个话题，当前${a.length}个`}:{valid:!0,message:""}:{valid:!1,message:"话题格式错误"}}function ua(a){return!a||!a.trim()?{valid:!1,message:"话题内容不能为空"}:a.length>20?{valid:!1,message:"单个话题不能超过20字"}:/[<>{}[\]()&$#@!%^*+=|\\/]/g.test(a)?{valid:!1,message:"话题不能包含特殊字符"}:{valid:!0,message:""}}function da(a){const i={};let n=!0;(!a.fileList||a.fileList.length===0)&&(i.fileList="请先上传视频文件",n=!1);const p=ke(a.title,a.selectedPlatform);p.valid||(i.title=p.message,n=!1),a.selectedPlatform||(i.platform="请选择发布平台",n=!1),(!a.selectedAccounts||a.selectedAccounts.length===0)&&(i.accounts="请选择发布账号",n=!1);const _=Ve(a.selectedTopics,a.selectedPlatform);return _.valid||(i.topics=_.message,n=!1),a.scheduleEnabled&&((!a.videosPerDay||a.videosPerDay<1||a.videosPerDay>55)&&(i.videosPerDay="每天发布视频数必须在1-55之间",n=!1),(!a.dailyTimes||a.dailyTimes.length===0)&&(i.dailyTimes="请设置发布时间",n=!1),a.dailyTimes&&a.dailyTimes.length!==a.videosPerDay&&(i.dailyTimes="发布时间数量必须与每天发布视频数一致",n=!1),(a.startDays===void 0||a.startDays<0)&&(i.startDays="请选择开始天数",n=!1)),{valid:n,errors:i}}const ra={class:"tab-management"},ca={class:"tab-header"},pa={class:"tab-list"},ma=["onClick"],fa={class:"tab-actions"},va={__name:"TabManagement",props:{tabs:{type:Array,required:!0},activeTab:{type:String,required:!0},batchPublishing:{type:Boolean,default:!1}},emits:["tab-change","remove-tab","add-tab","batch-publish"],setup(a){return(i,n)=>{const p=m("el-icon"),_=m("el-button");return r(),A("div",ra,[l("div",ca,[l("div",pa,[(r(!0),A(te,null,le(a.tabs,b=>(r(),A("div",{key:b.name,class:ne(["tab-item",{active:a.activeTab===b.name}]),onClick:u=>i.$emit("tab-change",b.name)},[l("span",null,S(b.label),1),a.tabs.length>1?(r(),J(p,{key:0,class:"close-icon",onClick:Be(u=>i.$emit("remove-tab",b.name),["stop"])},{default:t(()=>[e(I(Me))]),_:1},8,["onClick"])):G("",!0)],10,ma))),128))]),l("div",fa,[e(_,{type:"primary",size:"small",onClick:n[0]||(n[0]=b=>i.$emit("add-tab")),class:"add-tab-btn"},{default:t(()=>[e(p,null,{default:t(()=>[e(I(ot))]),_:1}),n[2]||(n[2]=v(" 添加Tab ",-1))]),_:1}),e(_,{type:"success",size:"small",onClick:n[1]||(n[1]=b=>i.$emit("batch-publish")),loading:a.batchPublishing,class:"batch-publish-btn"},{default:t(()=>[...n[3]||(n[3]=[v(" 批量发布 ",-1)])]),_:1},8,["loading"])])])])}}},_a=ee(va,[["__scopeId","data-v-7584dadb"]]),ga={class:"upload-section"},ya={class:"upload-options"},ha={key:0,class:"uploaded-files"},ba={class:"file-list"},$a={class:"file-size"},wa={class:"upload-options-content"},ka={class:"material-library-content"},Va={class:"material-list"},Ca={class:"material-info"},Aa={class:"material-name"},Ta={class:"material-details"},xa={class:"file-size"},Pa={class:"upload-time"},Sa={class:"dialog-footer"},Ma={__name:"VideoUpload",props:{fileList:{type:Array,default:()=>[]},uploadAction:{type:String,required:!0},authHeaders:{type:Object,required:!0},materials:{type:Array,default:()=>[]}},emits:["show-upload-options","remove-file","upload-success","material-selected"],setup(a,{expose:i,emit:n}){const p=a,_=n,b=be(),u=O(!1),$=O(!1),C=O(!1),M=O([]),T=()=>{u.value=!1,$.value=!0},L=async()=>{if(u.value=!1,p.materials.length===0)try{const D=await ue.getAllMaterials();if(D.code===200)b.setMaterials(D.data);else{k.error("获取素材列表失败");return}}catch(D){console.error("获取素材列表出错:",D),k.error("获取素材列表失败");return}M.value=[],C.value=!0},q=(D,h)=>{D.code===200?(_("upload-success",D,h),$.value=!1,k.success("文件上传成功")):k.error(D.msg||"上传失败")},V=D=>{k.error("文件上传失败"),console.error("上传错误:",D)},o=()=>{if(M.value.length===0){k.warning("请选择至少一个素材");return}_("material-selected",M.value);const D=M.value.length;C.value=!1,M.value=[],k.success(`已添加 ${D} 个素材`)},E=()=>{u.value=!0};return i({showUploadOptions:E}),(D,h)=>{const W=m("el-icon"),P=m("el-button"),z=m("el-link"),K=m("el-dialog"),H=m("el-upload"),U=m("el-checkbox"),d=m("el-checkbox-group");return r(),A("div",ga,[h[14]||(h[14]=l("h3",null,"视频",-1)),l("div",ya,[e(P,{type:"primary",onClick:E,class:"upload-btn"},{default:t(()=>[e(W,null,{default:t(()=>[e(I(me))]),_:1}),h[5]||(h[5]=v(" 上传视频 ",-1))]),_:1})]),a.fileList.length>0?(r(),A("div",ha,[h[7]||(h[7]=l("h4",null,"已上传文件：",-1)),l("div",ba,[(r(!0),A(te,null,le(a.fileList,(F,j)=>(r(),A("div",{key:j,class:"file-item"},[e(z,{href:F.url,target:"_blank",type:"primary"},{default:t(()=>[v(S(F.name),1)]),_:2},1032,["href"]),l("span",$a,S((F.size/1024/1024).toFixed(2))+"MB",1),e(P,{type:"danger",size:"small",onClick:Y=>D.$emit("remove-file",j)},{default:t(()=>[...h[6]||(h[6]=[v("删除",-1)])]),_:1},8,["onClick"])]))),128))])])):G("",!0),e(K,{modelValue:u.value,"onUpdate:modelValue":h[0]||(h[0]=F=>u.value=F),title:"选择上传方式",width:"400px",class:"upload-options-dialog"},{default:t(()=>[l("div",wa,[e(P,{type:"primary",onClick:T,class:"option-btn"},{default:t(()=>[e(W,null,{default:t(()=>[e(I(me))]),_:1}),h[8]||(h[8]=v(" 本地上传 ",-1))]),_:1}),e(P,{type:"success",onClick:L,class:"option-btn"},{default:t(()=>[e(W,null,{default:t(()=>[e(I(nt))]),_:1}),h[9]||(h[9]=v(" 素材库 ",-1))]),_:1})])]),_:1},8,["modelValue"]),e(K,{modelValue:$.value,"onUpdate:modelValue":h[1]||(h[1]=F=>$.value=F),title:"本地上传",width:"600px",class:"local-upload-dialog"},{default:t(()=>[e(H,{class:"video-upload",drag:"","auto-upload":!0,action:a.uploadAction,"on-success":q,"on-error":V,multiple:"",accept:"video/*",headers:a.authHeaders},{tip:t(()=>[...h[10]||(h[10]=[l("div",{class:"el-upload__tip"}," 支持MP4、AVI等视频格式，可上传多个文件 ",-1)])]),default:t(()=>[e(W,{class:"el-icon--upload"},{default:t(()=>[e(I(me))]),_:1}),h[11]||(h[11]=l("div",{class:"el-upload__text"},[v(" 将视频文件拖到此处，或"),l("em",null,"点击上传")],-1))]),_:1},8,["action","headers"])]),_:1},8,["modelValue"]),e(K,{modelValue:C.value,"onUpdate:modelValue":h[4]||(h[4]=F=>C.value=F),title:"选择素材",width:"800px",class:"material-library-dialog"},{footer:t(()=>[l("div",Sa,[e(P,{onClick:h[3]||(h[3]=F=>C.value=!1)},{default:t(()=>[...h[12]||(h[12]=[v("取消",-1)])]),_:1}),e(P,{type:"primary",onClick:o},{default:t(()=>[...h[13]||(h[13]=[v("确定",-1)])]),_:1})])]),default:t(()=>[l("div",ka,[e(d,{modelValue:M.value,"onUpdate:modelValue":h[2]||(h[2]=F=>M.value=F)},{default:t(()=>[l("div",Va,[(r(!0),A(te,null,le(a.materials,F=>(r(),A("div",{key:F.id,class:"material-item"},[e(U,{label:F.id,class:"material-checkbox"},{default:t(()=>[l("div",Ca,[l("div",Aa,S(F.filename),1),l("div",Ta,[l("span",xa,S(F.filesize)+"MB",1),l("span",Pa,S(F.upload_time),1)])])]),_:2},1032,["label"])]))),128))])]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"])])}}},Ua=ee(Ma,[["__scopeId","data-v-a4989d91"]]),La={class:"platform-section"},Ia={key:0,class:"platform-tips"},Ea={__name:"PlatformSelection",props:{modelValue:{type:Number,required:!0}},emits:["update:modelValue","platform-change"],setup(a,{emit:i}){const n=a,p=i,_=ia(),b=X({get:()=>n.modelValue,set:C=>p("update:modelValue",C)}),u=X(()=>ve(n.modelValue)),$=C=>{p("platform-change",C)};return(C,M)=>{const T=m("el-radio"),L=m("el-radio-group"),q=m("el-alert");return r(),A("div",La,[M[1]||(M[1]=l("h3",null,"平台",-1)),e(L,{modelValue:b.value,"onUpdate:modelValue":M[0]||(M[0]=V=>b.value=V),onChange:$,class:"platform-radios"},{default:t(()=>[(r(!0),A(te,null,le(I(_),V=>(r(),J(T,{key:V.key,label:V.key,class:"platform-radio"},{default:t(()=>[v(S(V.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"]),u.value?(r(),A("div",Ia,[e(q,{title:`${u.value.name}平台限制：标题最多${u.value.titleLimit}字，话题最多${u.value.topicLimit}个`,type:"info",closable:!1,"show-icon":"",class:"platform-alert"},null,8,["title"])])):G("",!0)])}}},za=ee(Ea,[["__scopeId","data-v-4ae792d5"]]),Da={class:"account-section"},Fa={class:"account-display"},Oa={class:"selected-accounts"},Ra={class:"account-dialog-content"},Ba={class:"account-list"},qa={class:"account-info"},Na={class:"account-name"},Ka={class:"dialog-footer"},ja={__name:"AccountSelection",props:{modelValue:{type:Array,default:()=>[]},platformKey:{type:Number,required:!0}},emits:["update:modelValue"],setup(a,{emit:i}){const n=a,p=i,_=Ae(),b=X({get:()=>n.modelValue,set:V=>p("update:modelValue",V)}),u=O(!1),$=O([]),C=X(()=>{const o={3:"抖音",2:"视频号",1:"小红书",4:"快手"}[n.platformKey];return o?_.accounts.filter(E=>E.platform===o):[]}),M=()=>{$.value=[...b.value],u.value=!0},T=()=>{b.value=[...$.value],u.value=!1,k.success("账号选择完成")},L=V=>{b.value.splice(V,1)},q=V=>{const o=_.accounts.find(E=>E.id===V);return o?o.name:V};return(V,o)=>{const E=m("el-tag"),D=m("el-button"),h=m("el-checkbox"),W=m("el-checkbox-group"),P=m("el-dialog");return r(),A("div",Da,[o[6]||(o[6]=l("h3",null,"账号",-1)),l("div",Fa,[l("div",Oa,[(r(!0),A(te,null,le(b.value,(z,K)=>(r(),J(E,{key:K,closable:"",onClose:H=>L(K),class:"account-tag"},{default:t(()=>[v(S(q(z)),1)]),_:2},1032,["onClose"]))),128))]),e(D,{type:"primary",plain:"",onClick:M,class:"select-account-btn"},{default:t(()=>[...o[3]||(o[3]=[v(" 选择账号 ",-1)])]),_:1})]),e(P,{modelValue:u.value,"onUpdate:modelValue":o[2]||(o[2]=z=>u.value=z),title:"选择账号",width:"600px",class:"account-dialog"},{footer:t(()=>[l("div",Ka,[e(D,{onClick:o[1]||(o[1]=z=>u.value=!1)},{default:t(()=>[...o[4]||(o[4]=[v("取消",-1)])]),_:1}),e(D,{type:"primary",onClick:T},{default:t(()=>[...o[5]||(o[5]=[v("确定",-1)])]),_:1})])]),default:t(()=>[l("div",Ra,[e(W,{modelValue:$.value,"onUpdate:modelValue":o[0]||(o[0]=z=>$.value=z)},{default:t(()=>[l("div",Ba,[(r(!0),A(te,null,le(C.value,z=>(r(),J(h,{key:z.id,label:z.id,class:"account-item"},{default:t(()=>[l("div",qa,[l("span",Na,S(z.name),1)])]),_:2},1032,["label"]))),128))])]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"])])}}},Ha=ee(ja,[["__scopeId","data-v-7cdefdfd"]]),Wa={class:"title-section"},Xa={key:0,class:"error-message"},Ga={__name:"TitleInput",props:{modelValue:{type:String,default:""},platformKey:{type:Number,required:!0},validateOnInput:{type:Boolean,default:!0}},emits:["update:modelValue","validation-change"],setup(a,{expose:i,emit:n}){const p=a,_=n,b=X(()=>ve(p.platformKey)),u=X({get:()=>p.modelValue,set:q=>_("update:modelValue",q)}),$=X(()=>b.value.titlePlaceholder),C=X(()=>b.value.titleLimit),M=O(""),T=q=>{if(p.validateOnInput){const V=ke(q,p.platformKey);M.value=V.valid?"":V.message,_("validation-change",V)}};return i({validate:()=>{const q=ke(p.modelValue,p.platformKey);return M.value=q.valid?"":q.message,_("validation-change",q),q}}),(q,V)=>{const o=m("el-input"),E=m("el-alert");return r(),A("div",Wa,[V[1]||(V[1]=l("h3",null,"标题",-1)),e(o,{modelValue:u.value,"onUpdate:modelValue":V[0]||(V[0]=D=>u.value=D),type:"textarea",rows:3,placeholder:$.value,maxlength:C.value,"show-word-limit":"",class:"title-input",onInput:T},null,8,["modelValue","placeholder","maxlength"]),M.value?(r(),A("div",Xa,[e(E,{title:M.value,type:"error",closable:!1,"show-icon":"",class:"error-alert"},null,8,["title"])])):G("",!0)])}}},Ja=ee(Ga,[["__scopeId","data-v-f75530ea"]]),Qa={class:"topic-section"},Ya={class:"topic-display"},Za={class:"selected-topics"},es={key:0,class:"topic-tips"},ts={key:1,class:"error-message"},ls={class:"topic-dialog-content"},as={class:"custom-topic-input"},ss={class:"recommended-topics"},os={class:"topic-grid"},ns={class:"dialog-footer"},is={__name:"TopicInput",props:{modelValue:{type:Array,default:()=>[]},platformKey:{type:Number,required:!0},validateOnInput:{type:Boolean,default:!0}},emits:["update:modelValue","validation-change"],setup(a,{expose:i,emit:n}){const p=a,_=n,b=X(()=>ve(p.platformKey)),u=X({get:()=>p.modelValue,set:P=>_("update:modelValue",P)}),$=X(()=>u.value.length>=b.value.topicLimit),C=O(""),M=O(!1),T=O(""),L=["游戏","知识","自动化","系统平台","自媒体工具","跨境电商","科技","教程","云手机平台","云电脑平台","脚本","开源","健康","时尚","美妆","摄影","宠物","汽车"],q=()=>{if($.value){k.warning(`最多只能添加${b.value.topicLimit}个话题`);return}M.value=!0},V=()=>{if(!T.value.trim()){k.warning("请输入话题内容");return}const P=ua(T.value.trim());if(!P.valid){k.error(P.message);return}if($.value){k.warning(`最多只能添加${b.value.topicLimit}个话题`);return}u.value.includes(T.value.trim())?k.warning("话题已存在"):(u.value.push(T.value.trim()),T.value="",k.success("话题添加成功"),h())},o=P=>{if($.value&&!u.value.includes(P)){k.warning(`最多只能添加${b.value.topicLimit}个话题`);return}const z=u.value.indexOf(P);z>-1?u.value.splice(z,1):u.value.push(P),h()},E=P=>{u.value.splice(P,1),h()},D=()=>{M.value=!1,T.value="",k.success("添加话题完成")},h=()=>{if(p.validateOnInput){const P=Ve(u.value,p.platformKey);C.value=P.valid?"":P.message,_("validation-change",P)}};return i({validate:()=>{const P=Ve(p.modelValue,p.platformKey);return C.value=P.valid?"":P.message,_("validation-change",P),P}}),(P,z)=>{const K=m("el-tag"),H=m("el-button"),U=m("el-alert"),d=m("el-input"),F=m("el-dialog");return r(),A("div",Qa,[z[9]||(z[9]=l("h3",null,"话题",-1)),l("div",Ya,[l("div",Za,[(r(!0),A(te,null,le(u.value,(j,Y)=>(r(),J(K,{key:Y,closable:"",onClose:ae=>E(Y),class:"topic-tag"},{default:t(()=>[v(" #"+S(j),1)]),_:2},1032,["onClose"]))),128))]),e(H,{type:"primary",plain:"",onClick:q,class:"select-topic-btn",disabled:$.value},{default:t(()=>[...z[3]||(z[3]=[v(" 添加话题 ",-1)])]),_:1},8,["disabled"])]),b.value?(r(),A("div",es,[e(U,{title:`已添加 ${u.value.length}/${b.value.topicLimit} 个话题`,type:$.value?"warning":"info",closable:!1,"show-icon":"",class:"topic-alert"},null,8,["title","type"])])):G("",!0),C.value?(r(),A("div",ts,[e(U,{title:C.value,type:"error",closable:!1,"show-icon":"",class:"error-alert"},null,8,["title"])])):G("",!0),e(F,{modelValue:M.value,"onUpdate:modelValue":z[2]||(z[2]=j=>M.value=j),title:"添加话题",width:"600px",class:"topic-dialog"},{footer:t(()=>[l("div",ns,[e(H,{onClick:z[1]||(z[1]=j=>M.value=!1)},{default:t(()=>[...z[7]||(z[7]=[v("取消",-1)])]),_:1}),e(H,{type:"primary",onClick:D},{default:t(()=>[...z[8]||(z[8]=[v("确定",-1)])]),_:1})])]),default:t(()=>[l("div",ls,[l("div",as,[e(d,{modelValue:T.value,"onUpdate:modelValue":z[0]||(z[0]=j=>T.value=j),placeholder:"输入自定义话题",class:"custom-input",onKeyup:qe(V,["enter"])},{prepend:t(()=>[...z[4]||(z[4]=[v("#",-1)])]),_:1},8,["modelValue"]),e(H,{type:"primary",onClick:V},{default:t(()=>[...z[5]||(z[5]=[v("添加",-1)])]),_:1})]),l("div",ss,[z[6]||(z[6]=l("h4",null,"推荐话题",-1)),l("div",os,[(r(),A(te,null,le(L,j=>e(H,{key:j,type:u.value.includes(j)?"primary":"default",onClick:Y=>o(j),class:"topic-btn",disabled:u.value.includes(j)&&$.value},{default:t(()=>[v(S(j),1)]),_:2},1032,["type","onClick","disabled"])),64))])])])]),_:1},8,["modelValue"])])}}},us=ee(is,[["__scopeId","data-v-b3973a1b"]]),ds={class:"schedule-section"},rs={class:"schedule-controls"},cs={key:0,class:"schedule-settings"},ps={class:"schedule-item"},ms={class:"schedule-item"},fs={class:"time-selectors"},vs={class:"schedule-item"},_s={__name:"ScheduleSettings",props:{scheduleEnabled:{type:Boolean,default:!1},videosPerDay:{type:Number,default:1},dailyTimes:{type:Array,default:()=>["10:00"]},startDays:{type:Number,default:0}},emits:["update:scheduleEnabled","update:videosPerDay","update:dailyTimes","update:startDays"],setup(a,{emit:i}){const n=a,p=i,_=X({get:()=>n.scheduleEnabled,set:T=>p("update:scheduleEnabled",T)}),b=X({get:()=>n.videosPerDay,set:T=>p("update:videosPerDay",T)}),u=X({get:()=>n.dailyTimes,set:T=>p("update:dailyTimes",T)}),$=X({get:()=>n.startDays,set:T=>p("update:startDays",T)}),C=T=>{T||(p("update:videosPerDay",1),p("update:dailyTimes",["10:00"]),p("update:startDays",0))},M=()=>{if(u.value.length<b.value){const T=[...u.value,"10:00"];p("update:dailyTimes",T)}};return(T,L)=>{const q=m("el-switch"),V=m("el-option"),o=m("el-select"),E=m("el-time-select"),D=m("el-button");return r(),A("div",ds,[L[7]||(L[7]=l("h3",null,"定时发布",-1)),l("div",rs,[e(q,{modelValue:_.value,"onUpdate:modelValue":L[0]||(L[0]=h=>_.value=h),"active-text":"定时发布","inactive-text":"立即发布",onChange:C},null,8,["modelValue"]),_.value?(r(),A("div",cs,[l("div",ps,[L[3]||(L[3]=l("span",{class:"label"},"每天发布视频数：",-1)),e(o,{modelValue:b.value,"onUpdate:modelValue":L[1]||(L[1]=h=>b.value=h),placeholder:"选择发布数量"},{default:t(()=>[(r(),A(te,null,le(55,h=>e(V,{key:h,label:h,value:h},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),l("div",ms,[L[5]||(L[5]=l("span",{class:"label"},"每天发布时间：",-1)),l("div",fs,[(r(!0),A(te,null,le(u.value,(h,W)=>(r(),J(E,{key:W,modelValue:u.value[W],"onUpdate:modelValue":P=>u.value[W]=P,start:"00:00",step:"00:30",end:"23:30",placeholder:"选择时间"},null,8,["modelValue","onUpdate:modelValue"]))),128)),u.value.length<b.value?(r(),J(D,{key:0,type:"primary",size:"small",onClick:M},{default:t(()=>[...L[4]||(L[4]=[v(" 添加时间 ",-1)])]),_:1})):G("",!0)])]),l("div",vs,[L[6]||(L[6]=l("span",{class:"label"},"开始天数：",-1)),e(o,{modelValue:$.value,"onUpdate:modelValue":L[2]||(L[2]=h=>$.value=h),placeholder:"选择开始天数"},{default:t(()=>[e(V,{label:"明天",value:0}),e(V,{label:"后天",value:1})]),_:1},8,["modelValue"])])])):G("",!0)])])}}},gs=ee(_s,[["__scopeId","data-v-7e1e15aa"]]),ys={class:"publish-center"},hs={class:"publish-content"},bs={class:"tab-content-wrapper"},$s={key:0,class:"publish-status"},ws={class:"action-buttons"},ks={class:"publish-progress"},Vs={key:0,class:"current-publishing"},Cs={key:1,class:"publish-results"},As={class:"label"},Ts={class:"message"},xs={class:"dialog-footer"},Ps={__name:"PublishCenter",setup(a){const i="http://localhost:5409",n=X(()=>({Authorization:`Bearer ${localStorage.getItem("token")||""}`})),p=O("tab1");let _=1;const b=be(),u=Ae(),$=X(()=>b.materials),C={1:"小红书",2:"视频号",3:"抖音",4:"快手"},M=O(!1);Ce(async()=>{try{const g=await ye.getValidAccounts({validate:0});g&&g.code===200&&Array.isArray(g.data)&&u.setAccounts(g.data)}catch(g){console.warn("初始化获取账号失败",g)}});const T=pe([{name:"tab1",label:C[1],fileList:[],displayFileList:[],selectedAccounts:[],selectedPlatform:1,title:"",selectedTopics:[],scheduleEnabled:!1,videosPerDay:1,dailyTimes:["10:00"],startDays:0,publishStatus:null,validationErrors:{}}]),L=O(!1),q=O(null),V=O(0),o=O([]),E=O(!1),D=()=>{_++;const g={name:`tab${_}`,label:C[1],fileList:[],displayFileList:[],selectedAccounts:[],selectedPlatform:1,title:"",selectedTopics:[],scheduleEnabled:!1,videosPerDay:1,dailyTimes:["10:00"],startDays:0,publishStatus:null,validationErrors:{}};T.push(g),p.value=g.name},h=g=>{const w=T.findIndex(y=>y.name===g);w>-1&&(T.splice(w,1),p.value===g&&T.length>0&&(p.value=T[0].name))},W=g=>{const w=T.find(y=>y.name===p.value);w&&(w.selectedAccounts=[],U(w))},P=(g,w,y)=>{w.valid?delete y.validationErrors[g]:y.validationErrors[g]=w.message},z=(g,w,y)=>{if(g.code===200){const s=g.data.path||g.data,R=s.split("/").pop(),x={name:w.name,url:ue.getMaterialPreviewUrl(R),path:s,size:w.size,type:w.type};y.fileList.push(x),y.displayFileList=[...y.fileList.map(N=>({name:N.name,url:N.url}))],k.success("文件上传成功"),console.log("上传成功:",x)}else k.error(g.msg||"上传失败")},K=(g,w)=>{g.forEach(y=>{const s=$.value.find(R=>R.id===y);if(s){const R={name:s.filename,url:ue.getMaterialPreviewUrl(s.file_path.split("/").pop()),path:s.file_path,size:s.filesize*1024*1024,type:"video/mp4"};w.fileList.some(N=>N.path===R.path)||w.fileList.push(R)}}),w.displayFileList=[...w.fileList.map(y=>({name:y.name,url:y.url}))]},H=(g,w)=>{g.fileList.splice(w,1),g.displayFileList=[...g.fileList.map(y=>({name:y.name,url:y.url}))],k.success("文件删除成功")},U=g=>{const w=C[g.selectedPlatform],y=g.selectedAccounts||[];if(w&&y.length>0){const s=u.accounts.find(x=>x.id===y[0]),R=(s==null?void 0:s.name)||"";g.label=R?`${w}_${R}`:`${w}`}else if(w)g.label=w;else{const s=T.findIndex(R=>R.name===g.name);g.label=`发布${s+1}`}};Ne(T,()=>{T.forEach(U)},{deep:!0});const d=g=>{k.info("已取消发布")},F=async g=>new Promise((w,y)=>{const s=da(g);if(!s.valid){const x=Object.values(s.errors)[0];k.error(x),y(new Error(x));return}const R={type:g.selectedPlatform,title:g.title,tags:g.selectedTopics,fileList:g.fileList.map(x=>x.path),accountList:g.selectedAccounts.map(x=>{const N=u.accounts.find(f=>f.id===x);return N?N.filePath:x}),enableTimer:g.scheduleEnabled?1:0,videosPerDay:g.scheduleEnabled&&g.videosPerDay||1,dailyTimes:g.scheduleEnabled?g.dailyTimes||["10:00"]:["10:00"],startDays:g.scheduleEnabled&&g.startDays||0,category:0};fetch(`${i}/postVideo`,{method:"POST",headers:{"Content-Type":"application/json",...n.value},body:JSON.stringify(R)}).then(x=>x.json()).then(x=>{x.code===200?(g.publishStatus={message:"发布成功",type:"success"},g.fileList=[],g.displayFileList=[],g.title="",g.selectedTopics=[],g.selectedAccounts=[],g.scheduleEnabled=!1,g.validationErrors={},w()):(g.publishStatus={message:`发布失败：${x.msg||"发布失败"}`,type:"error"},y(new Error(x.msg||"发布失败")))}).catch(x=>{console.error("发布错误:",x),g.publishStatus={message:"发布失败，请检查网络连接",type:"error"},y(x)})}),j=()=>{const g=[];return T.forEach(w=>{const y=[];(!w.fileList||w.fileList.length===0)&&y.push("未上传视频"),(!w.selectedAccounts||w.selectedAccounts.length===0)&&y.push("未选择账号"),y.length&&g.push({tab:w,message:`${w.label}: ${y.join("、")}`})}),g},Y=async()=>{if(M.value)return;const g=j();if(g.length>0){p.value=g[0].tab.name,g[0].tab.publishStatus={message:g[0].message,type:"error"};try{await fe.alert(g.map(w=>w.message).join(`
`),"请完善发布项后再批量发布",{confirmButtonText:"好的"})}catch{}k.error("存在未准备完成的发布项：请为每个发布项上传视频并选择账号");return}M.value=!0,q.value=null,V.value=0,o.value=[],E.value=!1,L.value=!0;try{for(let R=0;R<T.length;R++){if(E.value){o.value.push({label:T[R].label,status:"cancelled",message:"已取消"});continue}const x=T[R];q.value=x,V.value=Math.floor(R/T.length*100);try{await F(x),o.value.push({label:x.label,status:"success",message:"发布成功"})}catch(N){o.value.push({label:x.label,status:"error",message:N.message})}}V.value=100;const w=o.value.filter(R=>R.status==="success").length,y=o.value.filter(R=>R.status==="error").length,s=o.value.filter(R=>R.status==="cancelled").length;E.value?k.warning(`发布已取消：${w}个成功，${y}个失败，${s}个未执行`):y>0?k.error(`发布完成：${w}个成功，${y}个失败`):(k.success("所有Tab发布成功"),setTimeout(()=>{L.value=!1},1e3))}catch(w){console.error("批量发布出错:",w),k.error("批量发布出错，请重试")}finally{M.value=!1,E.value=!1}},ae=()=>{E.value=!0,k.info("正在取消发布...")};return(g,w)=>{const y=m("el-alert"),s=m("el-button"),R=m("el-progress"),x=m("el-icon"),N=m("el-dialog");return r(),A("div",ys,[e(_a,{tabs:T,"active-tab":p.value,"batch-publishing":M.value,onTabChange:w[0]||(w[0]=f=>p.value=f),onRemoveTab:h,onAddTab:D,onBatchPublish:Y},null,8,["tabs","active-tab","batch-publishing"]),l("div",hs,[l("div",bs,[(r(!0),A(te,null,le(T,f=>he((r(),A("div",{key:f.name,class:"tab-content"},[f.publishStatus?(r(),A("div",$s,[e(y,{title:f.publishStatus.message,type:f.publishStatus.type,closable:!1,"show-icon":""},null,8,["title","type"])])):G("",!0),e(Ua,{"file-list":f.fileList,"upload-action":`${I(i)}/upload`,"auth-headers":n.value,materials:$.value,onRemoveFile:B=>H(f,B),onUploadSuccess:(B,Z)=>z(B,Z,f),onMaterialSelected:B=>K(B,f)},null,8,["file-list","upload-action","auth-headers","materials","onRemoveFile","onUploadSuccess","onMaterialSelected"]),e(za,{modelValue:f.selectedPlatform,"onUpdate:modelValue":B=>f.selectedPlatform=B,onPlatformChange:W},null,8,["modelValue","onUpdate:modelValue"]),e(Ha,{modelValue:f.selectedAccounts,"onUpdate:modelValue":B=>f.selectedAccounts=B,"platform-key":f.selectedPlatform},null,8,["modelValue","onUpdate:modelValue","platform-key"]),e(Ja,{modelValue:f.title,"onUpdate:modelValue":B=>f.title=B,"platform-key":f.selectedPlatform,onValidationChange:B=>P("title",B,f)},null,8,["modelValue","onUpdate:modelValue","platform-key","onValidationChange"]),e(us,{modelValue:f.selectedTopics,"onUpdate:modelValue":B=>f.selectedTopics=B,"platform-key":f.selectedPlatform,onValidationChange:B=>P("topics",B,f)},null,8,["modelValue","onUpdate:modelValue","platform-key","onValidationChange"]),e(gs,{"schedule-enabled":f.scheduleEnabled,"onUpdate:scheduleEnabled":B=>f.scheduleEnabled=B,"videos-per-day":f.videosPerDay,"onUpdate:videosPerDay":B=>f.videosPerDay=B,"daily-times":f.dailyTimes,"onUpdate:dailyTimes":B=>f.dailyTimes=B,"start-days":f.startDays,"onUpdate:startDays":B=>f.startDays=B},null,8,["schedule-enabled","onUpdate:scheduleEnabled","videos-per-day","onUpdate:videosPerDay","daily-times","onUpdate:dailyTimes","start-days","onUpdate:startDays"]),l("div",ws,[e(s,{size:"small",onClick:B=>d()},{default:t(()=>[...w[3]||(w[3]=[v("取消",-1)])]),_:1},8,["onClick"]),e(s,{size:"small",type:"primary",onClick:B=>F(f)},{default:t(()=>[...w[4]||(w[4]=[v("发布",-1)])]),_:1},8,["onClick"])])])),[[$e,p.value===f.name]])),128))])]),e(N,{modelValue:L.value,"onUpdate:modelValue":w[2]||(w[2]=f=>L.value=f),title:"批量发布进度",width:"500px","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},{footer:t(()=>[l("div",xs,[e(s,{onClick:ae,disabled:V.value===100},{default:t(()=>[...w[5]||(w[5]=[v(" 取消发布 ",-1)])]),_:1},8,["disabled"]),V.value===100?(r(),J(s,{key:0,type:"primary",onClick:w[1]||(w[1]=f=>L.value=!1)},{default:t(()=>[...w[6]||(w[6]=[v(" 关闭 ",-1)])]),_:1})):G("",!0)])]),default:t(()=>[l("div",ks,[e(R,{percentage:V.value,status:V.value===100?"success":""},null,8,["percentage","status"]),q.value?(r(),A("div",Vs," 正在发布："+S(q.value.label),1)):G("",!0),o.value.length>0?(r(),A("div",Cs,[(r(!0),A(te,null,le(o.value,(f,B)=>(r(),A("div",{key:B,class:ne(["result-item",f.status])},[f.status==="success"?(r(),J(x,{key:0},{default:t(()=>[e(I(it))]),_:1})):f.status==="error"?(r(),J(x,{key:1},{default:t(()=>[e(I(Me))]),_:1})):(r(),J(x,{key:2},{default:t(()=>[e(I(ut))]),_:1})),l("span",As,S(f.label),1),l("span",Ts,S(f.message),1)],2))),128))])):G("",!0)])]),_:1},8,["modelValue"])])}}},Ss=ee(Ps,[["__scopeId","data-v-0af57281"]]),Ms={class:"about"},Us={__name:"About",setup(a){return(i,n)=>(r(),A("div",Ms,[...n[0]||(n[0]=[l("h1",null,"关于我们",-1),l("p",null,"这是关于页面",-1)])]))}},Ls=ee(Us,[["__scopeId","data-v-cd67ee8e"]]),Is=[{path:"/",name:"Dashboard",component:tl},{path:"/account-management",name:"AccountManagement",component:ql},{path:"/material-management",name:"MaterialManagement",component:na},{path:"/publish-center",name:"PublishCenter",component:Ss},{path:"/about",name:"About",component:Ls}],Es=Ke({history:je(),routes:Is}),zs=He(),_e=We(bt);for(const[a,i]of Object.entries(dt))_e.component(a,i);_e.use(Es);_e.use(zs);_e.use(rt);_e.mount("#app");
