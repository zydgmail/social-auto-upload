import{b as H,ax as Ie,r as R,c as A,o as v,R as e,J as t,al as m,a as l,K as _e,S as ye,u as z,p as ie,ay as Ee,P as S,O as g,I as J,L as G,az as Ce,t as we,X as ze,ar as De,E as le,Q as Y,a6 as Z,W as Fe,a4 as Oe,aA as Re,aB as Be,aC as qe,au as Ne}from"./vue-CbZdtcPO.js";import{h as Ke,u as Ae,p as je,a as ue,m as He,d as Te,f as We,b as Xe,l as Ge,c as Je,e as Qe,t as Ye,E as V,g as ce,r as se,i as Ze,j as et,k as tt,n as xe,o as lt,q as at,s as st,v as ot,w as nt}from"./elementPlus-CSqc6bT9.js";import{a as it}from"./utils-NIGUFBhG.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))c(f);new MutationObserver(f=>{for(const b of f)if(b.type==="childList")for(const u of b.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&c(u)}).observe(document,{childList:!0,subtree:!0});function n(f){const b={};return f.integrity&&(b.integrity=f.integrity),f.referrerPolicy&&(b.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?b.credentials="include":f.crossOrigin==="anonymous"?b.credentials="omit":b.credentials="same-origin",b}function c(f){if(f.ep)return;f.ep=!0;const b=n(f);fetch(f.href,b)}})();const ut="/vite.svg",Q=(s,i)=>{const n=s.__vccOpts||s;for(const[c,f]of i)n[c]=f;return n},dt={id:"app"},rt={class:"sidebar"},ct={class:"logo"},pt={src:ut,alt:"Logo",class:"logo-img"},mt={class:"header-content"},ft={class:"header-left"},vt={__name:"App",setup(s){const i=Ie(),n=H(()=>i.path),c=R(!1),f=()=>{c.value=!c.value};return(b,u)=>{const $=m("el-icon"),T=m("el-menu-item"),C=m("el-menu"),U=m("el-aside"),I=m("el-header"),E=m("router-view"),h=m("el-main"),o=m("el-container");return v(),A("div",dt,[e(o,null,{default:t(()=>[e(U,{width:c.value?"64px":"200px"},{default:t(()=>[l("div",rt,[l("div",ct,[_e(l("img",pt,null,512),[[ye,c.value]]),_e(l("h2",null,"自媒体自动化运营系统",512),[[ye,!c.value]])]),e(C,{router:!0,"default-active":n.value,collapse:c.value,class:"sidebar-menu","background-color":"#001529","text-color":"#fff","active-text-color":"#409EFF"},{default:t(()=>[e(T,{index:"/"},{default:t(()=>[e($,null,{default:t(()=>[e(z(Ke))]),_:1}),u[0]||(u[0]=l("span",null,"首页",-1))]),_:1}),e(T,{index:"/account-management"},{default:t(()=>[e($,null,{default:t(()=>[e(z(Ae))]),_:1}),u[1]||(u[1]=l("span",null,"账号管理",-1))]),_:1}),e(T,{index:"/material-management"},{default:t(()=>[e($,null,{default:t(()=>[e(z(je))]),_:1}),u[2]||(u[2]=l("span",null,"素材管理",-1))]),_:1}),e(T,{index:"/publish-center"},{default:t(()=>[e($,null,{default:t(()=>[e(z(ue))]),_:1}),u[3]||(u[3]=l("span",null,"发布中心",-1))]),_:1}),e(T,{index:"/website"},{default:t(()=>[e($,null,{default:t(()=>[e(z(He))]),_:1}),u[4]||(u[4]=l("span",null,"网站",-1))]),_:1}),e(T,{index:"/data"},{default:t(()=>[e($,null,{default:t(()=>[e(z(Te))]),_:1}),u[5]||(u[5]=l("span",null,"数据",-1))]),_:1})]),_:1},8,["default-active","collapse"])])]),_:1},8,["width"]),e(o,null,{default:t(()=>[e(I,null,{default:t(()=>[l("div",mt,[l("div",ft,[e($,{class:"toggle-sidebar",onClick:f},{default:t(()=>[e(z(We))]),_:1})]),u[6]||(u[6]=l("div",{class:"header-right"},null,-1))])]),_:1}),e(h,null,{default:t(()=>[e(E)]),_:1})]),_:1})]),_:1})])}}},_t=Q(vt,[["__scopeId","data-v-176fbaed"]]),gt={class:"dashboard"},yt={class:"dashboard-content"},ht={class:"stat-card-content"},bt={class:"stat-icon"},$t={class:"stat-info"},wt={class:"stat-value"},kt={class:"stat-footer"},Vt={class:"stat-detail"},Ct={class:"stat-card-content"},At={class:"stat-icon platform-icon"},Tt={class:"stat-info"},xt={class:"stat-value"},Pt={class:"stat-footer"},St={class:"stat-detail"},Mt={class:"stat-card-content"},Ut={class:"stat-icon task-icon"},Lt={class:"stat-info"},It={class:"stat-value"},Et={class:"stat-footer"},zt={class:"stat-detail"},Dt={class:"stat-card-content"},Ft={class:"stat-icon content-icon"},Ot={class:"stat-info"},Rt={class:"stat-value"},Bt={class:"stat-footer"},qt={class:"stat-detail"},Nt={class:"quick-actions"},Kt={class:"action-icon"},jt={class:"action-icon"},Ht={class:"action-icon"},Wt={class:"action-icon"},Xt={class:"recent-tasks"},Gt={class:"section-header"},Jt={__name:"Dashboard",setup(s){const i=Ee(),n=ie({total:12,normal:10,abnormal:2}),c=ie({total:4,kuaishou:3,douyin:4,channels:2,xiaohongshu:3}),f=ie({total:24,completed:18,inProgress:5,failed:1}),b=ie({total:36,published:30,draft:6}),u=R([{id:1,title:"快手视频自动发布",platform:"快手",account:"快手账号1",createTime:"2024-05-01 10:30:00",status:"已完成"},{id:2,title:"抖音视频定时发布",platform:"抖音",account:"抖音账号1",createTime:"2024-05-01 11:15:00",status:"进行中"},{id:3,title:"视频号内容上传",platform:"视频号",account:"视频号账号1",createTime:"2024-05-01 14:20:00",status:"待执行"},{id:4,title:"小红书图文发布",platform:"小红书",account:"小红书账号1",createTime:"2024-05-01 16:45:00",status:"已失败"},{id:5,title:"快手短视频批量上传",platform:"快手",account:"快手账号2",createTime:"2024-05-02 09:10:00",status:"待执行"}]),$=h=>({快手:"success",抖音:"danger",视频号:"warning",小红书:"info"})[h]||"info",T=h=>({已完成:"success",进行中:"warning",待执行:"info",已失败:"danger"})[h]||"info",C=h=>{i.push(h)},U=h=>{V.info(`查看任务: ${h.title}`)},I=h=>{ce.confirm(`确定要执行任务 ${h.title} 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(()=>{const o=u.value.findIndex(q=>q.id===h.id);o!==-1&&(u.value[o].status="进行中"),V({type:"success",message:"任务已开始执行"})}).catch(()=>{})},E=h=>{ce.confirm(`确定要取消任务 ${h.title} 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const o=u.value.findIndex(q=>q.id===h.id);o!==-1&&(u.value[o].status="已取消"),V({type:"success",message:"任务已取消"})}).catch(()=>{})};return(h,o)=>{const q=m("el-icon"),x=m("el-card"),k=m("el-col"),B=m("el-tag"),M=m("el-tooltip"),P=m("el-row"),W=m("el-button"),j=m("el-table-column"),D=m("el-table");return v(),A("div",gt,[o[19]||(o[19]=l("div",{class:"page-header"},[l("h1",null,"自媒体自动化运营系统")],-1)),l("div",yt,[e(P,{gutter:20},{default:t(()=>[e(k,{span:6},{default:t(()=>[e(x,{class:"stat-card"},{default:t(()=>[l("div",ht,[l("div",bt,[e(q,null,{default:t(()=>[e(z(Ae))]),_:1})]),l("div",$t,[l("div",wt,S(n.total),1),o[1]||(o[1]=l("div",{class:"stat-label"},"账号总数",-1))])]),l("div",kt,[l("div",Vt,[l("span",null,"正常: "+S(n.normal),1),l("span",null,"异常: "+S(n.abnormal),1)])])]),_:1})]),_:1}),e(k,{span:6},{default:t(()=>[e(x,{class:"stat-card"},{default:t(()=>[l("div",Ct,[l("div",At,[e(q,null,{default:t(()=>[e(z(Xe))]),_:1})]),l("div",Tt,[l("div",xt,S(c.total),1),o[2]||(o[2]=l("div",{class:"stat-label"},"平台总数",-1))])]),l("div",Pt,[l("div",St,[e(M,{content:"快手账号",placement:"top"},{default:t(()=>[e(B,{size:"small",type:"success"},{default:t(()=>[g(S(c.kuaishou),1)]),_:1})]),_:1}),e(M,{content:"抖音账号",placement:"top"},{default:t(()=>[e(B,{size:"small",type:"danger"},{default:t(()=>[g(S(c.douyin),1)]),_:1})]),_:1}),e(M,{content:"视频号账号",placement:"top"},{default:t(()=>[e(B,{size:"small",type:"warning"},{default:t(()=>[g(S(c.channels),1)]),_:1})]),_:1}),e(M,{content:"小红书账号",placement:"top"},{default:t(()=>[e(B,{size:"small",type:"info"},{default:t(()=>[g(S(c.xiaohongshu),1)]),_:1})]),_:1})])])]),_:1})]),_:1}),e(k,{span:6},{default:t(()=>[e(x,{class:"stat-card"},{default:t(()=>[l("div",Mt,[l("div",Ut,[e(q,null,{default:t(()=>[e(z(Ge))]),_:1})]),l("div",Lt,[l("div",It,S(f.total),1),o[3]||(o[3]=l("div",{class:"stat-label"},"任务总数",-1))])]),l("div",Et,[l("div",zt,[l("span",null,"完成: "+S(f.completed),1),l("span",null,"进行中: "+S(f.inProgress),1),l("span",null,"失败: "+S(f.failed),1)])])]),_:1})]),_:1}),e(k,{span:6},{default:t(()=>[e(x,{class:"stat-card"},{default:t(()=>[l("div",Dt,[l("div",Ft,[e(q,null,{default:t(()=>[e(z(Je))]),_:1})]),l("div",Ot,[l("div",Rt,S(b.total),1),o[4]||(o[4]=l("div",{class:"stat-label"},"内容总数",-1))])]),l("div",Bt,[l("div",qt,[l("span",null,"已发布: "+S(b.published),1),l("span",null,"草稿: "+S(b.draft),1)])])]),_:1})]),_:1})]),_:1}),l("div",Nt,[o[13]||(o[13]=l("h2",null,"快捷操作",-1)),e(P,{gutter:20},{default:t(()=>[e(k,{span:6},{default:t(()=>[e(x,{class:"action-card",onClick:o[0]||(o[0]=r=>C("/account-management"))},{default:t(()=>[l("div",Kt,[e(q,null,{default:t(()=>[e(z(Qe))]),_:1})]),o[5]||(o[5]=l("div",{class:"action-title"},"账号管理",-1)),o[6]||(o[6]=l("div",{class:"action-desc"},"管理所有平台账号",-1))]),_:1})]),_:1}),e(k,{span:6},{default:t(()=>[e(x,{class:"action-card"},{default:t(()=>[l("div",jt,[e(q,null,{default:t(()=>[e(z(ue))]),_:1})]),o[7]||(o[7]=l("div",{class:"action-title"},"内容上传",-1)),o[8]||(o[8]=l("div",{class:"action-desc"},"上传视频和图文内容",-1))]),_:1})]),_:1}),e(k,{span:6},{default:t(()=>[e(x,{class:"action-card"},{default:t(()=>[l("div",Ht,[e(q,null,{default:t(()=>[e(z(Ye))]),_:1})]),o[9]||(o[9]=l("div",{class:"action-title"},"定时发布",-1)),o[10]||(o[10]=l("div",{class:"action-desc"},"设置内容发布时间",-1))]),_:1})]),_:1}),e(k,{span:6},{default:t(()=>[e(x,{class:"action-card"},{default:t(()=>[l("div",Wt,[e(q,null,{default:t(()=>[e(z(Te))]),_:1})]),o[11]||(o[11]=l("div",{class:"action-title"},"数据分析",-1)),o[12]||(o[12]=l("div",{class:"action-desc"},"查看内容数据分析",-1))]),_:1})]),_:1})]),_:1})]),l("div",Xt,[l("div",Gt,[o[15]||(o[15]=l("h2",null,"最近任务",-1)),e(W,{text:""},{default:t(()=>[...o[14]||(o[14]=[g("查看全部",-1)])]),_:1})]),e(D,{data:u.value,style:{width:"100%"}},{default:t(()=>[e(j,{prop:"title",label:"任务名称",width:"250"}),e(j,{prop:"platform",label:"平台",width:"120"},{default:t(r=>[e(B,{type:$(r.row.platform),effect:"plain"},{default:t(()=>[g(S(r.row.platform),1)]),_:2},1032,["type"])]),_:1}),e(j,{prop:"account",label:"账号",width:"150"}),e(j,{prop:"createTime",label:"创建时间",width:"180"}),e(j,{prop:"status",label:"状态",width:"120"},{default:t(r=>[e(B,{type:T(r.row.status),effect:"plain"},{default:t(()=>[g(S(r.row.status),1)]),_:2},1032,["type"])]),_:1}),e(j,{label:"操作"},{default:t(r=>[e(W,{size:"small",onClick:F=>U(r.row)},{default:t(()=>[...o[16]||(o[16]=[g("查看",-1)])]),_:1},8,["onClick"]),r.row.status==="待执行"?(v(),J(W,{key:0,size:"small",type:"primary",onClick:F=>I(r.row)},{default:t(()=>[...o[17]||(o[17]=[g(" 执行 ",-1)])]),_:1},8,["onClick"])):G("",!0),r.row.status!=="已完成"&&r.row.status!=="已失败"?(v(),J(W,{key:1,size:"small",type:"danger",onClick:F=>E(r.row)},{default:t(()=>[...o[18]||(o[18]=[g(" 取消 ",-1)])]),_:1},8,["onClick"])):G("",!0)]),_:1})]),_:1},8,["data"])])])])}}},Qt=Q(Jt,[["__scopeId","data-v-db5c2d61"]]),oe=it.create({baseURL:"http://localhost:5409",headers:{"Content-Type":"application/json"}});oe.interceptors.request.use(s=>{const i=localStorage.getItem("token");return i&&(s.headers.Authorization=`Bearer ${i}`),s},s=>(console.error("请求错误:",s),Promise.reject(s)));oe.interceptors.response.use(s=>{const{data:i}=s;return i.code===200||i.success?i:(V.error(i.message||"请求失败"),Promise.reject(new Error(i.message||"请求失败")))},s=>{if(console.error("响应错误:",s),s.response){const{status:i}=s.response;switch(i){case 401:V.error("未授权，请重新登录");break;case 403:V.error("拒绝访问");break;case 404:V.error("请求地址不存在");break;case 500:V.error("服务器内部错误");break;default:V.error("网络错误")}}else V.error("网络连接失败");return Promise.reject(s)});const ne={get(s,i){return oe.get(s,{params:i})},post(s,i,n={}){return oe.post(s,i,n)},put(s,i,n={}){return oe.put(s,i,n)},delete(s,i){return oe.delete(s,{params:i})},upload(s,i){return oe.post(s,i,{headers:{"Content-Type":"multipart/form-data"}})}},ve={getValidAccounts(s){return ne.get("/getValidAccounts",s)},addAccount(s){return ne.post("/account",s)},updateAccount(s){return ne.post("/updateUserinfo",s)},deleteAccount(s){return ne.get(`/deleteAccount?id=${s}`)}},ke=Ce("account",()=>{const s=R([]),i={1:"小红书",2:"视频号",3:"抖音",4:"快手"};return{accounts:s,setAccounts:$=>{s.value=$.map(T=>({id:T[0],type:T[1],filePath:T[2],name:T[3],status:T[4]===1?"正常":"异常",platform:i[T[1]]||"未知",avatar:"/vite.svg"}))},addAccount:$=>{s.value.push($)},updateAccount:($,T)=>{const C=s.value.findIndex(U=>U.id===$);C!==-1&&(s.value[C]={...s.value[C],...T})},deleteAccount:$=>{s.value=s.value.filter(T=>T.id!==$)},getAccountsByPlatform:$=>s.value.filter(T=>T.platform===$)}}),ge=Ce("app",()=>{const s=R(!0),i=R(!0),n=R(!1),c=R([]);return{isFirstTimeAccountManagement:s,isFirstTimeMaterialManagement:i,isAccountRefreshing:n,materials:c,setAccountManagementVisited:()=>{s.value=!1},setMaterialManagementVisited:()=>{i.value=!1},resetVisitStatus:()=>{s.value=!0,i.value=!0},setMaterials:I=>{c.value=I},addMaterial:I=>{c.value.push(I)},removeMaterial:I=>{const E=c.value.findIndex(h=>h.id===I);E>-1&&c.value.splice(E,1)},setAccountRefreshing:I=>{n.value=I}}}),Yt={class:"account-management","element-loading-text":"正在验证账号..."},Zt={class:"account-tabs"},el={class:"account-list-container"},tl={class:"account-search"},ll={class:"action-buttons"},al={class:"refresh-text"},sl={key:0,class:"account-list"},ol={key:1,class:"empty-data"},nl={class:"account-list-container"},il={class:"account-search"},ul={class:"action-buttons"},dl={class:"refresh-text"},rl={key:0,class:"account-list"},cl={key:1,class:"empty-data"},pl={class:"account-list-container"},ml={class:"account-search"},fl={class:"action-buttons"},vl={class:"refresh-text"},_l={key:0,class:"account-list"},gl={key:1,class:"empty-data"},yl={class:"account-list-container"},hl={class:"account-search"},bl={class:"action-buttons"},$l={class:"refresh-text"},wl={key:0,class:"account-list"},kl={key:1,class:"empty-data"},Vl={class:"account-list-container"},Cl={class:"account-search"},Al={class:"action-buttons"},Tl={class:"refresh-text"},xl={key:0,class:"account-list"},Pl={key:1,class:"empty-data"},Sl={key:0,class:"qrcode-container"},Ml={key:0,class:"qrcode-wrapper"},Ul=["src"],Ll={key:1,class:"loading-wrapper"},Il={key:2,class:"success-wrapper"},El={key:3,class:"error-wrapper"},zl={class:"dialog-footer"},Dl={__name:"AccountManagement",setup(s){const i=ke(),n=ge(),c=R("all"),f=R(""),b=async(d=!1)=>{if(!n.isAccountRefreshing){n.setAccountRefreshing(!0);try{const a=await ve.getValidAccounts({validate:d?1:0});a.code===200&&a.data?(i.setAccounts(a.data),d&&V.success("账号验证完成"),n.isFirstTimeAccountManagement&&n.setAccountManagementVisited()):V.error("获取账号数据失败")}catch(a){console.error("获取账号数据失败:",a),V.error("获取账号数据失败")}finally{n.setAccountRefreshing(!1)}}};we(()=>{n.isFirstTimeAccountManagement&&b(!1)});const u=d=>({快手:"success",抖音:"danger",视频号:"warning",小红书:"info"})[d]||"info",$=H(()=>f.value?i.accounts.filter(d=>d.name.includes(f.value)):i.accounts),T=H(()=>$.value.filter(d=>d.platform==="快手")),C=H(()=>$.value.filter(d=>d.platform==="抖音")),U=H(()=>$.value.filter(d=>d.platform==="视频号")),I=H(()=>$.value.filter(d=>d.platform==="小红书")),E=()=>{},h=R(!1),o=R("add"),q=R(null),x=ie({id:null,name:"",platform:"",status:"正常"}),k={platform:[{required:!0,message:"请选择平台",trigger:"change"}],name:[{required:!0,message:"请输入账号名称",trigger:"blur"}]},B=R(!1),M=R(""),P=R(""),W=()=>{o.value="add",Object.assign(x,{id:null,name:"",platform:"",status:"正常"}),B.value=!1,M.value="",P.value="",h.value=!0},j=d=>{o.value="edit",Object.assign(x,{...d}),h.value=!0},D=d=>{ce.confirm(`确定要删除账号 ${d.name} 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const a=await ve.deleteAccount(d.id);a.code===200?(i.deleteAccount(d.id),V({type:"success",message:"删除成功"})):V.error(a.msg||"删除失败")}catch(a){console.error("删除账号失败:",a),V.error("删除账号失败")}}).catch(()=>{})};let r=null;const F=()=>{r&&(r.close(),r=null)},K=(d,a)=>{F(),B.value=!0,M.value="",P.value="";const X=`http://localhost:5409/login?type=${{小红书:"1",视频号:"2",抖音:"3",快手:"4"}[d]||"1"}&id=${encodeURIComponent(a)}`;r=new EventSource(X),r.onmessage=p=>{const w=p.data;if(console.log("SSE消息:",w),!M.value&&w.length>100)try{w.startsWith("data:image")?M.value=w:M.value=`data:image/png;base64,${w}`,console.log("设置二维码数据，长度:",w.length)}catch(ee){console.error("处理二维码数据出错:",ee)}else(w==="200"||w==="500")&&(P.value=w,w==="200"?setTimeout(()=>{F(),setTimeout(()=>{h.value=!1,B.value=!1,V.success("账号添加成功"),V({type:"info",message:"正在同步账号信息...",duration:0}),b().then(()=>{V.closeAll(),V.success("账号信息已更新")})},1e3)},1e3):(F(),setTimeout(()=>{B.value=!1,M.value="",P.value=""},2e3)))},r.onerror=p=>{console.error("SSE连接错误:",p),V.error("连接服务器失败，请稍后再试"),F(),B.value=!1}},y=()=>{q.value.validate(async d=>{if(d)if(o.value==="add")K(x.platform,x.name);else try{const a=await ve.updateAccount({id:x.id,type:x.platform==="快手"?1:x.platform==="抖音"?2:x.platform==="视频号"?3:4,userName:x.name});a.code===200?(i.updateAccount(x.id,x),V.success("更新成功"),h.value=!1,b()):V.error(a.msg||"更新账号失败")}catch(a){console.error("更新账号失败:",a),V.error("更新账号失败")}else return!1})};return ze(()=>{F()}),(d,a)=>{const N=m("el-input"),L=m("el-button"),O=m("el-icon"),X=m("el-avatar"),p=m("el-table-column"),w=m("el-tag"),ee=m("el-table"),de=m("el-empty"),re=m("el-tab-pane"),Pe=m("el-tabs"),fe=m("el-option"),Se=m("el-select"),Ve=m("el-form-item"),Me=m("el-form"),Ue=m("el-dialog"),Le=De("loading");return _e((v(),A("div",Yt,[a[35]||(a[35]=l("div",{class:"page-header"},[l("h1",null,"账号管理")],-1)),l("div",Zt,[e(Pe,{modelValue:c.value,"onUpdate:modelValue":a[10]||(a[10]=_=>c.value=_),class:"account-tabs-nav"},{default:t(()=>[e(re,{label:"全部",name:"all"},{default:t(()=>[l("div",el,[l("div",tl,[e(N,{modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=_=>f.value=_),placeholder:"输入名称或账号搜索","prefix-icon":"Search",clearable:"",onClear:E,onInput:E},null,8,["modelValue"]),l("div",ll,[e(L,{type:"primary",onClick:W},{default:t(()=>[...a[15]||(a[15]=[g("添加账号",-1)])]),_:1}),e(L,{type:"info",onClick:a[1]||(a[1]=()=>b(!0))},{default:t(()=>[e(O,{class:le({"is-loading":z(n).isAccountRefreshing,"refresh-icon":!0})},{default:t(()=>[e(z(se))]),_:1},8,["class"]),l("span",al,S(z(n).isAccountRefreshing?"验证中...":"手动过期验证"),1)]),_:1})])]),$.value.length>0?(v(),A("div",sl,[e(ee,{data:$.value,style:{width:"100%"}},{default:t(()=>[e(p,{label:"头像",width:"80"},{default:t(_=>[e(X,{src:_.row.avatar,size:40},null,8,["src"])]),_:1}),e(p,{prop:"name",label:"名称",width:"180"}),e(p,{prop:"platform",label:"平台"},{default:t(_=>[e(w,{type:u(_.row.platform),effect:"plain"},{default:t(()=>[g(S(_.row.platform),1)]),_:2},1032,["type"])]),_:1}),e(p,{prop:"status",label:"状态"},{default:t(_=>[e(w,{type:_.row.status==="正常"?"success":"danger",effect:"plain"},{default:t(()=>[g(S(_.row.status),1)]),_:2},1032,["type"])]),_:1}),e(p,{label:"操作"},{default:t(_=>[e(L,{size:"small",onClick:te=>j(_.row)},{default:t(()=>[...a[16]||(a[16]=[g("编辑",-1)])]),_:1},8,["onClick"]),e(L,{size:"small",type:"danger",onClick:te=>D(_.row)},{default:t(()=>[...a[17]||(a[17]=[g("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(v(),A("div",ol,[e(de,{description:"暂无账号数据"})]))])]),_:1}),e(re,{label:"快手",name:"kuaishou"},{default:t(()=>[l("div",nl,[l("div",il,[e(N,{modelValue:f.value,"onUpdate:modelValue":a[2]||(a[2]=_=>f.value=_),placeholder:"输入名称或账号搜索","prefix-icon":"Search",clearable:"",onClear:E,onInput:E},null,8,["modelValue"]),l("div",ul,[e(L,{type:"primary",onClick:W},{default:t(()=>[...a[18]||(a[18]=[g("添加账号",-1)])]),_:1}),e(L,{type:"info",onClick:a[3]||(a[3]=()=>b(!0))},{default:t(()=>[e(O,{class:le({"is-loading":z(n).isAccountRefreshing,"refresh-icon":!0})},{default:t(()=>[e(z(se))]),_:1},8,["class"]),l("span",dl,S(z(n).isAccountRefreshing?"验证中...":"手动过期验证"),1)]),_:1})])]),T.value.length>0?(v(),A("div",rl,[e(ee,{data:T.value,style:{width:"100%"}},{default:t(()=>[e(p,{label:"头像",width:"80"},{default:t(_=>[e(X,{src:_.row.avatar,size:40},null,8,["src"])]),_:1}),e(p,{prop:"name",label:"名称",width:"180"}),e(p,{prop:"platform",label:"平台"},{default:t(_=>[e(w,{type:u(_.row.platform),effect:"plain"},{default:t(()=>[g(S(_.row.platform),1)]),_:2},1032,["type"])]),_:1}),e(p,{prop:"status",label:"状态"},{default:t(_=>[e(w,{type:_.row.status==="正常"?"success":"danger",effect:"plain"},{default:t(()=>[g(S(_.row.status),1)]),_:2},1032,["type"])]),_:1}),e(p,{label:"操作"},{default:t(_=>[e(L,{size:"small",onClick:te=>j(_.row)},{default:t(()=>[...a[19]||(a[19]=[g("编辑",-1)])]),_:1},8,["onClick"]),e(L,{size:"small",type:"danger",onClick:te=>D(_.row)},{default:t(()=>[...a[20]||(a[20]=[g("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(v(),A("div",cl,[e(de,{description:"暂无快手账号数据"})]))])]),_:1}),e(re,{label:"抖音",name:"douyin"},{default:t(()=>[l("div",pl,[l("div",ml,[e(N,{modelValue:f.value,"onUpdate:modelValue":a[4]||(a[4]=_=>f.value=_),placeholder:"输入名称或账号搜索","prefix-icon":"Search",clearable:"",onClear:E,onInput:E},null,8,["modelValue"]),l("div",fl,[e(L,{type:"primary",onClick:W},{default:t(()=>[...a[21]||(a[21]=[g("添加账号",-1)])]),_:1}),e(L,{type:"info",onClick:a[5]||(a[5]=()=>b(!0))},{default:t(()=>[e(O,{class:le({"is-loading":z(n).isAccountRefreshing,"refresh-icon":!0})},{default:t(()=>[e(z(se))]),_:1},8,["class"]),l("span",vl,S(z(n).isAccountRefreshing?"验证中...":"手动过期验证"),1)]),_:1})])]),C.value.length>0?(v(),A("div",_l,[e(ee,{data:C.value,style:{width:"100%"}},{default:t(()=>[e(p,{label:"头像",width:"80"},{default:t(_=>[e(X,{src:_.row.avatar,size:40},null,8,["src"])]),_:1}),e(p,{prop:"name",label:"名称",width:"180"}),e(p,{prop:"platform",label:"平台"},{default:t(_=>[e(w,{type:u(_.row.platform),effect:"plain"},{default:t(()=>[g(S(_.row.platform),1)]),_:2},1032,["type"])]),_:1}),e(p,{prop:"status",label:"状态"},{default:t(_=>[e(w,{type:_.row.status==="正常"?"success":"danger",effect:"plain"},{default:t(()=>[g(S(_.row.status),1)]),_:2},1032,["type"])]),_:1}),e(p,{label:"操作"},{default:t(_=>[e(L,{size:"small",onClick:te=>j(_.row)},{default:t(()=>[...a[22]||(a[22]=[g("编辑",-1)])]),_:1},8,["onClick"]),e(L,{size:"small",type:"danger",onClick:te=>D(_.row)},{default:t(()=>[...a[23]||(a[23]=[g("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(v(),A("div",gl,[e(de,{description:"暂无抖音账号数据"})]))])]),_:1}),e(re,{label:"视频号",name:"channels"},{default:t(()=>[l("div",yl,[l("div",hl,[e(N,{modelValue:f.value,"onUpdate:modelValue":a[6]||(a[6]=_=>f.value=_),placeholder:"输入名称或账号搜索","prefix-icon":"Search",clearable:"",onClear:E,onInput:E},null,8,["modelValue"]),l("div",bl,[e(L,{type:"primary",onClick:W},{default:t(()=>[...a[24]||(a[24]=[g("添加账号",-1)])]),_:1}),e(L,{type:"info",onClick:a[7]||(a[7]=()=>b(!0))},{default:t(()=>[e(O,{class:le({"is-loading":z(n).isAccountRefreshing,"refresh-icon":!0})},{default:t(()=>[e(z(se))]),_:1},8,["class"]),l("span",$l,S(z(n).isAccountRefreshing?"验证中...":"手动过期验证"),1)]),_:1})])]),U.value.length>0?(v(),A("div",wl,[e(ee,{data:U.value,style:{width:"100%"}},{default:t(()=>[e(p,{label:"头像",width:"80"},{default:t(_=>[e(X,{src:_.row.avatar,size:40},null,8,["src"])]),_:1}),e(p,{prop:"name",label:"名称",width:"180"}),e(p,{prop:"platform",label:"平台"},{default:t(_=>[e(w,{type:u(_.row.platform),effect:"plain"},{default:t(()=>[g(S(_.row.platform),1)]),_:2},1032,["type"])]),_:1}),e(p,{prop:"status",label:"状态"},{default:t(_=>[e(w,{type:_.row.status==="正常"?"success":"danger",effect:"plain"},{default:t(()=>[g(S(_.row.status),1)]),_:2},1032,["type"])]),_:1}),e(p,{label:"操作"},{default:t(_=>[e(L,{size:"small",onClick:te=>j(_.row)},{default:t(()=>[...a[25]||(a[25]=[g("编辑",-1)])]),_:1},8,["onClick"]),e(L,{size:"small",type:"danger",onClick:te=>D(_.row)},{default:t(()=>[...a[26]||(a[26]=[g("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(v(),A("div",kl,[e(de,{description:"暂无视频号账号数据"})]))])]),_:1}),e(re,{label:"小红书",name:"xiaohongshu"},{default:t(()=>[l("div",Vl,[l("div",Cl,[e(N,{modelValue:f.value,"onUpdate:modelValue":a[8]||(a[8]=_=>f.value=_),placeholder:"输入名称或账号搜索","prefix-icon":"Search",clearable:"",onClear:E,onInput:E},null,8,["modelValue"]),l("div",Al,[e(L,{type:"primary",onClick:W},{default:t(()=>[...a[27]||(a[27]=[g("添加账号",-1)])]),_:1}),e(L,{type:"info",onClick:a[9]||(a[9]=()=>b(!0))},{default:t(()=>[e(O,{class:le({"is-loading":z(n).isAccountRefreshing,"refresh-icon":!0})},{default:t(()=>[e(z(se))]),_:1},8,["class"]),l("span",Tl,S(z(n).isAccountRefreshing?"验证中...":"手动过期验证"),1)]),_:1})])]),I.value.length>0?(v(),A("div",xl,[e(ee,{data:I.value,style:{width:"100%"}},{default:t(()=>[e(p,{label:"头像",width:"80"},{default:t(_=>[e(X,{src:_.row.avatar,size:40},null,8,["src"])]),_:1}),e(p,{prop:"name",label:"名称",width:"180"}),e(p,{prop:"platform",label:"平台"},{default:t(_=>[e(w,{type:u(_.row.platform),effect:"plain"},{default:t(()=>[g(S(_.row.platform),1)]),_:2},1032,["type"])]),_:1}),e(p,{prop:"status",label:"状态"},{default:t(_=>[e(w,{type:_.row.status==="正常"?"success":"danger",effect:"plain"},{default:t(()=>[g(S(_.row.status),1)]),_:2},1032,["type"])]),_:1}),e(p,{label:"操作"},{default:t(_=>[e(L,{size:"small",onClick:te=>j(_.row)},{default:t(()=>[...a[28]||(a[28]=[g("编辑",-1)])]),_:1},8,["onClick"]),e(L,{size:"small",type:"danger",onClick:te=>D(_.row)},{default:t(()=>[...a[29]||(a[29]=[g("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(v(),A("div",Pl,[e(de,{description:"暂无小红书账号数据"})]))])]),_:1})]),_:1},8,["modelValue"])]),e(Ue,{modelValue:h.value,"onUpdate:modelValue":a[14]||(a[14]=_=>h.value=_),title:o.value==="add"?"添加账号":"编辑账号",width:"500px","close-on-click-modal":!1,"close-on-press-escape":!B.value,"show-close":!B.value},{footer:t(()=>[l("span",zl,[e(L,{onClick:a[13]||(a[13]=_=>h.value=!1)},{default:t(()=>[...a[34]||(a[34]=[g("取消",-1)])]),_:1}),e(L,{type:"primary",onClick:y,loading:B.value,disabled:B.value},{default:t(()=>[g(S(B.value?"请求中":"确认"),1)]),_:1},8,["loading","disabled"])])]),default:t(()=>[e(Me,{model:x,"label-width":"80px",rules:k,ref_key:"accountFormRef",ref:q},{default:t(()=>[e(Ve,{label:"平台",prop:"platform"},{default:t(()=>[e(Se,{modelValue:x.platform,"onUpdate:modelValue":a[11]||(a[11]=_=>x.platform=_),placeholder:"请选择平台",style:{width:"100%"},disabled:o.value==="edit"||B.value},{default:t(()=>[e(fe,{label:"快手",value:"快手"}),e(fe,{label:"抖音",value:"抖音"}),e(fe,{label:"视频号",value:"视频号"}),e(fe,{label:"小红书",value:"小红书"})]),_:1},8,["modelValue","disabled"])]),_:1}),e(Ve,{label:"名称",prop:"name"},{default:t(()=>[e(N,{modelValue:x.name,"onUpdate:modelValue":a[12]||(a[12]=_=>x.name=_),placeholder:"请输入账号名称",disabled:B.value},null,8,["modelValue","disabled"])]),_:1}),B.value?(v(),A("div",Sl,[M.value&&!P.value?(v(),A("div",Ml,[a[30]||(a[30]=l("p",{class:"qrcode-tip"},"请使用对应平台APP扫描二维码登录",-1)),l("img",{src:M.value,alt:"登录二维码",class:"qrcode-image"},null,8,Ul)])):!M.value&&!P.value?(v(),A("div",Ll,[e(O,{class:"is-loading"},{default:t(()=>[e(z(se))]),_:1}),a[31]||(a[31]=l("span",null,"请求中...",-1))])):P.value==="200"?(v(),A("div",Il,[e(O,null,{default:t(()=>[e(z(Ze))]),_:1}),a[32]||(a[32]=l("span",null,"添加成功",-1))])):P.value==="500"?(v(),A("div",El,[e(O,null,{default:t(()=>[e(z(et))]),_:1}),a[33]||(a[33]=l("span",null,"添加失败，请稍后再试",-1))])):G("",!0)])):G("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title","close-on-press-escape","show-close"])])),[[Le,z(n).isAccountRefreshing]])}}},Fl=Q(Dl,[["__scopeId","data-v-15d9d15f"]]),ae={getAllMaterials:()=>ne.get("/getFiles"),uploadMaterial:s=>ne.upload("/uploadSave",s),deleteMaterial:s=>ne.get(`/deleteFile?id=${s}`),downloadMaterial:s=>`http://localhost:5409/download/${s}`,getMaterialPreviewUrl:s=>`http://localhost:5409/getFile?filename=${s}`},Ol={class:"material-management"},Rl={class:"material-list-container"},Bl={class:"material-search"},ql={class:"action-buttons"},Nl={key:0},Kl={key:0,class:"material-list"},jl={key:1,class:"empty-data"},Hl={class:"upload-form"},Wl={class:"dialog-footer"},Xl={key:0,class:"preview-container"},Gl={key:0,class:"video-preview"},Jl={controls:"",style:{"max-width":"100%","max-height":"60vh"}},Ql=["src"],Yl={key:1,class:"image-preview"},Zl=["src"],ea={key:2,class:"file-info"},ta={__name:"MaterialManagement",setup(s){const i=ge(),n=R(""),c=R(!1),f=R(!1),b=R(!1),u=R(!1),$=R(null),T=R([]),C=R(""),U=async()=>{c.value=!0;try{const D=await ae.getAllMaterials();D.code===200?(i.setMaterials(D.data),V.success("刷新成功")):V.error("获取素材列表失败")}catch(D){console.error("获取素材列表出错:",D),V.error("获取素材列表失败")}finally{c.value=!1}},I=H(()=>{if(!n.value)return i.materials;const D=n.value.toLowerCase();return i.materials.filter(r=>r.filename.toLowerCase().includes(D))}),E=()=>{},h=()=>{T.value=[],C.value="",b.value=!0},o=()=>{T.value=[],C.value=""},q=(D,r)=>{console.log("选择的文件:",D),D.raw&&(T.value=[D])},x=async()=>{if(T.value.length===0){V.warning("请选择要上传的文件");return}const D=T.value[0];if(!D||!D.raw){V.warning("文件对象无效，请重新选择文件");return}f.value=!0;try{const r=new FormData;console.log("上传文件对象:",D.raw),r.append("file",D.raw),C.value.trim()&&(r.append("filename",C.value.trim()),console.log("自定义文件名:",C.value.trim()));const F=await ae.uploadMaterial(r);F.code===200?(V.success("上传成功"),b.value=!1,await U()):V.error(F.msg||"上传失败")}catch(r){console.error("上传素材出错:",r),V.error("上传失败: "+(r.message||"未知错误"))}finally{f.value=!1}},k=async D=>{$.value=null,u.value=!0,V.info("加载中...");try{await new Promise(r=>setTimeout(r,100)),$.value=D}catch(r){console.error("预览素材出错:",r),V.error("预览加载失败"),u.value=!1}},B=D=>{ce.confirm(`确定要删除素材 ${D.filename} 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const r=await ae.deleteMaterial(D.id);r.code===200?(i.removeMaterial(D.id),V.success("删除成功")):V.error(r.msg||"删除失败")}catch(r){console.error("删除素材出错:",r),V.error("删除失败")}}).catch(()=>{})},M=D=>{const r=D.split("/").pop();return ae.getMaterialPreviewUrl(r)},P=D=>{const r=ae.downloadMaterial(D.file_path);window.open(r,"_blank")},W=D=>[".mp4",".avi",".mov",".wmv",".flv",".mkv"].some(F=>D.toLowerCase().endsWith(F)),j=D=>[".jpg",".jpeg",".png",".gif",".bmp",".webp"].some(F=>D.toLowerCase().endsWith(F));return we(()=>{i.materials.length===0&&U()}),(D,r)=>{const F=m("el-input"),K=m("el-button"),y=m("el-icon"),d=m("el-table-column"),a=m("el-table"),N=m("el-empty"),L=m("el-form-item"),O=m("el-upload"),X=m("el-form"),p=m("el-dialog");return v(),A("div",Ol,[r[14]||(r[14]=l("div",{class:"page-header"},[l("h1",null,"素材管理")],-1)),l("div",Rl,[l("div",Bl,[e(F,{modelValue:n.value,"onUpdate:modelValue":r[0]||(r[0]=w=>n.value=w),placeholder:"输入文件名搜索","prefix-icon":"Search",clearable:"",onClear:E,onInput:E},null,8,["modelValue"]),l("div",ql,[e(K,{type:"primary",onClick:h},{default:t(()=>[...r[6]||(r[6]=[g("上传素材",-1)])]),_:1}),e(K,{type:"info",onClick:U,loading:!1},{default:t(()=>[e(y,{class:le({"is-loading":c.value})},{default:t(()=>[e(z(se))]),_:1},8,["class"]),c.value?(v(),A("span",Nl,"刷新中")):G("",!0)]),_:1})])]),I.value.length>0?(v(),A("div",Kl,[e(a,{data:I.value,style:{width:"100%"}},{default:t(()=>[e(d,{prop:"filename",label:"文件名",width:"300"}),e(d,{prop:"filesize",label:"文件大小",width:"120"},{default:t(w=>[g(S(w.row.filesize)+" MB ",1)]),_:1}),e(d,{prop:"upload_time",label:"上传时间",width:"180"}),e(d,{label:"操作"},{default:t(w=>[e(K,{size:"small",onClick:ee=>k(w.row)},{default:t(()=>[...r[7]||(r[7]=[g("预览",-1)])]),_:1},8,["onClick"]),e(K,{size:"small",type:"danger",onClick:ee=>B(w.row)},{default:t(()=>[...r[8]||(r[8]=[g("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(v(),A("div",jl,[e(N,{description:"暂无素材数据"})]))]),e(p,{modelValue:b.value,"onUpdate:modelValue":r[3]||(r[3]=w=>b.value=w),title:"上传素材",width:"40%",onClose:o},{footer:t(()=>[l("div",Wl,[e(K,{onClick:r[2]||(r[2]=w=>b.value=!1)},{default:t(()=>[...r[11]||(r[11]=[g("取消",-1)])]),_:1}),e(K,{type:"primary",onClick:x,loading:f.value},{default:t(()=>[g(S(f.value?"上传中":"确认上传"),1)]),_:1},8,["loading"])])]),default:t(()=>[l("div",Hl,[e(X,{"label-width":"80px"},{default:t(()=>[e(L,{label:"文件名称:"},{default:t(()=>[e(F,{modelValue:C.value,"onUpdate:modelValue":r[1]||(r[1]=w=>C.value=w),placeholder:"选填",clearable:""},null,8,["modelValue"])]),_:1}),e(L,{label:"选择文件"},{default:t(()=>[e(O,{class:"upload-demo",drag:"","auto-upload":!1,"on-change":q,"file-list":T.value,limit:1},{tip:t(()=>[...r[9]||(r[9]=[l("div",{class:"el-upload__tip"}," 支持视频、图片等格式文件，只能上传一个文件 ",-1)])]),default:t(()=>[e(y,{class:"el-icon--upload"},{default:t(()=>[e(z(ue))]),_:1}),r[10]||(r[10]=l("div",{class:"el-upload__text"},[g(" 将文件拖到此处，或"),l("em",null,"点击上传")],-1))]),_:1},8,["file-list"])]),_:1})]),_:1})])]),_:1},8,["modelValue"]),e(p,{modelValue:u.value,"onUpdate:modelValue":r[5]||(r[5]=w=>u.value=w),title:"素材预览",width:"50%",top:"10vh"},{default:t(()=>[$.value?(v(),A("div",Xl,[W($.value.filename)?(v(),A("div",Gl,[l("video",Jl,[l("source",{src:M($.value.file_path),type:"video/mp4"},null,8,Ql),r[12]||(r[12]=g(" 您的浏览器不支持视频播放 ",-1))])])):j($.value.filename)?(v(),A("div",Yl,[l("img",{src:M($.value.file_path),style:{"max-width":"100%","max-height":"60vh"}},null,8,Zl)])):(v(),A("div",ea,[l("p",null,"文件名: "+S($.value.filename),1),l("p",null,"文件大小: "+S($.value.filesize)+" MB",1),l("p",null,"上传时间: "+S($.value.upload_time),1),e(K,{type:"primary",onClick:r[4]||(r[4]=w=>P($.value))},{default:t(()=>[...r[13]||(r[13]=[g("下载文件",-1)])]),_:1})]))])):G("",!0)]),_:1},8,["modelValue"])])}}},la=Q(ta,[["__scopeId","data-v-3d75da5e"]]),he={DOUYIN:{key:3,name:"抖音",titleLimit:30,topicLimit:5,titlePlaceholder:"请输入标题（最多30字）",topicPlaceholder:"最多可添加5个话题"},KUAISHOU:{key:4,name:"快手",titleLimit:30,topicLimit:3,titlePlaceholder:"请输入标题（最多30字）",topicPlaceholder:"最多可添加3个话题"},WEIXIN:{key:2,name:"视频号",titleLimit:16,topicLimit:20,titlePlaceholder:"请输入标题（最多16字）",topicPlaceholder:"最多可添加20个话题"},XIAOHONGSHU:{key:1,name:"小红书",titleLimit:20,topicLimit:10,titlePlaceholder:"请输入标题（最多20字）",topicPlaceholder:"最多可添加10个话题"}};function pe(s){return Object.values(he).find(i=>i.key===s)||he.XIAOHONGSHU}function aa(){return Object.values(he)}function be(s,i){const n=pe(i);return!s||!s.trim()?{valid:!1,message:"请输入标题"}:s.length>n.titleLimit?{valid:!1,message:`标题不能超过${n.titleLimit}字，当前${s.length}字`}:{valid:!0,message:""}}function $e(s,i){const n=pe(i);return Array.isArray(s)?s.length>n.topicLimit?{valid:!1,message:`最多只能添加${n.topicLimit}个话题，当前${s.length}个`}:{valid:!0,message:""}:{valid:!1,message:"话题格式错误"}}function sa(s){return!s||!s.trim()?{valid:!1,message:"话题内容不能为空"}:s.length>20?{valid:!1,message:"单个话题不能超过20字"}:/[<>{}[\]()&$#@!%^*+=|\\/]/g.test(s)?{valid:!1,message:"话题不能包含特殊字符"}:{valid:!0,message:""}}function oa(s){const i={};let n=!0;(!s.fileList||s.fileList.length===0)&&(i.fileList="请先上传视频文件",n=!1);const c=be(s.title,s.selectedPlatform);c.valid||(i.title=c.message,n=!1),s.selectedPlatform||(i.platform="请选择发布平台",n=!1),(!s.selectedAccounts||s.selectedAccounts.length===0)&&(i.accounts="请选择发布账号",n=!1);const f=$e(s.selectedTopics,s.selectedPlatform);return f.valid||(i.topics=f.message,n=!1),s.scheduleEnabled&&((!s.videosPerDay||s.videosPerDay<1||s.videosPerDay>55)&&(i.videosPerDay="每天发布视频数必须在1-55之间",n=!1),(!s.dailyTimes||s.dailyTimes.length===0)&&(i.dailyTimes="请设置发布时间",n=!1),s.dailyTimes&&s.dailyTimes.length!==s.videosPerDay&&(i.dailyTimes="发布时间数量必须与每天发布视频数一致",n=!1),(s.startDays===void 0||s.startDays<0)&&(i.startDays="请选择开始天数",n=!1)),{valid:n,errors:i}}const na={class:"tab-management"},ia={class:"tab-header"},ua={class:"tab-list"},da=["onClick"],ra={class:"tab-actions"},ca={__name:"TabManagement",props:{tabs:{type:Array,required:!0},activeTab:{type:String,required:!0},batchPublishing:{type:Boolean,default:!1}},emits:["tab-change","remove-tab","add-tab","batch-publish"],setup(s){return(i,n)=>{const c=m("el-icon"),f=m("el-button");return v(),A("div",na,[l("div",ia,[l("div",ua,[(v(!0),A(Y,null,Z(s.tabs,b=>(v(),A("div",{key:b.name,class:le(["tab-item",{active:s.activeTab===b.name}]),onClick:u=>i.$emit("tab-change",b.name)},[l("span",null,S(b.label),1),s.tabs.length>1?(v(),J(c,{key:0,class:"close-icon",onClick:Fe(u=>i.$emit("remove-tab",b.name),["stop"])},{default:t(()=>[e(z(xe))]),_:1},8,["onClick"])):G("",!0)],10,da))),128))]),l("div",ra,[e(f,{type:"primary",size:"small",onClick:n[0]||(n[0]=b=>i.$emit("add-tab")),class:"add-tab-btn"},{default:t(()=>[e(c,null,{default:t(()=>[e(z(tt))]),_:1}),n[2]||(n[2]=g(" 添加Tab ",-1))]),_:1}),e(f,{type:"success",size:"small",onClick:n[1]||(n[1]=b=>i.$emit("batch-publish")),loading:s.batchPublishing,class:"batch-publish-btn"},{default:t(()=>[...n[3]||(n[3]=[g(" 批量发布 ",-1)])]),_:1},8,["loading"])])])])}}},pa=Q(ca,[["__scopeId","data-v-7584dadb"]]),ma={class:"upload-section"},fa={class:"upload-options"},va={key:0,class:"uploaded-files"},_a={class:"file-list"},ga={class:"file-size"},ya={class:"upload-options-content"},ha={class:"material-library-content"},ba={class:"material-list"},$a={class:"material-info"},wa={class:"material-name"},ka={class:"material-details"},Va={class:"file-size"},Ca={class:"upload-time"},Aa={class:"dialog-footer"},Ta={__name:"VideoUpload",props:{fileList:{type:Array,default:()=>[]},uploadAction:{type:String,required:!0},authHeaders:{type:Object,required:!0},materials:{type:Array,default:()=>[]}},emits:["show-upload-options","remove-file","upload-success","material-selected"],setup(s,{expose:i,emit:n}){const c=s,f=n,b=ge(),u=R(!1),$=R(!1),T=R(!1),C=R([]),U=()=>{u.value=!1,$.value=!0},I=async()=>{if(u.value=!1,c.materials.length===0)try{const x=await ae.getAllMaterials();if(x.code===200)b.setMaterials(x.data);else{V.error("获取素材列表失败");return}}catch(x){console.error("获取素材列表出错:",x),V.error("获取素材列表失败");return}C.value=[],T.value=!0},E=(x,k)=>{x.code===200?(f("upload-success",x,k),$.value=!1,V.success("文件上传成功")):V.error(x.msg||"上传失败")},h=x=>{V.error("文件上传失败"),console.error("上传错误:",x)},o=()=>{if(C.value.length===0){V.warning("请选择至少一个素材");return}f("material-selected",C.value);const x=C.value.length;T.value=!1,C.value=[],V.success(`已添加 ${x} 个素材`)},q=()=>{u.value=!0};return i({showUploadOptions:q}),(x,k)=>{const B=m("el-icon"),M=m("el-button"),P=m("el-link"),W=m("el-dialog"),j=m("el-upload"),D=m("el-checkbox"),r=m("el-checkbox-group");return v(),A("div",ma,[k[14]||(k[14]=l("h3",null,"视频",-1)),l("div",fa,[e(M,{type:"primary",onClick:q,class:"upload-btn"},{default:t(()=>[e(B,null,{default:t(()=>[e(z(ue))]),_:1}),k[5]||(k[5]=g(" 上传视频 ",-1))]),_:1})]),s.fileList.length>0?(v(),A("div",va,[k[7]||(k[7]=l("h4",null,"已上传文件：",-1)),l("div",_a,[(v(!0),A(Y,null,Z(s.fileList,(F,K)=>(v(),A("div",{key:K,class:"file-item"},[e(P,{href:F.url,target:"_blank",type:"primary"},{default:t(()=>[g(S(F.name),1)]),_:2},1032,["href"]),l("span",ga,S((F.size/1024/1024).toFixed(2))+"MB",1),e(M,{type:"danger",size:"small",onClick:y=>x.$emit("remove-file",K)},{default:t(()=>[...k[6]||(k[6]=[g("删除",-1)])]),_:1},8,["onClick"])]))),128))])])):G("",!0),e(W,{modelValue:u.value,"onUpdate:modelValue":k[0]||(k[0]=F=>u.value=F),title:"选择上传方式",width:"400px",class:"upload-options-dialog"},{default:t(()=>[l("div",ya,[e(M,{type:"primary",onClick:U,class:"option-btn"},{default:t(()=>[e(B,null,{default:t(()=>[e(z(ue))]),_:1}),k[8]||(k[8]=g(" 本地上传 ",-1))]),_:1}),e(M,{type:"success",onClick:I,class:"option-btn"},{default:t(()=>[e(B,null,{default:t(()=>[e(z(lt))]),_:1}),k[9]||(k[9]=g(" 素材库 ",-1))]),_:1})])]),_:1},8,["modelValue"]),e(W,{modelValue:$.value,"onUpdate:modelValue":k[1]||(k[1]=F=>$.value=F),title:"本地上传",width:"600px",class:"local-upload-dialog"},{default:t(()=>[e(j,{class:"video-upload",drag:"","auto-upload":!0,action:s.uploadAction,"on-success":E,"on-error":h,multiple:"",accept:"video/*",headers:s.authHeaders},{tip:t(()=>[...k[10]||(k[10]=[l("div",{class:"el-upload__tip"}," 支持MP4、AVI等视频格式，可上传多个文件 ",-1)])]),default:t(()=>[e(B,{class:"el-icon--upload"},{default:t(()=>[e(z(ue))]),_:1}),k[11]||(k[11]=l("div",{class:"el-upload__text"},[g(" 将视频文件拖到此处，或"),l("em",null,"点击上传")],-1))]),_:1},8,["action","headers"])]),_:1},8,["modelValue"]),e(W,{modelValue:T.value,"onUpdate:modelValue":k[4]||(k[4]=F=>T.value=F),title:"选择素材",width:"800px",class:"material-library-dialog"},{footer:t(()=>[l("div",Aa,[e(M,{onClick:k[3]||(k[3]=F=>T.value=!1)},{default:t(()=>[...k[12]||(k[12]=[g("取消",-1)])]),_:1}),e(M,{type:"primary",onClick:o},{default:t(()=>[...k[13]||(k[13]=[g("确定",-1)])]),_:1})])]),default:t(()=>[l("div",ha,[e(r,{modelValue:C.value,"onUpdate:modelValue":k[2]||(k[2]=F=>C.value=F)},{default:t(()=>[l("div",ba,[(v(!0),A(Y,null,Z(s.materials,F=>(v(),A("div",{key:F.id,class:"material-item"},[e(D,{label:F.id,class:"material-checkbox"},{default:t(()=>[l("div",$a,[l("div",wa,S(F.filename),1),l("div",ka,[l("span",Va,S(F.filesize)+"MB",1),l("span",Ca,S(F.upload_time),1)])])]),_:2},1032,["label"])]))),128))])]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"])])}}},xa=Q(Ta,[["__scopeId","data-v-a4989d91"]]),Pa={class:"platform-section"},Sa={key:0,class:"platform-tips"},Ma={__name:"PlatformSelection",props:{modelValue:{type:Number,required:!0}},emits:["update:modelValue","platform-change"],setup(s,{emit:i}){const n=s,c=i,f=aa(),b=H({get:()=>n.modelValue,set:T=>c("update:modelValue",T)}),u=H(()=>pe(n.modelValue)),$=T=>{c("platform-change",T)};return(T,C)=>{const U=m("el-radio"),I=m("el-radio-group"),E=m("el-alert");return v(),A("div",Pa,[C[1]||(C[1]=l("h3",null,"平台",-1)),e(I,{modelValue:b.value,"onUpdate:modelValue":C[0]||(C[0]=h=>b.value=h),onChange:$,class:"platform-radios"},{default:t(()=>[(v(!0),A(Y,null,Z(z(f),h=>(v(),J(U,{key:h.key,label:h.key,class:"platform-radio"},{default:t(()=>[g(S(h.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"]),u.value?(v(),A("div",Sa,[e(E,{title:`${u.value.name}平台限制：标题最多${u.value.titleLimit}字，话题最多${u.value.topicLimit}个`,type:"info",closable:!1,"show-icon":"",class:"platform-alert"},null,8,["title"])])):G("",!0)])}}},Ua=Q(Ma,[["__scopeId","data-v-4ae792d5"]]),La={class:"account-section"},Ia={class:"account-display"},Ea={class:"selected-accounts"},za={class:"account-dialog-content"},Da={class:"account-list"},Fa={class:"account-info"},Oa={class:"account-name"},Ra={class:"dialog-footer"},Ba={__name:"AccountSelection",props:{modelValue:{type:Array,default:()=>[]},platformKey:{type:Number,required:!0}},emits:["update:modelValue"],setup(s,{emit:i}){const n=s,c=i,f=ke(),b=H({get:()=>n.modelValue,set:h=>c("update:modelValue",h)}),u=R(!1),$=R([]),T=H(()=>{const o={3:"抖音",2:"视频号",1:"小红书",4:"快手"}[n.platformKey];return o?f.accounts.filter(q=>q.platform===o):[]}),C=()=>{$.value=[...b.value],u.value=!0},U=()=>{b.value=[...$.value],u.value=!1,V.success("账号选择完成")},I=h=>{b.value.splice(h,1)},E=h=>{const o=f.accounts.find(q=>q.id===h);return o?o.name:h};return(h,o)=>{const q=m("el-tag"),x=m("el-button"),k=m("el-checkbox"),B=m("el-checkbox-group"),M=m("el-dialog");return v(),A("div",La,[o[6]||(o[6]=l("h3",null,"账号",-1)),l("div",Ia,[l("div",Ea,[(v(!0),A(Y,null,Z(b.value,(P,W)=>(v(),J(q,{key:W,closable:"",onClose:j=>I(W),class:"account-tag"},{default:t(()=>[g(S(E(P)),1)]),_:2},1032,["onClose"]))),128))]),e(x,{type:"primary",plain:"",onClick:C,class:"select-account-btn"},{default:t(()=>[...o[3]||(o[3]=[g(" 选择账号 ",-1)])]),_:1})]),e(M,{modelValue:u.value,"onUpdate:modelValue":o[2]||(o[2]=P=>u.value=P),title:"选择账号",width:"600px",class:"account-dialog"},{footer:t(()=>[l("div",Ra,[e(x,{onClick:o[1]||(o[1]=P=>u.value=!1)},{default:t(()=>[...o[4]||(o[4]=[g("取消",-1)])]),_:1}),e(x,{type:"primary",onClick:U},{default:t(()=>[...o[5]||(o[5]=[g("确定",-1)])]),_:1})])]),default:t(()=>[l("div",za,[e(B,{modelValue:$.value,"onUpdate:modelValue":o[0]||(o[0]=P=>$.value=P)},{default:t(()=>[l("div",Da,[(v(!0),A(Y,null,Z(T.value,P=>(v(),J(k,{key:P.id,label:P.id,class:"account-item"},{default:t(()=>[l("div",Fa,[l("span",Oa,S(P.name),1)])]),_:2},1032,["label"]))),128))])]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"])])}}},qa=Q(Ba,[["__scopeId","data-v-7cdefdfd"]]),Na={class:"title-section"},Ka={key:0,class:"error-message"},ja={__name:"TitleInput",props:{modelValue:{type:String,default:""},platformKey:{type:Number,required:!0},validateOnInput:{type:Boolean,default:!0}},emits:["update:modelValue","validation-change"],setup(s,{expose:i,emit:n}){const c=s,f=n,b=H(()=>pe(c.platformKey)),u=H({get:()=>c.modelValue,set:E=>f("update:modelValue",E)}),$=H(()=>b.value.titlePlaceholder),T=H(()=>b.value.titleLimit),C=R(""),U=E=>{if(c.validateOnInput){const h=be(E,c.platformKey);C.value=h.valid?"":h.message,f("validation-change",h)}};return i({validate:()=>{const E=be(c.modelValue,c.platformKey);return C.value=E.valid?"":E.message,f("validation-change",E),E}}),(E,h)=>{const o=m("el-input"),q=m("el-alert");return v(),A("div",Na,[h[1]||(h[1]=l("h3",null,"标题",-1)),e(o,{modelValue:u.value,"onUpdate:modelValue":h[0]||(h[0]=x=>u.value=x),type:"textarea",rows:3,placeholder:$.value,maxlength:T.value,"show-word-limit":"",class:"title-input",onInput:U},null,8,["modelValue","placeholder","maxlength"]),C.value?(v(),A("div",Ka,[e(q,{title:C.value,type:"error",closable:!1,"show-icon":"",class:"error-alert"},null,8,["title"])])):G("",!0)])}}},Ha=Q(ja,[["__scopeId","data-v-f75530ea"]]),Wa={class:"topic-section"},Xa={class:"topic-display"},Ga={class:"selected-topics"},Ja={key:0,class:"topic-tips"},Qa={key:1,class:"error-message"},Ya={class:"topic-dialog-content"},Za={class:"custom-topic-input"},es={class:"recommended-topics"},ts={class:"topic-grid"},ls={class:"dialog-footer"},as={__name:"TopicInput",props:{modelValue:{type:Array,default:()=>[]},platformKey:{type:Number,required:!0},validateOnInput:{type:Boolean,default:!0}},emits:["update:modelValue","validation-change"],setup(s,{expose:i,emit:n}){const c=s,f=n,b=H(()=>pe(c.platformKey)),u=H({get:()=>c.modelValue,set:M=>f("update:modelValue",M)}),$=H(()=>u.value.length>=b.value.topicLimit),T=R(""),C=R(!1),U=R(""),I=["游戏","知识","自动化","系统平台","自媒体工具","跨境电商","科技","教程","云手机平台","云电脑平台","脚本","开源","健康","时尚","美妆","摄影","宠物","汽车"],E=()=>{if($.value){V.warning(`最多只能添加${b.value.topicLimit}个话题`);return}C.value=!0},h=()=>{if(!U.value.trim()){V.warning("请输入话题内容");return}const M=sa(U.value.trim());if(!M.valid){V.error(M.message);return}if($.value){V.warning(`最多只能添加${b.value.topicLimit}个话题`);return}u.value.includes(U.value.trim())?V.warning("话题已存在"):(u.value.push(U.value.trim()),U.value="",V.success("话题添加成功"),k())},o=M=>{if($.value&&!u.value.includes(M)){V.warning(`最多只能添加${b.value.topicLimit}个话题`);return}const P=u.value.indexOf(M);P>-1?u.value.splice(P,1):u.value.push(M),k()},q=M=>{u.value.splice(M,1),k()},x=()=>{C.value=!1,U.value="",V.success("添加话题完成")},k=()=>{if(c.validateOnInput){const M=$e(u.value,c.platformKey);T.value=M.valid?"":M.message,f("validation-change",M)}};return i({validate:()=>{const M=$e(c.modelValue,c.platformKey);return T.value=M.valid?"":M.message,f("validation-change",M),M}}),(M,P)=>{const W=m("el-tag"),j=m("el-button"),D=m("el-alert"),r=m("el-input"),F=m("el-dialog");return v(),A("div",Wa,[P[9]||(P[9]=l("h3",null,"话题",-1)),l("div",Xa,[l("div",Ga,[(v(!0),A(Y,null,Z(u.value,(K,y)=>(v(),J(W,{key:y,closable:"",onClose:d=>q(y),class:"topic-tag"},{default:t(()=>[g(" #"+S(K),1)]),_:2},1032,["onClose"]))),128))]),e(j,{type:"primary",plain:"",onClick:E,class:"select-topic-btn",disabled:$.value},{default:t(()=>[...P[3]||(P[3]=[g(" 添加话题 ",-1)])]),_:1},8,["disabled"])]),b.value?(v(),A("div",Ja,[e(D,{title:`已添加 ${u.value.length}/${b.value.topicLimit} 个话题`,type:$.value?"warning":"info",closable:!1,"show-icon":"",class:"topic-alert"},null,8,["title","type"])])):G("",!0),T.value?(v(),A("div",Qa,[e(D,{title:T.value,type:"error",closable:!1,"show-icon":"",class:"error-alert"},null,8,["title"])])):G("",!0),e(F,{modelValue:C.value,"onUpdate:modelValue":P[2]||(P[2]=K=>C.value=K),title:"添加话题",width:"600px",class:"topic-dialog"},{footer:t(()=>[l("div",ls,[e(j,{onClick:P[1]||(P[1]=K=>C.value=!1)},{default:t(()=>[...P[7]||(P[7]=[g("取消",-1)])]),_:1}),e(j,{type:"primary",onClick:x},{default:t(()=>[...P[8]||(P[8]=[g("确定",-1)])]),_:1})])]),default:t(()=>[l("div",Ya,[l("div",Za,[e(r,{modelValue:U.value,"onUpdate:modelValue":P[0]||(P[0]=K=>U.value=K),placeholder:"输入自定义话题",class:"custom-input",onKeyup:Oe(h,["enter"])},{prepend:t(()=>[...P[4]||(P[4]=[g("#",-1)])]),_:1},8,["modelValue"]),e(j,{type:"primary",onClick:h},{default:t(()=>[...P[5]||(P[5]=[g("添加",-1)])]),_:1})]),l("div",es,[P[6]||(P[6]=l("h4",null,"推荐话题",-1)),l("div",ts,[(v(),A(Y,null,Z(I,K=>e(j,{key:K,type:u.value.includes(K)?"primary":"default",onClick:y=>o(K),class:"topic-btn",disabled:u.value.includes(K)&&$.value},{default:t(()=>[g(S(K),1)]),_:2},1032,["type","onClick","disabled"])),64))])])])]),_:1},8,["modelValue"])])}}},ss=Q(as,[["__scopeId","data-v-b3973a1b"]]),os={class:"schedule-section"},ns={class:"schedule-controls"},is={key:0,class:"schedule-settings"},us={class:"schedule-item"},ds={class:"schedule-item"},rs={class:"time-selectors"},cs={class:"schedule-item"},ps={__name:"ScheduleSettings",props:{scheduleEnabled:{type:Boolean,default:!1},videosPerDay:{type:Number,default:1},dailyTimes:{type:Array,default:()=>["10:00"]},startDays:{type:Number,default:0}},emits:["update:scheduleEnabled","update:videosPerDay","update:dailyTimes","update:startDays"],setup(s,{emit:i}){const n=s,c=i,f=H({get:()=>n.scheduleEnabled,set:U=>c("update:scheduleEnabled",U)}),b=H({get:()=>n.videosPerDay,set:U=>c("update:videosPerDay",U)}),u=H({get:()=>n.dailyTimes,set:U=>c("update:dailyTimes",U)}),$=H({get:()=>n.startDays,set:U=>c("update:startDays",U)}),T=U=>{U||(c("update:videosPerDay",1),c("update:dailyTimes",["10:00"]),c("update:startDays",0))},C=()=>{if(u.value.length<b.value){const U=[...u.value,"10:00"];c("update:dailyTimes",U)}};return(U,I)=>{const E=m("el-switch"),h=m("el-option"),o=m("el-select"),q=m("el-time-select"),x=m("el-button");return v(),A("div",os,[I[7]||(I[7]=l("h3",null,"定时发布",-1)),l("div",ns,[e(E,{modelValue:f.value,"onUpdate:modelValue":I[0]||(I[0]=k=>f.value=k),"active-text":"定时发布","inactive-text":"立即发布",onChange:T},null,8,["modelValue"]),f.value?(v(),A("div",is,[l("div",us,[I[3]||(I[3]=l("span",{class:"label"},"每天发布视频数：",-1)),e(o,{modelValue:b.value,"onUpdate:modelValue":I[1]||(I[1]=k=>b.value=k),placeholder:"选择发布数量"},{default:t(()=>[(v(),A(Y,null,Z(55,k=>e(h,{key:k,label:k,value:k},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),l("div",ds,[I[5]||(I[5]=l("span",{class:"label"},"每天发布时间：",-1)),l("div",rs,[(v(!0),A(Y,null,Z(u.value,(k,B)=>(v(),J(q,{key:B,modelValue:u.value[B],"onUpdate:modelValue":M=>u.value[B]=M,start:"00:00",step:"00:30",end:"23:30",placeholder:"选择时间"},null,8,["modelValue","onUpdate:modelValue"]))),128)),u.value.length<b.value?(v(),J(x,{key:0,type:"primary",size:"small",onClick:C},{default:t(()=>[...I[4]||(I[4]=[g(" 添加时间 ",-1)])]),_:1})):G("",!0)])]),l("div",cs,[I[6]||(I[6]=l("span",{class:"label"},"开始天数：",-1)),e(o,{modelValue:$.value,"onUpdate:modelValue":I[2]||(I[2]=k=>$.value=k),placeholder:"选择开始天数"},{default:t(()=>[e(h,{label:"明天",value:0}),e(h,{label:"后天",value:1})]),_:1},8,["modelValue"])])])):G("",!0)])])}}},ms=Q(ps,[["__scopeId","data-v-7e1e15aa"]]),fs={class:"publish-center"},vs={class:"publish-content"},_s={class:"tab-content-wrapper"},gs={key:0,class:"publish-status"},ys={class:"action-buttons"},hs={class:"publish-progress"},bs={key:0,class:"current-publishing"},$s={key:1,class:"publish-results"},ws={class:"label"},ks={class:"message"},Vs={class:"dialog-footer"},Cs={__name:"PublishCenter",setup(s){const i="http://localhost:5409",n=H(()=>({Authorization:`Bearer ${localStorage.getItem("token")||""}`})),c=R("tab1");let f=1;const b=ge(),u=ke(),$=H(()=>b.materials),T=R(!1);we(async()=>{try{const y=await ve.getValidAccounts({validate:0});y&&y.code===200&&Array.isArray(y.data)&&u.setAccounts(y.data)}catch(y){console.warn("初始化获取账号失败",y)}});const C=ie([{name:"tab1",label:"发布1",fileList:[],displayFileList:[],selectedAccounts:[],selectedPlatform:1,title:"",selectedTopics:[],scheduleEnabled:!1,videosPerDay:1,dailyTimes:["10:00"],startDays:0,publishStatus:null,validationErrors:{}}]),U=R(!1),I=R(null),E=R(0),h=R([]),o=R(!1),q=()=>{f++;const y={name:`tab${f}`,label:`发布${f}`,fileList:[],displayFileList:[],selectedAccounts:[],selectedPlatform:1,title:"",selectedTopics:[],scheduleEnabled:!1,videosPerDay:1,dailyTimes:["10:00"],startDays:0,publishStatus:null,validationErrors:{}};C.push(y),c.value=y.name},x=y=>{const d=C.findIndex(a=>a.name===y);d>-1&&(C.splice(d,1),c.value===y&&C.length>0&&(c.value=C[0].name))},k=y=>{const d=C.find(a=>a.name===c.value);d&&(d.selectedAccounts=[])},B=(y,d,a)=>{d.valid?delete a.validationErrors[y]:a.validationErrors[y]=d.message},M=(y,d,a)=>{if(y.code===200){const N=y.data.path||y.data,L=N.split("/").pop(),O={name:d.name,url:ae.getMaterialPreviewUrl(L),path:N,size:d.size,type:d.type};a.fileList.push(O),a.displayFileList=[...a.fileList.map(X=>({name:X.name,url:X.url}))],V.success("文件上传成功"),console.log("上传成功:",O)}else V.error(y.msg||"上传失败")},P=(y,d)=>{y.forEach(a=>{const N=$.value.find(L=>L.id===a);if(N){const L={name:N.filename,url:ae.getMaterialPreviewUrl(N.file_path.split("/").pop()),path:N.file_path,size:N.filesize*1024*1024,type:"video/mp4"};d.fileList.some(X=>X.path===L.path)||d.fileList.push(L)}}),d.displayFileList=[...d.fileList.map(a=>({name:a.name,url:a.url}))]},W=(y,d)=>{y.fileList.splice(d,1),y.displayFileList=[...y.fileList.map(a=>({name:a.name,url:a.url}))],V.success("文件删除成功")},j=y=>{V.info("已取消发布")},D=async y=>new Promise((d,a)=>{const N=oa(y);if(!N.valid){const O=Object.values(N.errors)[0];V.error(O),a(new Error(O));return}const L={type:y.selectedPlatform,title:y.title,tags:y.selectedTopics,fileList:y.fileList.map(O=>O.path),accountList:y.selectedAccounts.map(O=>{const X=u.accounts.find(p=>p.id===O);return X?X.filePath:O}),enableTimer:y.scheduleEnabled?1:0,videosPerDay:y.scheduleEnabled&&y.videosPerDay||1,dailyTimes:y.scheduleEnabled?y.dailyTimes||["10:00"]:["10:00"],startDays:y.scheduleEnabled&&y.startDays||0,category:0};fetch(`${i}/postVideo`,{method:"POST",headers:{"Content-Type":"application/json",...n.value},body:JSON.stringify(L)}).then(O=>O.json()).then(O=>{O.code===200?(y.publishStatus={message:"发布成功",type:"success"},y.fileList=[],y.displayFileList=[],y.title="",y.selectedTopics=[],y.selectedAccounts=[],y.scheduleEnabled=!1,y.validationErrors={},d()):(y.publishStatus={message:`发布失败：${O.msg||"发布失败"}`,type:"error"},a(new Error(O.msg||"发布失败")))}).catch(O=>{console.error("发布错误:",O),y.publishStatus={message:"发布失败，请检查网络连接",type:"error"},a(O)})}),r=()=>{const y=[];return C.forEach(d=>{const a=[];(!d.fileList||d.fileList.length===0)&&a.push("未上传视频"),(!d.selectedAccounts||d.selectedAccounts.length===0)&&a.push("未选择账号"),a.length&&y.push({tab:d,message:`${d.label}: ${a.join("、")}`})}),y},F=async()=>{if(T.value)return;const y=r();if(y.length>0){c.value=y[0].tab.name,y[0].tab.publishStatus={message:y[0].message,type:"error"};try{await ce.alert(y.map(d=>d.message).join(`
`),"请完善发布项后再批量发布",{confirmButtonText:"好的"})}catch{}V.error("存在未准备完成的发布项：请为每个发布项上传视频并选择账号");return}T.value=!0,I.value=null,E.value=0,h.value=[],o.value=!1,U.value=!0;try{for(let L=0;L<C.length;L++){if(o.value){h.value.push({label:C[L].label,status:"cancelled",message:"已取消"});continue}const O=C[L];I.value=O,E.value=Math.floor(L/C.length*100);try{await D(O),h.value.push({label:O.label,status:"success",message:"发布成功"})}catch(X){h.value.push({label:O.label,status:"error",message:X.message})}}E.value=100;const d=h.value.filter(L=>L.status==="success").length,a=h.value.filter(L=>L.status==="error").length,N=h.value.filter(L=>L.status==="cancelled").length;o.value?V.warning(`发布已取消：${d}个成功，${a}个失败，${N}个未执行`):a>0?V.error(`发布完成：${d}个成功，${a}个失败`):(V.success("所有Tab发布成功"),setTimeout(()=>{U.value=!1},1e3))}catch(d){console.error("批量发布出错:",d),V.error("批量发布出错，请重试")}finally{T.value=!1,o.value=!1}},K=()=>{o.value=!0,V.info("正在取消发布...")};return(y,d)=>{const a=m("el-alert"),N=m("el-button"),L=m("el-progress"),O=m("el-icon"),X=m("el-dialog");return v(),A("div",fs,[e(pa,{tabs:C,"active-tab":c.value,"batch-publishing":T.value,onTabChange:d[0]||(d[0]=p=>c.value=p),onRemoveTab:x,onAddTab:q,onBatchPublish:F},null,8,["tabs","active-tab","batch-publishing"]),l("div",vs,[l("div",_s,[(v(!0),A(Y,null,Z(C,p=>_e((v(),A("div",{key:p.name,class:"tab-content"},[p.publishStatus?(v(),A("div",gs,[e(a,{title:p.publishStatus.message,type:p.publishStatus.type,closable:!1,"show-icon":""},null,8,["title","type"])])):G("",!0),e(xa,{"file-list":p.fileList,"upload-action":`${z(i)}/upload`,"auth-headers":n.value,materials:$.value,onRemoveFile:w=>W(p,w),onUploadSuccess:(w,ee)=>M(w,ee,p),onMaterialSelected:w=>P(w,p)},null,8,["file-list","upload-action","auth-headers","materials","onRemoveFile","onUploadSuccess","onMaterialSelected"]),e(Ua,{modelValue:p.selectedPlatform,"onUpdate:modelValue":w=>p.selectedPlatform=w,onPlatformChange:k},null,8,["modelValue","onUpdate:modelValue"]),e(qa,{modelValue:p.selectedAccounts,"onUpdate:modelValue":w=>p.selectedAccounts=w,"platform-key":p.selectedPlatform},null,8,["modelValue","onUpdate:modelValue","platform-key"]),e(Ha,{modelValue:p.title,"onUpdate:modelValue":w=>p.title=w,"platform-key":p.selectedPlatform,onValidationChange:w=>B("title",w,p)},null,8,["modelValue","onUpdate:modelValue","platform-key","onValidationChange"]),e(ss,{modelValue:p.selectedTopics,"onUpdate:modelValue":w=>p.selectedTopics=w,"platform-key":p.selectedPlatform,onValidationChange:w=>B("topics",w,p)},null,8,["modelValue","onUpdate:modelValue","platform-key","onValidationChange"]),e(ms,{"schedule-enabled":p.scheduleEnabled,"onUpdate:scheduleEnabled":w=>p.scheduleEnabled=w,"videos-per-day":p.videosPerDay,"onUpdate:videosPerDay":w=>p.videosPerDay=w,"daily-times":p.dailyTimes,"onUpdate:dailyTimes":w=>p.dailyTimes=w,"start-days":p.startDays,"onUpdate:startDays":w=>p.startDays=w},null,8,["schedule-enabled","onUpdate:scheduleEnabled","videos-per-day","onUpdate:videosPerDay","daily-times","onUpdate:dailyTimes","start-days","onUpdate:startDays"]),l("div",ys,[e(N,{size:"small",onClick:w=>j()},{default:t(()=>[...d[3]||(d[3]=[g("取消",-1)])]),_:1},8,["onClick"]),e(N,{size:"small",type:"primary",onClick:w=>D(p)},{default:t(()=>[...d[4]||(d[4]=[g("发布",-1)])]),_:1},8,["onClick"])])])),[[ye,c.value===p.name]])),128))])]),e(X,{modelValue:U.value,"onUpdate:modelValue":d[2]||(d[2]=p=>U.value=p),title:"批量发布进度",width:"500px","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},{footer:t(()=>[l("div",Vs,[e(N,{onClick:K,disabled:E.value===100},{default:t(()=>[...d[5]||(d[5]=[g(" 取消发布 ",-1)])]),_:1},8,["disabled"]),E.value===100?(v(),J(N,{key:0,type:"primary",onClick:d[1]||(d[1]=p=>U.value=!1)},{default:t(()=>[...d[6]||(d[6]=[g(" 关闭 ",-1)])]),_:1})):G("",!0)])]),default:t(()=>[l("div",hs,[e(L,{percentage:E.value,status:E.value===100?"success":""},null,8,["percentage","status"]),I.value?(v(),A("div",bs," 正在发布："+S(I.value.label),1)):G("",!0),h.value.length>0?(v(),A("div",$s,[(v(!0),A(Y,null,Z(h.value,(p,w)=>(v(),A("div",{key:w,class:le(["result-item",p.status])},[p.status==="success"?(v(),J(O,{key:0},{default:t(()=>[e(z(at))]),_:1})):p.status==="error"?(v(),J(O,{key:1},{default:t(()=>[e(z(xe))]),_:1})):(v(),J(O,{key:2},{default:t(()=>[e(z(st))]),_:1})),l("span",ws,S(p.label),1),l("span",ks,S(p.message),1)],2))),128))])):G("",!0)])]),_:1},8,["modelValue"])])}}},As=Q(Cs,[["__scopeId","data-v-beede16c"]]),Ts={class:"about"},xs={__name:"About",setup(s){return(i,n)=>(v(),A("div",Ts,[...n[0]||(n[0]=[l("h1",null,"关于我们",-1),l("p",null,"这是关于页面",-1)])]))}},Ps=Q(xs,[["__scopeId","data-v-cd67ee8e"]]),Ss=[{path:"/",name:"Dashboard",component:Qt},{path:"/account-management",name:"AccountManagement",component:Fl},{path:"/material-management",name:"MaterialManagement",component:la},{path:"/publish-center",name:"PublishCenter",component:As},{path:"/about",name:"About",component:Ps}],Ms=Re({history:Be(),routes:Ss}),Us=qe(),me=Ne(_t);for(const[s,i]of Object.entries(ot))me.component(s,i);me.use(Ms);me.use(Us);me.use(nt);me.mount("#app");
