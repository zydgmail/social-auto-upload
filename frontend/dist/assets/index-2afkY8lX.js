import{b as H,ax as Ie,r as R,c as k,o as f,R as e,J as t,al as p,a as l,K as ve,S as ye,u as D,p as ie,ay as Ee,P as M,O as _,I as J,L as G,az as Ce,t as we,X as ze,ar as De,E as le,Q as Y,a6 as Z,W as Fe,a4 as Oe,aA as Re,aB as Be,aC as qe,au as Ne}from"./vue-CbZdtcPO.js";import{h as Ke,u as Ae,p as je,a as ue,m as He,d as Te,f as We,b as Xe,l as Ge,c as Je,e as Qe,t as Ye,E as $,g as _e,r as se,i as Ze,j as et,k as tt,n as xe,o as lt,q as at,s as st,v as ot,w as nt}from"./elementPlus-CSqc6bT9.js";import{a as it}from"./utils-NIGUFBhG.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))c(m);new MutationObserver(m=>{for(const y of m)if(y.type==="childList")for(const d of y.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&c(d)}).observe(document,{childList:!0,subtree:!0});function n(m){const y={};return m.integrity&&(y.integrity=m.integrity),m.referrerPolicy&&(y.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?y.credentials="include":m.crossOrigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function c(m){if(m.ep)return;m.ep=!0;const y=n(m);fetch(m.href,y)}})();const ut="/vite.svg",Q=(a,i)=>{const n=a.__vccOpts||a;for(const[c,m]of i)n[c]=m;return n},dt={id:"app"},rt={class:"sidebar"},ct={class:"logo"},pt={src:ut,alt:"Logo",class:"logo-img"},mt={class:"header-content"},ft={class:"header-left"},vt={__name:"App",setup(a){const i=Ie(),n=H(()=>i.path),c=R(!1),m=()=>{c.value=!c.value};return(y,d)=>{const h=p("el-icon"),C=p("el-menu-item"),V=p("el-menu"),I=p("el-aside"),E=p("el-header"),z=p("router-view"),g=p("el-main"),o=p("el-container");return f(),k("div",dt,[e(o,null,{default:t(()=>[e(I,{width:c.value?"64px":"200px"},{default:t(()=>[l("div",rt,[l("div",ct,[ve(l("img",pt,null,512),[[ye,c.value]]),ve(l("h2",null,"自媒体自动化运营系统",512),[[ye,!c.value]])]),e(V,{router:!0,"default-active":n.value,collapse:c.value,class:"sidebar-menu","background-color":"#001529","text-color":"#fff","active-text-color":"#409EFF"},{default:t(()=>[e(C,{index:"/"},{default:t(()=>[e(h,null,{default:t(()=>[e(D(Ke))]),_:1}),d[0]||(d[0]=l("span",null,"首页",-1))]),_:1}),e(C,{index:"/account-management"},{default:t(()=>[e(h,null,{default:t(()=>[e(D(Ae))]),_:1}),d[1]||(d[1]=l("span",null,"账号管理",-1))]),_:1}),e(C,{index:"/material-management"},{default:t(()=>[e(h,null,{default:t(()=>[e(D(je))]),_:1}),d[2]||(d[2]=l("span",null,"素材管理",-1))]),_:1}),e(C,{index:"/publish-center"},{default:t(()=>[e(h,null,{default:t(()=>[e(D(ue))]),_:1}),d[3]||(d[3]=l("span",null,"发布中心",-1))]),_:1}),e(C,{index:"/website"},{default:t(()=>[e(h,null,{default:t(()=>[e(D(He))]),_:1}),d[4]||(d[4]=l("span",null,"网站",-1))]),_:1}),e(C,{index:"/data"},{default:t(()=>[e(h,null,{default:t(()=>[e(D(Te))]),_:1}),d[5]||(d[5]=l("span",null,"数据",-1))]),_:1})]),_:1},8,["default-active","collapse"])])]),_:1},8,["width"]),e(o,null,{default:t(()=>[e(E,null,{default:t(()=>[l("div",mt,[l("div",ft,[e(h,{class:"toggle-sidebar",onClick:m},{default:t(()=>[e(D(We))]),_:1})]),d[6]||(d[6]=l("div",{class:"header-right"},null,-1))])]),_:1}),e(g,null,{default:t(()=>[e(z)]),_:1})]),_:1})]),_:1})])}}},_t=Q(vt,[["__scopeId","data-v-176fbaed"]]),gt={class:"dashboard"},yt={class:"dashboard-content"},ht={class:"stat-card-content"},bt={class:"stat-icon"},$t={class:"stat-info"},wt={class:"stat-value"},kt={class:"stat-footer"},Vt={class:"stat-detail"},Ct={class:"stat-card-content"},At={class:"stat-icon platform-icon"},Tt={class:"stat-info"},xt={class:"stat-value"},Pt={class:"stat-footer"},St={class:"stat-detail"},Mt={class:"stat-card-content"},Ut={class:"stat-icon task-icon"},Lt={class:"stat-info"},It={class:"stat-value"},Et={class:"stat-footer"},zt={class:"stat-detail"},Dt={class:"stat-card-content"},Ft={class:"stat-icon content-icon"},Ot={class:"stat-info"},Rt={class:"stat-value"},Bt={class:"stat-footer"},qt={class:"stat-detail"},Nt={class:"quick-actions"},Kt={class:"action-icon"},jt={class:"action-icon"},Ht={class:"action-icon"},Wt={class:"action-icon"},Xt={class:"recent-tasks"},Gt={class:"section-header"},Jt={__name:"Dashboard",setup(a){const i=Ee(),n=ie({total:12,normal:10,abnormal:2}),c=ie({total:4,kuaishou:3,douyin:4,channels:2,xiaohongshu:3}),m=ie({total:24,completed:18,inProgress:5,failed:1}),y=ie({total:36,published:30,draft:6}),d=R([{id:1,title:"快手视频自动发布",platform:"快手",account:"快手账号1",createTime:"2024-05-01 10:30:00",status:"已完成"},{id:2,title:"抖音视频定时发布",platform:"抖音",account:"抖音账号1",createTime:"2024-05-01 11:15:00",status:"进行中"},{id:3,title:"视频号内容上传",platform:"视频号",account:"视频号账号1",createTime:"2024-05-01 14:20:00",status:"待执行"},{id:4,title:"小红书图文发布",platform:"小红书",account:"小红书账号1",createTime:"2024-05-01 16:45:00",status:"已失败"},{id:5,title:"快手短视频批量上传",platform:"快手",account:"快手账号2",createTime:"2024-05-02 09:10:00",status:"待执行"}]),h=g=>({快手:"success",抖音:"danger",视频号:"warning",小红书:"info"})[g]||"info",C=g=>({已完成:"success",进行中:"warning",待执行:"info",已失败:"danger"})[g]||"info",V=g=>{i.push(g)},I=g=>{$.info(`查看任务: ${g.title}`)},E=g=>{_e.confirm(`确定要执行任务 ${g.title} 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(()=>{const o=d.value.findIndex(N=>N.id===g.id);o!==-1&&(d.value[o].status="进行中"),$({type:"success",message:"任务已开始执行"})}).catch(()=>{})},z=g=>{_e.confirm(`确定要取消任务 ${g.title} 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const o=d.value.findIndex(N=>N.id===g.id);o!==-1&&(d.value[o].status="已取消"),$({type:"success",message:"任务已取消"})}).catch(()=>{})};return(g,o)=>{const N=p("el-icon"),T=p("el-card"),b=p("el-col"),q=p("el-tag"),U=p("el-tooltip"),S=p("el-row"),W=p("el-button"),K=p("el-table-column"),F=p("el-table");return f(),k("div",gt,[o[19]||(o[19]=l("div",{class:"page-header"},[l("h1",null,"自媒体自动化运营系统")],-1)),l("div",yt,[e(S,{gutter:20},{default:t(()=>[e(b,{span:6},{default:t(()=>[e(T,{class:"stat-card"},{default:t(()=>[l("div",ht,[l("div",bt,[e(N,null,{default:t(()=>[e(D(Ae))]),_:1})]),l("div",$t,[l("div",wt,M(n.total),1),o[1]||(o[1]=l("div",{class:"stat-label"},"账号总数",-1))])]),l("div",kt,[l("div",Vt,[l("span",null,"正常: "+M(n.normal),1),l("span",null,"异常: "+M(n.abnormal),1)])])]),_:1})]),_:1}),e(b,{span:6},{default:t(()=>[e(T,{class:"stat-card"},{default:t(()=>[l("div",Ct,[l("div",At,[e(N,null,{default:t(()=>[e(D(Xe))]),_:1})]),l("div",Tt,[l("div",xt,M(c.total),1),o[2]||(o[2]=l("div",{class:"stat-label"},"平台总数",-1))])]),l("div",Pt,[l("div",St,[e(U,{content:"快手账号",placement:"top"},{default:t(()=>[e(q,{size:"small",type:"success"},{default:t(()=>[_(M(c.kuaishou),1)]),_:1})]),_:1}),e(U,{content:"抖音账号",placement:"top"},{default:t(()=>[e(q,{size:"small",type:"danger"},{default:t(()=>[_(M(c.douyin),1)]),_:1})]),_:1}),e(U,{content:"视频号账号",placement:"top"},{default:t(()=>[e(q,{size:"small",type:"warning"},{default:t(()=>[_(M(c.channels),1)]),_:1})]),_:1}),e(U,{content:"小红书账号",placement:"top"},{default:t(()=>[e(q,{size:"small",type:"info"},{default:t(()=>[_(M(c.xiaohongshu),1)]),_:1})]),_:1})])])]),_:1})]),_:1}),e(b,{span:6},{default:t(()=>[e(T,{class:"stat-card"},{default:t(()=>[l("div",Mt,[l("div",Ut,[e(N,null,{default:t(()=>[e(D(Ge))]),_:1})]),l("div",Lt,[l("div",It,M(m.total),1),o[3]||(o[3]=l("div",{class:"stat-label"},"任务总数",-1))])]),l("div",Et,[l("div",zt,[l("span",null,"完成: "+M(m.completed),1),l("span",null,"进行中: "+M(m.inProgress),1),l("span",null,"失败: "+M(m.failed),1)])])]),_:1})]),_:1}),e(b,{span:6},{default:t(()=>[e(T,{class:"stat-card"},{default:t(()=>[l("div",Dt,[l("div",Ft,[e(N,null,{default:t(()=>[e(D(Je))]),_:1})]),l("div",Ot,[l("div",Rt,M(y.total),1),o[4]||(o[4]=l("div",{class:"stat-label"},"内容总数",-1))])]),l("div",Bt,[l("div",qt,[l("span",null,"已发布: "+M(y.published),1),l("span",null,"草稿: "+M(y.draft),1)])])]),_:1})]),_:1})]),_:1}),l("div",Nt,[o[13]||(o[13]=l("h2",null,"快捷操作",-1)),e(S,{gutter:20},{default:t(()=>[e(b,{span:6},{default:t(()=>[e(T,{class:"action-card",onClick:o[0]||(o[0]=r=>V("/account-management"))},{default:t(()=>[l("div",Kt,[e(N,null,{default:t(()=>[e(D(Qe))]),_:1})]),o[5]||(o[5]=l("div",{class:"action-title"},"账号管理",-1)),o[6]||(o[6]=l("div",{class:"action-desc"},"管理所有平台账号",-1))]),_:1})]),_:1}),e(b,{span:6},{default:t(()=>[e(T,{class:"action-card"},{default:t(()=>[l("div",jt,[e(N,null,{default:t(()=>[e(D(ue))]),_:1})]),o[7]||(o[7]=l("div",{class:"action-title"},"内容上传",-1)),o[8]||(o[8]=l("div",{class:"action-desc"},"上传视频和图文内容",-1))]),_:1})]),_:1}),e(b,{span:6},{default:t(()=>[e(T,{class:"action-card"},{default:t(()=>[l("div",Ht,[e(N,null,{default:t(()=>[e(D(Ye))]),_:1})]),o[9]||(o[9]=l("div",{class:"action-title"},"定时发布",-1)),o[10]||(o[10]=l("div",{class:"action-desc"},"设置内容发布时间",-1))]),_:1})]),_:1}),e(b,{span:6},{default:t(()=>[e(T,{class:"action-card"},{default:t(()=>[l("div",Wt,[e(N,null,{default:t(()=>[e(D(Te))]),_:1})]),o[11]||(o[11]=l("div",{class:"action-title"},"数据分析",-1)),o[12]||(o[12]=l("div",{class:"action-desc"},"查看内容数据分析",-1))]),_:1})]),_:1})]),_:1})]),l("div",Xt,[l("div",Gt,[o[15]||(o[15]=l("h2",null,"最近任务",-1)),e(W,{text:""},{default:t(()=>[...o[14]||(o[14]=[_("查看全部",-1)])]),_:1})]),e(F,{data:d.value,style:{width:"100%"}},{default:t(()=>[e(K,{prop:"title",label:"任务名称",width:"250"}),e(K,{prop:"platform",label:"平台",width:"120"},{default:t(r=>[e(q,{type:h(r.row.platform),effect:"plain"},{default:t(()=>[_(M(r.row.platform),1)]),_:2},1032,["type"])]),_:1}),e(K,{prop:"account",label:"账号",width:"150"}),e(K,{prop:"createTime",label:"创建时间",width:"180"}),e(K,{prop:"status",label:"状态",width:"120"},{default:t(r=>[e(q,{type:C(r.row.status),effect:"plain"},{default:t(()=>[_(M(r.row.status),1)]),_:2},1032,["type"])]),_:1}),e(K,{label:"操作"},{default:t(r=>[e(W,{size:"small",onClick:O=>I(r.row)},{default:t(()=>[...o[16]||(o[16]=[_("查看",-1)])]),_:1},8,["onClick"]),r.row.status==="待执行"?(f(),J(W,{key:0,size:"small",type:"primary",onClick:O=>E(r.row)},{default:t(()=>[...o[17]||(o[17]=[_(" 执行 ",-1)])]),_:1},8,["onClick"])):G("",!0),r.row.status!=="已完成"&&r.row.status!=="已失败"?(f(),J(W,{key:1,size:"small",type:"danger",onClick:O=>z(r.row)},{default:t(()=>[...o[18]||(o[18]=[_(" 取消 ",-1)])]),_:1},8,["onClick"])):G("",!0)]),_:1})]),_:1},8,["data"])])])])}}},Qt=Q(Jt,[["__scopeId","data-v-db5c2d61"]]),oe=it.create({baseURL:"http://localhost:5409",headers:{"Content-Type":"application/json"}});oe.interceptors.request.use(a=>{const i=localStorage.getItem("token");return i&&(a.headers.Authorization=`Bearer ${i}`),a},a=>(console.error("请求错误:",a),Promise.reject(a)));oe.interceptors.response.use(a=>{const{data:i}=a;return i.code===200||i.success?i:($.error(i.message||"请求失败"),Promise.reject(new Error(i.message||"请求失败")))},a=>{if(console.error("响应错误:",a),a.response){const{status:i}=a.response;switch(i){case 401:$.error("未授权，请重新登录");break;case 403:$.error("拒绝访问");break;case 404:$.error("请求地址不存在");break;case 500:$.error("服务器内部错误");break;default:$.error("网络错误")}}else $.error("网络连接失败");return Promise.reject(a)});const ne={get(a,i){return oe.get(a,{params:i})},post(a,i,n={}){return oe.post(a,i,n)},put(a,i,n={}){return oe.put(a,i,n)},delete(a,i){return oe.delete(a,{params:i})},upload(a,i){return oe.post(a,i,{headers:{"Content-Type":"multipart/form-data"}})}},fe={getValidAccounts(a){return ne.get("/getValidAccounts",a)},addAccount(a){return ne.post("/account",a)},updateAccount(a){return ne.post("/updateUserinfo",a)},deleteAccount(a){return ne.get(`/deleteAccount?id=${a}`)}},ke=Ce("account",()=>{const a=R([]),i={1:"小红书",2:"视频号",3:"抖音",4:"快手"};return{accounts:a,setAccounts:h=>{a.value=h.map(C=>({id:C[0],type:C[1],filePath:C[2],name:C[3],status:C[4]===1?"正常":"异常",platform:i[C[1]]||"未知",avatar:"/vite.svg"}))},addAccount:h=>{a.value.push(h)},updateAccount:(h,C)=>{const V=a.value.findIndex(I=>I.id===h);V!==-1&&(a.value[V]={...a.value[V],...C})},deleteAccount:h=>{a.value=a.value.filter(C=>C.id!==h)},getAccountsByPlatform:h=>a.value.filter(C=>C.platform===h)}}),ge=Ce("app",()=>{const a=R(!0),i=R(!0),n=R(!1),c=R([]);return{isFirstTimeAccountManagement:a,isFirstTimeMaterialManagement:i,isAccountRefreshing:n,materials:c,setAccountManagementVisited:()=>{a.value=!1},setMaterialManagementVisited:()=>{i.value=!1},resetVisitStatus:()=>{a.value=!0,i.value=!0},setMaterials:E=>{c.value=E},addMaterial:E=>{c.value.push(E)},removeMaterial:E=>{const z=c.value.findIndex(g=>g.id===E);z>-1&&c.value.splice(z,1)},setAccountRefreshing:E=>{n.value=E}}}),Yt={class:"account-management","element-loading-text":"正在验证账号..."},Zt={class:"account-tabs"},el={class:"account-list-container"},tl={class:"account-search"},ll={class:"action-buttons"},al={class:"refresh-text"},sl={key:0,class:"account-list"},ol={key:1,class:"empty-data"},nl={class:"account-list-container"},il={class:"account-search"},ul={class:"action-buttons"},dl={class:"refresh-text"},rl={key:0,class:"account-list"},cl={key:1,class:"empty-data"},pl={class:"account-list-container"},ml={class:"account-search"},fl={class:"action-buttons"},vl={class:"refresh-text"},_l={key:0,class:"account-list"},gl={key:1,class:"empty-data"},yl={class:"account-list-container"},hl={class:"account-search"},bl={class:"action-buttons"},$l={class:"refresh-text"},wl={key:0,class:"account-list"},kl={key:1,class:"empty-data"},Vl={class:"account-list-container"},Cl={class:"account-search"},Al={class:"action-buttons"},Tl={class:"refresh-text"},xl={key:0,class:"account-list"},Pl={key:1,class:"empty-data"},Sl={key:0,class:"qrcode-container"},Ml={key:0,class:"qrcode-wrapper"},Ul=["src"],Ll={key:1,class:"loading-wrapper"},Il={key:2,class:"success-wrapper"},El={key:3,class:"error-wrapper"},zl={class:"dialog-footer"},Dl={__name:"AccountManagement",setup(a){const i=ke(),n=ge(),c=R("all"),m=R(""),y=async(A=!1)=>{if(!n.isAccountRefreshing){n.setAccountRefreshing(!0);try{const s=await fe.getValidAccounts({validate:A?1:0});s.code===200&&s.data?(i.setAccounts(s.data),A&&$.success("账号验证完成"),n.isFirstTimeAccountManagement&&n.setAccountManagementVisited()):$.error("获取账号数据失败")}catch(s){console.error("获取账号数据失败:",s),$.error("获取账号数据失败")}finally{n.setAccountRefreshing(!1)}}};we(()=>{n.isFirstTimeAccountManagement&&y(!1)});const d=A=>({快手:"success",抖音:"danger",视频号:"warning",小红书:"info"})[A]||"info",h=H(()=>m.value?i.accounts.filter(A=>A.name.includes(m.value)):i.accounts),C=H(()=>h.value.filter(A=>A.platform==="快手")),V=H(()=>h.value.filter(A=>A.platform==="抖音")),I=H(()=>h.value.filter(A=>A.platform==="视频号")),E=H(()=>h.value.filter(A=>A.platform==="小红书")),z=()=>{},g=R(!1),o=R("add"),N=R(null),T=ie({id:null,name:"",platform:"",status:"正常"}),b={platform:[{required:!0,message:"请选择平台",trigger:"change"}],name:[{required:!0,message:"请输入账号名称",trigger:"blur"}]},q=R(!1),U=R(""),S=R(""),W=()=>{o.value="add",Object.assign(T,{id:null,name:"",platform:"",status:"正常"}),q.value=!1,U.value="",S.value="",g.value=!0},K=A=>{o.value="edit",Object.assign(T,{...A}),g.value=!0},F=A=>{_e.confirm(`确定要删除账号 ${A.name} 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const s=await fe.deleteAccount(A.id);s.code===200?(i.deleteAccount(A.id),$({type:"success",message:"删除成功"})):$.error(s.msg||"删除失败")}catch(s){console.error("删除账号失败:",s),$.error("删除账号失败")}}).catch(()=>{})};let r=null;const O=()=>{r&&(r.close(),r=null)},u=(A,s)=>{O(),q.value=!0,U.value="",S.value="";const x=`http://localhost:5409/login?type=${{小红书:"1",视频号:"2",抖音:"3",快手:"4"}[A]||"1"}&id=${encodeURIComponent(s)}`;r=new EventSource(x),r.onmessage=w=>{const B=w.data;if(console.log("SSE消息:",B),!U.value&&B.length>100)try{B.startsWith("data:image")?U.value=B:U.value=`data:image/png;base64,${B}`,console.log("设置二维码数据，长度:",B.length)}catch(ee){console.error("处理二维码数据出错:",ee)}else(B==="200"||B==="500")&&(S.value=B,B==="200"?setTimeout(()=>{O(),setTimeout(()=>{g.value=!1,q.value=!1,$.success("账号添加成功"),$({type:"info",message:"正在同步账号信息...",duration:0}),y().then(()=>{$.closeAll(),$.success("账号信息已更新")})},1e3)},1e3):(O(),setTimeout(()=>{q.value=!1,U.value="",S.value=""},2e3)))},r.onerror=w=>{console.error("SSE连接错误:",w),$.error("连接服务器失败，请稍后再试"),O(),q.value=!1}},L=()=>{N.value.validate(async A=>{if(A)if(o.value==="add")u(T.platform,T.name);else try{const s=await fe.updateAccount({id:T.id,type:T.platform==="快手"?1:T.platform==="抖音"?2:T.platform==="视频号"?3:4,userName:T.name});s.code===200?(i.updateAccount(T.id,T),$.success("更新成功"),g.value=!1,y()):$.error(s.msg||"更新账号失败")}catch(s){console.error("更新账号失败:",s),$.error("更新账号失败")}else return!1})};return ze(()=>{O()}),(A,s)=>{const j=p("el-input"),P=p("el-button"),X=p("el-icon"),x=p("el-avatar"),w=p("el-table-column"),B=p("el-tag"),ee=p("el-table"),de=p("el-empty"),re=p("el-tab-pane"),Pe=p("el-tabs"),me=p("el-option"),Se=p("el-select"),Ve=p("el-form-item"),Me=p("el-form"),Ue=p("el-dialog"),Le=De("loading");return ve((f(),k("div",Yt,[s[35]||(s[35]=l("div",{class:"page-header"},[l("h1",null,"账号管理")],-1)),l("div",Zt,[e(Pe,{modelValue:c.value,"onUpdate:modelValue":s[10]||(s[10]=v=>c.value=v),class:"account-tabs-nav"},{default:t(()=>[e(re,{label:"全部",name:"all"},{default:t(()=>[l("div",el,[l("div",tl,[e(j,{modelValue:m.value,"onUpdate:modelValue":s[0]||(s[0]=v=>m.value=v),placeholder:"输入名称或账号搜索","prefix-icon":"Search",clearable:"",onClear:z,onInput:z},null,8,["modelValue"]),l("div",ll,[e(P,{type:"primary",onClick:W},{default:t(()=>[...s[15]||(s[15]=[_("添加账号",-1)])]),_:1}),e(P,{type:"info",onClick:s[1]||(s[1]=()=>y(!0))},{default:t(()=>[e(X,{class:le({"is-loading":D(n).isAccountRefreshing,"refresh-icon":!0})},{default:t(()=>[e(D(se))]),_:1},8,["class"]),l("span",al,M(D(n).isAccountRefreshing?"验证中...":"手动过期验证"),1)]),_:1})])]),h.value.length>0?(f(),k("div",sl,[e(ee,{data:h.value,style:{width:"100%"}},{default:t(()=>[e(w,{label:"头像",width:"80"},{default:t(v=>[e(x,{src:v.row.avatar,size:40},null,8,["src"])]),_:1}),e(w,{prop:"name",label:"名称",width:"180"}),e(w,{prop:"platform",label:"平台"},{default:t(v=>[e(B,{type:d(v.row.platform),effect:"plain"},{default:t(()=>[_(M(v.row.platform),1)]),_:2},1032,["type"])]),_:1}),e(w,{prop:"status",label:"状态"},{default:t(v=>[e(B,{type:v.row.status==="正常"?"success":"danger",effect:"plain"},{default:t(()=>[_(M(v.row.status),1)]),_:2},1032,["type"])]),_:1}),e(w,{label:"操作"},{default:t(v=>[e(P,{size:"small",onClick:te=>K(v.row)},{default:t(()=>[...s[16]||(s[16]=[_("编辑",-1)])]),_:1},8,["onClick"]),e(P,{size:"small",type:"danger",onClick:te=>F(v.row)},{default:t(()=>[...s[17]||(s[17]=[_("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(f(),k("div",ol,[e(de,{description:"暂无账号数据"})]))])]),_:1}),e(re,{label:"快手",name:"kuaishou"},{default:t(()=>[l("div",nl,[l("div",il,[e(j,{modelValue:m.value,"onUpdate:modelValue":s[2]||(s[2]=v=>m.value=v),placeholder:"输入名称或账号搜索","prefix-icon":"Search",clearable:"",onClear:z,onInput:z},null,8,["modelValue"]),l("div",ul,[e(P,{type:"primary",onClick:W},{default:t(()=>[...s[18]||(s[18]=[_("添加账号",-1)])]),_:1}),e(P,{type:"info",onClick:s[3]||(s[3]=()=>y(!0))},{default:t(()=>[e(X,{class:le({"is-loading":D(n).isAccountRefreshing,"refresh-icon":!0})},{default:t(()=>[e(D(se))]),_:1},8,["class"]),l("span",dl,M(D(n).isAccountRefreshing?"验证中...":"手动过期验证"),1)]),_:1})])]),C.value.length>0?(f(),k("div",rl,[e(ee,{data:C.value,style:{width:"100%"}},{default:t(()=>[e(w,{label:"头像",width:"80"},{default:t(v=>[e(x,{src:v.row.avatar,size:40},null,8,["src"])]),_:1}),e(w,{prop:"name",label:"名称",width:"180"}),e(w,{prop:"platform",label:"平台"},{default:t(v=>[e(B,{type:d(v.row.platform),effect:"plain"},{default:t(()=>[_(M(v.row.platform),1)]),_:2},1032,["type"])]),_:1}),e(w,{prop:"status",label:"状态"},{default:t(v=>[e(B,{type:v.row.status==="正常"?"success":"danger",effect:"plain"},{default:t(()=>[_(M(v.row.status),1)]),_:2},1032,["type"])]),_:1}),e(w,{label:"操作"},{default:t(v=>[e(P,{size:"small",onClick:te=>K(v.row)},{default:t(()=>[...s[19]||(s[19]=[_("编辑",-1)])]),_:1},8,["onClick"]),e(P,{size:"small",type:"danger",onClick:te=>F(v.row)},{default:t(()=>[...s[20]||(s[20]=[_("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(f(),k("div",cl,[e(de,{description:"暂无快手账号数据"})]))])]),_:1}),e(re,{label:"抖音",name:"douyin"},{default:t(()=>[l("div",pl,[l("div",ml,[e(j,{modelValue:m.value,"onUpdate:modelValue":s[4]||(s[4]=v=>m.value=v),placeholder:"输入名称或账号搜索","prefix-icon":"Search",clearable:"",onClear:z,onInput:z},null,8,["modelValue"]),l("div",fl,[e(P,{type:"primary",onClick:W},{default:t(()=>[...s[21]||(s[21]=[_("添加账号",-1)])]),_:1}),e(P,{type:"info",onClick:s[5]||(s[5]=()=>y(!0))},{default:t(()=>[e(X,{class:le({"is-loading":D(n).isAccountRefreshing,"refresh-icon":!0})},{default:t(()=>[e(D(se))]),_:1},8,["class"]),l("span",vl,M(D(n).isAccountRefreshing?"验证中...":"手动过期验证"),1)]),_:1})])]),V.value.length>0?(f(),k("div",_l,[e(ee,{data:V.value,style:{width:"100%"}},{default:t(()=>[e(w,{label:"头像",width:"80"},{default:t(v=>[e(x,{src:v.row.avatar,size:40},null,8,["src"])]),_:1}),e(w,{prop:"name",label:"名称",width:"180"}),e(w,{prop:"platform",label:"平台"},{default:t(v=>[e(B,{type:d(v.row.platform),effect:"plain"},{default:t(()=>[_(M(v.row.platform),1)]),_:2},1032,["type"])]),_:1}),e(w,{prop:"status",label:"状态"},{default:t(v=>[e(B,{type:v.row.status==="正常"?"success":"danger",effect:"plain"},{default:t(()=>[_(M(v.row.status),1)]),_:2},1032,["type"])]),_:1}),e(w,{label:"操作"},{default:t(v=>[e(P,{size:"small",onClick:te=>K(v.row)},{default:t(()=>[...s[22]||(s[22]=[_("编辑",-1)])]),_:1},8,["onClick"]),e(P,{size:"small",type:"danger",onClick:te=>F(v.row)},{default:t(()=>[...s[23]||(s[23]=[_("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(f(),k("div",gl,[e(de,{description:"暂无抖音账号数据"})]))])]),_:1}),e(re,{label:"视频号",name:"channels"},{default:t(()=>[l("div",yl,[l("div",hl,[e(j,{modelValue:m.value,"onUpdate:modelValue":s[6]||(s[6]=v=>m.value=v),placeholder:"输入名称或账号搜索","prefix-icon":"Search",clearable:"",onClear:z,onInput:z},null,8,["modelValue"]),l("div",bl,[e(P,{type:"primary",onClick:W},{default:t(()=>[...s[24]||(s[24]=[_("添加账号",-1)])]),_:1}),e(P,{type:"info",onClick:s[7]||(s[7]=()=>y(!0))},{default:t(()=>[e(X,{class:le({"is-loading":D(n).isAccountRefreshing,"refresh-icon":!0})},{default:t(()=>[e(D(se))]),_:1},8,["class"]),l("span",$l,M(D(n).isAccountRefreshing?"验证中...":"手动过期验证"),1)]),_:1})])]),I.value.length>0?(f(),k("div",wl,[e(ee,{data:I.value,style:{width:"100%"}},{default:t(()=>[e(w,{label:"头像",width:"80"},{default:t(v=>[e(x,{src:v.row.avatar,size:40},null,8,["src"])]),_:1}),e(w,{prop:"name",label:"名称",width:"180"}),e(w,{prop:"platform",label:"平台"},{default:t(v=>[e(B,{type:d(v.row.platform),effect:"plain"},{default:t(()=>[_(M(v.row.platform),1)]),_:2},1032,["type"])]),_:1}),e(w,{prop:"status",label:"状态"},{default:t(v=>[e(B,{type:v.row.status==="正常"?"success":"danger",effect:"plain"},{default:t(()=>[_(M(v.row.status),1)]),_:2},1032,["type"])]),_:1}),e(w,{label:"操作"},{default:t(v=>[e(P,{size:"small",onClick:te=>K(v.row)},{default:t(()=>[...s[25]||(s[25]=[_("编辑",-1)])]),_:1},8,["onClick"]),e(P,{size:"small",type:"danger",onClick:te=>F(v.row)},{default:t(()=>[...s[26]||(s[26]=[_("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(f(),k("div",kl,[e(de,{description:"暂无视频号账号数据"})]))])]),_:1}),e(re,{label:"小红书",name:"xiaohongshu"},{default:t(()=>[l("div",Vl,[l("div",Cl,[e(j,{modelValue:m.value,"onUpdate:modelValue":s[8]||(s[8]=v=>m.value=v),placeholder:"输入名称或账号搜索","prefix-icon":"Search",clearable:"",onClear:z,onInput:z},null,8,["modelValue"]),l("div",Al,[e(P,{type:"primary",onClick:W},{default:t(()=>[...s[27]||(s[27]=[_("添加账号",-1)])]),_:1}),e(P,{type:"info",onClick:s[9]||(s[9]=()=>y(!0))},{default:t(()=>[e(X,{class:le({"is-loading":D(n).isAccountRefreshing,"refresh-icon":!0})},{default:t(()=>[e(D(se))]),_:1},8,["class"]),l("span",Tl,M(D(n).isAccountRefreshing?"验证中...":"手动过期验证"),1)]),_:1})])]),E.value.length>0?(f(),k("div",xl,[e(ee,{data:E.value,style:{width:"100%"}},{default:t(()=>[e(w,{label:"头像",width:"80"},{default:t(v=>[e(x,{src:v.row.avatar,size:40},null,8,["src"])]),_:1}),e(w,{prop:"name",label:"名称",width:"180"}),e(w,{prop:"platform",label:"平台"},{default:t(v=>[e(B,{type:d(v.row.platform),effect:"plain"},{default:t(()=>[_(M(v.row.platform),1)]),_:2},1032,["type"])]),_:1}),e(w,{prop:"status",label:"状态"},{default:t(v=>[e(B,{type:v.row.status==="正常"?"success":"danger",effect:"plain"},{default:t(()=>[_(M(v.row.status),1)]),_:2},1032,["type"])]),_:1}),e(w,{label:"操作"},{default:t(v=>[e(P,{size:"small",onClick:te=>K(v.row)},{default:t(()=>[...s[28]||(s[28]=[_("编辑",-1)])]),_:1},8,["onClick"]),e(P,{size:"small",type:"danger",onClick:te=>F(v.row)},{default:t(()=>[...s[29]||(s[29]=[_("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(f(),k("div",Pl,[e(de,{description:"暂无小红书账号数据"})]))])]),_:1})]),_:1},8,["modelValue"])]),e(Ue,{modelValue:g.value,"onUpdate:modelValue":s[14]||(s[14]=v=>g.value=v),title:o.value==="add"?"添加账号":"编辑账号",width:"500px","close-on-click-modal":!1,"close-on-press-escape":!q.value,"show-close":!q.value},{footer:t(()=>[l("span",zl,[e(P,{onClick:s[13]||(s[13]=v=>g.value=!1)},{default:t(()=>[...s[34]||(s[34]=[_("取消",-1)])]),_:1}),e(P,{type:"primary",onClick:L,loading:q.value,disabled:q.value},{default:t(()=>[_(M(q.value?"请求中":"确认"),1)]),_:1},8,["loading","disabled"])])]),default:t(()=>[e(Me,{model:T,"label-width":"80px",rules:b,ref_key:"accountFormRef",ref:N},{default:t(()=>[e(Ve,{label:"平台",prop:"platform"},{default:t(()=>[e(Se,{modelValue:T.platform,"onUpdate:modelValue":s[11]||(s[11]=v=>T.platform=v),placeholder:"请选择平台",style:{width:"100%"},disabled:o.value==="edit"||q.value},{default:t(()=>[e(me,{label:"快手",value:"快手"}),e(me,{label:"抖音",value:"抖音"}),e(me,{label:"视频号",value:"视频号"}),e(me,{label:"小红书",value:"小红书"})]),_:1},8,["modelValue","disabled"])]),_:1}),e(Ve,{label:"名称",prop:"name"},{default:t(()=>[e(j,{modelValue:T.name,"onUpdate:modelValue":s[12]||(s[12]=v=>T.name=v),placeholder:"请输入账号名称",disabled:q.value},null,8,["modelValue","disabled"])]),_:1}),q.value?(f(),k("div",Sl,[U.value&&!S.value?(f(),k("div",Ml,[s[30]||(s[30]=l("p",{class:"qrcode-tip"},"请使用对应平台APP扫描二维码登录",-1)),l("img",{src:U.value,alt:"登录二维码",class:"qrcode-image"},null,8,Ul)])):!U.value&&!S.value?(f(),k("div",Ll,[e(X,{class:"is-loading"},{default:t(()=>[e(D(se))]),_:1}),s[31]||(s[31]=l("span",null,"请求中...",-1))])):S.value==="200"?(f(),k("div",Il,[e(X,null,{default:t(()=>[e(D(Ze))]),_:1}),s[32]||(s[32]=l("span",null,"添加成功",-1))])):S.value==="500"?(f(),k("div",El,[e(X,null,{default:t(()=>[e(D(et))]),_:1}),s[33]||(s[33]=l("span",null,"添加失败，请稍后再试",-1))])):G("",!0)])):G("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title","close-on-press-escape","show-close"])])),[[Le,D(n).isAccountRefreshing]])}}},Fl=Q(Dl,[["__scopeId","data-v-15d9d15f"]]),ae={getAllMaterials:()=>ne.get("/getFiles"),uploadMaterial:a=>ne.upload("/uploadSave",a),deleteMaterial:a=>ne.get(`/deleteFile?id=${a}`),downloadMaterial:a=>`http://localhost:5409/download/${a}`,getMaterialPreviewUrl:a=>`http://localhost:5409/getFile?filename=${a}`},Ol={class:"material-management"},Rl={class:"material-list-container"},Bl={class:"material-search"},ql={class:"action-buttons"},Nl={key:0},Kl={key:0,class:"material-list"},jl={key:1,class:"empty-data"},Hl={class:"upload-form"},Wl={class:"dialog-footer"},Xl={key:0,class:"preview-container"},Gl={key:0,class:"video-preview"},Jl={controls:"",style:{"max-width":"100%","max-height":"60vh"}},Ql=["src"],Yl={key:1,class:"image-preview"},Zl=["src"],ea={key:2,class:"file-info"},ta={__name:"MaterialManagement",setup(a){const i=ge(),n=R(""),c=R(!1),m=R(!1),y=R(!1),d=R(!1),h=R(null),C=R([]),V=R(""),I=async()=>{c.value=!0;try{const F=await ae.getAllMaterials();F.code===200?(i.setMaterials(F.data),$.success("刷新成功")):$.error("获取素材列表失败")}catch(F){console.error("获取素材列表出错:",F),$.error("获取素材列表失败")}finally{c.value=!1}},E=H(()=>{if(!n.value)return i.materials;const F=n.value.toLowerCase();return i.materials.filter(r=>r.filename.toLowerCase().includes(F))}),z=()=>{},g=()=>{C.value=[],V.value="",y.value=!0},o=()=>{C.value=[],V.value=""},N=(F,r)=>{console.log("选择的文件:",F),F.raw&&(C.value=[F])},T=async()=>{if(C.value.length===0){$.warning("请选择要上传的文件");return}const F=C.value[0];if(!F||!F.raw){$.warning("文件对象无效，请重新选择文件");return}m.value=!0;try{const r=new FormData;console.log("上传文件对象:",F.raw),r.append("file",F.raw),V.value.trim()&&(r.append("filename",V.value.trim()),console.log("自定义文件名:",V.value.trim()));const O=await ae.uploadMaterial(r);O.code===200?($.success("上传成功"),y.value=!1,await I()):$.error(O.msg||"上传失败")}catch(r){console.error("上传素材出错:",r),$.error("上传失败: "+(r.message||"未知错误"))}finally{m.value=!1}},b=async F=>{h.value=null,d.value=!0,$.info("加载中...");try{await new Promise(r=>setTimeout(r,100)),h.value=F}catch(r){console.error("预览素材出错:",r),$.error("预览加载失败"),d.value=!1}},q=F=>{_e.confirm(`确定要删除素材 ${F.filename} 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const r=await ae.deleteMaterial(F.id);r.code===200?(i.removeMaterial(F.id),$.success("删除成功")):$.error(r.msg||"删除失败")}catch(r){console.error("删除素材出错:",r),$.error("删除失败")}}).catch(()=>{})},U=F=>{const r=F.split("/").pop();return ae.getMaterialPreviewUrl(r)},S=F=>{const r=ae.downloadMaterial(F.file_path);window.open(r,"_blank")},W=F=>[".mp4",".avi",".mov",".wmv",".flv",".mkv"].some(O=>F.toLowerCase().endsWith(O)),K=F=>[".jpg",".jpeg",".png",".gif",".bmp",".webp"].some(O=>F.toLowerCase().endsWith(O));return we(()=>{i.materials.length===0&&I()}),(F,r)=>{const O=p("el-input"),u=p("el-button"),L=p("el-icon"),A=p("el-table-column"),s=p("el-table"),j=p("el-empty"),P=p("el-form-item"),X=p("el-upload"),x=p("el-form"),w=p("el-dialog");return f(),k("div",Ol,[r[14]||(r[14]=l("div",{class:"page-header"},[l("h1",null,"素材管理")],-1)),l("div",Rl,[l("div",Bl,[e(O,{modelValue:n.value,"onUpdate:modelValue":r[0]||(r[0]=B=>n.value=B),placeholder:"输入文件名搜索","prefix-icon":"Search",clearable:"",onClear:z,onInput:z},null,8,["modelValue"]),l("div",ql,[e(u,{type:"primary",onClick:g},{default:t(()=>[...r[6]||(r[6]=[_("上传素材",-1)])]),_:1}),e(u,{type:"info",onClick:I,loading:!1},{default:t(()=>[e(L,{class:le({"is-loading":c.value})},{default:t(()=>[e(D(se))]),_:1},8,["class"]),c.value?(f(),k("span",Nl,"刷新中")):G("",!0)]),_:1})])]),E.value.length>0?(f(),k("div",Kl,[e(s,{data:E.value,style:{width:"100%"}},{default:t(()=>[e(A,{prop:"filename",label:"文件名",width:"300"}),e(A,{prop:"filesize",label:"文件大小",width:"120"},{default:t(B=>[_(M(B.row.filesize)+" MB ",1)]),_:1}),e(A,{prop:"upload_time",label:"上传时间",width:"180"}),e(A,{label:"操作"},{default:t(B=>[e(u,{size:"small",onClick:ee=>b(B.row)},{default:t(()=>[...r[7]||(r[7]=[_("预览",-1)])]),_:1},8,["onClick"]),e(u,{size:"small",type:"danger",onClick:ee=>q(B.row)},{default:t(()=>[...r[8]||(r[8]=[_("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(f(),k("div",jl,[e(j,{description:"暂无素材数据"})]))]),e(w,{modelValue:y.value,"onUpdate:modelValue":r[3]||(r[3]=B=>y.value=B),title:"上传素材",width:"40%",onClose:o},{footer:t(()=>[l("div",Wl,[e(u,{onClick:r[2]||(r[2]=B=>y.value=!1)},{default:t(()=>[...r[11]||(r[11]=[_("取消",-1)])]),_:1}),e(u,{type:"primary",onClick:T,loading:m.value},{default:t(()=>[_(M(m.value?"上传中":"确认上传"),1)]),_:1},8,["loading"])])]),default:t(()=>[l("div",Hl,[e(x,{"label-width":"80px"},{default:t(()=>[e(P,{label:"文件名称:"},{default:t(()=>[e(O,{modelValue:V.value,"onUpdate:modelValue":r[1]||(r[1]=B=>V.value=B),placeholder:"选填",clearable:""},null,8,["modelValue"])]),_:1}),e(P,{label:"选择文件"},{default:t(()=>[e(X,{class:"upload-demo",drag:"","auto-upload":!1,"on-change":N,"file-list":C.value,limit:1},{tip:t(()=>[...r[9]||(r[9]=[l("div",{class:"el-upload__tip"}," 支持视频、图片等格式文件，只能上传一个文件 ",-1)])]),default:t(()=>[e(L,{class:"el-icon--upload"},{default:t(()=>[e(D(ue))]),_:1}),r[10]||(r[10]=l("div",{class:"el-upload__text"},[_(" 将文件拖到此处，或"),l("em",null,"点击上传")],-1))]),_:1},8,["file-list"])]),_:1})]),_:1})])]),_:1},8,["modelValue"]),e(w,{modelValue:d.value,"onUpdate:modelValue":r[5]||(r[5]=B=>d.value=B),title:"素材预览",width:"50%",top:"10vh"},{default:t(()=>[h.value?(f(),k("div",Xl,[W(h.value.filename)?(f(),k("div",Gl,[l("video",Jl,[l("source",{src:U(h.value.file_path),type:"video/mp4"},null,8,Ql),r[12]||(r[12]=_(" 您的浏览器不支持视频播放 ",-1))])])):K(h.value.filename)?(f(),k("div",Yl,[l("img",{src:U(h.value.file_path),style:{"max-width":"100%","max-height":"60vh"}},null,8,Zl)])):(f(),k("div",ea,[l("p",null,"文件名: "+M(h.value.filename),1),l("p",null,"文件大小: "+M(h.value.filesize)+" MB",1),l("p",null,"上传时间: "+M(h.value.upload_time),1),e(u,{type:"primary",onClick:r[4]||(r[4]=B=>S(h.value))},{default:t(()=>[...r[13]||(r[13]=[_("下载文件",-1)])]),_:1})]))])):G("",!0)]),_:1},8,["modelValue"])])}}},la=Q(ta,[["__scopeId","data-v-3d75da5e"]]),he={DOUYIN:{key:3,name:"抖音",titleLimit:30,topicLimit:5,titlePlaceholder:"请输入标题（最多30字）",topicPlaceholder:"最多可添加5个话题"},KUAISHOU:{key:4,name:"快手",titleLimit:30,topicLimit:3,titlePlaceholder:"请输入标题（最多30字）",topicPlaceholder:"最多可添加3个话题"},WEIXIN:{key:2,name:"视频号",titleLimit:50,topicLimit:4,titlePlaceholder:"请输入标题（最多50字）",topicPlaceholder:"最多可添加4个话题"},XIAOHONGSHU:{key:1,name:"小红书",titleLimit:20,topicLimit:3,titlePlaceholder:"请输入标题（最多20字）",topicPlaceholder:"最多可添加3个话题"}};function ce(a){return Object.values(he).find(i=>i.key===a)||he.XIAOHONGSHU}function aa(){return Object.values(he)}function be(a,i){const n=ce(i);return!a||!a.trim()?{valid:!1,message:"请输入标题"}:a.length>n.titleLimit?{valid:!1,message:`标题不能超过${n.titleLimit}字，当前${a.length}字`}:{valid:!0,message:""}}function $e(a,i){const n=ce(i);return Array.isArray(a)?a.length>n.topicLimit?{valid:!1,message:`最多只能添加${n.topicLimit}个话题，当前${a.length}个`}:{valid:!0,message:""}:{valid:!1,message:"话题格式错误"}}function sa(a){return!a||!a.trim()?{valid:!1,message:"话题内容不能为空"}:a.length>20?{valid:!1,message:"单个话题不能超过20字"}:/[<>{}[\]()&$#@!%^*+=|\\/]/g.test(a)?{valid:!1,message:"话题不能包含特殊字符"}:{valid:!0,message:""}}function oa(a){const i={};let n=!0;(!a.fileList||a.fileList.length===0)&&(i.fileList="请先上传视频文件",n=!1);const c=be(a.title,a.selectedPlatform);c.valid||(i.title=c.message,n=!1),a.selectedPlatform||(i.platform="请选择发布平台",n=!1),(!a.selectedAccounts||a.selectedAccounts.length===0)&&(i.accounts="请选择发布账号",n=!1);const m=$e(a.selectedTopics,a.selectedPlatform);return m.valid||(i.topics=m.message,n=!1),a.scheduleEnabled&&((!a.videosPerDay||a.videosPerDay<1||a.videosPerDay>55)&&(i.videosPerDay="每天发布视频数必须在1-55之间",n=!1),(!a.dailyTimes||a.dailyTimes.length===0)&&(i.dailyTimes="请设置发布时间",n=!1),a.dailyTimes&&a.dailyTimes.length!==a.videosPerDay&&(i.dailyTimes="发布时间数量必须与每天发布视频数一致",n=!1),(a.startDays===void 0||a.startDays<0)&&(i.startDays="请选择开始天数",n=!1)),{valid:n,errors:i}}const na={class:"tab-management"},ia={class:"tab-header"},ua={class:"tab-list"},da=["onClick"],ra={class:"tab-actions"},ca={__name:"TabManagement",props:{tabs:{type:Array,required:!0},activeTab:{type:String,required:!0},batchPublishing:{type:Boolean,default:!1}},emits:["tab-change","remove-tab","add-tab","batch-publish"],setup(a){return(i,n)=>{const c=p("el-icon"),m=p("el-button");return f(),k("div",na,[l("div",ia,[l("div",ua,[(f(!0),k(Y,null,Z(a.tabs,y=>(f(),k("div",{key:y.name,class:le(["tab-item",{active:a.activeTab===y.name}]),onClick:d=>i.$emit("tab-change",y.name)},[l("span",null,M(y.label),1),a.tabs.length>1?(f(),J(c,{key:0,class:"close-icon",onClick:Fe(d=>i.$emit("remove-tab",y.name),["stop"])},{default:t(()=>[e(D(xe))]),_:1},8,["onClick"])):G("",!0)],10,da))),128))]),l("div",ra,[e(m,{type:"primary",size:"small",onClick:n[0]||(n[0]=y=>i.$emit("add-tab")),class:"add-tab-btn"},{default:t(()=>[e(c,null,{default:t(()=>[e(D(tt))]),_:1}),n[2]||(n[2]=_(" 添加Tab ",-1))]),_:1}),e(m,{type:"success",size:"small",onClick:n[1]||(n[1]=y=>i.$emit("batch-publish")),loading:a.batchPublishing,class:"batch-publish-btn"},{default:t(()=>[...n[3]||(n[3]=[_(" 批量发布 ",-1)])]),_:1},8,["loading"])])])])}}},pa=Q(ca,[["__scopeId","data-v-7584dadb"]]),ma={class:"upload-section"},fa={class:"upload-options"},va={key:0,class:"uploaded-files"},_a={class:"file-list"},ga={class:"file-size"},ya={class:"upload-options-content"},ha={class:"material-library-content"},ba={class:"material-list"},$a={class:"material-info"},wa={class:"material-name"},ka={class:"material-details"},Va={class:"file-size"},Ca={class:"upload-time"},Aa={class:"dialog-footer"},Ta={__name:"VideoUpload",props:{fileList:{type:Array,default:()=>[]},uploadAction:{type:String,required:!0},authHeaders:{type:Object,required:!0},materials:{type:Array,default:()=>[]}},emits:["show-upload-options","remove-file","upload-success","material-selected"],setup(a,{expose:i,emit:n}){const c=a,m=n,y=ge(),d=R(!1),h=R(!1),C=R(!1),V=R([]),I=()=>{d.value=!1,h.value=!0},E=async()=>{if(d.value=!1,c.materials.length===0)try{const T=await ae.getAllMaterials();if(T.code===200)y.setMaterials(T.data);else{$.error("获取素材列表失败");return}}catch(T){console.error("获取素材列表出错:",T),$.error("获取素材列表失败");return}V.value=[],C.value=!0},z=(T,b)=>{T.code===200?(m("upload-success",T,b),h.value=!1,$.success("文件上传成功")):$.error(T.msg||"上传失败")},g=T=>{$.error("文件上传失败"),console.error("上传错误:",T)},o=()=>{if(V.value.length===0){$.warning("请选择至少一个素材");return}m("material-selected",V.value);const T=V.value.length;C.value=!1,V.value=[],$.success(`已添加 ${T} 个素材`)},N=()=>{d.value=!0};return i({showUploadOptions:N}),(T,b)=>{const q=p("el-icon"),U=p("el-button"),S=p("el-link"),W=p("el-dialog"),K=p("el-upload"),F=p("el-checkbox"),r=p("el-checkbox-group");return f(),k("div",ma,[b[14]||(b[14]=l("h3",null,"视频",-1)),l("div",fa,[e(U,{type:"primary",onClick:N,class:"upload-btn"},{default:t(()=>[e(q,null,{default:t(()=>[e(D(ue))]),_:1}),b[5]||(b[5]=_(" 上传视频 ",-1))]),_:1})]),a.fileList.length>0?(f(),k("div",va,[b[7]||(b[7]=l("h4",null,"已上传文件：",-1)),l("div",_a,[(f(!0),k(Y,null,Z(a.fileList,(O,u)=>(f(),k("div",{key:u,class:"file-item"},[e(S,{href:O.url,target:"_blank",type:"primary"},{default:t(()=>[_(M(O.name),1)]),_:2},1032,["href"]),l("span",ga,M((O.size/1024/1024).toFixed(2))+"MB",1),e(U,{type:"danger",size:"small",onClick:L=>T.$emit("remove-file",u)},{default:t(()=>[...b[6]||(b[6]=[_("删除",-1)])]),_:1},8,["onClick"])]))),128))])])):G("",!0),e(W,{modelValue:d.value,"onUpdate:modelValue":b[0]||(b[0]=O=>d.value=O),title:"选择上传方式",width:"400px",class:"upload-options-dialog"},{default:t(()=>[l("div",ya,[e(U,{type:"primary",onClick:I,class:"option-btn"},{default:t(()=>[e(q,null,{default:t(()=>[e(D(ue))]),_:1}),b[8]||(b[8]=_(" 本地上传 ",-1))]),_:1}),e(U,{type:"success",onClick:E,class:"option-btn"},{default:t(()=>[e(q,null,{default:t(()=>[e(D(lt))]),_:1}),b[9]||(b[9]=_(" 素材库 ",-1))]),_:1})])]),_:1},8,["modelValue"]),e(W,{modelValue:h.value,"onUpdate:modelValue":b[1]||(b[1]=O=>h.value=O),title:"本地上传",width:"600px",class:"local-upload-dialog"},{default:t(()=>[e(K,{class:"video-upload",drag:"","auto-upload":!0,action:a.uploadAction,"on-success":z,"on-error":g,multiple:"",accept:"video/*",headers:a.authHeaders},{tip:t(()=>[...b[10]||(b[10]=[l("div",{class:"el-upload__tip"}," 支持MP4、AVI等视频格式，可上传多个文件 ",-1)])]),default:t(()=>[e(q,{class:"el-icon--upload"},{default:t(()=>[e(D(ue))]),_:1}),b[11]||(b[11]=l("div",{class:"el-upload__text"},[_(" 将视频文件拖到此处，或"),l("em",null,"点击上传")],-1))]),_:1},8,["action","headers"])]),_:1},8,["modelValue"]),e(W,{modelValue:C.value,"onUpdate:modelValue":b[4]||(b[4]=O=>C.value=O),title:"选择素材",width:"800px",class:"material-library-dialog"},{footer:t(()=>[l("div",Aa,[e(U,{onClick:b[3]||(b[3]=O=>C.value=!1)},{default:t(()=>[...b[12]||(b[12]=[_("取消",-1)])]),_:1}),e(U,{type:"primary",onClick:o},{default:t(()=>[...b[13]||(b[13]=[_("确定",-1)])]),_:1})])]),default:t(()=>[l("div",ha,[e(r,{modelValue:V.value,"onUpdate:modelValue":b[2]||(b[2]=O=>V.value=O)},{default:t(()=>[l("div",ba,[(f(!0),k(Y,null,Z(a.materials,O=>(f(),k("div",{key:O.id,class:"material-item"},[e(F,{label:O.id,class:"material-checkbox"},{default:t(()=>[l("div",$a,[l("div",wa,M(O.filename),1),l("div",ka,[l("span",Va,M(O.filesize)+"MB",1),l("span",Ca,M(O.upload_time),1)])])]),_:2},1032,["label"])]))),128))])]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"])])}}},xa=Q(Ta,[["__scopeId","data-v-a4989d91"]]),Pa={class:"platform-section"},Sa={key:0,class:"platform-tips"},Ma={__name:"PlatformSelection",props:{modelValue:{type:Number,required:!0}},emits:["update:modelValue","platform-change"],setup(a,{emit:i}){const n=a,c=i,m=aa(),y=H({get:()=>n.modelValue,set:C=>c("update:modelValue",C)}),d=H(()=>ce(n.modelValue)),h=C=>{c("platform-change",C)};return(C,V)=>{const I=p("el-radio"),E=p("el-radio-group"),z=p("el-alert");return f(),k("div",Pa,[V[1]||(V[1]=l("h3",null,"平台",-1)),e(E,{modelValue:y.value,"onUpdate:modelValue":V[0]||(V[0]=g=>y.value=g),onChange:h,class:"platform-radios"},{default:t(()=>[(f(!0),k(Y,null,Z(D(m),g=>(f(),J(I,{key:g.key,label:g.key,class:"platform-radio"},{default:t(()=>[_(M(g.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"]),d.value?(f(),k("div",Sa,[e(z,{title:`${d.value.name}平台限制：标题最多${d.value.titleLimit}字，话题最多${d.value.topicLimit}个`,type:"info",closable:!1,"show-icon":"",class:"platform-alert"},null,8,["title"])])):G("",!0)])}}},Ua=Q(Ma,[["__scopeId","data-v-4ae792d5"]]),La={class:"account-section"},Ia={class:"account-display"},Ea={class:"selected-accounts"},za={class:"account-dialog-content"},Da={class:"account-list"},Fa={class:"account-info"},Oa={class:"account-name"},Ra={class:"dialog-footer"},Ba={__name:"AccountSelection",props:{modelValue:{type:Array,default:()=>[]},platformKey:{type:Number,required:!0}},emits:["update:modelValue"],setup(a,{emit:i}){const n=a,c=i,m=ke(),y=H({get:()=>n.modelValue,set:g=>c("update:modelValue",g)}),d=R(!1),h=R([]),C=H(()=>{const o={3:"抖音",2:"视频号",1:"小红书",4:"快手"}[n.platformKey];return o?m.accounts.filter(N=>N.platform===o):[]}),V=()=>{h.value=[...y.value],d.value=!0},I=()=>{y.value=[...h.value],d.value=!1,$.success("账号选择完成")},E=g=>{y.value.splice(g,1)},z=g=>{const o=m.accounts.find(N=>N.id===g);return o?o.name:g};return(g,o)=>{const N=p("el-tag"),T=p("el-button"),b=p("el-checkbox"),q=p("el-checkbox-group"),U=p("el-dialog");return f(),k("div",La,[o[6]||(o[6]=l("h3",null,"账号",-1)),l("div",Ia,[l("div",Ea,[(f(!0),k(Y,null,Z(y.value,(S,W)=>(f(),J(N,{key:W,closable:"",onClose:K=>E(W),class:"account-tag"},{default:t(()=>[_(M(z(S)),1)]),_:2},1032,["onClose"]))),128))]),e(T,{type:"primary",plain:"",onClick:V,class:"select-account-btn"},{default:t(()=>[...o[3]||(o[3]=[_(" 选择账号 ",-1)])]),_:1})]),e(U,{modelValue:d.value,"onUpdate:modelValue":o[2]||(o[2]=S=>d.value=S),title:"选择账号",width:"600px",class:"account-dialog"},{footer:t(()=>[l("div",Ra,[e(T,{onClick:o[1]||(o[1]=S=>d.value=!1)},{default:t(()=>[...o[4]||(o[4]=[_("取消",-1)])]),_:1}),e(T,{type:"primary",onClick:I},{default:t(()=>[...o[5]||(o[5]=[_("确定",-1)])]),_:1})])]),default:t(()=>[l("div",za,[e(q,{modelValue:h.value,"onUpdate:modelValue":o[0]||(o[0]=S=>h.value=S)},{default:t(()=>[l("div",Da,[(f(!0),k(Y,null,Z(C.value,S=>(f(),J(b,{key:S.id,label:S.id,class:"account-item"},{default:t(()=>[l("div",Fa,[l("span",Oa,M(S.name),1)])]),_:2},1032,["label"]))),128))])]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"])])}}},qa=Q(Ba,[["__scopeId","data-v-7cdefdfd"]]),Na={class:"title-section"},Ka={key:0,class:"error-message"},ja={__name:"TitleInput",props:{modelValue:{type:String,default:""},platformKey:{type:Number,required:!0},validateOnInput:{type:Boolean,default:!0}},emits:["update:modelValue","validation-change"],setup(a,{expose:i,emit:n}){const c=a,m=n,y=H(()=>ce(c.platformKey)),d=H({get:()=>c.modelValue,set:z=>m("update:modelValue",z)}),h=H(()=>y.value.titlePlaceholder),C=H(()=>y.value.titleLimit),V=R(""),I=z=>{if(c.validateOnInput){const g=be(z,c.platformKey);V.value=g.valid?"":g.message,m("validation-change",g)}};return i({validate:()=>{const z=be(c.modelValue,c.platformKey);return V.value=z.valid?"":z.message,m("validation-change",z),z}}),(z,g)=>{const o=p("el-input"),N=p("el-alert");return f(),k("div",Na,[g[1]||(g[1]=l("h3",null,"标题",-1)),e(o,{modelValue:d.value,"onUpdate:modelValue":g[0]||(g[0]=T=>d.value=T),type:"textarea",rows:3,placeholder:h.value,maxlength:C.value,"show-word-limit":"",class:"title-input",onInput:I},null,8,["modelValue","placeholder","maxlength"]),V.value?(f(),k("div",Ka,[e(N,{title:V.value,type:"error",closable:!1,"show-icon":"",class:"error-alert"},null,8,["title"])])):G("",!0)])}}},Ha=Q(ja,[["__scopeId","data-v-f75530ea"]]),Wa={class:"topic-section"},Xa={class:"topic-display"},Ga={class:"selected-topics"},Ja={key:0,class:"topic-tips"},Qa={key:1,class:"error-message"},Ya={class:"topic-dialog-content"},Za={class:"custom-topic-input"},es={class:"recommended-topics"},ts={class:"topic-grid"},ls={class:"dialog-footer"},as={__name:"TopicInput",props:{modelValue:{type:Array,default:()=>[]},platformKey:{type:Number,required:!0},validateOnInput:{type:Boolean,default:!0}},emits:["update:modelValue","validation-change"],setup(a,{expose:i,emit:n}){const c=a,m=n,y=H(()=>ce(c.platformKey)),d=H({get:()=>c.modelValue,set:U=>m("update:modelValue",U)}),h=H(()=>d.value.length>=y.value.topicLimit),C=R(""),V=R(!1),I=R(""),E=["游戏","知识","自动化","系统平台","自媒体工具","跨境电商","科技","教程","云手机平台","云电脑平台","脚本","开源","健康","时尚","美妆","摄影","宠物","汽车"],z=()=>{if(h.value){$.warning(`最多只能添加${y.value.topicLimit}个话题`);return}V.value=!0},g=()=>{if(!I.value.trim()){$.warning("请输入话题内容");return}const U=sa(I.value.trim());if(!U.valid){$.error(U.message);return}if(h.value){$.warning(`最多只能添加${y.value.topicLimit}个话题`);return}d.value.includes(I.value.trim())?$.warning("话题已存在"):(d.value.push(I.value.trim()),I.value="",$.success("话题添加成功"),b())},o=U=>{if(h.value&&!d.value.includes(U)){$.warning(`最多只能添加${y.value.topicLimit}个话题`);return}const S=d.value.indexOf(U);S>-1?d.value.splice(S,1):d.value.push(U),b()},N=U=>{d.value.splice(U,1),b()},T=()=>{V.value=!1,I.value="",$.success("添加话题完成")},b=()=>{if(c.validateOnInput){const U=$e(d.value,c.platformKey);C.value=U.valid?"":U.message,m("validation-change",U)}};return i({validate:()=>{const U=$e(c.modelValue,c.platformKey);return C.value=U.valid?"":U.message,m("validation-change",U),U}}),(U,S)=>{const W=p("el-tag"),K=p("el-button"),F=p("el-alert"),r=p("el-input"),O=p("el-dialog");return f(),k("div",Wa,[S[9]||(S[9]=l("h3",null,"话题",-1)),l("div",Xa,[l("div",Ga,[(f(!0),k(Y,null,Z(d.value,(u,L)=>(f(),J(W,{key:L,closable:"",onClose:A=>N(L),class:"topic-tag"},{default:t(()=>[_(" #"+M(u),1)]),_:2},1032,["onClose"]))),128))]),e(K,{type:"primary",plain:"",onClick:z,class:"select-topic-btn",disabled:h.value},{default:t(()=>[...S[3]||(S[3]=[_(" 添加话题 ",-1)])]),_:1},8,["disabled"])]),y.value?(f(),k("div",Ja,[e(F,{title:`已添加 ${d.value.length}/${y.value.topicLimit} 个话题`,type:h.value?"warning":"info",closable:!1,"show-icon":"",class:"topic-alert"},null,8,["title","type"])])):G("",!0),C.value?(f(),k("div",Qa,[e(F,{title:C.value,type:"error",closable:!1,"show-icon":"",class:"error-alert"},null,8,["title"])])):G("",!0),e(O,{modelValue:V.value,"onUpdate:modelValue":S[2]||(S[2]=u=>V.value=u),title:"添加话题",width:"600px",class:"topic-dialog"},{footer:t(()=>[l("div",ls,[e(K,{onClick:S[1]||(S[1]=u=>V.value=!1)},{default:t(()=>[...S[7]||(S[7]=[_("取消",-1)])]),_:1}),e(K,{type:"primary",onClick:T},{default:t(()=>[...S[8]||(S[8]=[_("确定",-1)])]),_:1})])]),default:t(()=>[l("div",Ya,[l("div",Za,[e(r,{modelValue:I.value,"onUpdate:modelValue":S[0]||(S[0]=u=>I.value=u),placeholder:"输入自定义话题",class:"custom-input",onKeyup:Oe(g,["enter"])},{prepend:t(()=>[...S[4]||(S[4]=[_("#",-1)])]),_:1},8,["modelValue"]),e(K,{type:"primary",onClick:g},{default:t(()=>[...S[5]||(S[5]=[_("添加",-1)])]),_:1})]),l("div",es,[S[6]||(S[6]=l("h4",null,"推荐话题",-1)),l("div",ts,[(f(),k(Y,null,Z(E,u=>e(K,{key:u,type:d.value.includes(u)?"primary":"default",onClick:L=>o(u),class:"topic-btn",disabled:d.value.includes(u)&&h.value},{default:t(()=>[_(M(u),1)]),_:2},1032,["type","onClick","disabled"])),64))])])])]),_:1},8,["modelValue"])])}}},ss=Q(as,[["__scopeId","data-v-b3973a1b"]]),os={class:"schedule-section"},ns={class:"schedule-controls"},is={key:0,class:"schedule-settings"},us={class:"schedule-item"},ds={class:"schedule-item"},rs={class:"time-selectors"},cs={class:"schedule-item"},ps={__name:"ScheduleSettings",props:{scheduleEnabled:{type:Boolean,default:!1},videosPerDay:{type:Number,default:1},dailyTimes:{type:Array,default:()=>["10:00"]},startDays:{type:Number,default:0}},emits:["update:scheduleEnabled","update:videosPerDay","update:dailyTimes","update:startDays"],setup(a,{emit:i}){const n=a,c=i,m=H({get:()=>n.scheduleEnabled,set:I=>c("update:scheduleEnabled",I)}),y=H({get:()=>n.videosPerDay,set:I=>c("update:videosPerDay",I)}),d=H({get:()=>n.dailyTimes,set:I=>c("update:dailyTimes",I)}),h=H({get:()=>n.startDays,set:I=>c("update:startDays",I)}),C=I=>{I||(c("update:videosPerDay",1),c("update:dailyTimes",["10:00"]),c("update:startDays",0))},V=()=>{if(d.value.length<y.value){const I=[...d.value,"10:00"];c("update:dailyTimes",I)}};return(I,E)=>{const z=p("el-switch"),g=p("el-option"),o=p("el-select"),N=p("el-time-select"),T=p("el-button");return f(),k("div",os,[E[7]||(E[7]=l("h3",null,"定时发布",-1)),l("div",ns,[e(z,{modelValue:m.value,"onUpdate:modelValue":E[0]||(E[0]=b=>m.value=b),"active-text":"定时发布","inactive-text":"立即发布",onChange:C},null,8,["modelValue"]),m.value?(f(),k("div",is,[l("div",us,[E[3]||(E[3]=l("span",{class:"label"},"每天发布视频数：",-1)),e(o,{modelValue:y.value,"onUpdate:modelValue":E[1]||(E[1]=b=>y.value=b),placeholder:"选择发布数量"},{default:t(()=>[(f(),k(Y,null,Z(55,b=>e(g,{key:b,label:b,value:b},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),l("div",ds,[E[5]||(E[5]=l("span",{class:"label"},"每天发布时间：",-1)),l("div",rs,[(f(!0),k(Y,null,Z(d.value,(b,q)=>(f(),J(N,{key:q,modelValue:d.value[q],"onUpdate:modelValue":U=>d.value[q]=U,start:"00:00",step:"00:30",end:"23:30",placeholder:"选择时间"},null,8,["modelValue","onUpdate:modelValue"]))),128)),d.value.length<y.value?(f(),J(T,{key:0,type:"primary",size:"small",onClick:V},{default:t(()=>[...E[4]||(E[4]=[_(" 添加时间 ",-1)])]),_:1})):G("",!0)])]),l("div",cs,[E[6]||(E[6]=l("span",{class:"label"},"开始天数：",-1)),e(o,{modelValue:h.value,"onUpdate:modelValue":E[2]||(E[2]=b=>h.value=b),placeholder:"选择开始天数"},{default:t(()=>[e(g,{label:"明天",value:0}),e(g,{label:"后天",value:1})]),_:1},8,["modelValue"])])])):G("",!0)])])}}},ms=Q(ps,[["__scopeId","data-v-7e1e15aa"]]),fs={class:"publish-center"},vs={class:"publish-content"},_s={class:"tab-content-wrapper"},gs={key:0,class:"publish-status"},ys={class:"action-buttons"},hs={class:"publish-progress"},bs={key:0,class:"current-publishing"},$s={key:1,class:"publish-results"},ws={class:"label"},ks={class:"message"},Vs={class:"dialog-footer"},Cs={__name:"PublishCenter",setup(a){const i="http://localhost:5409",n=H(()=>({Authorization:`Bearer ${localStorage.getItem("token")||""}`})),c=R("tab1");let m=1;const y=ge(),d=ke(),h=H(()=>y.materials),C=R(!1);we(async()=>{try{const u=await fe.getValidAccounts({validate:0});u&&u.code===200&&Array.isArray(u.data)&&d.setAccounts(u.data)}catch(u){console.warn("初始化获取账号失败",u)}});const V=ie([{name:"tab1",label:"发布1",fileList:[],displayFileList:[],selectedAccounts:[],selectedPlatform:1,title:"",selectedTopics:[],scheduleEnabled:!1,videosPerDay:1,dailyTimes:["10:00"],startDays:0,publishStatus:null,validationErrors:{}}]),I=R(!1),E=R(null),z=R(0),g=R([]),o=R(!1),N=()=>{m++;const u={name:`tab${m}`,label:`发布${m}`,fileList:[],displayFileList:[],selectedAccounts:[],selectedPlatform:1,title:"",selectedTopics:[],scheduleEnabled:!1,videosPerDay:1,dailyTimes:["10:00"],startDays:0,publishStatus:null,validationErrors:{}};V.push(u),c.value=u.name},T=u=>{const L=V.findIndex(A=>A.name===u);L>-1&&(V.splice(L,1),c.value===u&&V.length>0&&(c.value=V[0].name))},b=u=>{const L=V.find(A=>A.name===c.value);L&&(L.selectedAccounts=[])},q=(u,L,A)=>{L.valid?delete A.validationErrors[u]:A.validationErrors[u]=L.message},U=(u,L,A)=>{if(u.code===200){const s=u.data.path||u.data,j=s.split("/").pop(),P={name:L.name,url:ae.getMaterialPreviewUrl(j),path:s,size:L.size,type:L.type};A.fileList.push(P),A.displayFileList=[...A.fileList.map(X=>({name:X.name,url:X.url}))],$.success("文件上传成功"),console.log("上传成功:",P)}else $.error(u.msg||"上传失败")},S=(u,L)=>{u.forEach(A=>{const s=h.value.find(j=>j.id===A);if(s){const j={name:s.filename,url:ae.getMaterialPreviewUrl(s.file_path.split("/").pop()),path:s.file_path,size:s.filesize*1024*1024,type:"video/mp4"};L.fileList.some(X=>X.path===j.path)||L.fileList.push(j)}}),L.displayFileList=[...L.fileList.map(A=>({name:A.name,url:A.url}))]},W=(u,L)=>{u.fileList.splice(L,1),u.displayFileList=[...u.fileList.map(A=>({name:A.name,url:A.url}))],$.success("文件删除成功")},K=u=>{$.info("已取消发布")},F=async u=>new Promise((L,A)=>{const s=oa(u);if(!s.valid){const P=Object.values(s.errors)[0];$.error(P),A(new Error(P));return}const j={type:u.selectedPlatform,title:u.title,tags:u.selectedTopics,fileList:u.fileList.map(P=>P.path),accountList:u.selectedAccounts.map(P=>{const X=d.accounts.find(x=>x.id===P);return X?X.filePath:P}),enableTimer:u.scheduleEnabled?1:0,videosPerDay:u.scheduleEnabled&&u.videosPerDay||1,dailyTimes:u.scheduleEnabled?u.dailyTimes||["10:00"]:["10:00"],startDays:u.scheduleEnabled&&u.startDays||0,category:0};fetch(`${i}/postVideo`,{method:"POST",headers:{"Content-Type":"application/json",...n.value},body:JSON.stringify(j)}).then(P=>P.json()).then(P=>{P.code===200?(u.publishStatus={message:"发布成功",type:"success"},u.fileList=[],u.displayFileList=[],u.title="",u.selectedTopics=[],u.selectedAccounts=[],u.scheduleEnabled=!1,u.validationErrors={},L()):(u.publishStatus={message:`发布失败：${P.msg||"发布失败"}`,type:"error"},A(new Error(P.msg||"发布失败")))}).catch(P=>{console.error("发布错误:",P),u.publishStatus={message:"发布失败，请检查网络连接",type:"error"},A(P)})}),r=async()=>{if(!C.value){C.value=!0,E.value=null,z.value=0,g.value=[],o.value=!1,I.value=!0;try{for(let s=0;s<V.length;s++){if(o.value){g.value.push({label:V[s].label,status:"cancelled",message:"已取消"});continue}const j=V[s];E.value=j,z.value=Math.floor(s/V.length*100);try{await F(j),g.value.push({label:j.label,status:"success",message:"发布成功"})}catch(P){g.value.push({label:j.label,status:"error",message:P.message})}}z.value=100;const u=g.value.filter(s=>s.status==="success").length,L=g.value.filter(s=>s.status==="error").length,A=g.value.filter(s=>s.status==="cancelled").length;o.value?$.warning(`发布已取消：${u}个成功，${L}个失败，${A}个未执行`):L>0?$.error(`发布完成：${u}个成功，${L}个失败`):($.success("所有Tab发布成功"),setTimeout(()=>{I.value=!1},1e3))}catch(u){console.error("批量发布出错:",u),$.error("批量发布出错，请重试")}finally{C.value=!1,o.value=!1}}},O=()=>{o.value=!0,$.info("正在取消发布...")};return(u,L)=>{const A=p("el-alert"),s=p("el-button"),j=p("el-progress"),P=p("el-icon"),X=p("el-dialog");return f(),k("div",fs,[e(pa,{tabs:V,"active-tab":c.value,"batch-publishing":C.value,onTabChange:L[0]||(L[0]=x=>c.value=x),onRemoveTab:T,onAddTab:N,onBatchPublish:r},null,8,["tabs","active-tab","batch-publishing"]),l("div",vs,[l("div",_s,[(f(!0),k(Y,null,Z(V,x=>ve((f(),k("div",{key:x.name,class:"tab-content"},[x.publishStatus?(f(),k("div",gs,[e(A,{title:x.publishStatus.message,type:x.publishStatus.type,closable:!1,"show-icon":""},null,8,["title","type"])])):G("",!0),e(xa,{"file-list":x.fileList,"upload-action":`${D(i)}/upload`,"auth-headers":n.value,materials:h.value,onRemoveFile:w=>W(x,w),onUploadSuccess:(w,B)=>U(w,B,x),onMaterialSelected:w=>S(w,x)},null,8,["file-list","upload-action","auth-headers","materials","onRemoveFile","onUploadSuccess","onMaterialSelected"]),e(Ua,{modelValue:x.selectedPlatform,"onUpdate:modelValue":w=>x.selectedPlatform=w,onPlatformChange:b},null,8,["modelValue","onUpdate:modelValue"]),e(qa,{modelValue:x.selectedAccounts,"onUpdate:modelValue":w=>x.selectedAccounts=w,"platform-key":x.selectedPlatform},null,8,["modelValue","onUpdate:modelValue","platform-key"]),e(Ha,{modelValue:x.title,"onUpdate:modelValue":w=>x.title=w,"platform-key":x.selectedPlatform,onValidationChange:w=>q("title",w,x)},null,8,["modelValue","onUpdate:modelValue","platform-key","onValidationChange"]),e(ss,{modelValue:x.selectedTopics,"onUpdate:modelValue":w=>x.selectedTopics=w,"platform-key":x.selectedPlatform,onValidationChange:w=>q("topics",w,x)},null,8,["modelValue","onUpdate:modelValue","platform-key","onValidationChange"]),e(ms,{"schedule-enabled":x.scheduleEnabled,"onUpdate:scheduleEnabled":w=>x.scheduleEnabled=w,"videos-per-day":x.videosPerDay,"onUpdate:videosPerDay":w=>x.videosPerDay=w,"daily-times":x.dailyTimes,"onUpdate:dailyTimes":w=>x.dailyTimes=w,"start-days":x.startDays,"onUpdate:startDays":w=>x.startDays=w},null,8,["schedule-enabled","onUpdate:scheduleEnabled","videos-per-day","onUpdate:videosPerDay","daily-times","onUpdate:dailyTimes","start-days","onUpdate:startDays"]),l("div",ys,[e(s,{size:"small",onClick:w=>K()},{default:t(()=>[...L[3]||(L[3]=[_("取消",-1)])]),_:1},8,["onClick"]),e(s,{size:"small",type:"primary",onClick:w=>F(x)},{default:t(()=>[...L[4]||(L[4]=[_("发布",-1)])]),_:1},8,["onClick"])])])),[[ye,c.value===x.name]])),128))])]),e(X,{modelValue:I.value,"onUpdate:modelValue":L[2]||(L[2]=x=>I.value=x),title:"批量发布进度",width:"500px","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},{footer:t(()=>[l("div",Vs,[e(s,{onClick:O,disabled:z.value===100},{default:t(()=>[...L[5]||(L[5]=[_(" 取消发布 ",-1)])]),_:1},8,["disabled"]),z.value===100?(f(),J(s,{key:0,type:"primary",onClick:L[1]||(L[1]=x=>I.value=!1)},{default:t(()=>[...L[6]||(L[6]=[_(" 关闭 ",-1)])]),_:1})):G("",!0)])]),default:t(()=>[l("div",hs,[e(j,{percentage:z.value,status:z.value===100?"success":""},null,8,["percentage","status"]),E.value?(f(),k("div",bs," 正在发布："+M(E.value.label),1)):G("",!0),g.value.length>0?(f(),k("div",$s,[(f(!0),k(Y,null,Z(g.value,(x,w)=>(f(),k("div",{key:w,class:le(["result-item",x.status])},[x.status==="success"?(f(),J(P,{key:0},{default:t(()=>[e(D(at))]),_:1})):x.status==="error"?(f(),J(P,{key:1},{default:t(()=>[e(D(xe))]),_:1})):(f(),J(P,{key:2},{default:t(()=>[e(D(st))]),_:1})),l("span",ws,M(x.label),1),l("span",ks,M(x.message),1)],2))),128))])):G("",!0)])]),_:1},8,["modelValue"])])}}},As=Q(Cs,[["__scopeId","data-v-176d1cb9"]]),Ts={class:"about"},xs={__name:"About",setup(a){return(i,n)=>(f(),k("div",Ts,[...n[0]||(n[0]=[l("h1",null,"关于我们",-1),l("p",null,"这是关于页面",-1)])]))}},Ps=Q(xs,[["__scopeId","data-v-cd67ee8e"]]),Ss=[{path:"/",name:"Dashboard",component:Qt},{path:"/account-management",name:"AccountManagement",component:Fl},{path:"/material-management",name:"MaterialManagement",component:la},{path:"/publish-center",name:"PublishCenter",component:As},{path:"/about",name:"About",component:Ps}],Ms=Re({history:Be(),routes:Ss}),Us=qe(),pe=Ne(_t);for(const[a,i]of Object.entries(ot))pe.component(a,i);pe.use(Ms);pe.use(Us);pe.use(nt);pe.mount("#app");
