import{b as de,ax as st,r as C,c as _,o as c,R as e,J as t,al as f,a as l,K as ze,S as Le,u as $,p as ke,ay as at,P as y,O as d,I as le,L as G,az as qe,t as Ne,X as ot,E as ce,Q as ee,a6 as te,W as nt,aA as it,aB as ut,aC as dt,au as rt}from"./vue-CbZdtcPO.js";import{h as ct,u as je,p as pt,a as $e,m as ft,d as Ke,f as mt,b as _t,l as vt,c as gt,e as yt,t as ht,E as m,g as xe,r as ve,i as bt,j as wt,k as Oe,n as kt,o as $t,q as Ct,s as Vt}from"./elementPlus-Dg80OzPX.js";import{a as At}from"./utils-NIGUFBhG.js";(function(){const v=document.createElement("link").relList;if(v&&v.supports&&v.supports("modulepreload"))return;for(const g of document.querySelectorAll('link[rel="modulepreload"]'))A(g);new MutationObserver(g=>{for(const S of g)if(S.type==="childList")for(const b of S.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&A(b)}).observe(document,{childList:!0,subtree:!0});function h(g){const S={};return g.integrity&&(S.integrity=g.integrity),g.referrerPolicy&&(S.referrerPolicy=g.referrerPolicy),g.crossOrigin==="use-credentials"?S.credentials="include":g.crossOrigin==="anonymous"?S.credentials="omit":S.credentials="same-origin",S}function A(g){if(g.ep)return;g.ep=!0;const S=h(g);fetch(g.href,S)}})();const Tt="/vite.svg",Ce=(p,v)=>{const h=p.__vccOpts||p;for(const[A,g]of v)h[A]=g;return h},xt={id:"app"},Mt={class:"sidebar"},Pt={class:"logo"},St={src:Tt,alt:"Logo",class:"logo-img"},Ut={class:"header-content"},zt={class:"header-left"},Lt={__name:"App",setup(p){const v=st(),h=de(()=>v.path),A=C(!1),g=()=>{A.value=!A.value};return(S,b)=>{const w=f("el-icon"),x=f("el-menu-item"),F=f("el-menu"),N=f("el-aside"),j=f("el-header"),B=f("router-view"),E=f("el-main"),r=f("el-container");return c(),_("div",xt,[e(r,null,{default:t(()=>[e(N,{width:A.value?"64px":"200px"},{default:t(()=>[l("div",Mt,[l("div",Pt,[ze(l("img",St,null,512),[[Le,A.value]]),ze(l("h2",null,"自媒体自动化运营系统",512),[[Le,!A.value]])]),e(F,{router:!0,"default-active":h.value,collapse:A.value,class:"sidebar-menu","background-color":"#001529","text-color":"#fff","active-text-color":"#409EFF"},{default:t(()=>[e(x,{index:"/"},{default:t(()=>[e(w,null,{default:t(()=>[e($(ct))]),_:1}),b[0]||(b[0]=l("span",null,"首页",-1))]),_:1}),e(x,{index:"/account-management"},{default:t(()=>[e(w,null,{default:t(()=>[e($(je))]),_:1}),b[1]||(b[1]=l("span",null,"账号管理",-1))]),_:1}),e(x,{index:"/material-management"},{default:t(()=>[e(w,null,{default:t(()=>[e($(pt))]),_:1}),b[2]||(b[2]=l("span",null,"素材管理",-1))]),_:1}),e(x,{index:"/publish-center"},{default:t(()=>[e(w,null,{default:t(()=>[e($($e))]),_:1}),b[3]||(b[3]=l("span",null,"发布中心",-1))]),_:1}),e(x,{index:"/website"},{default:t(()=>[e(w,null,{default:t(()=>[e($(ft))]),_:1}),b[4]||(b[4]=l("span",null,"网站",-1))]),_:1}),e(x,{index:"/data"},{default:t(()=>[e(w,null,{default:t(()=>[e($(Ke))]),_:1}),b[5]||(b[5]=l("span",null,"数据",-1))]),_:1})]),_:1},8,["default-active","collapse"])])]),_:1},8,["width"]),e(r,null,{default:t(()=>[e(j,null,{default:t(()=>[l("div",Ut,[l("div",zt,[e(w,{class:"toggle-sidebar",onClick:g},{default:t(()=>[e($(mt))]),_:1})]),b[6]||(b[6]=l("div",{class:"header-right"},null,-1))])]),_:1}),e(E,null,{default:t(()=>[e(B)]),_:1})]),_:1})]),_:1})])}}},Et=Ce(Lt,[["__scopeId","data-v-176fbaed"]]),Dt={class:"dashboard"},Ft={class:"dashboard-content"},It={class:"stat-card-content"},Rt={class:"stat-icon"},Bt={class:"stat-info"},Ot={class:"stat-value"},qt={class:"stat-footer"},Nt={class:"stat-detail"},jt={class:"stat-card-content"},Kt={class:"stat-icon platform-icon"},Wt={class:"stat-info"},Ht={class:"stat-value"},Jt={class:"stat-footer"},Xt={class:"stat-detail"},Qt={class:"stat-card-content"},Gt={class:"stat-icon task-icon"},Yt={class:"stat-info"},Zt={class:"stat-value"},el={class:"stat-footer"},tl={class:"stat-detail"},ll={class:"stat-card-content"},sl={class:"stat-icon content-icon"},al={class:"stat-info"},ol={class:"stat-value"},nl={class:"stat-footer"},il={class:"stat-detail"},ul={class:"quick-actions"},dl={class:"action-icon"},rl={class:"action-icon"},cl={class:"action-icon"},pl={class:"action-icon"},fl={class:"recent-tasks"},ml={class:"section-header"},_l={__name:"Dashboard",setup(p){const v=at(),h=ke({total:12,normal:10,abnormal:2}),A=ke({total:4,kuaishou:3,douyin:4,channels:2,xiaohongshu:3}),g=ke({total:24,completed:18,inProgress:5,failed:1}),S=ke({total:36,published:30,draft:6}),b=C([{id:1,title:"快手视频自动发布",platform:"快手",account:"快手账号1",createTime:"2024-05-01 10:30:00",status:"已完成"},{id:2,title:"抖音视频定时发布",platform:"抖音",account:"抖音账号1",createTime:"2024-05-01 11:15:00",status:"进行中"},{id:3,title:"视频号内容上传",platform:"视频号",account:"视频号账号1",createTime:"2024-05-01 14:20:00",status:"待执行"},{id:4,title:"小红书图文发布",platform:"小红书",account:"小红书账号1",createTime:"2024-05-01 16:45:00",status:"已失败"},{id:5,title:"快手短视频批量上传",platform:"快手",account:"快手账号2",createTime:"2024-05-02 09:10:00",status:"待执行"}]),w=E=>({快手:"success",抖音:"danger",视频号:"warning",小红书:"info"})[E]||"info",x=E=>({已完成:"success",进行中:"warning",待执行:"info",已失败:"danger"})[E]||"info",F=E=>{v.push(E)},N=E=>{m.info(`查看任务: ${E.title}`)},j=E=>{xe.confirm(`确定要执行任务 ${E.title} 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(()=>{const r=b.value.findIndex(O=>O.id===E.id);r!==-1&&(b.value[r].status="进行中"),m({type:"success",message:"任务已开始执行"})}).catch(()=>{})},B=E=>{xe.confirm(`确定要取消任务 ${E.title} 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const r=b.value.findIndex(O=>O.id===E.id);r!==-1&&(b.value[r].status="已取消"),m({type:"success",message:"任务已取消"})}).catch(()=>{})};return(E,r)=>{const O=f("el-icon"),L=f("el-card"),D=f("el-col"),R=f("el-tag"),H=f("el-tooltip"),J=f("el-row"),K=f("el-button"),Y=f("el-table-column"),V=f("el-table");return c(),_("div",Dt,[r[19]||(r[19]=l("div",{class:"page-header"},[l("h1",null,"自媒体自动化运营系统")],-1)),l("div",Ft,[e(J,{gutter:20},{default:t(()=>[e(D,{span:6},{default:t(()=>[e(L,{class:"stat-card"},{default:t(()=>[l("div",It,[l("div",Rt,[e(O,null,{default:t(()=>[e($(je))]),_:1})]),l("div",Bt,[l("div",Ot,y(h.total),1),r[1]||(r[1]=l("div",{class:"stat-label"},"账号总数",-1))])]),l("div",qt,[l("div",Nt,[l("span",null,"正常: "+y(h.normal),1),l("span",null,"异常: "+y(h.abnormal),1)])])]),_:1})]),_:1}),e(D,{span:6},{default:t(()=>[e(L,{class:"stat-card"},{default:t(()=>[l("div",jt,[l("div",Kt,[e(O,null,{default:t(()=>[e($(_t))]),_:1})]),l("div",Wt,[l("div",Ht,y(A.total),1),r[2]||(r[2]=l("div",{class:"stat-label"},"平台总数",-1))])]),l("div",Jt,[l("div",Xt,[e(H,{content:"快手账号",placement:"top"},{default:t(()=>[e(R,{size:"small",type:"success"},{default:t(()=>[d(y(A.kuaishou),1)]),_:1})]),_:1}),e(H,{content:"抖音账号",placement:"top"},{default:t(()=>[e(R,{size:"small",type:"danger"},{default:t(()=>[d(y(A.douyin),1)]),_:1})]),_:1}),e(H,{content:"视频号账号",placement:"top"},{default:t(()=>[e(R,{size:"small",type:"warning"},{default:t(()=>[d(y(A.channels),1)]),_:1})]),_:1}),e(H,{content:"小红书账号",placement:"top"},{default:t(()=>[e(R,{size:"small",type:"info"},{default:t(()=>[d(y(A.xiaohongshu),1)]),_:1})]),_:1})])])]),_:1})]),_:1}),e(D,{span:6},{default:t(()=>[e(L,{class:"stat-card"},{default:t(()=>[l("div",Qt,[l("div",Gt,[e(O,null,{default:t(()=>[e($(vt))]),_:1})]),l("div",Yt,[l("div",Zt,y(g.total),1),r[3]||(r[3]=l("div",{class:"stat-label"},"任务总数",-1))])]),l("div",el,[l("div",tl,[l("span",null,"完成: "+y(g.completed),1),l("span",null,"进行中: "+y(g.inProgress),1),l("span",null,"失败: "+y(g.failed),1)])])]),_:1})]),_:1}),e(D,{span:6},{default:t(()=>[e(L,{class:"stat-card"},{default:t(()=>[l("div",ll,[l("div",sl,[e(O,null,{default:t(()=>[e($(gt))]),_:1})]),l("div",al,[l("div",ol,y(S.total),1),r[4]||(r[4]=l("div",{class:"stat-label"},"内容总数",-1))])]),l("div",nl,[l("div",il,[l("span",null,"已发布: "+y(S.published),1),l("span",null,"草稿: "+y(S.draft),1)])])]),_:1})]),_:1})]),_:1}),l("div",ul,[r[13]||(r[13]=l("h2",null,"快捷操作",-1)),e(J,{gutter:20},{default:t(()=>[e(D,{span:6},{default:t(()=>[e(L,{class:"action-card",onClick:r[0]||(r[0]=i=>F("/account-management"))},{default:t(()=>[l("div",dl,[e(O,null,{default:t(()=>[e($(yt))]),_:1})]),r[5]||(r[5]=l("div",{class:"action-title"},"账号管理",-1)),r[6]||(r[6]=l("div",{class:"action-desc"},"管理所有平台账号",-1))]),_:1})]),_:1}),e(D,{span:6},{default:t(()=>[e(L,{class:"action-card"},{default:t(()=>[l("div",rl,[e(O,null,{default:t(()=>[e($($e))]),_:1})]),r[7]||(r[7]=l("div",{class:"action-title"},"内容上传",-1)),r[8]||(r[8]=l("div",{class:"action-desc"},"上传视频和图文内容",-1))]),_:1})]),_:1}),e(D,{span:6},{default:t(()=>[e(L,{class:"action-card"},{default:t(()=>[l("div",cl,[e(O,null,{default:t(()=>[e($(ht))]),_:1})]),r[9]||(r[9]=l("div",{class:"action-title"},"定时发布",-1)),r[10]||(r[10]=l("div",{class:"action-desc"},"设置内容发布时间",-1))]),_:1})]),_:1}),e(D,{span:6},{default:t(()=>[e(L,{class:"action-card"},{default:t(()=>[l("div",pl,[e(O,null,{default:t(()=>[e($(Ke))]),_:1})]),r[11]||(r[11]=l("div",{class:"action-title"},"数据分析",-1)),r[12]||(r[12]=l("div",{class:"action-desc"},"查看内容数据分析",-1))]),_:1})]),_:1})]),_:1})]),l("div",fl,[l("div",ml,[r[15]||(r[15]=l("h2",null,"最近任务",-1)),e(K,{text:""},{default:t(()=>[...r[14]||(r[14]=[d("查看全部",-1)])]),_:1})]),e(V,{data:b.value,style:{width:"100%"}},{default:t(()=>[e(Y,{prop:"title",label:"任务名称",width:"250"}),e(Y,{prop:"platform",label:"平台",width:"120"},{default:t(i=>[e(R,{type:w(i.row.platform),effect:"plain"},{default:t(()=>[d(y(i.row.platform),1)]),_:2},1032,["type"])]),_:1}),e(Y,{prop:"account",label:"账号",width:"150"}),e(Y,{prop:"createTime",label:"创建时间",width:"180"}),e(Y,{prop:"status",label:"状态",width:"120"},{default:t(i=>[e(R,{type:x(i.row.status),effect:"plain"},{default:t(()=>[d(y(i.row.status),1)]),_:2},1032,["type"])]),_:1}),e(Y,{label:"操作"},{default:t(i=>[e(K,{size:"small",onClick:W=>N(i.row)},{default:t(()=>[...r[16]||(r[16]=[d("查看",-1)])]),_:1},8,["onClick"]),i.row.status==="待执行"?(c(),le(K,{key:0,size:"small",type:"primary",onClick:W=>j(i.row)},{default:t(()=>[...r[17]||(r[17]=[d(" 执行 ",-1)])]),_:1},8,["onClick"])):G("",!0),i.row.status!=="已完成"&&i.row.status!=="已失败"?(c(),le(K,{key:1,size:"small",type:"danger",onClick:W=>B(i.row)},{default:t(()=>[...r[18]||(r[18]=[d(" 取消 ",-1)])]),_:1},8,["onClick"])):G("",!0)]),_:1})]),_:1},8,["data"])])])])}}},vl=Ce(_l,[["__scopeId","data-v-db5c2d61"]]),ge=At.create({baseURL:"http://localhost:5409",headers:{"Content-Type":"application/json"}});ge.interceptors.request.use(p=>{const v=localStorage.getItem("token");return v&&(p.headers.Authorization=`Bearer ${v}`),p},p=>(console.error("请求错误:",p),Promise.reject(p)));ge.interceptors.response.use(p=>{const{data:v}=p;return v.code===200||v.success?v:(m.error(v.message||"请求失败"),Promise.reject(new Error(v.message||"请求失败")))},p=>{if(console.error("响应错误:",p),p.response){const{status:v}=p.response;switch(v){case 401:m.error("未授权，请重新登录");break;case 403:m.error("拒绝访问");break;case 404:m.error("请求地址不存在");break;case 500:m.error("服务器内部错误");break;default:m.error("网络错误")}}else m.error("网络连接失败");return Promise.reject(p)});const ye={get(p,v){return ge.get(p,{params:v})},post(p,v,h={}){return ge.post(p,v,h)},put(p,v,h={}){return ge.put(p,v,h)},delete(p,v){return ge.delete(p,{params:v})},upload(p,v){return ge.post(p,v,{headers:{"Content-Type":"multipart/form-data"}})}},Ue={getValidAccounts(){return ye.get("/getValidAccounts")},addAccount(p){return ye.post("/account",p)},updateAccount(p){return ye.post("/updateUserinfo",p)},deleteAccount(p){return ye.get(`/deleteAccount?id=${p}`)}},We=qe("account",()=>{const p=C([]),v={1:"小红书",2:"视频号",3:"抖音",4:"快手"};return{accounts:p,setAccounts:w=>{p.value=w.map(x=>({id:x[0],type:x[1],filePath:x[2],name:x[3],status:x[4]===1?"正常":"异常",platform:v[x[1]]||"未知",avatar:"/vite.svg"}))},addAccount:w=>{p.value.push(w)},updateAccount:(w,x)=>{const F=p.value.findIndex(N=>N.id===w);F!==-1&&(p.value[F]={...p.value[F],...x})},deleteAccount:w=>{p.value=p.value.filter(x=>x.id!==w)},getAccountsByPlatform:w=>p.value.filter(x=>x.platform===w)}}),Ee=qe("app",()=>{const p=C(!0),v=C(!0),h=C(!1),A=C([]);return{isFirstTimeAccountManagement:p,isFirstTimeMaterialManagement:v,isAccountRefreshing:h,materials:A,setAccountManagementVisited:()=>{p.value=!1},setMaterialManagementVisited:()=>{v.value=!1},resetVisitStatus:()=>{p.value=!0,v.value=!0},setMaterials:j=>{A.value=j},addMaterial:j=>{A.value.push(j)},removeMaterial:j=>{const B=A.value.findIndex(E=>E.id===j);B>-1&&A.value.splice(B,1)},setAccountRefreshing:j=>{h.value=j}}}),gl={class:"account-management"},yl={class:"account-tabs"},hl={class:"account-list-container"},bl={class:"account-search"},wl={class:"action-buttons"},kl={key:0},$l={key:0,class:"account-list"},Cl={key:1,class:"empty-data"},Vl={class:"account-list-container"},Al={class:"account-search"},Tl={class:"action-buttons"},xl={key:0},Ml={key:0,class:"account-list"},Pl={key:1,class:"empty-data"},Sl={class:"account-list-container"},Ul={class:"account-search"},zl={class:"action-buttons"},Ll={key:0},El={key:0,class:"account-list"},Dl={key:1,class:"empty-data"},Fl={class:"account-list-container"},Il={class:"account-search"},Rl={class:"action-buttons"},Bl={key:0},Ol={key:0,class:"account-list"},ql={key:1,class:"empty-data"},Nl={class:"account-list-container"},jl={class:"account-search"},Kl={class:"action-buttons"},Wl={key:0},Hl={key:0,class:"account-list"},Jl={key:1,class:"empty-data"},Xl={key:0,class:"qrcode-container"},Ql={key:0,class:"qrcode-wrapper"},Gl=["src"],Yl={key:1,class:"loading-wrapper"},Zl={key:2,class:"success-wrapper"},es={key:3,class:"error-wrapper"},ts={class:"dialog-footer"},ls={__name:"AccountManagement",setup(p){const v=We(),h=Ee(),A=C("all"),g=C(""),S=async()=>{if(!h.isAccountRefreshing){h.setAccountRefreshing(!0);try{const U=await Ue.getValidAccounts();U.code===200&&U.data?(v.setAccounts(U.data),m.success("账号数据获取成功"),h.isFirstTimeAccountManagement&&h.setAccountManagementVisited()):m.error("获取账号数据失败")}catch(U){console.error("获取账号数据失败:",U),m.error("获取账号数据失败")}finally{h.setAccountRefreshing(!1)}}};Ne(()=>{h.isFirstTimeAccountManagement&&S()});const b=U=>({快手:"success",抖音:"danger",视频号:"warning",小红书:"info"})[U]||"info",w=de(()=>g.value?v.accounts.filter(U=>U.name.includes(g.value)):v.accounts),x=de(()=>w.value.filter(U=>U.platform==="快手")),F=de(()=>w.value.filter(U=>U.platform==="抖音")),N=de(()=>w.value.filter(U=>U.platform==="视频号")),j=de(()=>w.value.filter(U=>U.platform==="小红书")),B=()=>{},E=C(!1),r=C("add"),O=C(null),L=ke({id:null,name:"",platform:"",status:"正常"}),D={platform:[{required:!0,message:"请选择平台",trigger:"change"}],name:[{required:!0,message:"请输入账号名称",trigger:"blur"}]},R=C(!1),H=C(""),J=C(""),K=()=>{r.value="add",Object.assign(L,{id:null,name:"",platform:"",status:"正常"}),R.value=!1,H.value="",J.value="",E.value=!0},Y=U=>{r.value="edit",Object.assign(L,{...U}),E.value=!0},V=U=>{xe.confirm(`确定要删除账号 ${U.name} 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const o=await Ue.deleteAccount(U.id);o.code===200?(v.deleteAccount(U.id),m({type:"success",message:"删除成功"})):m.error(o.msg||"删除失败")}catch(o){console.error("删除账号失败:",o),m.error("删除账号失败")}}).catch(()=>{})};let i=null;const W=()=>{i&&(i.close(),i=null)},se=(U,o)=>{W(),R.value=!0,H.value="",J.value="";const oe=`http://localhost:5409/login?type=${{小红书:"1",视频号:"2",抖音:"3",快手:"4"}[U]||"1"}&id=${encodeURIComponent(o)}`;i=new EventSource(oe),i.onmessage=z=>{const M=z.data;if(console.log("SSE消息:",M),!H.value&&M.length>100)try{M.startsWith("data:image")?H.value=M:H.value=`data:image/png;base64,${M}`,console.log("设置二维码数据，长度:",M.length)}catch(ne){console.error("处理二维码数据出错:",ne)}else(M==="200"||M==="500")&&(J.value=M,M==="200"?setTimeout(()=>{W(),setTimeout(()=>{E.value=!1,R.value=!1,m.success("账号添加成功"),m({type:"info",message:"正在同步账号信息...",duration:0}),S().then(()=>{m.closeAll(),m.success("账号信息已更新")})},1e3)},1e3):(W(),setTimeout(()=>{R.value=!1,H.value="",J.value=""},2e3)))},i.onerror=z=>{console.error("SSE连接错误:",z),m.error("连接服务器失败，请稍后再试"),W(),R.value=!1}},he=()=>{O.value.validate(async U=>{if(U)if(r.value==="add")se(L.platform,L.name);else try{const o=await Ue.updateAccount({id:L.id,type:L.platform==="快手"?1:L.platform==="抖音"?2:L.platform==="视频号"?3:4,userName:L.name});o.code===200?(v.updateAccount(L.id,L),m.success("更新成功"),E.value=!1,S()):m.error(o.msg||"更新账号失败")}catch(o){console.error("更新账号失败:",o),m.error("更新账号失败")}else return!1})};return ot(()=>{W()}),(U,o)=>{const ae=f("el-input"),I=f("el-button"),Z=f("el-icon"),oe=f("el-avatar"),z=f("el-table-column"),M=f("el-tag"),ne=f("el-table"),fe=f("el-empty"),re=f("el-tab-pane"),Me=f("el-tabs"),be=f("el-option"),Pe=f("el-select"),Te=f("el-form-item"),me=f("el-form"),we=f("el-dialog");return c(),_("div",gl,[o[30]||(o[30]=l("div",{class:"page-header"},[l("h1",null,"账号管理")],-1)),l("div",yl,[e(Me,{modelValue:A.value,"onUpdate:modelValue":o[5]||(o[5]=a=>A.value=a),class:"account-tabs-nav"},{default:t(()=>[e(re,{label:"全部",name:"all"},{default:t(()=>[l("div",hl,[l("div",bl,[e(ae,{modelValue:g.value,"onUpdate:modelValue":o[0]||(o[0]=a=>g.value=a),placeholder:"输入名称或账号搜索","prefix-icon":"Search",clearable:"",onClear:B,onInput:B},null,8,["modelValue"]),l("div",wl,[e(I,{type:"primary",onClick:K},{default:t(()=>[...o[10]||(o[10]=[d("添加账号",-1)])]),_:1}),e(I,{type:"info",onClick:S,loading:!1},{default:t(()=>[e(Z,{class:ce({"is-loading":$(h).isAccountRefreshing})},{default:t(()=>[e($(ve))]),_:1},8,["class"]),$(h).isAccountRefreshing?(c(),_("span",kl,"刷新中")):G("",!0)]),_:1})])]),w.value.length>0?(c(),_("div",$l,[e(ne,{data:w.value,style:{width:"100%"}},{default:t(()=>[e(z,{label:"头像",width:"80"},{default:t(a=>[e(oe,{src:a.row.avatar,size:40},null,8,["src"])]),_:1}),e(z,{prop:"name",label:"名称",width:"180"}),e(z,{prop:"platform",label:"平台"},{default:t(a=>[e(M,{type:b(a.row.platform),effect:"plain"},{default:t(()=>[d(y(a.row.platform),1)]),_:2},1032,["type"])]),_:1}),e(z,{prop:"status",label:"状态"},{default:t(a=>[e(M,{type:a.row.status==="正常"?"success":"danger",effect:"plain"},{default:t(()=>[d(y(a.row.status),1)]),_:2},1032,["type"])]),_:1}),e(z,{label:"操作"},{default:t(a=>[e(I,{size:"small",onClick:X=>Y(a.row)},{default:t(()=>[...o[11]||(o[11]=[d("编辑",-1)])]),_:1},8,["onClick"]),e(I,{size:"small",type:"danger",onClick:X=>V(a.row)},{default:t(()=>[...o[12]||(o[12]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(c(),_("div",Cl,[e(fe,{description:"暂无账号数据"})]))])]),_:1}),e(re,{label:"快手",name:"kuaishou"},{default:t(()=>[l("div",Vl,[l("div",Al,[e(ae,{modelValue:g.value,"onUpdate:modelValue":o[1]||(o[1]=a=>g.value=a),placeholder:"输入名称或账号搜索","prefix-icon":"Search",clearable:"",onClear:B,onInput:B},null,8,["modelValue"]),l("div",Tl,[e(I,{type:"primary",onClick:K},{default:t(()=>[...o[13]||(o[13]=[d("添加账号",-1)])]),_:1}),e(I,{type:"info",onClick:S,loading:!1},{default:t(()=>[e(Z,{class:ce({"is-loading":$(h).isAccountRefreshing})},{default:t(()=>[e($(ve))]),_:1},8,["class"]),$(h).isAccountRefreshing?(c(),_("span",xl,"刷新中")):G("",!0)]),_:1})])]),x.value.length>0?(c(),_("div",Ml,[e(ne,{data:x.value,style:{width:"100%"}},{default:t(()=>[e(z,{label:"头像",width:"80"},{default:t(a=>[e(oe,{src:a.row.avatar,size:40},null,8,["src"])]),_:1}),e(z,{prop:"name",label:"名称",width:"180"}),e(z,{prop:"platform",label:"平台"},{default:t(a=>[e(M,{type:b(a.row.platform),effect:"plain"},{default:t(()=>[d(y(a.row.platform),1)]),_:2},1032,["type"])]),_:1}),e(z,{prop:"status",label:"状态"},{default:t(a=>[e(M,{type:a.row.status==="正常"?"success":"danger",effect:"plain"},{default:t(()=>[d(y(a.row.status),1)]),_:2},1032,["type"])]),_:1}),e(z,{label:"操作"},{default:t(a=>[e(I,{size:"small",onClick:X=>Y(a.row)},{default:t(()=>[...o[14]||(o[14]=[d("编辑",-1)])]),_:1},8,["onClick"]),e(I,{size:"small",type:"danger",onClick:X=>V(a.row)},{default:t(()=>[...o[15]||(o[15]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(c(),_("div",Pl,[e(fe,{description:"暂无快手账号数据"})]))])]),_:1}),e(re,{label:"抖音",name:"douyin"},{default:t(()=>[l("div",Sl,[l("div",Ul,[e(ae,{modelValue:g.value,"onUpdate:modelValue":o[2]||(o[2]=a=>g.value=a),placeholder:"输入名称或账号搜索","prefix-icon":"Search",clearable:"",onClear:B,onInput:B},null,8,["modelValue"]),l("div",zl,[e(I,{type:"primary",onClick:K},{default:t(()=>[...o[16]||(o[16]=[d("添加账号",-1)])]),_:1}),e(I,{type:"info",onClick:S,loading:!1},{default:t(()=>[e(Z,{class:ce({"is-loading":$(h).isAccountRefreshing})},{default:t(()=>[e($(ve))]),_:1},8,["class"]),$(h).isAccountRefreshing?(c(),_("span",Ll,"刷新中")):G("",!0)]),_:1})])]),F.value.length>0?(c(),_("div",El,[e(ne,{data:F.value,style:{width:"100%"}},{default:t(()=>[e(z,{label:"头像",width:"80"},{default:t(a=>[e(oe,{src:a.row.avatar,size:40},null,8,["src"])]),_:1}),e(z,{prop:"name",label:"名称",width:"180"}),e(z,{prop:"platform",label:"平台"},{default:t(a=>[e(M,{type:b(a.row.platform),effect:"plain"},{default:t(()=>[d(y(a.row.platform),1)]),_:2},1032,["type"])]),_:1}),e(z,{prop:"status",label:"状态"},{default:t(a=>[e(M,{type:a.row.status==="正常"?"success":"danger",effect:"plain"},{default:t(()=>[d(y(a.row.status),1)]),_:2},1032,["type"])]),_:1}),e(z,{label:"操作"},{default:t(a=>[e(I,{size:"small",onClick:X=>Y(a.row)},{default:t(()=>[...o[17]||(o[17]=[d("编辑",-1)])]),_:1},8,["onClick"]),e(I,{size:"small",type:"danger",onClick:X=>V(a.row)},{default:t(()=>[...o[18]||(o[18]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(c(),_("div",Dl,[e(fe,{description:"暂无抖音账号数据"})]))])]),_:1}),e(re,{label:"视频号",name:"channels"},{default:t(()=>[l("div",Fl,[l("div",Il,[e(ae,{modelValue:g.value,"onUpdate:modelValue":o[3]||(o[3]=a=>g.value=a),placeholder:"输入名称或账号搜索","prefix-icon":"Search",clearable:"",onClear:B,onInput:B},null,8,["modelValue"]),l("div",Rl,[e(I,{type:"primary",onClick:K},{default:t(()=>[...o[19]||(o[19]=[d("添加账号",-1)])]),_:1}),e(I,{type:"info",onClick:S,loading:!1},{default:t(()=>[e(Z,{class:ce({"is-loading":$(h).isAccountRefreshing})},{default:t(()=>[e($(ve))]),_:1},8,["class"]),$(h).isAccountRefreshing?(c(),_("span",Bl,"刷新中")):G("",!0)]),_:1})])]),N.value.length>0?(c(),_("div",Ol,[e(ne,{data:N.value,style:{width:"100%"}},{default:t(()=>[e(z,{label:"头像",width:"80"},{default:t(a=>[e(oe,{src:a.row.avatar,size:40},null,8,["src"])]),_:1}),e(z,{prop:"name",label:"名称",width:"180"}),e(z,{prop:"platform",label:"平台"},{default:t(a=>[e(M,{type:b(a.row.platform),effect:"plain"},{default:t(()=>[d(y(a.row.platform),1)]),_:2},1032,["type"])]),_:1}),e(z,{prop:"status",label:"状态"},{default:t(a=>[e(M,{type:a.row.status==="正常"?"success":"danger",effect:"plain"},{default:t(()=>[d(y(a.row.status),1)]),_:2},1032,["type"])]),_:1}),e(z,{label:"操作"},{default:t(a=>[e(I,{size:"small",onClick:X=>Y(a.row)},{default:t(()=>[...o[20]||(o[20]=[d("编辑",-1)])]),_:1},8,["onClick"]),e(I,{size:"small",type:"danger",onClick:X=>V(a.row)},{default:t(()=>[...o[21]||(o[21]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(c(),_("div",ql,[e(fe,{description:"暂无视频号账号数据"})]))])]),_:1}),e(re,{label:"小红书",name:"xiaohongshu"},{default:t(()=>[l("div",Nl,[l("div",jl,[e(ae,{modelValue:g.value,"onUpdate:modelValue":o[4]||(o[4]=a=>g.value=a),placeholder:"输入名称或账号搜索","prefix-icon":"Search",clearable:"",onClear:B,onInput:B},null,8,["modelValue"]),l("div",Kl,[e(I,{type:"primary",onClick:K},{default:t(()=>[...o[22]||(o[22]=[d("添加账号",-1)])]),_:1}),e(I,{type:"info",onClick:S,loading:!1},{default:t(()=>[e(Z,{class:ce({"is-loading":$(h).isAccountRefreshing})},{default:t(()=>[e($(ve))]),_:1},8,["class"]),$(h).isAccountRefreshing?(c(),_("span",Wl,"刷新中")):G("",!0)]),_:1})])]),j.value.length>0?(c(),_("div",Hl,[e(ne,{data:j.value,style:{width:"100%"}},{default:t(()=>[e(z,{label:"头像",width:"80"},{default:t(a=>[e(oe,{src:a.row.avatar,size:40},null,8,["src"])]),_:1}),e(z,{prop:"name",label:"名称",width:"180"}),e(z,{prop:"platform",label:"平台"},{default:t(a=>[e(M,{type:b(a.row.platform),effect:"plain"},{default:t(()=>[d(y(a.row.platform),1)]),_:2},1032,["type"])]),_:1}),e(z,{prop:"status",label:"状态"},{default:t(a=>[e(M,{type:a.row.status==="正常"?"success":"danger",effect:"plain"},{default:t(()=>[d(y(a.row.status),1)]),_:2},1032,["type"])]),_:1}),e(z,{label:"操作"},{default:t(a=>[e(I,{size:"small",onClick:X=>Y(a.row)},{default:t(()=>[...o[23]||(o[23]=[d("编辑",-1)])]),_:1},8,["onClick"]),e(I,{size:"small",type:"danger",onClick:X=>V(a.row)},{default:t(()=>[...o[24]||(o[24]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(c(),_("div",Jl,[e(fe,{description:"暂无小红书账号数据"})]))])]),_:1})]),_:1},8,["modelValue"])]),e(we,{modelValue:E.value,"onUpdate:modelValue":o[9]||(o[9]=a=>E.value=a),title:r.value==="add"?"添加账号":"编辑账号",width:"500px","close-on-click-modal":!1,"close-on-press-escape":!R.value,"show-close":!R.value},{footer:t(()=>[l("span",ts,[e(I,{onClick:o[8]||(o[8]=a=>E.value=!1)},{default:t(()=>[...o[29]||(o[29]=[d("取消",-1)])]),_:1}),e(I,{type:"primary",onClick:he,loading:R.value,disabled:R.value},{default:t(()=>[d(y(R.value?"请求中":"确认"),1)]),_:1},8,["loading","disabled"])])]),default:t(()=>[e(me,{model:L,"label-width":"80px",rules:D,ref_key:"accountFormRef",ref:O},{default:t(()=>[e(Te,{label:"平台",prop:"platform"},{default:t(()=>[e(Pe,{modelValue:L.platform,"onUpdate:modelValue":o[6]||(o[6]=a=>L.platform=a),placeholder:"请选择平台",style:{width:"100%"},disabled:r.value==="edit"||R.value},{default:t(()=>[e(be,{label:"快手",value:"快手"}),e(be,{label:"抖音",value:"抖音"}),e(be,{label:"视频号",value:"视频号"}),e(be,{label:"小红书",value:"小红书"})]),_:1},8,["modelValue","disabled"])]),_:1}),e(Te,{label:"名称",prop:"name"},{default:t(()=>[e(ae,{modelValue:L.name,"onUpdate:modelValue":o[7]||(o[7]=a=>L.name=a),placeholder:"请输入账号名称",disabled:R.value},null,8,["modelValue","disabled"])]),_:1}),R.value?(c(),_("div",Xl,[H.value&&!J.value?(c(),_("div",Ql,[o[25]||(o[25]=l("p",{class:"qrcode-tip"},"请使用对应平台APP扫描二维码登录",-1)),l("img",{src:H.value,alt:"登录二维码",class:"qrcode-image"},null,8,Gl)])):!H.value&&!J.value?(c(),_("div",Yl,[e(Z,{class:"is-loading"},{default:t(()=>[e($(ve))]),_:1}),o[26]||(o[26]=l("span",null,"请求中...",-1))])):J.value==="200"?(c(),_("div",Zl,[e(Z,null,{default:t(()=>[e($(bt))]),_:1}),o[27]||(o[27]=l("span",null,"添加成功",-1))])):J.value==="500"?(c(),_("div",es,[e(Z,null,{default:t(()=>[e($(wt))]),_:1}),o[28]||(o[28]=l("span",null,"添加失败，请稍后再试",-1))])):G("",!0)])):G("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title","close-on-press-escape","show-close"])])}}},ss=Ce(ls,[["__scopeId","data-v-23e28d1f"]]),pe={getAllMaterials:()=>ye.get("/getFiles"),uploadMaterial:p=>ye.upload("/uploadSave",p),deleteMaterial:p=>ye.get(`/deleteFile?id=${p}`),downloadMaterial:p=>`http://localhost:5409/download/${p}`,getMaterialPreviewUrl:p=>`http://localhost:5409/getFile?filename=${p}`},as={class:"material-management"},os={class:"material-list-container"},ns={class:"material-search"},is={class:"action-buttons"},us={key:0},ds={key:0,class:"material-list"},rs={key:1,class:"empty-data"},cs={class:"upload-form"},ps={class:"dialog-footer"},fs={key:0,class:"preview-container"},ms={key:0,class:"video-preview"},_s={controls:"",style:{"max-width":"100%","max-height":"60vh"}},vs=["src"],gs={key:1,class:"image-preview"},ys=["src"],hs={key:2,class:"file-info"},bs={__name:"MaterialManagement",setup(p){const v=Ee(),h=C(""),A=C(!1),g=C(!1),S=C(!1),b=C(!1),w=C(null),x=C([]),F=C(""),N=async()=>{A.value=!0;try{const V=await pe.getAllMaterials();V.code===200?(v.setMaterials(V.data),m.success("刷新成功")):m.error("获取素材列表失败")}catch(V){console.error("获取素材列表出错:",V),m.error("获取素材列表失败")}finally{A.value=!1}},j=de(()=>{if(!h.value)return v.materials;const V=h.value.toLowerCase();return v.materials.filter(i=>i.filename.toLowerCase().includes(V))}),B=()=>{},E=()=>{x.value=[],F.value="",S.value=!0},r=()=>{x.value=[],F.value=""},O=(V,i)=>{console.log("选择的文件:",V),V.raw&&(x.value=[V])},L=async()=>{if(x.value.length===0){m.warning("请选择要上传的文件");return}const V=x.value[0];if(!V||!V.raw){m.warning("文件对象无效，请重新选择文件");return}g.value=!0;try{const i=new FormData;console.log("上传文件对象:",V.raw),i.append("file",V.raw),F.value.trim()&&(i.append("filename",F.value.trim()),console.log("自定义文件名:",F.value.trim()));const W=await pe.uploadMaterial(i);W.code===200?(m.success("上传成功"),S.value=!1,await N()):m.error(W.msg||"上传失败")}catch(i){console.error("上传素材出错:",i),m.error("上传失败: "+(i.message||"未知错误"))}finally{g.value=!1}},D=async V=>{w.value=null,b.value=!0,m.info("加载中...");try{await new Promise(i=>setTimeout(i,100)),w.value=V}catch(i){console.error("预览素材出错:",i),m.error("预览加载失败"),b.value=!1}},R=V=>{xe.confirm(`确定要删除素材 ${V.filename} 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const i=await pe.deleteMaterial(V.id);i.code===200?(v.removeMaterial(V.id),m.success("删除成功")):m.error(i.msg||"删除失败")}catch(i){console.error("删除素材出错:",i),m.error("删除失败")}}).catch(()=>{})},H=V=>{const i=V.split("/").pop();return pe.getMaterialPreviewUrl(i)},J=V=>{const i=pe.downloadMaterial(V.file_path);window.open(i,"_blank")},K=V=>[".mp4",".avi",".mov",".wmv",".flv",".mkv"].some(W=>V.toLowerCase().endsWith(W)),Y=V=>[".jpg",".jpeg",".png",".gif",".bmp",".webp"].some(W=>V.toLowerCase().endsWith(W));return Ne(()=>{v.materials.length===0&&N()}),(V,i)=>{const W=f("el-input"),se=f("el-button"),he=f("el-icon"),U=f("el-table-column"),o=f("el-table"),ae=f("el-empty"),I=f("el-form-item"),Z=f("el-upload"),oe=f("el-form"),z=f("el-dialog");return c(),_("div",as,[i[14]||(i[14]=l("div",{class:"page-header"},[l("h1",null,"素材管理")],-1)),l("div",os,[l("div",ns,[e(W,{modelValue:h.value,"onUpdate:modelValue":i[0]||(i[0]=M=>h.value=M),placeholder:"输入文件名搜索","prefix-icon":"Search",clearable:"",onClear:B,onInput:B},null,8,["modelValue"]),l("div",is,[e(se,{type:"primary",onClick:E},{default:t(()=>[...i[6]||(i[6]=[d("上传素材",-1)])]),_:1}),e(se,{type:"info",onClick:N,loading:!1},{default:t(()=>[e(he,{class:ce({"is-loading":A.value})},{default:t(()=>[e($(ve))]),_:1},8,["class"]),A.value?(c(),_("span",us,"刷新中")):G("",!0)]),_:1})])]),j.value.length>0?(c(),_("div",ds,[e(o,{data:j.value,style:{width:"100%"}},{default:t(()=>[e(U,{prop:"filename",label:"文件名",width:"300"}),e(U,{prop:"filesize",label:"文件大小",width:"120"},{default:t(M=>[d(y(M.row.filesize)+" MB ",1)]),_:1}),e(U,{prop:"upload_time",label:"上传时间",width:"180"}),e(U,{label:"操作"},{default:t(M=>[e(se,{size:"small",onClick:ne=>D(M.row)},{default:t(()=>[...i[7]||(i[7]=[d("预览",-1)])]),_:1},8,["onClick"]),e(se,{size:"small",type:"danger",onClick:ne=>R(M.row)},{default:t(()=>[...i[8]||(i[8]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(c(),_("div",rs,[e(ae,{description:"暂无素材数据"})]))]),e(z,{modelValue:S.value,"onUpdate:modelValue":i[3]||(i[3]=M=>S.value=M),title:"上传素材",width:"40%",onClose:r},{footer:t(()=>[l("div",ps,[e(se,{onClick:i[2]||(i[2]=M=>S.value=!1)},{default:t(()=>[...i[11]||(i[11]=[d("取消",-1)])]),_:1}),e(se,{type:"primary",onClick:L,loading:g.value},{default:t(()=>[d(y(g.value?"上传中":"确认上传"),1)]),_:1},8,["loading"])])]),default:t(()=>[l("div",cs,[e(oe,{"label-width":"80px"},{default:t(()=>[e(I,{label:"文件名称:"},{default:t(()=>[e(W,{modelValue:F.value,"onUpdate:modelValue":i[1]||(i[1]=M=>F.value=M),placeholder:"选填",clearable:""},null,8,["modelValue"])]),_:1}),e(I,{label:"选择文件"},{default:t(()=>[e(Z,{class:"upload-demo",drag:"","auto-upload":!1,"on-change":O,"file-list":x.value,limit:1},{tip:t(()=>[...i[9]||(i[9]=[l("div",{class:"el-upload__tip"}," 支持视频、图片等格式文件，只能上传一个文件 ",-1)])]),default:t(()=>[e(he,{class:"el-icon--upload"},{default:t(()=>[e($($e))]),_:1}),i[10]||(i[10]=l("div",{class:"el-upload__text"},[d(" 将文件拖到此处，或"),l("em",null,"点击上传")],-1))]),_:1},8,["file-list"])]),_:1})]),_:1})])]),_:1},8,["modelValue"]),e(z,{modelValue:b.value,"onUpdate:modelValue":i[5]||(i[5]=M=>b.value=M),title:"素材预览",width:"50%",top:"10vh"},{default:t(()=>[w.value?(c(),_("div",fs,[K(w.value.filename)?(c(),_("div",ms,[l("video",_s,[l("source",{src:H(w.value.file_path),type:"video/mp4"},null,8,vs),i[12]||(i[12]=d(" 您的浏览器不支持视频播放 ",-1))])])):Y(w.value.filename)?(c(),_("div",gs,[l("img",{src:H(w.value.file_path),style:{"max-width":"100%","max-height":"60vh"}},null,8,ys)])):(c(),_("div",hs,[l("p",null,"文件名: "+y(w.value.filename),1),l("p",null,"文件大小: "+y(w.value.filesize)+" MB",1),l("p",null,"上传时间: "+y(w.value.upload_time),1),e(se,{type:"primary",onClick:i[4]||(i[4]=M=>J(w.value))},{default:t(()=>[...i[13]||(i[13]=[d("下载文件",-1)])]),_:1})]))])):G("",!0)]),_:1},8,["modelValue"])])}}},ws=Ce(bs,[["__scopeId","data-v-3d75da5e"]]),ks={class:"publish-center"},$s={class:"tab-management"},Cs={class:"tab-header"},Vs={class:"tab-list"},As=["onClick"],Ts={class:"tab-actions"},xs={class:"publish-content"},Ms={class:"tab-content-wrapper"},Ps={key:0,class:"publish-status"},Ss={class:"upload-section"},Us={class:"upload-options"},zs={key:0,class:"uploaded-files"},Ls={class:"file-list"},Es={class:"file-size"},Ds={class:"upload-options-content"},Fs={class:"publish-progress"},Is={key:0,class:"current-publishing"},Rs={key:1,class:"publish-results"},Bs={class:"label"},Os={class:"message"},qs={class:"dialog-footer"},Ns={class:"material-library-content"},js={class:"material-list"},Ks={class:"material-info"},Ws={class:"material-name"},Hs={class:"material-details"},Js={class:"file-size"},Xs={class:"upload-time"},Qs={class:"dialog-footer"},Gs={class:"account-section"},Ys={class:"account-display"},Zs={class:"selected-accounts"},ea={class:"account-dialog-content"},ta={class:"account-list"},la={class:"account-info"},sa={class:"account-name"},aa={class:"dialog-footer"},oa={class:"platform-section"},na={class:"title-section"},ia={class:"topic-section"},ua={class:"topic-display"},da={class:"selected-topics"},ra={class:"topic-dialog-content"},ca={class:"custom-topic-input"},pa={class:"recommended-topics"},fa={class:"topic-grid"},ma={class:"dialog-footer"},_a={class:"schedule-section"},va={class:"schedule-controls"},ga={key:0,class:"schedule-settings"},ya={class:"schedule-item"},ha={class:"schedule-item"},ba={class:"schedule-item"},wa={class:"action-buttons"},ka={__name:"PublishCenter",setup(p){const v="http://localhost:5409",h=de(()=>({Authorization:`Bearer ${localStorage.getItem("token")||""}`})),A=C("tab1");let g=1;const S=Ee(),b=C(!1),w=C(!1),x=C(!1),F=C(null),N=C([]),j=de(()=>S.materials),B=C(!1);C(""),C("info");const E=[{key:3,name:"抖音"},{key:4,name:"快手"},{key:2,name:"视频号"},{key:1,name:"小红书"}],r=ke([{name:"tab1",label:"发布1",fileList:[],displayFileList:[],selectedAccounts:[],selectedPlatform:1,title:"",selectedTopics:[],scheduleEnabled:!1,videosPerDay:1,dailyTimes:["10:00"],startDays:0,publishStatus:null}]),O=C(!1),L=C([]),D=C(null),R=We(),H=de(()=>{const u={3:"抖音",2:"视频号",1:"小红书",4:"快手"},s=D.value?u[D.value.selectedPlatform]:null;return s?R.accounts.filter(P=>P.platform===s):[]}),J=C(!1),K=C(""),Y=["游戏","电影","音乐","美食","旅行","文化","科技","生活","娱乐","体育","教育","艺术","健康","时尚","美妆","摄影","宠物","汽车"],V=()=>{g++;const u={name:`tab${g}`,label:`发布${g}`,fileList:[],displayFileList:[],selectedAccounts:[],selectedPlatform:1,title:"",selectedTopics:[],scheduleEnabled:!1,videosPerDay:1,dailyTimes:["10:00"],startDays:0,publishStatus:null};r.push(u),A.value=u.name},i=u=>{const s=r.findIndex(P=>P.name===u);s>-1&&(r.splice(s,1),A.value===u&&r.length>0&&(A.value=r[0].name))},W=(u,s,P)=>{if(u.code===200){const k=u.data.path||u.data,q=k.split("/").pop(),ie={name:s.name,url:pe.getMaterialPreviewUrl(q),path:k,size:s.size,type:s.type};P.fileList.push(ie),P.displayFileList=[...P.fileList.map(ue=>({name:ue.name,url:ue.url}))],m.success("文件上传成功"),console.log("上传成功:",ie)}else m.error(u.msg||"上传失败")},se=u=>{m.error("文件上传失败"),console.error("上传错误:",u)},he=(u,s)=>{u.fileList.splice(s,1),u.displayFileList=[...u.fileList.map(P=>({name:P.name,url:P.url}))],m.success("文件删除成功")},U=u=>{D.value=u,J.value=!0},o=()=>{if(!K.value.trim()){m.warning("请输入话题内容");return}D.value&&!D.value.selectedTopics.includes(K.value.trim())?(D.value.selectedTopics.push(K.value.trim()),K.value="",m.success("话题添加成功")):m.warning("话题已存在")},ae=u=>{if(!D.value)return;const s=D.value.selectedTopics.indexOf(u);s>-1?D.value.selectedTopics.splice(s,1):D.value.selectedTopics.push(u)},I=(u,s)=>{u.selectedTopics.splice(s,1)},Z=()=>{J.value=!1,K.value="",D.value=null,m.success("添加话题完成")},oe=u=>{D.value=u,L.value=[...u.selectedAccounts],O.value=!0},z=()=>{D.value&&(D.value.selectedAccounts=[...L.value]),O.value=!1,D.value=null,m.success("账号选择完成")},M=(u,s)=>{u.selectedAccounts.splice(s,1)},ne=u=>{const s=R.accounts.find(P=>P.id===u);return s?s.name:u},fe=u=>{m.info("已取消发布")},re=async u=>new Promise((s,P)=>{if(u.fileList.length===0){m.error("请先上传视频文件"),P(new Error("请先上传视频文件"));return}if(!u.title.trim()){m.error("请输入标题"),P(new Error("请输入标题"));return}if(!u.selectedPlatform){m.error("请选择发布平台"),P(new Error("请选择发布平台"));return}if(u.selectedAccounts.length===0){m.error("请选择发布账号"),P(new Error("请选择发布账号"));return}const k={type:u.selectedPlatform,title:u.title,tags:u.selectedTopics,fileList:u.fileList.map(q=>q.path),accountList:u.selectedAccounts.map(q=>{const ie=R.accounts.find(ue=>ue.id===q);return ie?ie.filePath:q}),enableTimer:u.scheduleEnabled?1:0,videosPerDay:u.scheduleEnabled&&u.videosPerDay||1,dailyTimes:u.scheduleEnabled?u.dailyTimes||["10:00"]:["10:00"],startDays:u.scheduleEnabled&&u.startDays||0,category:0};fetch(`${v}/postVideo`,{method:"POST",headers:{"Content-Type":"application/json",...h.value},body:JSON.stringify(k)}).then(q=>q.json()).then(q=>{q.code===200?(u.publishStatus={message:"发布成功",type:"success"},u.fileList=[],u.displayFileList=[],u.title="",u.selectedTopics=[],u.selectedAccounts=[],u.scheduleEnabled=!1,s()):(u.publishStatus={message:`发布失败：${q.msg||"发布失败"}`,type:"error"},P(new Error(q.msg||"发布失败")))}).catch(q=>{console.error("发布错误:",q),u.publishStatus={message:"发布失败，请检查网络连接",type:"error"},P(q)})}),Me=u=>{F.value=u,b.value=!0},be=()=>{b.value=!1,w.value=!0},Pe=async()=>{if(b.value=!1,j.value.length===0)try{const u=await pe.getAllMaterials();if(u.code===200)S.setMaterials(u.data);else{m.error("获取素材列表失败");return}}catch(u){console.error("获取素材列表出错:",u),m.error("获取素材列表失败");return}N.value=[],x.value=!0},Te=()=>{if(N.value.length===0){m.warning("请选择至少一个素材");return}F.value&&(N.value.forEach(s=>{const P=j.value.find(k=>k.id===s);if(P){const k={name:P.filename,url:pe.getMaterialPreviewUrl(P.file_path.split("/").pop()),path:P.file_path,size:P.filesize*1024*1024,type:"video/mp4"};F.value.fileList.some(ie=>ie.path===k.path)||F.value.fileList.push(k)}}),F.value.displayFileList=[...F.value.fileList.map(s=>({name:s.name,url:s.url}))]);const u=N.value.length;x.value=!1,N.value=[],F.value=null,m.success(`已添加 ${u} 个素材`)},me=C(!1),we=C(null),a=C(0),X=C([]),Ve=C(!1),He=()=>{Ve.value=!0,m.info("正在取消发布...")},Je=async()=>{if(!B.value){B.value=!0,we.value=null,a.value=0,X.value=[],Ve.value=!1,me.value=!0;try{for(let k=0;k<r.length;k++){if(Ve.value){X.value.push({label:r[k].label,status:"cancelled",message:"已取消"});continue}const q=r[k];we.value=q,a.value=Math.floor(k/r.length*100);try{await re(q),X.value.push({label:q.label,status:"success",message:"发布成功"})}catch(ie){X.value.push({label:q.label,status:"error",message:ie.message})}}a.value=100;const u=X.value.filter(k=>k.status==="success").length,s=X.value.filter(k=>k.status==="error").length,P=X.value.filter(k=>k.status==="cancelled").length;Ve.value?m.warning(`发布已取消：${u}个成功，${s}个失败，${P}个未执行`):s>0?m.error(`发布完成：${u}个成功，${s}个失败`):(m.success("所有Tab发布成功"),setTimeout(()=>{me.value=!1},1e3))}catch(u){console.error("批量发布出错:",u),m.error("批量发布出错，请重试")}finally{B.value=!1,Ve.value=!1}}};return(u,s)=>{const P=f("el-icon"),k=f("el-button"),q=f("el-alert"),ie=f("el-link"),ue=f("el-dialog"),Xe=f("el-upload"),Qe=f("el-progress"),Ge=f("Check"),Ye=f("InfoFilled"),De=f("el-checkbox"),Fe=f("el-checkbox-group"),Ie=f("el-tag"),Ze=f("el-radio"),et=f("el-radio-group"),Re=f("el-input"),tt=f("el-switch"),Se=f("el-option"),Be=f("el-select"),lt=f("el-time-select");return c(),_("div",ks,[l("div",$s,[l("div",Cs,[l("div",Vs,[(c(!0),_(ee,null,te(r,T=>(c(),_("div",{key:T.name,class:ce(["tab-item",{active:A.value===T.name}]),onClick:n=>A.value=T.name},[l("span",null,y(T.label),1),r.length>1?(c(),le(P,{key:0,class:"close-icon",onClick:nt(n=>i(T.name),["stop"])},{default:t(()=>[e($(Oe))]),_:1},8,["onClick"])):G("",!0)],10,As))),128))]),l("div",Ts,[e(k,{type:"primary",size:"small",onClick:V,class:"add-tab-btn"},{default:t(()=>[e(P,null,{default:t(()=>[e($(kt))]),_:1}),s[13]||(s[13]=d(" 添加Tab ",-1))]),_:1}),e(k,{type:"success",size:"small",onClick:Je,loading:B.value,class:"batch-publish-btn"},{default:t(()=>[...s[14]||(s[14]=[d(" 批量发布 ",-1)])]),_:1},8,["loading"])])])]),l("div",xs,[l("div",Ms,[(c(!0),_(ee,null,te(r,T=>ze((c(),_("div",{key:T.name,class:"tab-content"},[T.publishStatus?(c(),_("div",Ps,[e(q,{title:T.publishStatus.message,type:T.publishStatus.type,closable:!1,"show-icon":""},null,8,["title","type"])])):G("",!0),l("div",Ss,[s[18]||(s[18]=l("h3",null,"视频",-1)),l("div",Us,[e(k,{type:"primary",onClick:n=>Me(T),class:"upload-btn"},{default:t(()=>[e(P,null,{default:t(()=>[e($($e))]),_:1}),s[15]||(s[15]=d(" 上传视频 ",-1))]),_:1},8,["onClick"])]),T.fileList.length>0?(c(),_("div",zs,[s[17]||(s[17]=l("h4",null,"已上传文件：",-1)),l("div",Ls,[(c(!0),_(ee,null,te(T.fileList,(n,Q)=>(c(),_("div",{key:Q,class:"file-item"},[e(ie,{href:n.url,target:"_blank",type:"primary"},{default:t(()=>[d(y(n.name),1)]),_:2},1032,["href"]),l("span",Es,y((n.size/1024/1024).toFixed(2))+"MB",1),e(k,{type:"danger",size:"small",onClick:_e=>he(T,Q)},{default:t(()=>[...s[16]||(s[16]=[d("删除",-1)])]),_:1},8,["onClick"])]))),128))])])):G("",!0)]),e(ue,{modelValue:b.value,"onUpdate:modelValue":s[0]||(s[0]=n=>b.value=n),title:"选择上传方式",width:"400px",class:"upload-options-dialog"},{default:t(()=>[l("div",Ds,[e(k,{type:"primary",onClick:be,class:"option-btn"},{default:t(()=>[e(P,null,{default:t(()=>[e($($e))]),_:1}),s[19]||(s[19]=d(" 本地上传 ",-1))]),_:1}),e(k,{type:"success",onClick:Pe,class:"option-btn"},{default:t(()=>[e(P,null,{default:t(()=>[e($($t))]),_:1}),s[20]||(s[20]=d(" 素材库 ",-1))]),_:1})])]),_:1},8,["modelValue"]),e(ue,{modelValue:w.value,"onUpdate:modelValue":s[1]||(s[1]=n=>w.value=n),title:"本地上传",width:"600px",class:"local-upload-dialog"},{default:t(()=>[e(Xe,{class:"video-upload",drag:"","auto-upload":!0,action:`${$(v)}/upload`,"on-success":(n,Q)=>W(n,Q,F.value),"on-error":se,multiple:"",accept:"video/*",headers:h.value},{tip:t(()=>[...s[21]||(s[21]=[l("div",{class:"el-upload__tip"}," 支持MP4、AVI等视频格式，可上传多个文件 ",-1)])]),default:t(()=>[e(P,{class:"el-icon--upload"},{default:t(()=>[e($($e))]),_:1}),s[22]||(s[22]=l("div",{class:"el-upload__text"},[d(" 将视频文件拖到此处，或"),l("em",null,"点击上传")],-1))]),_:1},8,["action","on-success","headers"])]),_:1},8,["modelValue"]),e(ue,{modelValue:me.value,"onUpdate:modelValue":s[3]||(s[3]=n=>me.value=n),title:"批量发布进度",width:"500px","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},{footer:t(()=>[l("div",qs,[e(k,{onClick:He,disabled:a.value===100},{default:t(()=>[...s[23]||(s[23]=[d(" 取消发布 ",-1)])]),_:1},8,["disabled"]),a.value===100?(c(),le(k,{key:0,type:"primary",onClick:s[2]||(s[2]=n=>me.value=!1)},{default:t(()=>[...s[24]||(s[24]=[d(" 关闭 ",-1)])]),_:1})):G("",!0)])]),default:t(()=>[l("div",Fs,[e(Qe,{percentage:a.value,status:a.value===100?"success":""},null,8,["percentage","status"]),we.value?(c(),_("div",Is," 正在发布："+y(we.value.label),1)):G("",!0),X.value.length>0?(c(),_("div",Rs,[(c(!0),_(ee,null,te(X.value,(n,Q)=>(c(),_("div",{key:Q,class:ce(["result-item",n.status])},[n.status==="success"?(c(),le(P,{key:0},{default:t(()=>[e(Ge)]),_:1})):n.status==="error"?(c(),le(P,{key:1},{default:t(()=>[e($(Oe))]),_:1})):(c(),le(P,{key:2},{default:t(()=>[e(Ye)]),_:1})),l("span",Bs,y(n.label),1),l("span",Os,y(n.message),1)],2))),128))])):G("",!0)])]),_:1},8,["modelValue"]),e(ue,{modelValue:x.value,"onUpdate:modelValue":s[6]||(s[6]=n=>x.value=n),title:"选择素材",width:"800px",class:"material-library-dialog"},{footer:t(()=>[l("div",Qs,[e(k,{onClick:s[5]||(s[5]=n=>x.value=!1)},{default:t(()=>[...s[25]||(s[25]=[d("取消",-1)])]),_:1}),e(k,{type:"primary",onClick:Te},{default:t(()=>[...s[26]||(s[26]=[d("确定",-1)])]),_:1})])]),default:t(()=>[l("div",Ns,[e(Fe,{modelValue:N.value,"onUpdate:modelValue":s[4]||(s[4]=n=>N.value=n)},{default:t(()=>[l("div",js,[(c(!0),_(ee,null,te(j.value,n=>(c(),_("div",{key:n.id,class:"material-item"},[e(De,{label:n.id,class:"material-checkbox"},{default:t(()=>[l("div",Ks,[l("div",Ws,y(n.filename),1),l("div",Hs,[l("span",Js,y(n.filesize)+"MB",1),l("span",Xs,y(n.upload_time),1)])])]),_:2},1032,["label"])]))),128))])]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"]),l("div",Gs,[s[28]||(s[28]=l("h3",null,"账号",-1)),l("div",Ys,[l("div",Zs,[(c(!0),_(ee,null,te(T.selectedAccounts,(n,Q)=>(c(),le(Ie,{key:Q,closable:"",onClose:_e=>M(T,Q),class:"account-tag"},{default:t(()=>[d(y(ne(n)),1)]),_:2},1032,["onClose"]))),128))]),e(k,{type:"primary",plain:"",onClick:n=>oe(T),class:"select-account-btn"},{default:t(()=>[...s[27]||(s[27]=[d(" 选择账号 ",-1)])]),_:1},8,["onClick"])])]),e(ue,{modelValue:O.value,"onUpdate:modelValue":s[9]||(s[9]=n=>O.value=n),title:"选择账号",width:"600px",class:"account-dialog"},{footer:t(()=>[l("div",aa,[e(k,{onClick:s[8]||(s[8]=n=>O.value=!1)},{default:t(()=>[...s[29]||(s[29]=[d("取消",-1)])]),_:1}),e(k,{type:"primary",onClick:z},{default:t(()=>[...s[30]||(s[30]=[d("确定",-1)])]),_:1})])]),default:t(()=>[l("div",ea,[e(Fe,{modelValue:L.value,"onUpdate:modelValue":s[7]||(s[7]=n=>L.value=n)},{default:t(()=>[l("div",ta,[(c(!0),_(ee,null,te(H.value,n=>(c(),le(De,{key:n.id,label:n.id,class:"account-item"},{default:t(()=>[l("div",la,[l("span",sa,y(n.name),1)])]),_:2},1032,["label"]))),128))])]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"]),l("div",oa,[s[31]||(s[31]=l("h3",null,"平台",-1)),e(et,{modelValue:T.selectedPlatform,"onUpdate:modelValue":n=>T.selectedPlatform=n,class:"platform-radios"},{default:t(()=>[(c(),_(ee,null,te(E,n=>e(Ze,{key:n.key,label:n.key,class:"platform-radio"},{default:t(()=>[d(y(n.name),1)]),_:2},1032,["label"])),64))]),_:1},8,["modelValue","onUpdate:modelValue"])]),l("div",na,[s[32]||(s[32]=l("h3",null,"标题",-1)),e(Re,{modelValue:T.title,"onUpdate:modelValue":n=>T.title=n,type:"textarea",rows:3,placeholder:"请输入标题",maxlength:"100","show-word-limit":"",class:"title-input"},null,8,["modelValue","onUpdate:modelValue"])]),l("div",ia,[s[34]||(s[34]=l("h3",null,"话题",-1)),l("div",ua,[l("div",da,[(c(!0),_(ee,null,te(T.selectedTopics,(n,Q)=>(c(),le(Ie,{key:Q,closable:"",onClose:_e=>I(T,Q),class:"topic-tag"},{default:t(()=>[d(" #"+y(n),1)]),_:2},1032,["onClose"]))),128))]),e(k,{type:"primary",plain:"",onClick:n=>U(T),class:"select-topic-btn"},{default:t(()=>[...s[33]||(s[33]=[d(" 添加话题 ",-1)])]),_:1},8,["onClick"])])]),e(ue,{modelValue:J.value,"onUpdate:modelValue":s[12]||(s[12]=n=>J.value=n),title:"添加话题",width:"600px",class:"topic-dialog"},{footer:t(()=>[l("div",ma,[e(k,{onClick:s[11]||(s[11]=n=>J.value=!1)},{default:t(()=>[...s[38]||(s[38]=[d("取消",-1)])]),_:1}),e(k,{type:"primary",onClick:Z},{default:t(()=>[...s[39]||(s[39]=[d("确定",-1)])]),_:1})])]),default:t(()=>[l("div",ra,[l("div",ca,[e(Re,{modelValue:K.value,"onUpdate:modelValue":s[10]||(s[10]=n=>K.value=n),placeholder:"输入自定义话题",class:"custom-input"},{prepend:t(()=>[...s[35]||(s[35]=[d("#",-1)])]),_:1},8,["modelValue"]),e(k,{type:"primary",onClick:o},{default:t(()=>[...s[36]||(s[36]=[d("添加",-1)])]),_:1})]),l("div",pa,[s[37]||(s[37]=l("h4",null,"推荐话题",-1)),l("div",fa,[(c(),_(ee,null,te(Y,n=>{var Q,_e;return e(k,{key:n,type:(_e=(Q=D.value)==null?void 0:Q.selectedTopics)!=null&&_e.includes(n)?"primary":"default",onClick:Pa=>ae(n),class:"topic-btn"},{default:t(()=>[d(y(n),1)]),_:2},1032,["type","onClick"])}),64))])])])]),_:1},8,["modelValue"]),l("div",_a,[s[44]||(s[44]=l("h3",null,"定时发布",-1)),l("div",va,[e(tt,{modelValue:T.scheduleEnabled,"onUpdate:modelValue":n=>T.scheduleEnabled=n,"active-text":"定时发布","inactive-text":"立即发布"},null,8,["modelValue","onUpdate:modelValue"]),T.scheduleEnabled?(c(),_("div",ga,[l("div",ya,[s[40]||(s[40]=l("span",{class:"label"},"每天发布视频数：",-1)),e(Be,{modelValue:T.videosPerDay,"onUpdate:modelValue":n=>T.videosPerDay=n,placeholder:"选择发布数量"},{default:t(()=>[(c(),_(ee,null,te(55,n=>e(Se,{key:n,label:n,value:n},null,8,["label","value"])),64))]),_:1},8,["modelValue","onUpdate:modelValue"])]),l("div",ha,[s[42]||(s[42]=l("span",{class:"label"},"每天发布时间：",-1)),(c(!0),_(ee,null,te(T.dailyTimes,(n,Q)=>(c(),le(lt,{key:Q,modelValue:T.dailyTimes[Q],"onUpdate:modelValue":_e=>T.dailyTimes[Q]=_e,start:"00:00",step:"00:30",end:"23:30",placeholder:"选择时间"},null,8,["modelValue","onUpdate:modelValue"]))),128)),T.dailyTimes.length<T.videosPerDay?(c(),le(k,{key:0,type:"primary",size:"small",onClick:n=>T.dailyTimes.push("10:00")},{default:t(()=>[...s[41]||(s[41]=[d(" 添加时间 ",-1)])]),_:1},8,["onClick"])):G("",!0)]),l("div",ba,[s[43]||(s[43]=l("span",{class:"label"},"开始天数：",-1)),e(Be,{modelValue:T.startDays,"onUpdate:modelValue":n=>T.startDays=n,placeholder:"选择开始天数"},{default:t(()=>[e(Se,{label:"明天",value:0}),e(Se,{label:"后天",value:1})]),_:1},8,["modelValue","onUpdate:modelValue"])])])):G("",!0)])]),l("div",wa,[e(k,{size:"small",onClick:n=>fe()},{default:t(()=>[...s[45]||(s[45]=[d("取消",-1)])]),_:1},8,["onClick"]),e(k,{size:"small",type:"primary",onClick:n=>re(T)},{default:t(()=>[...s[46]||(s[46]=[d("发布",-1)])]),_:1},8,["onClick"])])])),[[Le,A.value===T.name]])),128))])])])}}},$a=Ce(ka,[["__scopeId","data-v-79721ef4"]]),Ca={class:"about"},Va={__name:"About",setup(p){return(v,h)=>(c(),_("div",Ca,[...h[0]||(h[0]=[l("h1",null,"关于我们",-1),l("p",null,"这是关于页面",-1)])]))}},Aa=Ce(Va,[["__scopeId","data-v-cd67ee8e"]]),Ta=[{path:"/",name:"Dashboard",component:vl},{path:"/account-management",name:"AccountManagement",component:ss},{path:"/material-management",name:"MaterialManagement",component:ws},{path:"/publish-center",name:"PublishCenter",component:$a},{path:"/about",name:"About",component:Aa}],xa=it({history:ut(),routes:Ta}),Ma=dt(),Ae=rt(Et);for(const[p,v]of Object.entries(Ct))Ae.component(p,v);Ae.use(xa);Ae.use(Ma);Ae.use(Vt);Ae.mount("#app");
