import{b as X,ax as Ie,r as O,c as V,o as p,R as e,J as t,al as c,a as l,K as _e,S as ye,u as E,p as de,ay as Ee,P as U,O as v,I as Q,L as J,az as Ce,t as we,X as ze,ar as De,E as ae,Q as Z,a6 as ee,W as Fe,a4 as Oe,w as Re,aA as Be,aB as Ne,aC as qe,au as Ke}from"./vue-CbZdtcPO.js";import{h as je,u as Ae,p as He,a as re,m as We,d as Te,f as Xe,b as Ge,l as Je,c as Qe,e as Ye,t as Ze,E as w,g as ce,r as ne,i as et,j as tt,k as lt,n as xe,o as at,q as st,s as ot,v as nt,w as it}from"./elementPlus-CSqc6bT9.js";import{a as ut}from"./utils-NIGUFBhG.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))r(m);new MutationObserver(m=>{for(const g of m)if(g.type==="childList")for(const u of g.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function n(m){const g={};return m.integrity&&(g.integrity=m.integrity),m.referrerPolicy&&(g.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?g.credentials="include":m.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function r(m){if(m.ep)return;m.ep=!0;const g=n(m);fetch(m.href,g)}})();const dt="/vite.svg",Y=(s,i)=>{const n=s.__vccOpts||s;for(const[r,m]of i)n[r]=m;return n},rt={id:"app"},ct={class:"sidebar"},pt={class:"logo"},mt={src:dt,alt:"Logo",class:"logo-img"},ft={class:"header-content"},vt={class:"header-left"},_t={__name:"App",setup(s){const i=Ie(),n=X(()=>i.path),r=O(!1),m=()=>{r.value=!r.value};return(g,u)=>{const h=c("el-icon"),A=c("el-menu-item"),P=c("el-menu"),C=c("el-aside"),L=c("el-header"),D=c("router-view"),_=c("el-main"),o=c("el-container");return p(),V("div",rt,[e(o,null,{default:t(()=>[e(C,{width:r.value?"64px":"200px"},{default:t(()=>[l("div",ct,[l("div",pt,[_e(l("img",mt,null,512),[[ye,r.value]]),_e(l("h2",null,"自媒体自动化运营系统",512),[[ye,!r.value]])]),e(P,{router:!0,"default-active":n.value,collapse:r.value,class:"sidebar-menu","background-color":"#001529","text-color":"#fff","active-text-color":"#409EFF"},{default:t(()=>[e(A,{index:"/"},{default:t(()=>[e(h,null,{default:t(()=>[e(E(je))]),_:1}),u[0]||(u[0]=l("span",null,"首页",-1))]),_:1}),e(A,{index:"/account-management"},{default:t(()=>[e(h,null,{default:t(()=>[e(E(Ae))]),_:1}),u[1]||(u[1]=l("span",null,"账号管理",-1))]),_:1}),e(A,{index:"/material-management"},{default:t(()=>[e(h,null,{default:t(()=>[e(E(He))]),_:1}),u[2]||(u[2]=l("span",null,"素材管理",-1))]),_:1}),e(A,{index:"/publish-center"},{default:t(()=>[e(h,null,{default:t(()=>[e(E(re))]),_:1}),u[3]||(u[3]=l("span",null,"发布中心",-1))]),_:1}),e(A,{index:"/website"},{default:t(()=>[e(h,null,{default:t(()=>[e(E(We))]),_:1}),u[4]||(u[4]=l("span",null,"网站",-1))]),_:1}),e(A,{index:"/data"},{default:t(()=>[e(h,null,{default:t(()=>[e(E(Te))]),_:1}),u[5]||(u[5]=l("span",null,"数据",-1))]),_:1})]),_:1},8,["default-active","collapse"])])]),_:1},8,["width"]),e(o,null,{default:t(()=>[e(L,null,{default:t(()=>[l("div",ft,[l("div",vt,[e(h,{class:"toggle-sidebar",onClick:m},{default:t(()=>[e(E(Xe))]),_:1})]),u[6]||(u[6]=l("div",{class:"header-right"},null,-1))])]),_:1}),e(_,null,{default:t(()=>[e(D)]),_:1})]),_:1})]),_:1})])}}},gt=Y(_t,[["__scopeId","data-v-176fbaed"]]),yt={class:"dashboard"},ht={class:"dashboard-content"},bt={class:"stat-card-content"},$t={class:"stat-icon"},wt={class:"stat-info"},kt={class:"stat-value"},Vt={class:"stat-footer"},Ct={class:"stat-detail"},At={class:"stat-card-content"},Tt={class:"stat-icon platform-icon"},xt={class:"stat-info"},Pt={class:"stat-value"},St={class:"stat-footer"},Mt={class:"stat-detail"},Ut={class:"stat-card-content"},Lt={class:"stat-icon task-icon"},It={class:"stat-info"},Et={class:"stat-value"},zt={class:"stat-footer"},Dt={class:"stat-detail"},Ft={class:"stat-card-content"},Ot={class:"stat-icon content-icon"},Rt={class:"stat-info"},Bt={class:"stat-value"},Nt={class:"stat-footer"},qt={class:"stat-detail"},Kt={class:"quick-actions"},jt={class:"action-icon"},Ht={class:"action-icon"},Wt={class:"action-icon"},Xt={class:"action-icon"},Gt={class:"recent-tasks"},Jt={class:"section-header"},Qt={__name:"Dashboard",setup(s){const i=Ee(),n=de({total:12,normal:10,abnormal:2}),r=de({total:4,kuaishou:3,douyin:4,channels:2,xiaohongshu:3}),m=de({total:24,completed:18,inProgress:5,failed:1}),g=de({total:36,published:30,draft:6}),u=O([{id:1,title:"快手视频自动发布",platform:"快手",account:"快手账号1",createTime:"2024-05-01 10:30:00",status:"已完成"},{id:2,title:"抖音视频定时发布",platform:"抖音",account:"抖音账号1",createTime:"2024-05-01 11:15:00",status:"进行中"},{id:3,title:"视频号内容上传",platform:"视频号",account:"视频号账号1",createTime:"2024-05-01 14:20:00",status:"待执行"},{id:4,title:"小红书图文发布",platform:"小红书",account:"小红书账号1",createTime:"2024-05-01 16:45:00",status:"已失败"},{id:5,title:"快手短视频批量上传",platform:"快手",account:"快手账号2",createTime:"2024-05-02 09:10:00",status:"待执行"}]),h=_=>({快手:"success",抖音:"danger",视频号:"warning",小红书:"info"})[_]||"info",A=_=>({已完成:"success",进行中:"warning",待执行:"info",已失败:"danger"})[_]||"info",P=_=>{i.push(_)},C=_=>{w.info(`查看任务: ${_.title}`)},L=_=>{ce.confirm(`确定要执行任务 ${_.title} 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(()=>{const o=u.value.findIndex(R=>R.id===_.id);o!==-1&&(u.value[o].status="进行中"),w({type:"success",message:"任务已开始执行"})}).catch(()=>{})},D=_=>{ce.confirm(`确定要取消任务 ${_.title} 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const o=u.value.findIndex(R=>R.id===_.id);o!==-1&&(u.value[o].status="已取消"),w({type:"success",message:"任务已取消"})}).catch(()=>{})};return(_,o)=>{const R=c("el-icon"),T=c("el-card"),b=c("el-col"),N=c("el-tag"),S=c("el-tooltip"),M=c("el-row"),G=c("el-button"),W=c("el-table-column"),z=c("el-table");return p(),V("div",yt,[o[19]||(o[19]=l("div",{class:"page-header"},[l("h1",null,"自媒体自动化运营系统")],-1)),l("div",ht,[e(M,{gutter:20},{default:t(()=>[e(b,{span:6},{default:t(()=>[e(T,{class:"stat-card"},{default:t(()=>[l("div",bt,[l("div",$t,[e(R,null,{default:t(()=>[e(E(Ae))]),_:1})]),l("div",wt,[l("div",kt,U(n.total),1),o[1]||(o[1]=l("div",{class:"stat-label"},"账号总数",-1))])]),l("div",Vt,[l("div",Ct,[l("span",null,"正常: "+U(n.normal),1),l("span",null,"异常: "+U(n.abnormal),1)])])]),_:1})]),_:1}),e(b,{span:6},{default:t(()=>[e(T,{class:"stat-card"},{default:t(()=>[l("div",At,[l("div",Tt,[e(R,null,{default:t(()=>[e(E(Ge))]),_:1})]),l("div",xt,[l("div",Pt,U(r.total),1),o[2]||(o[2]=l("div",{class:"stat-label"},"平台总数",-1))])]),l("div",St,[l("div",Mt,[e(S,{content:"快手账号",placement:"top"},{default:t(()=>[e(N,{size:"small",type:"success"},{default:t(()=>[v(U(r.kuaishou),1)]),_:1})]),_:1}),e(S,{content:"抖音账号",placement:"top"},{default:t(()=>[e(N,{size:"small",type:"danger"},{default:t(()=>[v(U(r.douyin),1)]),_:1})]),_:1}),e(S,{content:"视频号账号",placement:"top"},{default:t(()=>[e(N,{size:"small",type:"warning"},{default:t(()=>[v(U(r.channels),1)]),_:1})]),_:1}),e(S,{content:"小红书账号",placement:"top"},{default:t(()=>[e(N,{size:"small",type:"info"},{default:t(()=>[v(U(r.xiaohongshu),1)]),_:1})]),_:1})])])]),_:1})]),_:1}),e(b,{span:6},{default:t(()=>[e(T,{class:"stat-card"},{default:t(()=>[l("div",Ut,[l("div",Lt,[e(R,null,{default:t(()=>[e(E(Je))]),_:1})]),l("div",It,[l("div",Et,U(m.total),1),o[3]||(o[3]=l("div",{class:"stat-label"},"任务总数",-1))])]),l("div",zt,[l("div",Dt,[l("span",null,"完成: "+U(m.completed),1),l("span",null,"进行中: "+U(m.inProgress),1),l("span",null,"失败: "+U(m.failed),1)])])]),_:1})]),_:1}),e(b,{span:6},{default:t(()=>[e(T,{class:"stat-card"},{default:t(()=>[l("div",Ft,[l("div",Ot,[e(R,null,{default:t(()=>[e(E(Qe))]),_:1})]),l("div",Rt,[l("div",Bt,U(g.total),1),o[4]||(o[4]=l("div",{class:"stat-label"},"内容总数",-1))])]),l("div",Nt,[l("div",qt,[l("span",null,"已发布: "+U(g.published),1),l("span",null,"草稿: "+U(g.draft),1)])])]),_:1})]),_:1})]),_:1}),l("div",Kt,[o[13]||(o[13]=l("h2",null,"快捷操作",-1)),e(M,{gutter:20},{default:t(()=>[e(b,{span:6},{default:t(()=>[e(T,{class:"action-card",onClick:o[0]||(o[0]=d=>P("/account-management"))},{default:t(()=>[l("div",jt,[e(R,null,{default:t(()=>[e(E(Ye))]),_:1})]),o[5]||(o[5]=l("div",{class:"action-title"},"账号管理",-1)),o[6]||(o[6]=l("div",{class:"action-desc"},"管理所有平台账号",-1))]),_:1})]),_:1}),e(b,{span:6},{default:t(()=>[e(T,{class:"action-card"},{default:t(()=>[l("div",Ht,[e(R,null,{default:t(()=>[e(E(re))]),_:1})]),o[7]||(o[7]=l("div",{class:"action-title"},"内容上传",-1)),o[8]||(o[8]=l("div",{class:"action-desc"},"上传视频和图文内容",-1))]),_:1})]),_:1}),e(b,{span:6},{default:t(()=>[e(T,{class:"action-card"},{default:t(()=>[l("div",Wt,[e(R,null,{default:t(()=>[e(E(Ze))]),_:1})]),o[9]||(o[9]=l("div",{class:"action-title"},"定时发布",-1)),o[10]||(o[10]=l("div",{class:"action-desc"},"设置内容发布时间",-1))]),_:1})]),_:1}),e(b,{span:6},{default:t(()=>[e(T,{class:"action-card"},{default:t(()=>[l("div",Xt,[e(R,null,{default:t(()=>[e(E(Te))]),_:1})]),o[11]||(o[11]=l("div",{class:"action-title"},"数据分析",-1)),o[12]||(o[12]=l("div",{class:"action-desc"},"查看内容数据分析",-1))]),_:1})]),_:1})]),_:1})]),l("div",Gt,[l("div",Jt,[o[15]||(o[15]=l("h2",null,"最近任务",-1)),e(G,{text:""},{default:t(()=>[...o[14]||(o[14]=[v("查看全部",-1)])]),_:1})]),e(z,{data:u.value,style:{width:"100%"}},{default:t(()=>[e(W,{prop:"title",label:"任务名称",width:"250"}),e(W,{prop:"platform",label:"平台",width:"120"},{default:t(d=>[e(N,{type:h(d.row.platform),effect:"plain"},{default:t(()=>[v(U(d.row.platform),1)]),_:2},1032,["type"])]),_:1}),e(W,{prop:"account",label:"账号",width:"150"}),e(W,{prop:"createTime",label:"创建时间",width:"180"}),e(W,{prop:"status",label:"状态",width:"120"},{default:t(d=>[e(N,{type:A(d.row.status),effect:"plain"},{default:t(()=>[v(U(d.row.status),1)]),_:2},1032,["type"])]),_:1}),e(W,{label:"操作"},{default:t(d=>[e(G,{size:"small",onClick:F=>C(d.row)},{default:t(()=>[...o[16]||(o[16]=[v("查看",-1)])]),_:1},8,["onClick"]),d.row.status==="待执行"?(p(),Q(G,{key:0,size:"small",type:"primary",onClick:F=>L(d.row)},{default:t(()=>[...o[17]||(o[17]=[v(" 执行 ",-1)])]),_:1},8,["onClick"])):J("",!0),d.row.status!=="已完成"&&d.row.status!=="已失败"?(p(),Q(G,{key:1,size:"small",type:"danger",onClick:F=>D(d.row)},{default:t(()=>[...o[18]||(o[18]=[v(" 取消 ",-1)])]),_:1},8,["onClick"])):J("",!0)]),_:1})]),_:1},8,["data"])])])])}}},Yt=Y(Qt,[["__scopeId","data-v-db5c2d61"]]),ie=ut.create({baseURL:"http://localhost:5409",headers:{"Content-Type":"application/json"}});ie.interceptors.request.use(s=>{const i=localStorage.getItem("token");return i&&(s.headers.Authorization=`Bearer ${i}`),s},s=>(console.error("请求错误:",s),Promise.reject(s)));ie.interceptors.response.use(s=>{const{data:i}=s;return i.code===200||i.success?i:(w.error(i.message||"请求失败"),Promise.reject(new Error(i.message||"请求失败")))},s=>{if(console.error("响应错误:",s),s.response){const{status:i}=s.response;switch(i){case 401:w.error("未授权，请重新登录");break;case 403:w.error("拒绝访问");break;case 404:w.error("请求地址不存在");break;case 500:w.error("服务器内部错误");break;default:w.error("网络错误")}}else w.error("网络连接失败");return Promise.reject(s)});const ue={get(s,i){return ie.get(s,{params:i})},post(s,i,n={}){return ie.post(s,i,n)},put(s,i,n={}){return ie.put(s,i,n)},delete(s,i){return ie.delete(s,{params:i})},upload(s,i){return ie.post(s,i,{headers:{"Content-Type":"multipart/form-data"}})}},ve={getValidAccounts(s){return ue.get("/getValidAccounts",s)},addAccount(s){return ue.post("/account",s)},updateAccount(s){return ue.post("/updateUserinfo",s)},deleteAccount(s){return ue.get(`/deleteAccount?id=${s}`)}},ke=Ce("account",()=>{const s=O([]),i={1:"小红书",2:"视频号",3:"抖音",4:"快手"};return{accounts:s,setAccounts:h=>{s.value=h.map(A=>({id:A[0],type:A[1],filePath:A[2],name:A[3],status:A[4]===1?"正常":"异常",platform:i[A[1]]||"未知",avatar:"/vite.svg"}))},addAccount:h=>{s.value.push(h)},updateAccount:(h,A)=>{const P=s.value.findIndex(C=>C.id===h);P!==-1&&(s.value[P]={...s.value[P],...A})},deleteAccount:h=>{s.value=s.value.filter(A=>A.id!==h)},getAccountsByPlatform:h=>s.value.filter(A=>A.platform===h)}}),ge=Ce("app",()=>{const s=O(!0),i=O(!0),n=O(!1),r=O([]);return{isFirstTimeAccountManagement:s,isFirstTimeMaterialManagement:i,isAccountRefreshing:n,materials:r,setAccountManagementVisited:()=>{s.value=!1},setMaterialManagementVisited:()=>{i.value=!1},resetVisitStatus:()=>{s.value=!0,i.value=!0},setMaterials:L=>{r.value=L},addMaterial:L=>{r.value.push(L)},removeMaterial:L=>{const D=r.value.findIndex(_=>_.id===L);D>-1&&r.value.splice(D,1)},setAccountRefreshing:L=>{n.value=L}}}),Zt={class:"account-management","element-loading-text":"正在验证账号..."},el={class:"account-tabs"},tl={class:"account-list-container"},ll={class:"account-search"},al={class:"action-buttons"},sl={class:"refresh-text"},ol={key:0,class:"account-list"},nl={key:1,class:"empty-data"},il={class:"account-list-container"},ul={class:"account-search"},dl={class:"action-buttons"},rl={class:"refresh-text"},cl={key:0,class:"account-list"},pl={key:1,class:"empty-data"},ml={class:"account-list-container"},fl={class:"account-search"},vl={class:"action-buttons"},_l={class:"refresh-text"},gl={key:0,class:"account-list"},yl={key:1,class:"empty-data"},hl={class:"account-list-container"},bl={class:"account-search"},$l={class:"action-buttons"},wl={class:"refresh-text"},kl={key:0,class:"account-list"},Vl={key:1,class:"empty-data"},Cl={class:"account-list-container"},Al={class:"account-search"},Tl={class:"action-buttons"},xl={class:"refresh-text"},Pl={key:0,class:"account-list"},Sl={key:1,class:"empty-data"},Ml={key:0,class:"qrcode-container"},Ul={key:0,class:"qrcode-wrapper"},Ll=["src"],Il={key:1,class:"loading-wrapper"},El={key:2,class:"success-wrapper"},zl={key:3,class:"error-wrapper"},Dl={class:"dialog-footer"},Fl={__name:"AccountManagement",setup(s){const i=ke(),n=ge(),r=O("all"),m=O(""),g=async(j=!1)=>{if(!n.isAccountRefreshing){n.setAccountRefreshing(!0);try{const a=await ve.getValidAccounts({validate:j?1:0});a.code===200&&a.data?(i.setAccounts(a.data),j&&w.success("账号验证完成"),n.isFirstTimeAccountManagement&&n.setAccountManagementVisited()):w.error("获取账号数据失败")}catch(a){console.error("获取账号数据失败:",a),w.error("获取账号数据失败")}finally{n.setAccountRefreshing(!1)}}};we(()=>{n.isFirstTimeAccountManagement&&g(!1)});const u=j=>({快手:"success",抖音:"danger",视频号:"warning",小红书:"info"})[j]||"info",h=X(()=>m.value?i.accounts.filter(j=>j.name.includes(m.value)):i.accounts),A=X(()=>h.value.filter(j=>j.platform==="快手")),P=X(()=>h.value.filter(j=>j.platform==="抖音")),C=X(()=>h.value.filter(j=>j.platform==="视频号")),L=X(()=>h.value.filter(j=>j.platform==="小红书")),D=()=>{},_=O(!1),o=O("add"),R=O(null),T=de({id:null,name:"",platform:"",status:"正常"}),b={platform:[{required:!0,message:"请选择平台",trigger:"change"}],name:[{required:!0,message:"请输入账号名称",trigger:"blur"}]},N=O(!1),S=O(""),M=O(""),G=()=>{o.value="add",Object.assign(T,{id:null,name:"",platform:"",status:"正常"}),N.value=!1,S.value="",M.value="",_.value=!0},W=j=>{o.value="edit",Object.assign(T,{...j}),_.value=!0},z=j=>{ce.confirm(`确定要删除账号 ${j.name} 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const a=await ve.deleteAccount(j.id);a.code===200?(i.deleteAccount(j.id),w({type:"success",message:"删除成功"})):w.error(a.msg||"删除失败")}catch(a){console.error("删除账号失败:",a),w.error("删除账号失败")}}).catch(()=>{})};let d=null;const F=()=>{d&&(d.close(),d=null)},H=(j,a)=>{F(),N.value=!0,S.value="",M.value="";const B=`http://localhost:5409/login?type=${{小红书:"1",视频号:"2",抖音:"3",快手:"4"}[j]||"1"}&id=${encodeURIComponent(a)}`;d=new EventSource(B),d.onmessage=$=>{const I=$.data;if(console.log("SSE消息:",I),!S.value&&I.length>100)try{I.startsWith("data:image")?S.value=I:S.value=`data:image/png;base64,${I}`,console.log("设置二维码数据，长度:",I.length)}catch(x){console.error("处理二维码数据出错:",x)}else(I==="200"||I==="500")&&(M.value=I,I==="200"?setTimeout(()=>{F(),setTimeout(()=>{_.value=!1,N.value=!1,w.success("账号添加成功"),w({type:"info",message:"正在同步账号信息...",duration:0}),g().then(()=>{w.closeAll(),w.success("账号信息已更新")})},1e3)},1e3):(F(),setTimeout(()=>{N.value=!1,S.value="",M.value=""},2e3)))},d.onerror=$=>{console.error("SSE连接错误:",$),w.error("连接服务器失败，请稍后再试"),F(),N.value=!1}},te=()=>{R.value.validate(async j=>{if(j)if(o.value==="add")H(T.platform,T.name);else try{const a=await ve.updateAccount({id:T.id,type:T.platform==="快手"?1:T.platform==="抖音"?2:T.platform==="视频号"?3:4,userName:T.name});a.code===200?(i.updateAccount(T.id,T),w.success("更新成功"),_.value=!1,g()):w.error(a.msg||"更新账号失败")}catch(a){console.error("更新账号失败:",a),w.error("更新账号失败")}else return!1})};return ze(()=>{F()}),(j,a)=>{const y=c("el-input"),k=c("el-button"),q=c("el-icon"),B=c("el-avatar"),$=c("el-table-column"),I=c("el-tag"),x=c("el-table"),K=c("el-empty"),oe=c("el-tab-pane"),Pe=c("el-tabs"),fe=c("el-option"),Se=c("el-select"),Ve=c("el-form-item"),Me=c("el-form"),Ue=c("el-dialog"),Le=De("loading");return _e((p(),V("div",Zt,[a[35]||(a[35]=l("div",{class:"page-header"},[l("h1",null,"账号管理")],-1)),l("div",el,[e(Pe,{modelValue:r.value,"onUpdate:modelValue":a[10]||(a[10]=f=>r.value=f),class:"account-tabs-nav"},{default:t(()=>[e(oe,{label:"全部",name:"all"},{default:t(()=>[l("div",tl,[l("div",ll,[e(y,{modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=f=>m.value=f),placeholder:"输入名称或账号搜索","prefix-icon":"Search",clearable:"",onClear:D,onInput:D},null,8,["modelValue"]),l("div",al,[e(k,{type:"primary",onClick:G},{default:t(()=>[...a[15]||(a[15]=[v("添加账号",-1)])]),_:1}),e(k,{type:"info",onClick:a[1]||(a[1]=()=>g(!0))},{default:t(()=>[e(q,{class:ae({"is-loading":E(n).isAccountRefreshing,"refresh-icon":!0})},{default:t(()=>[e(E(ne))]),_:1},8,["class"]),l("span",sl,U(E(n).isAccountRefreshing?"验证中...":"手动过期验证"),1)]),_:1})])]),h.value.length>0?(p(),V("div",ol,[e(x,{data:h.value,style:{width:"100%"}},{default:t(()=>[e($,{label:"头像",width:"80"},{default:t(f=>[e(B,{src:f.row.avatar,size:40},null,8,["src"])]),_:1}),e($,{prop:"name",label:"名称",width:"180"}),e($,{prop:"platform",label:"平台"},{default:t(f=>[e(I,{type:u(f.row.platform),effect:"plain"},{default:t(()=>[v(U(f.row.platform),1)]),_:2},1032,["type"])]),_:1}),e($,{prop:"status",label:"状态"},{default:t(f=>[e(I,{type:f.row.status==="正常"?"success":"danger",effect:"plain"},{default:t(()=>[v(U(f.row.status),1)]),_:2},1032,["type"])]),_:1}),e($,{label:"操作"},{default:t(f=>[e(k,{size:"small",onClick:le=>W(f.row)},{default:t(()=>[...a[16]||(a[16]=[v("编辑",-1)])]),_:1},8,["onClick"]),e(k,{size:"small",type:"danger",onClick:le=>z(f.row)},{default:t(()=>[...a[17]||(a[17]=[v("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(p(),V("div",nl,[e(K,{description:"暂无账号数据"})]))])]),_:1}),e(oe,{label:"快手",name:"kuaishou"},{default:t(()=>[l("div",il,[l("div",ul,[e(y,{modelValue:m.value,"onUpdate:modelValue":a[2]||(a[2]=f=>m.value=f),placeholder:"输入名称或账号搜索","prefix-icon":"Search",clearable:"",onClear:D,onInput:D},null,8,["modelValue"]),l("div",dl,[e(k,{type:"primary",onClick:G},{default:t(()=>[...a[18]||(a[18]=[v("添加账号",-1)])]),_:1}),e(k,{type:"info",onClick:a[3]||(a[3]=()=>g(!0))},{default:t(()=>[e(q,{class:ae({"is-loading":E(n).isAccountRefreshing,"refresh-icon":!0})},{default:t(()=>[e(E(ne))]),_:1},8,["class"]),l("span",rl,U(E(n).isAccountRefreshing?"验证中...":"手动过期验证"),1)]),_:1})])]),A.value.length>0?(p(),V("div",cl,[e(x,{data:A.value,style:{width:"100%"}},{default:t(()=>[e($,{label:"头像",width:"80"},{default:t(f=>[e(B,{src:f.row.avatar,size:40},null,8,["src"])]),_:1}),e($,{prop:"name",label:"名称",width:"180"}),e($,{prop:"platform",label:"平台"},{default:t(f=>[e(I,{type:u(f.row.platform),effect:"plain"},{default:t(()=>[v(U(f.row.platform),1)]),_:2},1032,["type"])]),_:1}),e($,{prop:"status",label:"状态"},{default:t(f=>[e(I,{type:f.row.status==="正常"?"success":"danger",effect:"plain"},{default:t(()=>[v(U(f.row.status),1)]),_:2},1032,["type"])]),_:1}),e($,{label:"操作"},{default:t(f=>[e(k,{size:"small",onClick:le=>W(f.row)},{default:t(()=>[...a[19]||(a[19]=[v("编辑",-1)])]),_:1},8,["onClick"]),e(k,{size:"small",type:"danger",onClick:le=>z(f.row)},{default:t(()=>[...a[20]||(a[20]=[v("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(p(),V("div",pl,[e(K,{description:"暂无快手账号数据"})]))])]),_:1}),e(oe,{label:"抖音",name:"douyin"},{default:t(()=>[l("div",ml,[l("div",fl,[e(y,{modelValue:m.value,"onUpdate:modelValue":a[4]||(a[4]=f=>m.value=f),placeholder:"输入名称或账号搜索","prefix-icon":"Search",clearable:"",onClear:D,onInput:D},null,8,["modelValue"]),l("div",vl,[e(k,{type:"primary",onClick:G},{default:t(()=>[...a[21]||(a[21]=[v("添加账号",-1)])]),_:1}),e(k,{type:"info",onClick:a[5]||(a[5]=()=>g(!0))},{default:t(()=>[e(q,{class:ae({"is-loading":E(n).isAccountRefreshing,"refresh-icon":!0})},{default:t(()=>[e(E(ne))]),_:1},8,["class"]),l("span",_l,U(E(n).isAccountRefreshing?"验证中...":"手动过期验证"),1)]),_:1})])]),P.value.length>0?(p(),V("div",gl,[e(x,{data:P.value,style:{width:"100%"}},{default:t(()=>[e($,{label:"头像",width:"80"},{default:t(f=>[e(B,{src:f.row.avatar,size:40},null,8,["src"])]),_:1}),e($,{prop:"name",label:"名称",width:"180"}),e($,{prop:"platform",label:"平台"},{default:t(f=>[e(I,{type:u(f.row.platform),effect:"plain"},{default:t(()=>[v(U(f.row.platform),1)]),_:2},1032,["type"])]),_:1}),e($,{prop:"status",label:"状态"},{default:t(f=>[e(I,{type:f.row.status==="正常"?"success":"danger",effect:"plain"},{default:t(()=>[v(U(f.row.status),1)]),_:2},1032,["type"])]),_:1}),e($,{label:"操作"},{default:t(f=>[e(k,{size:"small",onClick:le=>W(f.row)},{default:t(()=>[...a[22]||(a[22]=[v("编辑",-1)])]),_:1},8,["onClick"]),e(k,{size:"small",type:"danger",onClick:le=>z(f.row)},{default:t(()=>[...a[23]||(a[23]=[v("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(p(),V("div",yl,[e(K,{description:"暂无抖音账号数据"})]))])]),_:1}),e(oe,{label:"视频号",name:"channels"},{default:t(()=>[l("div",hl,[l("div",bl,[e(y,{modelValue:m.value,"onUpdate:modelValue":a[6]||(a[6]=f=>m.value=f),placeholder:"输入名称或账号搜索","prefix-icon":"Search",clearable:"",onClear:D,onInput:D},null,8,["modelValue"]),l("div",$l,[e(k,{type:"primary",onClick:G},{default:t(()=>[...a[24]||(a[24]=[v("添加账号",-1)])]),_:1}),e(k,{type:"info",onClick:a[7]||(a[7]=()=>g(!0))},{default:t(()=>[e(q,{class:ae({"is-loading":E(n).isAccountRefreshing,"refresh-icon":!0})},{default:t(()=>[e(E(ne))]),_:1},8,["class"]),l("span",wl,U(E(n).isAccountRefreshing?"验证中...":"手动过期验证"),1)]),_:1})])]),C.value.length>0?(p(),V("div",kl,[e(x,{data:C.value,style:{width:"100%"}},{default:t(()=>[e($,{label:"头像",width:"80"},{default:t(f=>[e(B,{src:f.row.avatar,size:40},null,8,["src"])]),_:1}),e($,{prop:"name",label:"名称",width:"180"}),e($,{prop:"platform",label:"平台"},{default:t(f=>[e(I,{type:u(f.row.platform),effect:"plain"},{default:t(()=>[v(U(f.row.platform),1)]),_:2},1032,["type"])]),_:1}),e($,{prop:"status",label:"状态"},{default:t(f=>[e(I,{type:f.row.status==="正常"?"success":"danger",effect:"plain"},{default:t(()=>[v(U(f.row.status),1)]),_:2},1032,["type"])]),_:1}),e($,{label:"操作"},{default:t(f=>[e(k,{size:"small",onClick:le=>W(f.row)},{default:t(()=>[...a[25]||(a[25]=[v("编辑",-1)])]),_:1},8,["onClick"]),e(k,{size:"small",type:"danger",onClick:le=>z(f.row)},{default:t(()=>[...a[26]||(a[26]=[v("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(p(),V("div",Vl,[e(K,{description:"暂无视频号账号数据"})]))])]),_:1}),e(oe,{label:"小红书",name:"xiaohongshu"},{default:t(()=>[l("div",Cl,[l("div",Al,[e(y,{modelValue:m.value,"onUpdate:modelValue":a[8]||(a[8]=f=>m.value=f),placeholder:"输入名称或账号搜索","prefix-icon":"Search",clearable:"",onClear:D,onInput:D},null,8,["modelValue"]),l("div",Tl,[e(k,{type:"primary",onClick:G},{default:t(()=>[...a[27]||(a[27]=[v("添加账号",-1)])]),_:1}),e(k,{type:"info",onClick:a[9]||(a[9]=()=>g(!0))},{default:t(()=>[e(q,{class:ae({"is-loading":E(n).isAccountRefreshing,"refresh-icon":!0})},{default:t(()=>[e(E(ne))]),_:1},8,["class"]),l("span",xl,U(E(n).isAccountRefreshing?"验证中...":"手动过期验证"),1)]),_:1})])]),L.value.length>0?(p(),V("div",Pl,[e(x,{data:L.value,style:{width:"100%"}},{default:t(()=>[e($,{label:"头像",width:"80"},{default:t(f=>[e(B,{src:f.row.avatar,size:40},null,8,["src"])]),_:1}),e($,{prop:"name",label:"名称",width:"180"}),e($,{prop:"platform",label:"平台"},{default:t(f=>[e(I,{type:u(f.row.platform),effect:"plain"},{default:t(()=>[v(U(f.row.platform),1)]),_:2},1032,["type"])]),_:1}),e($,{prop:"status",label:"状态"},{default:t(f=>[e(I,{type:f.row.status==="正常"?"success":"danger",effect:"plain"},{default:t(()=>[v(U(f.row.status),1)]),_:2},1032,["type"])]),_:1}),e($,{label:"操作"},{default:t(f=>[e(k,{size:"small",onClick:le=>W(f.row)},{default:t(()=>[...a[28]||(a[28]=[v("编辑",-1)])]),_:1},8,["onClick"]),e(k,{size:"small",type:"danger",onClick:le=>z(f.row)},{default:t(()=>[...a[29]||(a[29]=[v("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(p(),V("div",Sl,[e(K,{description:"暂无小红书账号数据"})]))])]),_:1})]),_:1},8,["modelValue"])]),e(Ue,{modelValue:_.value,"onUpdate:modelValue":a[14]||(a[14]=f=>_.value=f),title:o.value==="add"?"添加账号":"编辑账号",width:"500px","close-on-click-modal":!1,"close-on-press-escape":!N.value,"show-close":!N.value},{footer:t(()=>[l("span",Dl,[e(k,{onClick:a[13]||(a[13]=f=>_.value=!1)},{default:t(()=>[...a[34]||(a[34]=[v("取消",-1)])]),_:1}),e(k,{type:"primary",onClick:te,loading:N.value,disabled:N.value},{default:t(()=>[v(U(N.value?"请求中":"确认"),1)]),_:1},8,["loading","disabled"])])]),default:t(()=>[e(Me,{model:T,"label-width":"80px",rules:b,ref_key:"accountFormRef",ref:R},{default:t(()=>[e(Ve,{label:"平台",prop:"platform"},{default:t(()=>[e(Se,{modelValue:T.platform,"onUpdate:modelValue":a[11]||(a[11]=f=>T.platform=f),placeholder:"请选择平台",style:{width:"100%"},disabled:o.value==="edit"||N.value},{default:t(()=>[e(fe,{label:"快手",value:"快手"}),e(fe,{label:"抖音",value:"抖音"}),e(fe,{label:"视频号",value:"视频号"}),e(fe,{label:"小红书",value:"小红书"})]),_:1},8,["modelValue","disabled"])]),_:1}),e(Ve,{label:"名称",prop:"name"},{default:t(()=>[e(y,{modelValue:T.name,"onUpdate:modelValue":a[12]||(a[12]=f=>T.name=f),placeholder:"请输入账号名称",disabled:N.value},null,8,["modelValue","disabled"])]),_:1}),N.value?(p(),V("div",Ml,[S.value&&!M.value?(p(),V("div",Ul,[a[30]||(a[30]=l("p",{class:"qrcode-tip"},"请使用对应平台APP扫描二维码登录",-1)),l("img",{src:S.value,alt:"登录二维码",class:"qrcode-image"},null,8,Ll)])):!S.value&&!M.value?(p(),V("div",Il,[e(q,{class:"is-loading"},{default:t(()=>[e(E(ne))]),_:1}),a[31]||(a[31]=l("span",null,"请求中...",-1))])):M.value==="200"?(p(),V("div",El,[e(q,null,{default:t(()=>[e(E(et))]),_:1}),a[32]||(a[32]=l("span",null,"添加成功",-1))])):M.value==="500"?(p(),V("div",zl,[e(q,null,{default:t(()=>[e(E(tt))]),_:1}),a[33]||(a[33]=l("span",null,"添加失败，请稍后再试",-1))])):J("",!0)])):J("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title","close-on-press-escape","show-close"])])),[[Le,E(n).isAccountRefreshing]])}}},Ol=Y(Fl,[["__scopeId","data-v-15d9d15f"]]),se={getAllMaterials:()=>ue.get("/getFiles"),uploadMaterial:s=>ue.upload("/uploadSave",s),deleteMaterial:s=>ue.get(`/deleteFile?id=${s}`),downloadMaterial:s=>`http://localhost:5409/download/${s}`,getMaterialPreviewUrl:s=>`http://localhost:5409/getFile?filename=${s}`},Rl={class:"material-management"},Bl={class:"material-list-container"},Nl={class:"material-search"},ql={class:"action-buttons"},Kl={key:0},jl={key:0,class:"material-list"},Hl={key:1,class:"empty-data"},Wl={class:"upload-form"},Xl={class:"dialog-footer"},Gl={key:0,class:"preview-container"},Jl={key:0,class:"video-preview"},Ql={controls:"",style:{"max-width":"100%","max-height":"60vh"}},Yl=["src"],Zl={key:1,class:"image-preview"},ea=["src"],ta={key:2,class:"file-info"},la={__name:"MaterialManagement",setup(s){const i=ge(),n=O(""),r=O(!1),m=O(!1),g=O(!1),u=O(!1),h=O(null),A=O([]),P=O(""),C=async()=>{r.value=!0;try{const z=await se.getAllMaterials();z.code===200?(i.setMaterials(z.data),w.success("刷新成功")):w.error("获取素材列表失败")}catch(z){console.error("获取素材列表出错:",z),w.error("获取素材列表失败")}finally{r.value=!1}},L=X(()=>{if(!n.value)return i.materials;const z=n.value.toLowerCase();return i.materials.filter(d=>d.filename.toLowerCase().includes(z))}),D=()=>{},_=()=>{A.value=[],P.value="",g.value=!0},o=()=>{A.value=[],P.value=""},R=(z,d)=>{console.log("选择的文件:",z),z.raw&&(A.value=[z])},T=async()=>{if(A.value.length===0){w.warning("请选择要上传的文件");return}const z=A.value[0];if(!z||!z.raw){w.warning("文件对象无效，请重新选择文件");return}m.value=!0;try{const d=new FormData;console.log("上传文件对象:",z.raw),d.append("file",z.raw),P.value.trim()&&(d.append("filename",P.value.trim()),console.log("自定义文件名:",P.value.trim()));const F=await se.uploadMaterial(d);F.code===200?(w.success("上传成功"),g.value=!1,await C()):w.error(F.msg||"上传失败")}catch(d){console.error("上传素材出错:",d),w.error("上传失败: "+(d.message||"未知错误"))}finally{m.value=!1}},b=async z=>{h.value=null,u.value=!0,w.info("加载中...");try{await new Promise(d=>setTimeout(d,100)),h.value=z}catch(d){console.error("预览素材出错:",d),w.error("预览加载失败"),u.value=!1}},N=z=>{ce.confirm(`确定要删除素材 ${z.filename} 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const d=await se.deleteMaterial(z.id);d.code===200?(i.removeMaterial(z.id),w.success("删除成功")):w.error(d.msg||"删除失败")}catch(d){console.error("删除素材出错:",d),w.error("删除失败")}}).catch(()=>{})},S=z=>{const d=z.split("/").pop();return se.getMaterialPreviewUrl(d)},M=z=>{const d=se.downloadMaterial(z.file_path);window.open(d,"_blank")},G=z=>[".mp4",".avi",".mov",".wmv",".flv",".mkv"].some(F=>z.toLowerCase().endsWith(F)),W=z=>[".jpg",".jpeg",".png",".gif",".bmp",".webp"].some(F=>z.toLowerCase().endsWith(F));return we(()=>{i.materials.length===0&&C()}),(z,d)=>{const F=c("el-input"),H=c("el-button"),te=c("el-icon"),j=c("el-table-column"),a=c("el-table"),y=c("el-empty"),k=c("el-form-item"),q=c("el-upload"),B=c("el-form"),$=c("el-dialog");return p(),V("div",Rl,[d[14]||(d[14]=l("div",{class:"page-header"},[l("h1",null,"素材管理")],-1)),l("div",Bl,[l("div",Nl,[e(F,{modelValue:n.value,"onUpdate:modelValue":d[0]||(d[0]=I=>n.value=I),placeholder:"输入文件名搜索","prefix-icon":"Search",clearable:"",onClear:D,onInput:D},null,8,["modelValue"]),l("div",ql,[e(H,{type:"primary",onClick:_},{default:t(()=>[...d[6]||(d[6]=[v("上传素材",-1)])]),_:1}),e(H,{type:"info",onClick:C,loading:!1},{default:t(()=>[e(te,{class:ae({"is-loading":r.value})},{default:t(()=>[e(E(ne))]),_:1},8,["class"]),r.value?(p(),V("span",Kl,"刷新中")):J("",!0)]),_:1})])]),L.value.length>0?(p(),V("div",jl,[e(a,{data:L.value,style:{width:"100%"}},{default:t(()=>[e(j,{prop:"filename",label:"文件名",width:"300"}),e(j,{prop:"filesize",label:"文件大小",width:"120"},{default:t(I=>[v(U(I.row.filesize)+" MB ",1)]),_:1}),e(j,{prop:"upload_time",label:"上传时间",width:"180"}),e(j,{label:"操作"},{default:t(I=>[e(H,{size:"small",onClick:x=>b(I.row)},{default:t(()=>[...d[7]||(d[7]=[v("预览",-1)])]),_:1},8,["onClick"]),e(H,{size:"small",type:"danger",onClick:x=>N(I.row)},{default:t(()=>[...d[8]||(d[8]=[v("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(p(),V("div",Hl,[e(y,{description:"暂无素材数据"})]))]),e($,{modelValue:g.value,"onUpdate:modelValue":d[3]||(d[3]=I=>g.value=I),title:"上传素材",width:"40%",onClose:o},{footer:t(()=>[l("div",Xl,[e(H,{onClick:d[2]||(d[2]=I=>g.value=!1)},{default:t(()=>[...d[11]||(d[11]=[v("取消",-1)])]),_:1}),e(H,{type:"primary",onClick:T,loading:m.value},{default:t(()=>[v(U(m.value?"上传中":"确认上传"),1)]),_:1},8,["loading"])])]),default:t(()=>[l("div",Wl,[e(B,{"label-width":"80px"},{default:t(()=>[e(k,{label:"文件名称:"},{default:t(()=>[e(F,{modelValue:P.value,"onUpdate:modelValue":d[1]||(d[1]=I=>P.value=I),placeholder:"选填",clearable:""},null,8,["modelValue"])]),_:1}),e(k,{label:"选择文件"},{default:t(()=>[e(q,{class:"upload-demo",drag:"","auto-upload":!1,"on-change":R,"file-list":A.value,limit:1},{tip:t(()=>[...d[9]||(d[9]=[l("div",{class:"el-upload__tip"}," 支持视频、图片等格式文件，只能上传一个文件 ",-1)])]),default:t(()=>[e(te,{class:"el-icon--upload"},{default:t(()=>[e(E(re))]),_:1}),d[10]||(d[10]=l("div",{class:"el-upload__text"},[v(" 将文件拖到此处，或"),l("em",null,"点击上传")],-1))]),_:1},8,["file-list"])]),_:1})]),_:1})])]),_:1},8,["modelValue"]),e($,{modelValue:u.value,"onUpdate:modelValue":d[5]||(d[5]=I=>u.value=I),title:"素材预览",width:"50%",top:"10vh"},{default:t(()=>[h.value?(p(),V("div",Gl,[G(h.value.filename)?(p(),V("div",Jl,[l("video",Ql,[l("source",{src:S(h.value.file_path),type:"video/mp4"},null,8,Yl),d[12]||(d[12]=v(" 您的浏览器不支持视频播放 ",-1))])])):W(h.value.filename)?(p(),V("div",Zl,[l("img",{src:S(h.value.file_path),style:{"max-width":"100%","max-height":"60vh"}},null,8,ea)])):(p(),V("div",ta,[l("p",null,"文件名: "+U(h.value.filename),1),l("p",null,"文件大小: "+U(h.value.filesize)+" MB",1),l("p",null,"上传时间: "+U(h.value.upload_time),1),e(H,{type:"primary",onClick:d[4]||(d[4]=I=>M(h.value))},{default:t(()=>[...d[13]||(d[13]=[v("下载文件",-1)])]),_:1})]))])):J("",!0)]),_:1},8,["modelValue"])])}}},aa=Y(la,[["__scopeId","data-v-3d75da5e"]]),he={DOUYIN:{key:3,name:"抖音",titleLimit:30,topicLimit:5,titlePlaceholder:"请输入标题（最多30字）",topicPlaceholder:"最多可添加5个话题"},KUAISHOU:{key:4,name:"快手",titleLimit:30,topicLimit:3,titlePlaceholder:"请输入标题（最多30字）",topicPlaceholder:"最多可添加3个话题"},WEIXIN:{key:2,name:"视频号",titleLimit:16,topicLimit:20,titlePlaceholder:"请输入标题（最多16字）",topicPlaceholder:"最多可添加20个话题"},XIAOHONGSHU:{key:1,name:"小红书",titleLimit:20,topicLimit:10,titlePlaceholder:"请输入标题（最多20字）",topicPlaceholder:"最多可添加10个话题"}};function pe(s){return Object.values(he).find(i=>i.key===s)||he.XIAOHONGSHU}function sa(){return Object.values(he)}function be(s,i){const n=pe(i);return!s||!s.trim()?{valid:!1,message:"请输入标题"}:s.length>n.titleLimit?{valid:!1,message:`标题不能超过${n.titleLimit}字，当前${s.length}字`}:{valid:!0,message:""}}function $e(s,i){const n=pe(i);return Array.isArray(s)?s.length>n.topicLimit?{valid:!1,message:`最多只能添加${n.topicLimit}个话题，当前${s.length}个`}:{valid:!0,message:""}:{valid:!1,message:"话题格式错误"}}function oa(s){return!s||!s.trim()?{valid:!1,message:"话题内容不能为空"}:s.length>20?{valid:!1,message:"单个话题不能超过20字"}:/[<>{}[\]()&$#@!%^*+=|\\/]/g.test(s)?{valid:!1,message:"话题不能包含特殊字符"}:{valid:!0,message:""}}function na(s){const i={};let n=!0;(!s.fileList||s.fileList.length===0)&&(i.fileList="请先上传视频文件",n=!1);const r=be(s.title,s.selectedPlatform);r.valid||(i.title=r.message,n=!1),s.selectedPlatform||(i.platform="请选择发布平台",n=!1),(!s.selectedAccounts||s.selectedAccounts.length===0)&&(i.accounts="请选择发布账号",n=!1);const m=$e(s.selectedTopics,s.selectedPlatform);return m.valid||(i.topics=m.message,n=!1),s.scheduleEnabled&&((!s.videosPerDay||s.videosPerDay<1||s.videosPerDay>55)&&(i.videosPerDay="每天发布视频数必须在1-55之间",n=!1),(!s.dailyTimes||s.dailyTimes.length===0)&&(i.dailyTimes="请设置发布时间",n=!1),s.dailyTimes&&s.dailyTimes.length!==s.videosPerDay&&(i.dailyTimes="发布时间数量必须与每天发布视频数一致",n=!1),(s.startDays===void 0||s.startDays<0)&&(i.startDays="请选择开始天数",n=!1)),{valid:n,errors:i}}const ia={class:"tab-management"},ua={class:"tab-header"},da={class:"tab-list"},ra=["onClick"],ca={class:"tab-actions"},pa={__name:"TabManagement",props:{tabs:{type:Array,required:!0},activeTab:{type:String,required:!0},batchPublishing:{type:Boolean,default:!1}},emits:["tab-change","remove-tab","add-tab","batch-publish"],setup(s){return(i,n)=>{const r=c("el-icon"),m=c("el-button");return p(),V("div",ia,[l("div",ua,[l("div",da,[(p(!0),V(Z,null,ee(s.tabs,g=>(p(),V("div",{key:g.name,class:ae(["tab-item",{active:s.activeTab===g.name}]),onClick:u=>i.$emit("tab-change",g.name)},[l("span",null,U(g.label),1),s.tabs.length>1?(p(),Q(r,{key:0,class:"close-icon",onClick:Fe(u=>i.$emit("remove-tab",g.name),["stop"])},{default:t(()=>[e(E(xe))]),_:1},8,["onClick"])):J("",!0)],10,ra))),128))]),l("div",ca,[e(m,{type:"primary",size:"small",onClick:n[0]||(n[0]=g=>i.$emit("add-tab")),class:"add-tab-btn"},{default:t(()=>[e(r,null,{default:t(()=>[e(E(lt))]),_:1}),n[2]||(n[2]=v(" 添加Tab ",-1))]),_:1}),e(m,{type:"success",size:"small",onClick:n[1]||(n[1]=g=>i.$emit("batch-publish")),loading:s.batchPublishing,class:"batch-publish-btn"},{default:t(()=>[...n[3]||(n[3]=[v(" 批量发布 ",-1)])]),_:1},8,["loading"])])])])}}},ma=Y(pa,[["__scopeId","data-v-7584dadb"]]),fa={class:"upload-section"},va={class:"upload-options"},_a={key:0,class:"uploaded-files"},ga={class:"file-list"},ya={class:"file-size"},ha={class:"upload-options-content"},ba={class:"material-library-content"},$a={class:"material-list"},wa={class:"material-info"},ka={class:"material-name"},Va={class:"material-details"},Ca={class:"file-size"},Aa={class:"upload-time"},Ta={class:"dialog-footer"},xa={__name:"VideoUpload",props:{fileList:{type:Array,default:()=>[]},uploadAction:{type:String,required:!0},authHeaders:{type:Object,required:!0},materials:{type:Array,default:()=>[]}},emits:["show-upload-options","remove-file","upload-success","material-selected"],setup(s,{expose:i,emit:n}){const r=s,m=n,g=ge(),u=O(!1),h=O(!1),A=O(!1),P=O([]),C=()=>{u.value=!1,h.value=!0},L=async()=>{if(u.value=!1,r.materials.length===0)try{const T=await se.getAllMaterials();if(T.code===200)g.setMaterials(T.data);else{w.error("获取素材列表失败");return}}catch(T){console.error("获取素材列表出错:",T),w.error("获取素材列表失败");return}P.value=[],A.value=!0},D=(T,b)=>{T.code===200?(m("upload-success",T,b),h.value=!1,w.success("文件上传成功")):w.error(T.msg||"上传失败")},_=T=>{w.error("文件上传失败"),console.error("上传错误:",T)},o=()=>{if(P.value.length===0){w.warning("请选择至少一个素材");return}m("material-selected",P.value);const T=P.value.length;A.value=!1,P.value=[],w.success(`已添加 ${T} 个素材`)},R=()=>{u.value=!0};return i({showUploadOptions:R}),(T,b)=>{const N=c("el-icon"),S=c("el-button"),M=c("el-link"),G=c("el-dialog"),W=c("el-upload"),z=c("el-checkbox"),d=c("el-checkbox-group");return p(),V("div",fa,[b[14]||(b[14]=l("h3",null,"视频",-1)),l("div",va,[e(S,{type:"primary",onClick:R,class:"upload-btn"},{default:t(()=>[e(N,null,{default:t(()=>[e(E(re))]),_:1}),b[5]||(b[5]=v(" 上传视频 ",-1))]),_:1})]),s.fileList.length>0?(p(),V("div",_a,[b[7]||(b[7]=l("h4",null,"已上传文件：",-1)),l("div",ga,[(p(!0),V(Z,null,ee(s.fileList,(F,H)=>(p(),V("div",{key:H,class:"file-item"},[e(M,{href:F.url,target:"_blank",type:"primary"},{default:t(()=>[v(U(F.name),1)]),_:2},1032,["href"]),l("span",ya,U((F.size/1024/1024).toFixed(2))+"MB",1),e(S,{type:"danger",size:"small",onClick:te=>T.$emit("remove-file",H)},{default:t(()=>[...b[6]||(b[6]=[v("删除",-1)])]),_:1},8,["onClick"])]))),128))])])):J("",!0),e(G,{modelValue:u.value,"onUpdate:modelValue":b[0]||(b[0]=F=>u.value=F),title:"选择上传方式",width:"400px",class:"upload-options-dialog"},{default:t(()=>[l("div",ha,[e(S,{type:"primary",onClick:C,class:"option-btn"},{default:t(()=>[e(N,null,{default:t(()=>[e(E(re))]),_:1}),b[8]||(b[8]=v(" 本地上传 ",-1))]),_:1}),e(S,{type:"success",onClick:L,class:"option-btn"},{default:t(()=>[e(N,null,{default:t(()=>[e(E(at))]),_:1}),b[9]||(b[9]=v(" 素材库 ",-1))]),_:1})])]),_:1},8,["modelValue"]),e(G,{modelValue:h.value,"onUpdate:modelValue":b[1]||(b[1]=F=>h.value=F),title:"本地上传",width:"600px",class:"local-upload-dialog"},{default:t(()=>[e(W,{class:"video-upload",drag:"","auto-upload":!0,action:s.uploadAction,"on-success":D,"on-error":_,multiple:"",accept:"video/*",headers:s.authHeaders},{tip:t(()=>[...b[10]||(b[10]=[l("div",{class:"el-upload__tip"}," 支持MP4、AVI等视频格式，可上传多个文件 ",-1)])]),default:t(()=>[e(N,{class:"el-icon--upload"},{default:t(()=>[e(E(re))]),_:1}),b[11]||(b[11]=l("div",{class:"el-upload__text"},[v(" 将视频文件拖到此处，或"),l("em",null,"点击上传")],-1))]),_:1},8,["action","headers"])]),_:1},8,["modelValue"]),e(G,{modelValue:A.value,"onUpdate:modelValue":b[4]||(b[4]=F=>A.value=F),title:"选择素材",width:"800px",class:"material-library-dialog"},{footer:t(()=>[l("div",Ta,[e(S,{onClick:b[3]||(b[3]=F=>A.value=!1)},{default:t(()=>[...b[12]||(b[12]=[v("取消",-1)])]),_:1}),e(S,{type:"primary",onClick:o},{default:t(()=>[...b[13]||(b[13]=[v("确定",-1)])]),_:1})])]),default:t(()=>[l("div",ba,[e(d,{modelValue:P.value,"onUpdate:modelValue":b[2]||(b[2]=F=>P.value=F)},{default:t(()=>[l("div",$a,[(p(!0),V(Z,null,ee(s.materials,F=>(p(),V("div",{key:F.id,class:"material-item"},[e(z,{label:F.id,class:"material-checkbox"},{default:t(()=>[l("div",wa,[l("div",ka,U(F.filename),1),l("div",Va,[l("span",Ca,U(F.filesize)+"MB",1),l("span",Aa,U(F.upload_time),1)])])]),_:2},1032,["label"])]))),128))])]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"])])}}},Pa=Y(xa,[["__scopeId","data-v-a4989d91"]]),Sa={class:"platform-section"},Ma={key:0,class:"platform-tips"},Ua={__name:"PlatformSelection",props:{modelValue:{type:Number,required:!0}},emits:["update:modelValue","platform-change"],setup(s,{emit:i}){const n=s,r=i,m=sa(),g=X({get:()=>n.modelValue,set:A=>r("update:modelValue",A)}),u=X(()=>pe(n.modelValue)),h=A=>{r("platform-change",A)};return(A,P)=>{const C=c("el-radio"),L=c("el-radio-group"),D=c("el-alert");return p(),V("div",Sa,[P[1]||(P[1]=l("h3",null,"平台",-1)),e(L,{modelValue:g.value,"onUpdate:modelValue":P[0]||(P[0]=_=>g.value=_),onChange:h,class:"platform-radios"},{default:t(()=>[(p(!0),V(Z,null,ee(E(m),_=>(p(),Q(C,{key:_.key,label:_.key,class:"platform-radio"},{default:t(()=>[v(U(_.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"]),u.value?(p(),V("div",Ma,[e(D,{title:`${u.value.name}平台限制：标题最多${u.value.titleLimit}字，话题最多${u.value.topicLimit}个`,type:"info",closable:!1,"show-icon":"",class:"platform-alert"},null,8,["title"])])):J("",!0)])}}},La=Y(Ua,[["__scopeId","data-v-4ae792d5"]]),Ia={class:"account-section"},Ea={class:"account-display"},za={class:"selected-accounts"},Da={class:"account-dialog-content"},Fa={class:"account-list"},Oa={class:"account-info"},Ra={class:"account-name"},Ba={class:"dialog-footer"},Na={__name:"AccountSelection",props:{modelValue:{type:Array,default:()=>[]},platformKey:{type:Number,required:!0}},emits:["update:modelValue"],setup(s,{emit:i}){const n=s,r=i,m=ke(),g=X({get:()=>n.modelValue,set:_=>r("update:modelValue",_)}),u=O(!1),h=O([]),A=X(()=>{const o={3:"抖音",2:"视频号",1:"小红书",4:"快手"}[n.platformKey];return o?m.accounts.filter(R=>R.platform===o):[]}),P=()=>{h.value=[...g.value],u.value=!0},C=()=>{g.value=[...h.value],u.value=!1,w.success("账号选择完成")},L=_=>{g.value.splice(_,1)},D=_=>{const o=m.accounts.find(R=>R.id===_);return o?o.name:_};return(_,o)=>{const R=c("el-tag"),T=c("el-button"),b=c("el-checkbox"),N=c("el-checkbox-group"),S=c("el-dialog");return p(),V("div",Ia,[o[6]||(o[6]=l("h3",null,"账号",-1)),l("div",Ea,[l("div",za,[(p(!0),V(Z,null,ee(g.value,(M,G)=>(p(),Q(R,{key:G,closable:"",onClose:W=>L(G),class:"account-tag"},{default:t(()=>[v(U(D(M)),1)]),_:2},1032,["onClose"]))),128))]),e(T,{type:"primary",plain:"",onClick:P,class:"select-account-btn"},{default:t(()=>[...o[3]||(o[3]=[v(" 选择账号 ",-1)])]),_:1})]),e(S,{modelValue:u.value,"onUpdate:modelValue":o[2]||(o[2]=M=>u.value=M),title:"选择账号",width:"600px",class:"account-dialog"},{footer:t(()=>[l("div",Ba,[e(T,{onClick:o[1]||(o[1]=M=>u.value=!1)},{default:t(()=>[...o[4]||(o[4]=[v("取消",-1)])]),_:1}),e(T,{type:"primary",onClick:C},{default:t(()=>[...o[5]||(o[5]=[v("确定",-1)])]),_:1})])]),default:t(()=>[l("div",Da,[e(N,{modelValue:h.value,"onUpdate:modelValue":o[0]||(o[0]=M=>h.value=M)},{default:t(()=>[l("div",Fa,[(p(!0),V(Z,null,ee(A.value,M=>(p(),Q(b,{key:M.id,label:M.id,class:"account-item"},{default:t(()=>[l("div",Oa,[l("span",Ra,U(M.name),1)])]),_:2},1032,["label"]))),128))])]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"])])}}},qa=Y(Na,[["__scopeId","data-v-7cdefdfd"]]),Ka={class:"title-section"},ja={key:0,class:"error-message"},Ha={__name:"TitleInput",props:{modelValue:{type:String,default:""},platformKey:{type:Number,required:!0},validateOnInput:{type:Boolean,default:!0}},emits:["update:modelValue","validation-change"],setup(s,{expose:i,emit:n}){const r=s,m=n,g=X(()=>pe(r.platformKey)),u=X({get:()=>r.modelValue,set:D=>m("update:modelValue",D)}),h=X(()=>g.value.titlePlaceholder),A=X(()=>g.value.titleLimit),P=O(""),C=D=>{if(r.validateOnInput){const _=be(D,r.platformKey);P.value=_.valid?"":_.message,m("validation-change",_)}};return i({validate:()=>{const D=be(r.modelValue,r.platformKey);return P.value=D.valid?"":D.message,m("validation-change",D),D}}),(D,_)=>{const o=c("el-input"),R=c("el-alert");return p(),V("div",Ka,[_[1]||(_[1]=l("h3",null,"标题",-1)),e(o,{modelValue:u.value,"onUpdate:modelValue":_[0]||(_[0]=T=>u.value=T),type:"textarea",rows:3,placeholder:h.value,maxlength:A.value,"show-word-limit":"",class:"title-input",onInput:C},null,8,["modelValue","placeholder","maxlength"]),P.value?(p(),V("div",ja,[e(R,{title:P.value,type:"error",closable:!1,"show-icon":"",class:"error-alert"},null,8,["title"])])):J("",!0)])}}},Wa=Y(Ha,[["__scopeId","data-v-f75530ea"]]),Xa={class:"topic-section"},Ga={class:"topic-display"},Ja={class:"selected-topics"},Qa={key:0,class:"topic-tips"},Ya={key:1,class:"error-message"},Za={class:"topic-dialog-content"},es={class:"custom-topic-input"},ts={class:"recommended-topics"},ls={class:"topic-grid"},as={class:"dialog-footer"},ss={__name:"TopicInput",props:{modelValue:{type:Array,default:()=>[]},platformKey:{type:Number,required:!0},validateOnInput:{type:Boolean,default:!0}},emits:["update:modelValue","validation-change"],setup(s,{expose:i,emit:n}){const r=s,m=n,g=X(()=>pe(r.platformKey)),u=X({get:()=>r.modelValue,set:S=>m("update:modelValue",S)}),h=X(()=>u.value.length>=g.value.topicLimit),A=O(""),P=O(!1),C=O(""),L=["游戏","知识","自动化","系统平台","自媒体工具","跨境电商","科技","教程","云手机平台","云电脑平台","脚本","开源","健康","时尚","美妆","摄影","宠物","汽车"],D=()=>{if(h.value){w.warning(`最多只能添加${g.value.topicLimit}个话题`);return}P.value=!0},_=()=>{if(!C.value.trim()){w.warning("请输入话题内容");return}const S=oa(C.value.trim());if(!S.valid){w.error(S.message);return}if(h.value){w.warning(`最多只能添加${g.value.topicLimit}个话题`);return}u.value.includes(C.value.trim())?w.warning("话题已存在"):(u.value.push(C.value.trim()),C.value="",w.success("话题添加成功"),b())},o=S=>{if(h.value&&!u.value.includes(S)){w.warning(`最多只能添加${g.value.topicLimit}个话题`);return}const M=u.value.indexOf(S);M>-1?u.value.splice(M,1):u.value.push(S),b()},R=S=>{u.value.splice(S,1),b()},T=()=>{P.value=!1,C.value="",w.success("添加话题完成")},b=()=>{if(r.validateOnInput){const S=$e(u.value,r.platformKey);A.value=S.valid?"":S.message,m("validation-change",S)}};return i({validate:()=>{const S=$e(r.modelValue,r.platformKey);return A.value=S.valid?"":S.message,m("validation-change",S),S}}),(S,M)=>{const G=c("el-tag"),W=c("el-button"),z=c("el-alert"),d=c("el-input"),F=c("el-dialog");return p(),V("div",Xa,[M[9]||(M[9]=l("h3",null,"话题",-1)),l("div",Ga,[l("div",Ja,[(p(!0),V(Z,null,ee(u.value,(H,te)=>(p(),Q(G,{key:te,closable:"",onClose:j=>R(te),class:"topic-tag"},{default:t(()=>[v(" #"+U(H),1)]),_:2},1032,["onClose"]))),128))]),e(W,{type:"primary",plain:"",onClick:D,class:"select-topic-btn",disabled:h.value},{default:t(()=>[...M[3]||(M[3]=[v(" 添加话题 ",-1)])]),_:1},8,["disabled"])]),g.value?(p(),V("div",Qa,[e(z,{title:`已添加 ${u.value.length}/${g.value.topicLimit} 个话题`,type:h.value?"warning":"info",closable:!1,"show-icon":"",class:"topic-alert"},null,8,["title","type"])])):J("",!0),A.value?(p(),V("div",Ya,[e(z,{title:A.value,type:"error",closable:!1,"show-icon":"",class:"error-alert"},null,8,["title"])])):J("",!0),e(F,{modelValue:P.value,"onUpdate:modelValue":M[2]||(M[2]=H=>P.value=H),title:"添加话题",width:"600px",class:"topic-dialog"},{footer:t(()=>[l("div",as,[e(W,{onClick:M[1]||(M[1]=H=>P.value=!1)},{default:t(()=>[...M[7]||(M[7]=[v("取消",-1)])]),_:1}),e(W,{type:"primary",onClick:T},{default:t(()=>[...M[8]||(M[8]=[v("确定",-1)])]),_:1})])]),default:t(()=>[l("div",Za,[l("div",es,[e(d,{modelValue:C.value,"onUpdate:modelValue":M[0]||(M[0]=H=>C.value=H),placeholder:"输入自定义话题",class:"custom-input",onKeyup:Oe(_,["enter"])},{prepend:t(()=>[...M[4]||(M[4]=[v("#",-1)])]),_:1},8,["modelValue"]),e(W,{type:"primary",onClick:_},{default:t(()=>[...M[5]||(M[5]=[v("添加",-1)])]),_:1})]),l("div",ts,[M[6]||(M[6]=l("h4",null,"推荐话题",-1)),l("div",ls,[(p(),V(Z,null,ee(L,H=>e(W,{key:H,type:u.value.includes(H)?"primary":"default",onClick:te=>o(H),class:"topic-btn",disabled:u.value.includes(H)&&h.value},{default:t(()=>[v(U(H),1)]),_:2},1032,["type","onClick","disabled"])),64))])])])]),_:1},8,["modelValue"])])}}},os=Y(ss,[["__scopeId","data-v-b3973a1b"]]),ns={class:"schedule-section"},is={class:"schedule-controls"},us={key:0,class:"schedule-settings"},ds={class:"schedule-item"},rs={class:"schedule-item"},cs={class:"time-selectors"},ps={class:"schedule-item"},ms={__name:"ScheduleSettings",props:{scheduleEnabled:{type:Boolean,default:!1},videosPerDay:{type:Number,default:1},dailyTimes:{type:Array,default:()=>["10:00"]},startDays:{type:Number,default:0}},emits:["update:scheduleEnabled","update:videosPerDay","update:dailyTimes","update:startDays"],setup(s,{emit:i}){const n=s,r=i,m=X({get:()=>n.scheduleEnabled,set:C=>r("update:scheduleEnabled",C)}),g=X({get:()=>n.videosPerDay,set:C=>r("update:videosPerDay",C)}),u=X({get:()=>n.dailyTimes,set:C=>r("update:dailyTimes",C)}),h=X({get:()=>n.startDays,set:C=>r("update:startDays",C)}),A=C=>{C||(r("update:videosPerDay",1),r("update:dailyTimes",["10:00"]),r("update:startDays",0))},P=()=>{if(u.value.length<g.value){const C=[...u.value,"10:00"];r("update:dailyTimes",C)}};return(C,L)=>{const D=c("el-switch"),_=c("el-option"),o=c("el-select"),R=c("el-time-select"),T=c("el-button");return p(),V("div",ns,[L[7]||(L[7]=l("h3",null,"定时发布",-1)),l("div",is,[e(D,{modelValue:m.value,"onUpdate:modelValue":L[0]||(L[0]=b=>m.value=b),"active-text":"定时发布","inactive-text":"立即发布",onChange:A},null,8,["modelValue"]),m.value?(p(),V("div",us,[l("div",ds,[L[3]||(L[3]=l("span",{class:"label"},"每天发布视频数：",-1)),e(o,{modelValue:g.value,"onUpdate:modelValue":L[1]||(L[1]=b=>g.value=b),placeholder:"选择发布数量"},{default:t(()=>[(p(),V(Z,null,ee(55,b=>e(_,{key:b,label:b,value:b},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),l("div",rs,[L[5]||(L[5]=l("span",{class:"label"},"每天发布时间：",-1)),l("div",cs,[(p(!0),V(Z,null,ee(u.value,(b,N)=>(p(),Q(R,{key:N,modelValue:u.value[N],"onUpdate:modelValue":S=>u.value[N]=S,start:"00:00",step:"00:30",end:"23:30",placeholder:"选择时间"},null,8,["modelValue","onUpdate:modelValue"]))),128)),u.value.length<g.value?(p(),Q(T,{key:0,type:"primary",size:"small",onClick:P},{default:t(()=>[...L[4]||(L[4]=[v(" 添加时间 ",-1)])]),_:1})):J("",!0)])]),l("div",ps,[L[6]||(L[6]=l("span",{class:"label"},"开始天数：",-1)),e(o,{modelValue:h.value,"onUpdate:modelValue":L[2]||(L[2]=b=>h.value=b),placeholder:"选择开始天数"},{default:t(()=>[e(_,{label:"明天",value:0}),e(_,{label:"后天",value:1})]),_:1},8,["modelValue"])])])):J("",!0)])])}}},fs=Y(ms,[["__scopeId","data-v-7e1e15aa"]]),vs={class:"publish-center"},_s={class:"publish-content"},gs={class:"tab-content-wrapper"},ys={key:0,class:"publish-status"},hs={class:"action-buttons"},bs={class:"publish-progress"},$s={key:0,class:"current-publishing"},ws={key:1,class:"publish-results"},ks={class:"label"},Vs={class:"message"},Cs={class:"dialog-footer"},As={__name:"PublishCenter",setup(s){const i="http://localhost:5409",n=X(()=>({Authorization:`Bearer ${localStorage.getItem("token")||""}`})),r=O("tab1");let m=1;const g=ge(),u=ke(),h=X(()=>g.materials),A={1:"小红书",2:"视频号",3:"抖音",4:"快手"},P=O(!1);we(async()=>{try{const a=await ve.getValidAccounts({validate:0});a&&a.code===200&&Array.isArray(a.data)&&u.setAccounts(a.data)}catch(a){console.warn("初始化获取账号失败",a)}});const C=de([{name:"tab1",label:A[1],fileList:[],displayFileList:[],selectedAccounts:[],selectedPlatform:1,title:"",selectedTopics:[],scheduleEnabled:!1,videosPerDay:1,dailyTimes:["10:00"],startDays:0,publishStatus:null,validationErrors:{}}]),L=O(!1),D=O(null),_=O(0),o=O([]),R=O(!1),T=()=>{m++;const a={name:`tab${m}`,label:A[1],fileList:[],displayFileList:[],selectedAccounts:[],selectedPlatform:1,title:"",selectedTopics:[],scheduleEnabled:!1,videosPerDay:1,dailyTimes:["10:00"],startDays:0,publishStatus:null,validationErrors:{}};C.push(a),r.value=a.name},b=a=>{const y=C.findIndex(k=>k.name===a);y>-1&&(C.splice(y,1),r.value===a&&C.length>0&&(r.value=C[0].name))},N=a=>{const y=C.find(k=>k.name===r.value);y&&(y.selectedAccounts=[],z(y))},S=(a,y,k)=>{y.valid?delete k.validationErrors[a]:k.validationErrors[a]=y.message},M=(a,y,k)=>{if(a.code===200){const q=a.data.path||a.data,B=q.split("/").pop(),$={name:y.name,url:se.getMaterialPreviewUrl(B),path:q,size:y.size,type:y.type};k.fileList.push($),k.displayFileList=[...k.fileList.map(I=>({name:I.name,url:I.url}))],w.success("文件上传成功"),console.log("上传成功:",$)}else w.error(a.msg||"上传失败")},G=(a,y)=>{a.forEach(k=>{const q=h.value.find(B=>B.id===k);if(q){const B={name:q.filename,url:se.getMaterialPreviewUrl(q.file_path.split("/").pop()),path:q.file_path,size:q.filesize*1024*1024,type:"video/mp4"};y.fileList.some(I=>I.path===B.path)||y.fileList.push(B)}}),y.displayFileList=[...y.fileList.map(k=>({name:k.name,url:k.url}))]},W=(a,y)=>{a.fileList.splice(y,1),a.displayFileList=[...a.fileList.map(k=>({name:k.name,url:k.url}))],w.success("文件删除成功")},z=a=>{const y=A[a.selectedPlatform],k=a.selectedAccounts||[];if(y&&k.length>0){const q=u.accounts.find($=>$.id===k[0]),B=(q==null?void 0:q.name)||"";a.label=B?`${y}_${B}`:`${y}`}else if(y)a.label=y;else{const q=C.findIndex(B=>B.name===a.name);a.label=`发布${q+1}`}};Re(C,()=>{C.forEach(z)},{deep:!0});const d=a=>{w.info("已取消发布")},F=async a=>new Promise((y,k)=>{const q=na(a);if(!q.valid){const $=Object.values(q.errors)[0];w.error($),k(new Error($));return}const B={type:a.selectedPlatform,title:a.title,tags:a.selectedTopics,fileList:a.fileList.map($=>$.path),accountList:a.selectedAccounts.map($=>{const I=u.accounts.find(x=>x.id===$);return I?I.filePath:$}),enableTimer:a.scheduleEnabled?1:0,videosPerDay:a.scheduleEnabled&&a.videosPerDay||1,dailyTimes:a.scheduleEnabled?a.dailyTimes||["10:00"]:["10:00"],startDays:a.scheduleEnabled&&a.startDays||0,category:0};fetch(`${i}/postVideo`,{method:"POST",headers:{"Content-Type":"application/json",...n.value},body:JSON.stringify(B)}).then($=>$.json()).then($=>{$.code===200?(a.publishStatus={message:"发布成功",type:"success"},a.fileList=[],a.displayFileList=[],a.title="",a.selectedTopics=[],a.selectedAccounts=[],a.scheduleEnabled=!1,a.validationErrors={},y()):(a.publishStatus={message:`发布失败：${$.msg||"发布失败"}`,type:"error"},k(new Error($.msg||"发布失败")))}).catch($=>{console.error("发布错误:",$),a.publishStatus={message:"发布失败，请检查网络连接",type:"error"},k($)})}),H=()=>{const a=[];return C.forEach(y=>{const k=[];(!y.fileList||y.fileList.length===0)&&k.push("未上传视频"),(!y.selectedAccounts||y.selectedAccounts.length===0)&&k.push("未选择账号"),k.length&&a.push({tab:y,message:`${y.label}: ${k.join("、")}`})}),a},te=async()=>{if(P.value)return;const a=H();if(a.length>0){r.value=a[0].tab.name,a[0].tab.publishStatus={message:a[0].message,type:"error"};try{await ce.alert(a.map(y=>y.message).join(`
`),"请完善发布项后再批量发布",{confirmButtonText:"好的"})}catch{}w.error("存在未准备完成的发布项：请为每个发布项上传视频并选择账号");return}P.value=!0,D.value=null,_.value=0,o.value=[],R.value=!1,L.value=!0;try{for(let B=0;B<C.length;B++){if(R.value){o.value.push({label:C[B].label,status:"cancelled",message:"已取消"});continue}const $=C[B];D.value=$,_.value=Math.floor(B/C.length*100);try{await F($),o.value.push({label:$.label,status:"success",message:"发布成功"})}catch(I){o.value.push({label:$.label,status:"error",message:I.message})}}_.value=100;const y=o.value.filter(B=>B.status==="success").length,k=o.value.filter(B=>B.status==="error").length,q=o.value.filter(B=>B.status==="cancelled").length;R.value?w.warning(`发布已取消：${y}个成功，${k}个失败，${q}个未执行`):k>0?w.error(`发布完成：${y}个成功，${k}个失败`):(w.success("所有Tab发布成功"),setTimeout(()=>{L.value=!1},1e3))}catch(y){console.error("批量发布出错:",y),w.error("批量发布出错，请重试")}finally{P.value=!1,R.value=!1}},j=()=>{R.value=!0,w.info("正在取消发布...")};return(a,y)=>{const k=c("el-alert"),q=c("el-button"),B=c("el-progress"),$=c("el-icon"),I=c("el-dialog");return p(),V("div",vs,[e(ma,{tabs:C,"active-tab":r.value,"batch-publishing":P.value,onTabChange:y[0]||(y[0]=x=>r.value=x),onRemoveTab:b,onAddTab:T,onBatchPublish:te},null,8,["tabs","active-tab","batch-publishing"]),l("div",_s,[l("div",gs,[(p(!0),V(Z,null,ee(C,x=>_e((p(),V("div",{key:x.name,class:"tab-content"},[x.publishStatus?(p(),V("div",ys,[e(k,{title:x.publishStatus.message,type:x.publishStatus.type,closable:!1,"show-icon":""},null,8,["title","type"])])):J("",!0),e(Pa,{"file-list":x.fileList,"upload-action":`${E(i)}/upload`,"auth-headers":n.value,materials:h.value,onRemoveFile:K=>W(x,K),onUploadSuccess:(K,oe)=>M(K,oe,x),onMaterialSelected:K=>G(K,x)},null,8,["file-list","upload-action","auth-headers","materials","onRemoveFile","onUploadSuccess","onMaterialSelected"]),e(La,{modelValue:x.selectedPlatform,"onUpdate:modelValue":K=>x.selectedPlatform=K,onPlatformChange:N},null,8,["modelValue","onUpdate:modelValue"]),e(qa,{modelValue:x.selectedAccounts,"onUpdate:modelValue":K=>x.selectedAccounts=K,"platform-key":x.selectedPlatform},null,8,["modelValue","onUpdate:modelValue","platform-key"]),e(Wa,{modelValue:x.title,"onUpdate:modelValue":K=>x.title=K,"platform-key":x.selectedPlatform,onValidationChange:K=>S("title",K,x)},null,8,["modelValue","onUpdate:modelValue","platform-key","onValidationChange"]),e(os,{modelValue:x.selectedTopics,"onUpdate:modelValue":K=>x.selectedTopics=K,"platform-key":x.selectedPlatform,onValidationChange:K=>S("topics",K,x)},null,8,["modelValue","onUpdate:modelValue","platform-key","onValidationChange"]),e(fs,{"schedule-enabled":x.scheduleEnabled,"onUpdate:scheduleEnabled":K=>x.scheduleEnabled=K,"videos-per-day":x.videosPerDay,"onUpdate:videosPerDay":K=>x.videosPerDay=K,"daily-times":x.dailyTimes,"onUpdate:dailyTimes":K=>x.dailyTimes=K,"start-days":x.startDays,"onUpdate:startDays":K=>x.startDays=K},null,8,["schedule-enabled","onUpdate:scheduleEnabled","videos-per-day","onUpdate:videosPerDay","daily-times","onUpdate:dailyTimes","start-days","onUpdate:startDays"]),l("div",hs,[e(q,{size:"small",onClick:K=>d()},{default:t(()=>[...y[3]||(y[3]=[v("取消",-1)])]),_:1},8,["onClick"]),e(q,{size:"small",type:"primary",onClick:K=>F(x)},{default:t(()=>[...y[4]||(y[4]=[v("发布",-1)])]),_:1},8,["onClick"])])])),[[ye,r.value===x.name]])),128))])]),e(I,{modelValue:L.value,"onUpdate:modelValue":y[2]||(y[2]=x=>L.value=x),title:"批量发布进度",width:"500px","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},{footer:t(()=>[l("div",Cs,[e(q,{onClick:j,disabled:_.value===100},{default:t(()=>[...y[5]||(y[5]=[v(" 取消发布 ",-1)])]),_:1},8,["disabled"]),_.value===100?(p(),Q(q,{key:0,type:"primary",onClick:y[1]||(y[1]=x=>L.value=!1)},{default:t(()=>[...y[6]||(y[6]=[v(" 关闭 ",-1)])]),_:1})):J("",!0)])]),default:t(()=>[l("div",bs,[e(B,{percentage:_.value,status:_.value===100?"success":""},null,8,["percentage","status"]),D.value?(p(),V("div",$s," 正在发布："+U(D.value.label),1)):J("",!0),o.value.length>0?(p(),V("div",ws,[(p(!0),V(Z,null,ee(o.value,(x,K)=>(p(),V("div",{key:K,class:ae(["result-item",x.status])},[x.status==="success"?(p(),Q($,{key:0},{default:t(()=>[e(E(st))]),_:1})):x.status==="error"?(p(),Q($,{key:1},{default:t(()=>[e(E(xe))]),_:1})):(p(),Q($,{key:2},{default:t(()=>[e(E(ot))]),_:1})),l("span",ks,U(x.label),1),l("span",Vs,U(x.message),1)],2))),128))])):J("",!0)])]),_:1},8,["modelValue"])])}}},Ts=Y(As,[["__scopeId","data-v-0af57281"]]),xs={class:"about"},Ps={__name:"About",setup(s){return(i,n)=>(p(),V("div",xs,[...n[0]||(n[0]=[l("h1",null,"关于我们",-1),l("p",null,"这是关于页面",-1)])]))}},Ss=Y(Ps,[["__scopeId","data-v-cd67ee8e"]]),Ms=[{path:"/",name:"Dashboard",component:Yt},{path:"/account-management",name:"AccountManagement",component:Ol},{path:"/material-management",name:"MaterialManagement",component:aa},{path:"/publish-center",name:"PublishCenter",component:Ts},{path:"/about",name:"About",component:Ss}],Us=Be({history:Ne(),routes:Ms}),Ls=qe(),me=Ke(gt);for(const[s,i]of Object.entries(nt))me.component(s,i);me.use(Us);me.use(Ls);me.use(it);me.mount("#app");
