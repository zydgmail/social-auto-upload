import{b as X,ax as Ie,r as F,c as V,o as r,R as e,J as t,al as m,a as l,K as ve,S as ge,u as E,p as de,ay as Ee,P as M,O as v,I as Q,L as J,az as Ce,t as we,X as ze,ar as De,E as se,Q as ee,a6 as te,W as Fe,a4 as Re,w as Oe,aA as Be,aB as qe,aC as Ne,au as Ke}from"./vue-CbZdtcPO.js";import{h as je,u as Ae,p as He,a as re,m as We,d as Te,f as Xe,b as Ge,l as Je,c as Qe,e as Ye,t as Ze,E as k,g as ce,r as ne,i as et,j as tt,k as lt,n as xe,o as at,q as st,s as ot,v as nt,w as it}from"./elementPlus-CSqc6bT9.js";import{a as ut}from"./utils-NIGUFBhG.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))p(f);new MutationObserver(f=>{for(const y of f)if(y.type==="childList")for(const u of y.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&p(u)}).observe(document,{childList:!0,subtree:!0});function n(f){const y={};return f.integrity&&(y.integrity=f.integrity),f.referrerPolicy&&(y.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?y.credentials="include":f.crossOrigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function p(f){if(f.ep)return;f.ep=!0;const y=n(f);fetch(f.href,y)}})();const dt="/vite.svg",Z=(s,i)=>{const n=s.__vccOpts||s;for(const[p,f]of i)n[p]=f;return n},rt={id:"app"},ct={class:"sidebar"},pt={class:"logo"},mt={src:dt,alt:"Logo",class:"logo-img"},ft={class:"header-content"},vt={class:"header-left"},_t={__name:"App",setup(s){const i=Ie(),n=X(()=>i.path),p=F(!1),f=()=>{p.value=!p.value};return(y,u)=>{const h=m("el-icon"),A=m("el-menu-item"),S=m("el-menu"),C=m("el-aside"),U=m("el-header"),D=m("router-view"),g=m("el-main"),o=m("el-container");return r(),V("div",rt,[e(o,null,{default:t(()=>[e(C,{width:p.value?"64px":"200px"},{default:t(()=>[l("div",ct,[l("div",pt,[ve(l("img",mt,null,512),[[ge,p.value]]),ve(l("h2",null,"自媒体自动化运营系统",512),[[ge,!p.value]])]),e(S,{router:!0,"default-active":n.value,collapse:p.value,class:"sidebar-menu","background-color":"#001529","text-color":"#fff","active-text-color":"#409EFF"},{default:t(()=>[e(A,{index:"/"},{default:t(()=>[e(h,null,{default:t(()=>[e(E(je))]),_:1}),u[0]||(u[0]=l("span",null,"首页",-1))]),_:1}),e(A,{index:"/account-management"},{default:t(()=>[e(h,null,{default:t(()=>[e(E(Ae))]),_:1}),u[1]||(u[1]=l("span",null,"账号管理",-1))]),_:1}),e(A,{index:"/material-management"},{default:t(()=>[e(h,null,{default:t(()=>[e(E(He))]),_:1}),u[2]||(u[2]=l("span",null,"素材管理",-1))]),_:1}),e(A,{index:"/publish-center"},{default:t(()=>[e(h,null,{default:t(()=>[e(E(re))]),_:1}),u[3]||(u[3]=l("span",null,"发布中心",-1))]),_:1}),e(A,{index:"/website"},{default:t(()=>[e(h,null,{default:t(()=>[e(E(We))]),_:1}),u[4]||(u[4]=l("span",null,"网站",-1))]),_:1}),e(A,{index:"/data"},{default:t(()=>[e(h,null,{default:t(()=>[e(E(Te))]),_:1}),u[5]||(u[5]=l("span",null,"数据",-1))]),_:1})]),_:1},8,["default-active","collapse"])])]),_:1},8,["width"]),e(o,null,{default:t(()=>[e(U,null,{default:t(()=>[l("div",ft,[l("div",vt,[e(h,{class:"toggle-sidebar",onClick:f},{default:t(()=>[e(E(Xe))]),_:1})]),u[6]||(u[6]=l("div",{class:"header-right"},null,-1))])]),_:1}),e(g,null,{default:t(()=>[e(D)]),_:1})]),_:1})]),_:1})])}}},gt=Z(_t,[["__scopeId","data-v-176fbaed"]]),yt={class:"dashboard"},ht={class:"dashboard-content"},bt={class:"stat-card-content"},$t={class:"stat-icon"},wt={class:"stat-info"},kt={class:"stat-value"},Vt={class:"stat-footer"},Ct={class:"stat-detail"},At={class:"stat-card-content"},Tt={class:"stat-icon platform-icon"},xt={class:"stat-info"},Pt={class:"stat-value"},St={class:"stat-footer"},Mt={class:"stat-detail"},Ut={class:"stat-card-content"},Lt={class:"stat-icon task-icon"},It={class:"stat-info"},Et={class:"stat-value"},zt={class:"stat-footer"},Dt={class:"stat-detail"},Ft={class:"stat-card-content"},Rt={class:"stat-icon content-icon"},Ot={class:"stat-info"},Bt={class:"stat-value"},qt={class:"stat-footer"},Nt={class:"stat-detail"},Kt={class:"quick-actions"},jt={class:"action-icon"},Ht={class:"action-icon"},Wt={class:"action-icon"},Xt={class:"action-icon"},Gt={class:"recent-tasks"},Jt={class:"section-header"},Qt={__name:"Dashboard",setup(s){const i=Ee(),n=de({total:12,normal:10,abnormal:2}),p=de({total:4,kuaishou:3,douyin:4,channels:2,xiaohongshu:3}),f=de({total:24,completed:18,inProgress:5,failed:1}),y=de({total:36,published:30,draft:6}),u=F([{id:1,title:"快手视频自动发布",platform:"快手",account:"快手账号1",createTime:"2024-05-01 10:30:00",status:"已完成"},{id:2,title:"抖音视频定时发布",platform:"抖音",account:"抖音账号1",createTime:"2024-05-01 11:15:00",status:"进行中"},{id:3,title:"视频号内容上传",platform:"视频号",account:"视频号账号1",createTime:"2024-05-01 14:20:00",status:"待执行"},{id:4,title:"小红书图文发布",platform:"小红书",account:"小红书账号1",createTime:"2024-05-01 16:45:00",status:"已失败"},{id:5,title:"快手短视频批量上传",platform:"快手",account:"快手账号2",createTime:"2024-05-02 09:10:00",status:"待执行"}]),h=g=>({快手:"success",抖音:"danger",视频号:"warning",小红书:"info"})[g]||"info",A=g=>({已完成:"success",进行中:"warning",待执行:"info",已失败:"danger"})[g]||"info",S=g=>{i.push(g)},C=g=>{k.info(`查看任务: ${g.title}`)},U=g=>{ce.confirm(`确定要执行任务 ${g.title} 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(()=>{const o=u.value.findIndex(O=>O.id===g.id);o!==-1&&(u.value[o].status="进行中"),k({type:"success",message:"任务已开始执行"})}).catch(()=>{})},D=g=>{ce.confirm(`确定要取消任务 ${g.title} 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const o=u.value.findIndex(O=>O.id===g.id);o!==-1&&(u.value[o].status="已取消"),k({type:"success",message:"任务已取消"})}).catch(()=>{})};return(g,o)=>{const O=m("el-icon"),L=m("el-card"),b=m("el-col"),q=m("el-tag"),x=m("el-tooltip"),P=m("el-row"),G=m("el-button"),W=m("el-table-column"),I=m("el-table");return r(),V("div",yt,[o[19]||(o[19]=l("div",{class:"page-header"},[l("h1",null,"自媒体自动化运营系统")],-1)),l("div",ht,[e(P,{gutter:20},{default:t(()=>[e(b,{span:6},{default:t(()=>[e(L,{class:"stat-card"},{default:t(()=>[l("div",bt,[l("div",$t,[e(O,null,{default:t(()=>[e(E(Ae))]),_:1})]),l("div",wt,[l("div",kt,M(n.total),1),o[1]||(o[1]=l("div",{class:"stat-label"},"账号总数",-1))])]),l("div",Vt,[l("div",Ct,[l("span",null,"正常: "+M(n.normal),1),l("span",null,"异常: "+M(n.abnormal),1)])])]),_:1})]),_:1}),e(b,{span:6},{default:t(()=>[e(L,{class:"stat-card"},{default:t(()=>[l("div",At,[l("div",Tt,[e(O,null,{default:t(()=>[e(E(Ge))]),_:1})]),l("div",xt,[l("div",Pt,M(p.total),1),o[2]||(o[2]=l("div",{class:"stat-label"},"平台总数",-1))])]),l("div",St,[l("div",Mt,[e(x,{content:"快手账号",placement:"top"},{default:t(()=>[e(q,{size:"small",type:"success"},{default:t(()=>[v(M(p.kuaishou),1)]),_:1})]),_:1}),e(x,{content:"抖音账号",placement:"top"},{default:t(()=>[e(q,{size:"small",type:"danger"},{default:t(()=>[v(M(p.douyin),1)]),_:1})]),_:1}),e(x,{content:"视频号账号",placement:"top"},{default:t(()=>[e(q,{size:"small",type:"warning"},{default:t(()=>[v(M(p.channels),1)]),_:1})]),_:1}),e(x,{content:"小红书账号",placement:"top"},{default:t(()=>[e(q,{size:"small",type:"info"},{default:t(()=>[v(M(p.xiaohongshu),1)]),_:1})]),_:1})])])]),_:1})]),_:1}),e(b,{span:6},{default:t(()=>[e(L,{class:"stat-card"},{default:t(()=>[l("div",Ut,[l("div",Lt,[e(O,null,{default:t(()=>[e(E(Je))]),_:1})]),l("div",It,[l("div",Et,M(f.total),1),o[3]||(o[3]=l("div",{class:"stat-label"},"任务总数",-1))])]),l("div",zt,[l("div",Dt,[l("span",null,"完成: "+M(f.completed),1),l("span",null,"进行中: "+M(f.inProgress),1),l("span",null,"失败: "+M(f.failed),1)])])]),_:1})]),_:1}),e(b,{span:6},{default:t(()=>[e(L,{class:"stat-card"},{default:t(()=>[l("div",Ft,[l("div",Rt,[e(O,null,{default:t(()=>[e(E(Qe))]),_:1})]),l("div",Ot,[l("div",Bt,M(y.total),1),o[4]||(o[4]=l("div",{class:"stat-label"},"内容总数",-1))])]),l("div",qt,[l("div",Nt,[l("span",null,"已发布: "+M(y.published),1),l("span",null,"草稿: "+M(y.draft),1)])])]),_:1})]),_:1})]),_:1}),l("div",Kt,[o[13]||(o[13]=l("h2",null,"快捷操作",-1)),e(P,{gutter:20},{default:t(()=>[e(b,{span:6},{default:t(()=>[e(L,{class:"action-card",onClick:o[0]||(o[0]=d=>S("/account-management"))},{default:t(()=>[l("div",jt,[e(O,null,{default:t(()=>[e(E(Ye))]),_:1})]),o[5]||(o[5]=l("div",{class:"action-title"},"账号管理",-1)),o[6]||(o[6]=l("div",{class:"action-desc"},"管理所有平台账号",-1))]),_:1})]),_:1}),e(b,{span:6},{default:t(()=>[e(L,{class:"action-card"},{default:t(()=>[l("div",Ht,[e(O,null,{default:t(()=>[e(E(re))]),_:1})]),o[7]||(o[7]=l("div",{class:"action-title"},"内容上传",-1)),o[8]||(o[8]=l("div",{class:"action-desc"},"上传视频和图文内容",-1))]),_:1})]),_:1}),e(b,{span:6},{default:t(()=>[e(L,{class:"action-card"},{default:t(()=>[l("div",Wt,[e(O,null,{default:t(()=>[e(E(Ze))]),_:1})]),o[9]||(o[9]=l("div",{class:"action-title"},"定时发布",-1)),o[10]||(o[10]=l("div",{class:"action-desc"},"设置内容发布时间",-1))]),_:1})]),_:1}),e(b,{span:6},{default:t(()=>[e(L,{class:"action-card"},{default:t(()=>[l("div",Xt,[e(O,null,{default:t(()=>[e(E(Te))]),_:1})]),o[11]||(o[11]=l("div",{class:"action-title"},"数据分析",-1)),o[12]||(o[12]=l("div",{class:"action-desc"},"查看内容数据分析",-1))]),_:1})]),_:1})]),_:1})]),l("div",Gt,[l("div",Jt,[o[15]||(o[15]=l("h2",null,"最近任务",-1)),e(G,{text:""},{default:t(()=>[...o[14]||(o[14]=[v("查看全部",-1)])]),_:1})]),e(I,{data:u.value,style:{width:"100%"}},{default:t(()=>[e(W,{prop:"title",label:"任务名称",width:"250"}),e(W,{prop:"platform",label:"平台",width:"120"},{default:t(d=>[e(q,{type:h(d.row.platform),effect:"plain"},{default:t(()=>[v(M(d.row.platform),1)]),_:2},1032,["type"])]),_:1}),e(W,{prop:"account",label:"账号",width:"150"}),e(W,{prop:"createTime",label:"创建时间",width:"180"}),e(W,{prop:"status",label:"状态",width:"120"},{default:t(d=>[e(q,{type:A(d.row.status),effect:"plain"},{default:t(()=>[v(M(d.row.status),1)]),_:2},1032,["type"])]),_:1}),e(W,{label:"操作"},{default:t(d=>[e(G,{size:"small",onClick:B=>C(d.row)},{default:t(()=>[...o[16]||(o[16]=[v("查看",-1)])]),_:1},8,["onClick"]),d.row.status==="待执行"?(r(),Q(G,{key:0,size:"small",type:"primary",onClick:B=>U(d.row)},{default:t(()=>[...o[17]||(o[17]=[v(" 执行 ",-1)])]),_:1},8,["onClick"])):J("",!0),d.row.status!=="已完成"&&d.row.status!=="已失败"?(r(),Q(G,{key:1,size:"small",type:"danger",onClick:B=>D(d.row)},{default:t(()=>[...o[18]||(o[18]=[v(" 取消 ",-1)])]),_:1},8,["onClick"])):J("",!0)]),_:1})]),_:1},8,["data"])])])])}}},Yt=Z(Qt,[["__scopeId","data-v-db5c2d61"]]),ie=ut.create({baseURL:"http://localhost:5409",headers:{"Content-Type":"application/json"}});ie.interceptors.request.use(s=>{const i=localStorage.getItem("token");return i&&(s.headers.Authorization=`Bearer ${i}`),s},s=>(console.error("请求错误:",s),Promise.reject(s)));ie.interceptors.response.use(s=>{const{data:i}=s;return i.code===200||i.success?i:(k.error(i.message||"请求失败"),Promise.reject(new Error(i.message||"请求失败")))},s=>{if(console.error("响应错误:",s),s.response){const{status:i}=s.response;switch(i){case 401:k.error("未授权，请重新登录");break;case 403:k.error("拒绝访问");break;case 404:k.error("请求地址不存在");break;case 500:k.error("服务器内部错误");break;default:k.error("网络错误")}}else k.error("网络连接失败");return Promise.reject(s)});const ue={get(s,i){return ie.get(s,{params:i})},post(s,i,n={}){return ie.post(s,i,n)},put(s,i,n={}){return ie.put(s,i,n)},delete(s,i){return ie.delete(s,{params:i})},upload(s,i){return ie.post(s,i,{headers:{"Content-Type":"multipart/form-data"}})}},ye={getValidAccounts(s){return ue.get("/getValidAccounts",s)},addAccount(s){return ue.post("/account",s)},updateAccount(s){return ue.post("/updateUserinfo",s)},deleteAccount(s){return ue.get(`/deleteAccount?id=${s}`)}},ke=Ce("account",()=>{const s=F([]),i={1:"小红书",2:"视频号",3:"抖音",4:"快手"};return{accounts:s,setAccounts:h=>{s.value=h.map(A=>({id:A[0],type:A[1],filePath:A[2],name:A[3],status:A[4]===1?"正常":"异常",platform:i[A[1]]||"未知",avatar:"/vite.svg"}))},addAccount:h=>{s.value.push(h)},updateAccount:(h,A)=>{const S=s.value.findIndex(C=>C.id===h);S!==-1&&(s.value[S]={...s.value[S],...A})},deleteAccount:h=>{s.value=s.value.filter(A=>A.id!==h)},getAccountsByPlatform:h=>s.value.filter(A=>A.platform===h)}}),_e=Ce("app",()=>{const s=F(!0),i=F(!0),n=F(!1),p=F([]);return{isFirstTimeAccountManagement:s,isFirstTimeMaterialManagement:i,isAccountRefreshing:n,materials:p,setAccountManagementVisited:()=>{s.value=!1},setMaterialManagementVisited:()=>{i.value=!1},resetVisitStatus:()=>{s.value=!0,i.value=!0},setMaterials:U=>{p.value=U},addMaterial:U=>{p.value.push(U)},removeMaterial:U=>{const D=p.value.findIndex(g=>g.id===U);D>-1&&p.value.splice(D,1)},setAccountRefreshing:U=>{n.value=U}}}),Zt={class:"account-management","element-loading-text":"正在验证账号..."},el={class:"account-tabs"},tl={class:"account-list-container"},ll={class:"account-search"},al={class:"action-buttons"},sl={class:"refresh-text"},ol={key:0,class:"account-list"},nl={key:1,class:"empty-data"},il={class:"account-list-container"},ul={class:"account-search"},dl={class:"action-buttons"},rl={class:"refresh-text"},cl={key:0,class:"account-list"},pl={key:1,class:"empty-data"},ml={class:"account-list-container"},fl={class:"account-search"},vl={class:"action-buttons"},_l={class:"refresh-text"},gl={key:0,class:"account-list"},yl={key:1,class:"empty-data"},hl={class:"account-list-container"},bl={class:"account-search"},$l={class:"action-buttons"},wl={class:"refresh-text"},kl={key:0,class:"account-list"},Vl={key:1,class:"empty-data"},Cl={class:"account-list-container"},Al={class:"account-search"},Tl={class:"action-buttons"},xl={class:"refresh-text"},Pl={key:0,class:"account-list"},Sl={key:1,class:"empty-data"},Ml={key:0,class:"qrcode-container"},Ul={key:0,class:"qrcode-wrapper"},Ll=["src"],Il={key:1,class:"loading-wrapper"},El={key:2,class:"success-wrapper"},zl={key:3,class:"error-wrapper"},Dl={class:"dialog-footer"},Fl={__name:"AccountManagement",setup(s){const i=ke(),n=_e(),p=F("all"),f=F(""),y=async(j=!1)=>{if(!n.isAccountRefreshing){n.setAccountRefreshing(!0);try{const a=await ye.getValidAccounts({validate:j?1:0});a.code===200&&a.data?(i.setAccounts(a.data),j&&k.success("账号验证完成"),n.isFirstTimeAccountManagement&&n.setAccountManagementVisited()):k.error("获取账号数据失败")}catch(a){console.error("获取账号数据失败:",a),k.error("获取账号数据失败")}finally{n.setAccountRefreshing(!1)}}};we(()=>{n.isFirstTimeAccountManagement&&y(!1)});const u=j=>({快手:"success",抖音:"danger",视频号:"warning",小红书:"info"})[j]||"info",h=X(()=>f.value?i.accounts.filter(j=>j.name.includes(f.value)):i.accounts),A=X(()=>h.value.filter(j=>j.platform==="快手")),S=X(()=>h.value.filter(j=>j.platform==="抖音")),C=X(()=>h.value.filter(j=>j.platform==="视频号")),U=X(()=>h.value.filter(j=>j.platform==="小红书")),D=()=>{},g=F(!1),o=F("add"),O=F(null),L=de({id:null,name:"",platform:"",status:"正常"}),b={platform:[{required:!0,message:"请选择平台",trigger:"change"}],name:[{required:!0,message:"请输入账号名称",trigger:"blur"}]},q=F(!1),x=F(""),P=F(""),G=()=>{o.value="add",Object.assign(L,{id:null,name:"",platform:"",status:"正常"}),q.value=!1,x.value="",P.value="",g.value=!0},W=j=>{ce.confirm(`确定要删除账号 ${j.name} 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const a=await ye.deleteAccount(j.id);a.code===200?(i.deleteAccount(j.id),k({type:"success",message:"删除成功"})):k.error(a.msg||"删除失败")}catch(a){console.error("删除账号失败:",a),k.error("删除账号失败")}}).catch(()=>{})};let I=null;const d=()=>{I&&(I.close(),I=null)},B=(j,a,_=null)=>{d(),q.value=!0,x.value="",P.value="";const N={小红书:"1",视频号:"2",抖音:"3",快手:"4"}[j]||"1",K="http://localhost:5409",$=new URLSearchParams({type:N,id:a});_&&($.append("update","1"),$.append("record_id",String(_)));const R=`${K}/login?${$.toString()}`;I=new EventSource(R),I.onmessage=T=>{const z=T.data;if(console.log("SSE消息:",z),!x.value&&z.length>100)try{z.startsWith("data:image")?x.value=z:x.value=`data:image/png;base64,${z}`,console.log("设置二维码数据，长度:",z.length)}catch(le){console.error("处理二维码数据出错:",le)}else(z==="200"||z==="500")&&(P.value=z,z==="200"?setTimeout(()=>{d(),setTimeout(()=>{g.value=!1,q.value=!1,k.success(_?"账号更新成功":"账号添加成功"),k({type:"info",message:"正在同步账号信息...",duration:0}),y().then(()=>{k.closeAll(),k.success("账号信息已更新")})},1e3)},1e3):(d(),setTimeout(()=>{q.value=!1,x.value="",P.value=""},2e3)))},I.onerror=T=>{console.error("SSE连接错误:",T),k.error("连接服务器失败，请稍后再试"),d(),q.value=!1}},H=()=>{O.value.validate(async j=>{if(j)o.value==="add"?B(L.platform,L.name,L.id):k.info("编辑功能已取消，请删除后重新添加");else return!1})},Y=j=>{o.value="add",Object.assign(L,{id:j.id,platform:j.platform,name:j.name,status:"正常"}),q.value=!1,x.value="",P.value="",g.value=!0};return ze(()=>{d()}),(j,a)=>{const _=m("el-input"),w=m("el-button"),N=m("el-icon"),K=m("el-avatar"),$=m("el-table-column"),R=m("el-tag"),T=m("el-table"),z=m("el-empty"),le=m("el-tab-pane"),Pe=m("el-tabs"),fe=m("el-option"),Se=m("el-select"),Ve=m("el-form-item"),Me=m("el-form"),Ue=m("el-dialog"),Le=De("loading");return ve((r(),V("div",Zt,[a[35]||(a[35]=l("div",{class:"page-header"},[l("h1",null,"账号管理")],-1)),l("div",el,[e(Pe,{modelValue:p.value,"onUpdate:modelValue":a[10]||(a[10]=c=>p.value=c),class:"account-tabs-nav"},{default:t(()=>[e(le,{label:"全部",name:"all"},{default:t(()=>[l("div",tl,[l("div",ll,[e(_,{modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=c=>f.value=c),placeholder:"输入名称或账号搜索","prefix-icon":"Search",clearable:"",onClear:D,onInput:D},null,8,["modelValue"]),l("div",al,[e(w,{type:"primary",onClick:G},{default:t(()=>[...a[15]||(a[15]=[v("添加账号",-1)])]),_:1}),e(w,{type:"info",onClick:a[1]||(a[1]=()=>y(!0))},{default:t(()=>[e(N,{class:se({"is-loading":E(n).isAccountRefreshing,"refresh-icon":!0})},{default:t(()=>[e(E(ne))]),_:1},8,["class"]),l("span",sl,M(E(n).isAccountRefreshing?"验证中...":"手动过期验证"),1)]),_:1})])]),h.value.length>0?(r(),V("div",ol,[e(T,{data:h.value,style:{width:"100%"}},{default:t(()=>[e($,{label:"头像",width:"80"},{default:t(c=>[e(K,{src:c.row.avatar,size:40},null,8,["src"])]),_:1}),e($,{prop:"name",label:"名称",width:"180"}),e($,{prop:"platform",label:"平台"},{default:t(c=>[e(R,{type:u(c.row.platform),effect:"plain"},{default:t(()=>[v(M(c.row.platform),1)]),_:2},1032,["type"])]),_:1}),e($,{prop:"status",label:"状态"},{default:t(c=>[e(R,{type:c.row.status==="正常"?"success":"danger",effect:"plain"},{default:t(()=>[v(M(c.row.status),1)]),_:2},1032,["type"])]),_:1}),e($,{label:"操作"},{default:t(c=>[c.row.status!=="正常"?(r(),Q(w,{key:0,size:"small",type:"warning",onClick:ae=>Y(c.row)},{default:t(()=>[...a[16]||(a[16]=[v("重新添加",-1)])]),_:1},8,["onClick"])):J("",!0),e(w,{size:"small",type:"danger",onClick:ae=>W(c.row)},{default:t(()=>[...a[17]||(a[17]=[v("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(r(),V("div",nl,[e(z,{description:"暂无账号数据"})]))])]),_:1}),e(le,{label:"快手",name:"kuaishou"},{default:t(()=>[l("div",il,[l("div",ul,[e(_,{modelValue:f.value,"onUpdate:modelValue":a[2]||(a[2]=c=>f.value=c),placeholder:"输入名称或账号搜索","prefix-icon":"Search",clearable:"",onClear:D,onInput:D},null,8,["modelValue"]),l("div",dl,[e(w,{type:"primary",onClick:G},{default:t(()=>[...a[18]||(a[18]=[v("添加账号",-1)])]),_:1}),e(w,{type:"info",onClick:a[3]||(a[3]=()=>y(!0))},{default:t(()=>[e(N,{class:se({"is-loading":E(n).isAccountRefreshing,"refresh-icon":!0})},{default:t(()=>[e(E(ne))]),_:1},8,["class"]),l("span",rl,M(E(n).isAccountRefreshing?"验证中...":"手动过期验证"),1)]),_:1})])]),A.value.length>0?(r(),V("div",cl,[e(T,{data:A.value,style:{width:"100%"}},{default:t(()=>[e($,{label:"头像",width:"80"},{default:t(c=>[e(K,{src:c.row.avatar,size:40},null,8,["src"])]),_:1}),e($,{prop:"name",label:"名称",width:"180"}),e($,{prop:"platform",label:"平台"},{default:t(c=>[e(R,{type:u(c.row.platform),effect:"plain"},{default:t(()=>[v(M(c.row.platform),1)]),_:2},1032,["type"])]),_:1}),e($,{prop:"status",label:"状态"},{default:t(c=>[e(R,{type:c.row.status==="正常"?"success":"danger",effect:"plain"},{default:t(()=>[v(M(c.row.status),1)]),_:2},1032,["type"])]),_:1}),e($,{label:"操作"},{default:t(c=>[c.row.status!=="正常"?(r(),Q(w,{key:0,size:"small",type:"warning",onClick:ae=>Y(c.row)},{default:t(()=>[...a[19]||(a[19]=[v("重新添加",-1)])]),_:1},8,["onClick"])):J("",!0),e(w,{size:"small",type:"danger",onClick:ae=>W(c.row)},{default:t(()=>[...a[20]||(a[20]=[v("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(r(),V("div",pl,[e(z,{description:"暂无快手账号数据"})]))])]),_:1}),e(le,{label:"抖音",name:"douyin"},{default:t(()=>[l("div",ml,[l("div",fl,[e(_,{modelValue:f.value,"onUpdate:modelValue":a[4]||(a[4]=c=>f.value=c),placeholder:"输入名称或账号搜索","prefix-icon":"Search",clearable:"",onClear:D,onInput:D},null,8,["modelValue"]),l("div",vl,[e(w,{type:"primary",onClick:G},{default:t(()=>[...a[21]||(a[21]=[v("添加账号",-1)])]),_:1}),e(w,{type:"info",onClick:a[5]||(a[5]=()=>y(!0))},{default:t(()=>[e(N,{class:se({"is-loading":E(n).isAccountRefreshing,"refresh-icon":!0})},{default:t(()=>[e(E(ne))]),_:1},8,["class"]),l("span",_l,M(E(n).isAccountRefreshing?"验证中...":"手动过期验证"),1)]),_:1})])]),S.value.length>0?(r(),V("div",gl,[e(T,{data:S.value,style:{width:"100%"}},{default:t(()=>[e($,{label:"头像",width:"80"},{default:t(c=>[e(K,{src:c.row.avatar,size:40},null,8,["src"])]),_:1}),e($,{prop:"name",label:"名称",width:"180"}),e($,{prop:"platform",label:"平台"},{default:t(c=>[e(R,{type:u(c.row.platform),effect:"plain"},{default:t(()=>[v(M(c.row.platform),1)]),_:2},1032,["type"])]),_:1}),e($,{prop:"status",label:"状态"},{default:t(c=>[e(R,{type:c.row.status==="正常"?"success":"danger",effect:"plain"},{default:t(()=>[v(M(c.row.status),1)]),_:2},1032,["type"])]),_:1}),e($,{label:"操作"},{default:t(c=>[c.row.status!=="正常"?(r(),Q(w,{key:0,size:"small",type:"warning",onClick:ae=>Y(c.row)},{default:t(()=>[...a[22]||(a[22]=[v("重新添加",-1)])]),_:1},8,["onClick"])):J("",!0),e(w,{size:"small",type:"danger",onClick:ae=>W(c.row)},{default:t(()=>[...a[23]||(a[23]=[v("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(r(),V("div",yl,[e(z,{description:"暂无抖音账号数据"})]))])]),_:1}),e(le,{label:"视频号",name:"channels"},{default:t(()=>[l("div",hl,[l("div",bl,[e(_,{modelValue:f.value,"onUpdate:modelValue":a[6]||(a[6]=c=>f.value=c),placeholder:"输入名称或账号搜索","prefix-icon":"Search",clearable:"",onClear:D,onInput:D},null,8,["modelValue"]),l("div",$l,[e(w,{type:"primary",onClick:G},{default:t(()=>[...a[24]||(a[24]=[v("添加账号",-1)])]),_:1}),e(w,{type:"info",onClick:a[7]||(a[7]=()=>y(!0))},{default:t(()=>[e(N,{class:se({"is-loading":E(n).isAccountRefreshing,"refresh-icon":!0})},{default:t(()=>[e(E(ne))]),_:1},8,["class"]),l("span",wl,M(E(n).isAccountRefreshing?"验证中...":"手动过期验证"),1)]),_:1})])]),C.value.length>0?(r(),V("div",kl,[e(T,{data:C.value,style:{width:"100%"}},{default:t(()=>[e($,{label:"头像",width:"80"},{default:t(c=>[e(K,{src:c.row.avatar,size:40},null,8,["src"])]),_:1}),e($,{prop:"name",label:"名称",width:"180"}),e($,{prop:"platform",label:"平台"},{default:t(c=>[e(R,{type:u(c.row.platform),effect:"plain"},{default:t(()=>[v(M(c.row.platform),1)]),_:2},1032,["type"])]),_:1}),e($,{prop:"status",label:"状态"},{default:t(c=>[e(R,{type:c.row.status==="正常"?"success":"danger",effect:"plain"},{default:t(()=>[v(M(c.row.status),1)]),_:2},1032,["type"])]),_:1}),e($,{label:"操作"},{default:t(c=>[c.row.status!=="正常"?(r(),Q(w,{key:0,size:"small",type:"warning",onClick:ae=>Y(c.row)},{default:t(()=>[...a[25]||(a[25]=[v("重新添加",-1)])]),_:1},8,["onClick"])):J("",!0),e(w,{size:"small",type:"danger",onClick:ae=>W(c.row)},{default:t(()=>[...a[26]||(a[26]=[v("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(r(),V("div",Vl,[e(z,{description:"暂无视频号账号数据"})]))])]),_:1}),e(le,{label:"小红书",name:"xiaohongshu"},{default:t(()=>[l("div",Cl,[l("div",Al,[e(_,{modelValue:f.value,"onUpdate:modelValue":a[8]||(a[8]=c=>f.value=c),placeholder:"输入名称或账号搜索","prefix-icon":"Search",clearable:"",onClear:D,onInput:D},null,8,["modelValue"]),l("div",Tl,[e(w,{type:"primary",onClick:G},{default:t(()=>[...a[27]||(a[27]=[v("添加账号",-1)])]),_:1}),e(w,{type:"info",onClick:a[9]||(a[9]=()=>y(!0))},{default:t(()=>[e(N,{class:se({"is-loading":E(n).isAccountRefreshing,"refresh-icon":!0})},{default:t(()=>[e(E(ne))]),_:1},8,["class"]),l("span",xl,M(E(n).isAccountRefreshing?"验证中...":"手动过期验证"),1)]),_:1})])]),U.value.length>0?(r(),V("div",Pl,[e(T,{data:U.value,style:{width:"100%"}},{default:t(()=>[e($,{label:"头像",width:"80"},{default:t(c=>[e(K,{src:c.row.avatar,size:40},null,8,["src"])]),_:1}),e($,{prop:"name",label:"名称",width:"180"}),e($,{prop:"platform",label:"平台"},{default:t(c=>[e(R,{type:u(c.row.platform),effect:"plain"},{default:t(()=>[v(M(c.row.platform),1)]),_:2},1032,["type"])]),_:1}),e($,{prop:"status",label:"状态"},{default:t(c=>[e(R,{type:c.row.status==="正常"?"success":"danger",effect:"plain"},{default:t(()=>[v(M(c.row.status),1)]),_:2},1032,["type"])]),_:1}),e($,{label:"操作"},{default:t(c=>[c.row.status!=="正常"?(r(),Q(w,{key:0,size:"small",type:"warning",onClick:ae=>Y(c.row)},{default:t(()=>[...a[28]||(a[28]=[v("重新添加",-1)])]),_:1},8,["onClick"])):J("",!0),e(w,{size:"small",type:"danger",onClick:ae=>W(c.row)},{default:t(()=>[...a[29]||(a[29]=[v("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(r(),V("div",Sl,[e(z,{description:"暂无小红书账号数据"})]))])]),_:1})]),_:1},8,["modelValue"])]),e(Ue,{modelValue:g.value,"onUpdate:modelValue":a[14]||(a[14]=c=>g.value=c),title:o.value==="add"?"添加账号":"编辑账号",width:"500px","close-on-click-modal":!1,"close-on-press-escape":!q.value,"show-close":!q.value},{footer:t(()=>[l("span",Dl,[e(w,{onClick:a[13]||(a[13]=c=>g.value=!1)},{default:t(()=>[...a[34]||(a[34]=[v("取消",-1)])]),_:1}),e(w,{type:"primary",onClick:H,loading:q.value,disabled:q.value},{default:t(()=>[v(M(q.value?"请求中":"确认"),1)]),_:1},8,["loading","disabled"])])]),default:t(()=>[e(Me,{model:L,"label-width":"80px",rules:b,ref_key:"accountFormRef",ref:O},{default:t(()=>[e(Ve,{label:"平台",prop:"platform"},{default:t(()=>[e(Se,{modelValue:L.platform,"onUpdate:modelValue":a[11]||(a[11]=c=>L.platform=c),placeholder:"请选择平台",style:{width:"100%"},disabled:o.value==="edit"||q.value},{default:t(()=>[e(fe,{label:"快手",value:"快手"}),e(fe,{label:"抖音",value:"抖音"}),e(fe,{label:"视频号",value:"视频号"}),e(fe,{label:"小红书",value:"小红书"})]),_:1},8,["modelValue","disabled"])]),_:1}),e(Ve,{label:"名称",prop:"name"},{default:t(()=>[e(_,{modelValue:L.name,"onUpdate:modelValue":a[12]||(a[12]=c=>L.name=c),placeholder:"请输入账号名称",disabled:q.value},null,8,["modelValue","disabled"])]),_:1}),q.value?(r(),V("div",Ml,[x.value&&!P.value?(r(),V("div",Ul,[a[30]||(a[30]=l("p",{class:"qrcode-tip"},"请使用对应平台APP扫描二维码登录",-1)),l("img",{src:x.value,alt:"登录二维码",class:"qrcode-image"},null,8,Ll)])):!x.value&&!P.value?(r(),V("div",Il,[e(N,{class:"is-loading"},{default:t(()=>[e(E(ne))]),_:1}),a[31]||(a[31]=l("span",null,"请求中...",-1))])):P.value==="200"?(r(),V("div",El,[e(N,null,{default:t(()=>[e(E(et))]),_:1}),a[32]||(a[32]=l("span",null,"添加成功",-1))])):P.value==="500"?(r(),V("div",zl,[e(N,null,{default:t(()=>[e(E(tt))]),_:1}),a[33]||(a[33]=l("span",null,"添加失败，请稍后再试",-1))])):J("",!0)])):J("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title","close-on-press-escape","show-close"])])),[[Le,E(n).isAccountRefreshing]])}}},Rl=Z(Fl,[["__scopeId","data-v-14653fc8"]]),oe={getAllMaterials:()=>ue.get("/getFiles"),uploadMaterial:s=>ue.upload("/uploadSave",s),deleteMaterial:s=>ue.get(`/deleteFile?id=${s}`),downloadMaterial:s=>`http://localhost:5409/download/${s}`,getMaterialPreviewUrl:s=>`http://localhost:5409/getFile?filename=${s}`},Ol={class:"material-management"},Bl={class:"material-list-container"},ql={class:"material-search"},Nl={class:"action-buttons"},Kl={key:0},jl={key:0,class:"material-list"},Hl={key:1,class:"empty-data"},Wl={class:"upload-form"},Xl={class:"dialog-footer"},Gl={key:0,class:"preview-container"},Jl={key:0,class:"video-preview"},Ql={controls:"",style:{"max-width":"100%","max-height":"60vh"}},Yl=["src"],Zl={key:1,class:"image-preview"},ea=["src"],ta={key:2,class:"file-info"},la={__name:"MaterialManagement",setup(s){const i=_e(),n=F(""),p=F(!1),f=F(!1),y=F(!1),u=F(!1),h=F(null),A=F([]),S=F(""),C=async()=>{p.value=!0;try{const I=await oe.getAllMaterials();I.code===200?(i.setMaterials(I.data),k.success("刷新成功")):k.error("获取素材列表失败")}catch(I){console.error("获取素材列表出错:",I),k.error("获取素材列表失败")}finally{p.value=!1}},U=X(()=>{if(!n.value)return i.materials;const I=n.value.toLowerCase();return i.materials.filter(d=>d.filename.toLowerCase().includes(I))}),D=()=>{},g=()=>{A.value=[],S.value="",y.value=!0},o=()=>{A.value=[],S.value=""},O=(I,d)=>{console.log("选择的文件:",I),I.raw&&(A.value=[I])},L=async()=>{if(A.value.length===0){k.warning("请选择要上传的文件");return}const I=A.value[0];if(!I||!I.raw){k.warning("文件对象无效，请重新选择文件");return}f.value=!0;try{const d=new FormData;console.log("上传文件对象:",I.raw),d.append("file",I.raw),S.value.trim()&&(d.append("filename",S.value.trim()),console.log("自定义文件名:",S.value.trim()));const B=await oe.uploadMaterial(d);B.code===200?(k.success("上传成功"),y.value=!1,await C()):k.error(B.msg||"上传失败")}catch(d){console.error("上传素材出错:",d),k.error("上传失败: "+(d.message||"未知错误"))}finally{f.value=!1}},b=async I=>{h.value=null,u.value=!0,k.info("加载中...");try{await new Promise(d=>setTimeout(d,100)),h.value=I}catch(d){console.error("预览素材出错:",d),k.error("预览加载失败"),u.value=!1}},q=I=>{ce.confirm(`确定要删除素材 ${I.filename} 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const d=await oe.deleteMaterial(I.id);d.code===200?(i.removeMaterial(I.id),k.success("删除成功")):k.error(d.msg||"删除失败")}catch(d){console.error("删除素材出错:",d),k.error("删除失败")}}).catch(()=>{})},x=I=>{const d=I.split("/").pop();return oe.getMaterialPreviewUrl(d)},P=I=>{const d=oe.downloadMaterial(I.file_path);window.open(d,"_blank")},G=I=>[".mp4",".avi",".mov",".wmv",".flv",".mkv"].some(B=>I.toLowerCase().endsWith(B)),W=I=>[".jpg",".jpeg",".png",".gif",".bmp",".webp"].some(B=>I.toLowerCase().endsWith(B));return we(()=>{i.materials.length===0&&C()}),(I,d)=>{const B=m("el-input"),H=m("el-button"),Y=m("el-icon"),j=m("el-table-column"),a=m("el-table"),_=m("el-empty"),w=m("el-form-item"),N=m("el-upload"),K=m("el-form"),$=m("el-dialog");return r(),V("div",Ol,[d[14]||(d[14]=l("div",{class:"page-header"},[l("h1",null,"素材管理")],-1)),l("div",Bl,[l("div",ql,[e(B,{modelValue:n.value,"onUpdate:modelValue":d[0]||(d[0]=R=>n.value=R),placeholder:"输入文件名搜索","prefix-icon":"Search",clearable:"",onClear:D,onInput:D},null,8,["modelValue"]),l("div",Nl,[e(H,{type:"primary",onClick:g},{default:t(()=>[...d[6]||(d[6]=[v("上传素材",-1)])]),_:1}),e(H,{type:"info",onClick:C,loading:!1},{default:t(()=>[e(Y,{class:se({"is-loading":p.value})},{default:t(()=>[e(E(ne))]),_:1},8,["class"]),p.value?(r(),V("span",Kl,"刷新中")):J("",!0)]),_:1})])]),U.value.length>0?(r(),V("div",jl,[e(a,{data:U.value,style:{width:"100%"}},{default:t(()=>[e(j,{prop:"filename",label:"文件名",width:"300"}),e(j,{prop:"filesize",label:"文件大小",width:"120"},{default:t(R=>[v(M(R.row.filesize)+" MB ",1)]),_:1}),e(j,{prop:"upload_time",label:"上传时间",width:"180"}),e(j,{label:"操作"},{default:t(R=>[e(H,{size:"small",onClick:T=>b(R.row)},{default:t(()=>[...d[7]||(d[7]=[v("预览",-1)])]),_:1},8,["onClick"]),e(H,{size:"small",type:"danger",onClick:T=>q(R.row)},{default:t(()=>[...d[8]||(d[8]=[v("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])):(r(),V("div",Hl,[e(_,{description:"暂无素材数据"})]))]),e($,{modelValue:y.value,"onUpdate:modelValue":d[3]||(d[3]=R=>y.value=R),title:"上传素材",width:"40%",onClose:o},{footer:t(()=>[l("div",Xl,[e(H,{onClick:d[2]||(d[2]=R=>y.value=!1)},{default:t(()=>[...d[11]||(d[11]=[v("取消",-1)])]),_:1}),e(H,{type:"primary",onClick:L,loading:f.value},{default:t(()=>[v(M(f.value?"上传中":"确认上传"),1)]),_:1},8,["loading"])])]),default:t(()=>[l("div",Wl,[e(K,{"label-width":"80px"},{default:t(()=>[e(w,{label:"文件名称:"},{default:t(()=>[e(B,{modelValue:S.value,"onUpdate:modelValue":d[1]||(d[1]=R=>S.value=R),placeholder:"选填",clearable:""},null,8,["modelValue"])]),_:1}),e(w,{label:"选择文件"},{default:t(()=>[e(N,{class:"upload-demo",drag:"","auto-upload":!1,"on-change":O,"file-list":A.value,limit:1},{tip:t(()=>[...d[9]||(d[9]=[l("div",{class:"el-upload__tip"}," 支持视频、图片等格式文件，只能上传一个文件 ",-1)])]),default:t(()=>[e(Y,{class:"el-icon--upload"},{default:t(()=>[e(E(re))]),_:1}),d[10]||(d[10]=l("div",{class:"el-upload__text"},[v(" 将文件拖到此处，或"),l("em",null,"点击上传")],-1))]),_:1},8,["file-list"])]),_:1})]),_:1})])]),_:1},8,["modelValue"]),e($,{modelValue:u.value,"onUpdate:modelValue":d[5]||(d[5]=R=>u.value=R),title:"素材预览",width:"50%",top:"10vh"},{default:t(()=>[h.value?(r(),V("div",Gl,[G(h.value.filename)?(r(),V("div",Jl,[l("video",Ql,[l("source",{src:x(h.value.file_path),type:"video/mp4"},null,8,Yl),d[12]||(d[12]=v(" 您的浏览器不支持视频播放 ",-1))])])):W(h.value.filename)?(r(),V("div",Zl,[l("img",{src:x(h.value.file_path),style:{"max-width":"100%","max-height":"60vh"}},null,8,ea)])):(r(),V("div",ta,[l("p",null,"文件名: "+M(h.value.filename),1),l("p",null,"文件大小: "+M(h.value.filesize)+" MB",1),l("p",null,"上传时间: "+M(h.value.upload_time),1),e(H,{type:"primary",onClick:d[4]||(d[4]=R=>P(h.value))},{default:t(()=>[...d[13]||(d[13]=[v("下载文件",-1)])]),_:1})]))])):J("",!0)]),_:1},8,["modelValue"])])}}},aa=Z(la,[["__scopeId","data-v-3d75da5e"]]),he={DOUYIN:{key:3,name:"抖音",titleLimit:30,topicLimit:5,titlePlaceholder:"请输入标题（最多30字）",topicPlaceholder:"最多可添加5个话题"},KUAISHOU:{key:4,name:"快手",titleLimit:30,topicLimit:3,titlePlaceholder:"请输入标题（最多30字）",topicPlaceholder:"最多可添加3个话题"},WEIXIN:{key:2,name:"视频号",titleLimit:16,topicLimit:20,titlePlaceholder:"请输入标题（最多16字）",topicPlaceholder:"最多可添加20个话题"},XIAOHONGSHU:{key:1,name:"小红书",titleLimit:20,topicLimit:10,titlePlaceholder:"请输入标题（最多20字）",topicPlaceholder:"最多可添加10个话题"}};function pe(s){return Object.values(he).find(i=>i.key===s)||he.XIAOHONGSHU}function sa(){return Object.values(he)}function be(s,i){const n=pe(i);return!s||!s.trim()?{valid:!1,message:"请输入标题"}:s.length>n.titleLimit?{valid:!1,message:`标题不能超过${n.titleLimit}字，当前${s.length}字`}:{valid:!0,message:""}}function $e(s,i){const n=pe(i);return Array.isArray(s)?s.length>n.topicLimit?{valid:!1,message:`最多只能添加${n.topicLimit}个话题，当前${s.length}个`}:{valid:!0,message:""}:{valid:!1,message:"话题格式错误"}}function oa(s){return!s||!s.trim()?{valid:!1,message:"话题内容不能为空"}:s.length>20?{valid:!1,message:"单个话题不能超过20字"}:/[<>{}[\]()&$#@!%^*+=|\\/]/g.test(s)?{valid:!1,message:"话题不能包含特殊字符"}:{valid:!0,message:""}}function na(s){const i={};let n=!0;(!s.fileList||s.fileList.length===0)&&(i.fileList="请先上传视频文件",n=!1);const p=be(s.title,s.selectedPlatform);p.valid||(i.title=p.message,n=!1),s.selectedPlatform||(i.platform="请选择发布平台",n=!1),(!s.selectedAccounts||s.selectedAccounts.length===0)&&(i.accounts="请选择发布账号",n=!1);const f=$e(s.selectedTopics,s.selectedPlatform);return f.valid||(i.topics=f.message,n=!1),s.scheduleEnabled&&((!s.videosPerDay||s.videosPerDay<1||s.videosPerDay>55)&&(i.videosPerDay="每天发布视频数必须在1-55之间",n=!1),(!s.dailyTimes||s.dailyTimes.length===0)&&(i.dailyTimes="请设置发布时间",n=!1),s.dailyTimes&&s.dailyTimes.length!==s.videosPerDay&&(i.dailyTimes="发布时间数量必须与每天发布视频数一致",n=!1),(s.startDays===void 0||s.startDays<0)&&(i.startDays="请选择开始天数",n=!1)),{valid:n,errors:i}}const ia={class:"tab-management"},ua={class:"tab-header"},da={class:"tab-list"},ra=["onClick"],ca={class:"tab-actions"},pa={__name:"TabManagement",props:{tabs:{type:Array,required:!0},activeTab:{type:String,required:!0},batchPublishing:{type:Boolean,default:!1}},emits:["tab-change","remove-tab","add-tab","batch-publish"],setup(s){return(i,n)=>{const p=m("el-icon"),f=m("el-button");return r(),V("div",ia,[l("div",ua,[l("div",da,[(r(!0),V(ee,null,te(s.tabs,y=>(r(),V("div",{key:y.name,class:se(["tab-item",{active:s.activeTab===y.name}]),onClick:u=>i.$emit("tab-change",y.name)},[l("span",null,M(y.label),1),s.tabs.length>1?(r(),Q(p,{key:0,class:"close-icon",onClick:Fe(u=>i.$emit("remove-tab",y.name),["stop"])},{default:t(()=>[e(E(xe))]),_:1},8,["onClick"])):J("",!0)],10,ra))),128))]),l("div",ca,[e(f,{type:"primary",size:"small",onClick:n[0]||(n[0]=y=>i.$emit("add-tab")),class:"add-tab-btn"},{default:t(()=>[e(p,null,{default:t(()=>[e(E(lt))]),_:1}),n[2]||(n[2]=v(" 添加Tab ",-1))]),_:1}),e(f,{type:"success",size:"small",onClick:n[1]||(n[1]=y=>i.$emit("batch-publish")),loading:s.batchPublishing,class:"batch-publish-btn"},{default:t(()=>[...n[3]||(n[3]=[v(" 批量发布 ",-1)])]),_:1},8,["loading"])])])])}}},ma=Z(pa,[["__scopeId","data-v-7584dadb"]]),fa={class:"upload-section"},va={class:"upload-options"},_a={key:0,class:"uploaded-files"},ga={class:"file-list"},ya={class:"file-size"},ha={class:"upload-options-content"},ba={class:"material-library-content"},$a={class:"material-list"},wa={class:"material-info"},ka={class:"material-name"},Va={class:"material-details"},Ca={class:"file-size"},Aa={class:"upload-time"},Ta={class:"dialog-footer"},xa={__name:"VideoUpload",props:{fileList:{type:Array,default:()=>[]},uploadAction:{type:String,required:!0},authHeaders:{type:Object,required:!0},materials:{type:Array,default:()=>[]}},emits:["show-upload-options","remove-file","upload-success","material-selected"],setup(s,{expose:i,emit:n}){const p=s,f=n,y=_e(),u=F(!1),h=F(!1),A=F(!1),S=F([]),C=()=>{u.value=!1,h.value=!0},U=async()=>{if(u.value=!1,p.materials.length===0)try{const L=await oe.getAllMaterials();if(L.code===200)y.setMaterials(L.data);else{k.error("获取素材列表失败");return}}catch(L){console.error("获取素材列表出错:",L),k.error("获取素材列表失败");return}S.value=[],A.value=!0},D=(L,b)=>{L.code===200?(f("upload-success",L,b),h.value=!1,k.success("文件上传成功")):k.error(L.msg||"上传失败")},g=L=>{k.error("文件上传失败"),console.error("上传错误:",L)},o=()=>{if(S.value.length===0){k.warning("请选择至少一个素材");return}f("material-selected",S.value);const L=S.value.length;A.value=!1,S.value=[],k.success(`已添加 ${L} 个素材`)},O=()=>{u.value=!0};return i({showUploadOptions:O}),(L,b)=>{const q=m("el-icon"),x=m("el-button"),P=m("el-link"),G=m("el-dialog"),W=m("el-upload"),I=m("el-checkbox"),d=m("el-checkbox-group");return r(),V("div",fa,[b[14]||(b[14]=l("h3",null,"视频",-1)),l("div",va,[e(x,{type:"primary",onClick:O,class:"upload-btn"},{default:t(()=>[e(q,null,{default:t(()=>[e(E(re))]),_:1}),b[5]||(b[5]=v(" 上传视频 ",-1))]),_:1})]),s.fileList.length>0?(r(),V("div",_a,[b[7]||(b[7]=l("h4",null,"已上传文件：",-1)),l("div",ga,[(r(!0),V(ee,null,te(s.fileList,(B,H)=>(r(),V("div",{key:H,class:"file-item"},[e(P,{href:B.url,target:"_blank",type:"primary"},{default:t(()=>[v(M(B.name),1)]),_:2},1032,["href"]),l("span",ya,M((B.size/1024/1024).toFixed(2))+"MB",1),e(x,{type:"danger",size:"small",onClick:Y=>L.$emit("remove-file",H)},{default:t(()=>[...b[6]||(b[6]=[v("删除",-1)])]),_:1},8,["onClick"])]))),128))])])):J("",!0),e(G,{modelValue:u.value,"onUpdate:modelValue":b[0]||(b[0]=B=>u.value=B),title:"选择上传方式",width:"400px",class:"upload-options-dialog"},{default:t(()=>[l("div",ha,[e(x,{type:"primary",onClick:C,class:"option-btn"},{default:t(()=>[e(q,null,{default:t(()=>[e(E(re))]),_:1}),b[8]||(b[8]=v(" 本地上传 ",-1))]),_:1}),e(x,{type:"success",onClick:U,class:"option-btn"},{default:t(()=>[e(q,null,{default:t(()=>[e(E(at))]),_:1}),b[9]||(b[9]=v(" 素材库 ",-1))]),_:1})])]),_:1},8,["modelValue"]),e(G,{modelValue:h.value,"onUpdate:modelValue":b[1]||(b[1]=B=>h.value=B),title:"本地上传",width:"600px",class:"local-upload-dialog"},{default:t(()=>[e(W,{class:"video-upload",drag:"","auto-upload":!0,action:s.uploadAction,"on-success":D,"on-error":g,multiple:"",accept:"video/*",headers:s.authHeaders},{tip:t(()=>[...b[10]||(b[10]=[l("div",{class:"el-upload__tip"}," 支持MP4、AVI等视频格式，可上传多个文件 ",-1)])]),default:t(()=>[e(q,{class:"el-icon--upload"},{default:t(()=>[e(E(re))]),_:1}),b[11]||(b[11]=l("div",{class:"el-upload__text"},[v(" 将视频文件拖到此处，或"),l("em",null,"点击上传")],-1))]),_:1},8,["action","headers"])]),_:1},8,["modelValue"]),e(G,{modelValue:A.value,"onUpdate:modelValue":b[4]||(b[4]=B=>A.value=B),title:"选择素材",width:"800px",class:"material-library-dialog"},{footer:t(()=>[l("div",Ta,[e(x,{onClick:b[3]||(b[3]=B=>A.value=!1)},{default:t(()=>[...b[12]||(b[12]=[v("取消",-1)])]),_:1}),e(x,{type:"primary",onClick:o},{default:t(()=>[...b[13]||(b[13]=[v("确定",-1)])]),_:1})])]),default:t(()=>[l("div",ba,[e(d,{modelValue:S.value,"onUpdate:modelValue":b[2]||(b[2]=B=>S.value=B)},{default:t(()=>[l("div",$a,[(r(!0),V(ee,null,te(s.materials,B=>(r(),V("div",{key:B.id,class:"material-item"},[e(I,{label:B.id,class:"material-checkbox"},{default:t(()=>[l("div",wa,[l("div",ka,M(B.filename),1),l("div",Va,[l("span",Ca,M(B.filesize)+"MB",1),l("span",Aa,M(B.upload_time),1)])])]),_:2},1032,["label"])]))),128))])]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"])])}}},Pa=Z(xa,[["__scopeId","data-v-a4989d91"]]),Sa={class:"platform-section"},Ma={key:0,class:"platform-tips"},Ua={__name:"PlatformSelection",props:{modelValue:{type:Number,required:!0}},emits:["update:modelValue","platform-change"],setup(s,{emit:i}){const n=s,p=i,f=sa(),y=X({get:()=>n.modelValue,set:A=>p("update:modelValue",A)}),u=X(()=>pe(n.modelValue)),h=A=>{p("platform-change",A)};return(A,S)=>{const C=m("el-radio"),U=m("el-radio-group"),D=m("el-alert");return r(),V("div",Sa,[S[1]||(S[1]=l("h3",null,"平台",-1)),e(U,{modelValue:y.value,"onUpdate:modelValue":S[0]||(S[0]=g=>y.value=g),onChange:h,class:"platform-radios"},{default:t(()=>[(r(!0),V(ee,null,te(E(f),g=>(r(),Q(C,{key:g.key,label:g.key,class:"platform-radio"},{default:t(()=>[v(M(g.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"]),u.value?(r(),V("div",Ma,[e(D,{title:`${u.value.name}平台限制：标题最多${u.value.titleLimit}字，话题最多${u.value.topicLimit}个`,type:"info",closable:!1,"show-icon":"",class:"platform-alert"},null,8,["title"])])):J("",!0)])}}},La=Z(Ua,[["__scopeId","data-v-4ae792d5"]]),Ia={class:"account-section"},Ea={class:"account-display"},za={class:"selected-accounts"},Da={class:"account-dialog-content"},Fa={class:"account-list"},Ra={class:"account-info"},Oa={class:"account-name"},Ba={class:"dialog-footer"},qa={__name:"AccountSelection",props:{modelValue:{type:Array,default:()=>[]},platformKey:{type:Number,required:!0}},emits:["update:modelValue"],setup(s,{emit:i}){const n=s,p=i,f=ke(),y=X({get:()=>n.modelValue,set:g=>p("update:modelValue",g)}),u=F(!1),h=F([]),A=X(()=>{const o={3:"抖音",2:"视频号",1:"小红书",4:"快手"}[n.platformKey];return o?f.accounts.filter(O=>O.platform===o):[]}),S=()=>{h.value=[...y.value],u.value=!0},C=()=>{y.value=[...h.value],u.value=!1,k.success("账号选择完成")},U=g=>{y.value.splice(g,1)},D=g=>{const o=f.accounts.find(O=>O.id===g);return o?o.name:g};return(g,o)=>{const O=m("el-tag"),L=m("el-button"),b=m("el-checkbox"),q=m("el-checkbox-group"),x=m("el-dialog");return r(),V("div",Ia,[o[6]||(o[6]=l("h3",null,"账号",-1)),l("div",Ea,[l("div",za,[(r(!0),V(ee,null,te(y.value,(P,G)=>(r(),Q(O,{key:G,closable:"",onClose:W=>U(G),class:"account-tag"},{default:t(()=>[v(M(D(P)),1)]),_:2},1032,["onClose"]))),128))]),e(L,{type:"primary",plain:"",onClick:S,class:"select-account-btn"},{default:t(()=>[...o[3]||(o[3]=[v(" 选择账号 ",-1)])]),_:1})]),e(x,{modelValue:u.value,"onUpdate:modelValue":o[2]||(o[2]=P=>u.value=P),title:"选择账号",width:"600px",class:"account-dialog"},{footer:t(()=>[l("div",Ba,[e(L,{onClick:o[1]||(o[1]=P=>u.value=!1)},{default:t(()=>[...o[4]||(o[4]=[v("取消",-1)])]),_:1}),e(L,{type:"primary",onClick:C},{default:t(()=>[...o[5]||(o[5]=[v("确定",-1)])]),_:1})])]),default:t(()=>[l("div",Da,[e(q,{modelValue:h.value,"onUpdate:modelValue":o[0]||(o[0]=P=>h.value=P)},{default:t(()=>[l("div",Fa,[(r(!0),V(ee,null,te(A.value,P=>(r(),Q(b,{key:P.id,label:P.id,class:"account-item"},{default:t(()=>[l("div",Ra,[l("span",Oa,M(P.name),1)])]),_:2},1032,["label"]))),128))])]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"])])}}},Na=Z(qa,[["__scopeId","data-v-7cdefdfd"]]),Ka={class:"title-section"},ja={key:0,class:"error-message"},Ha={__name:"TitleInput",props:{modelValue:{type:String,default:""},platformKey:{type:Number,required:!0},validateOnInput:{type:Boolean,default:!0}},emits:["update:modelValue","validation-change"],setup(s,{expose:i,emit:n}){const p=s,f=n,y=X(()=>pe(p.platformKey)),u=X({get:()=>p.modelValue,set:D=>f("update:modelValue",D)}),h=X(()=>y.value.titlePlaceholder),A=X(()=>y.value.titleLimit),S=F(""),C=D=>{if(p.validateOnInput){const g=be(D,p.platformKey);S.value=g.valid?"":g.message,f("validation-change",g)}};return i({validate:()=>{const D=be(p.modelValue,p.platformKey);return S.value=D.valid?"":D.message,f("validation-change",D),D}}),(D,g)=>{const o=m("el-input"),O=m("el-alert");return r(),V("div",Ka,[g[1]||(g[1]=l("h3",null,"标题",-1)),e(o,{modelValue:u.value,"onUpdate:modelValue":g[0]||(g[0]=L=>u.value=L),type:"textarea",rows:3,placeholder:h.value,maxlength:A.value,"show-word-limit":"",class:"title-input",onInput:C},null,8,["modelValue","placeholder","maxlength"]),S.value?(r(),V("div",ja,[e(O,{title:S.value,type:"error",closable:!1,"show-icon":"",class:"error-alert"},null,8,["title"])])):J("",!0)])}}},Wa=Z(Ha,[["__scopeId","data-v-f75530ea"]]),Xa={class:"topic-section"},Ga={class:"topic-display"},Ja={class:"selected-topics"},Qa={key:0,class:"topic-tips"},Ya={key:1,class:"error-message"},Za={class:"topic-dialog-content"},es={class:"custom-topic-input"},ts={class:"recommended-topics"},ls={class:"topic-grid"},as={class:"dialog-footer"},ss={__name:"TopicInput",props:{modelValue:{type:Array,default:()=>[]},platformKey:{type:Number,required:!0},validateOnInput:{type:Boolean,default:!0}},emits:["update:modelValue","validation-change"],setup(s,{expose:i,emit:n}){const p=s,f=n,y=X(()=>pe(p.platformKey)),u=X({get:()=>p.modelValue,set:x=>f("update:modelValue",x)}),h=X(()=>u.value.length>=y.value.topicLimit),A=F(""),S=F(!1),C=F(""),U=["游戏","知识","自动化","系统平台","自媒体工具","跨境电商","科技","教程","云手机平台","云电脑平台","脚本","开源","健康","时尚","美妆","摄影","宠物","汽车"],D=()=>{if(h.value){k.warning(`最多只能添加${y.value.topicLimit}个话题`);return}S.value=!0},g=()=>{if(!C.value.trim()){k.warning("请输入话题内容");return}const x=oa(C.value.trim());if(!x.valid){k.error(x.message);return}if(h.value){k.warning(`最多只能添加${y.value.topicLimit}个话题`);return}u.value.includes(C.value.trim())?k.warning("话题已存在"):(u.value.push(C.value.trim()),C.value="",k.success("话题添加成功"),b())},o=x=>{if(h.value&&!u.value.includes(x)){k.warning(`最多只能添加${y.value.topicLimit}个话题`);return}const P=u.value.indexOf(x);P>-1?u.value.splice(P,1):u.value.push(x),b()},O=x=>{u.value.splice(x,1),b()},L=()=>{S.value=!1,C.value="",k.success("添加话题完成")},b=()=>{if(p.validateOnInput){const x=$e(u.value,p.platformKey);A.value=x.valid?"":x.message,f("validation-change",x)}};return i({validate:()=>{const x=$e(p.modelValue,p.platformKey);return A.value=x.valid?"":x.message,f("validation-change",x),x}}),(x,P)=>{const G=m("el-tag"),W=m("el-button"),I=m("el-alert"),d=m("el-input"),B=m("el-dialog");return r(),V("div",Xa,[P[9]||(P[9]=l("h3",null,"话题",-1)),l("div",Ga,[l("div",Ja,[(r(!0),V(ee,null,te(u.value,(H,Y)=>(r(),Q(G,{key:Y,closable:"",onClose:j=>O(Y),class:"topic-tag"},{default:t(()=>[v(" #"+M(H),1)]),_:2},1032,["onClose"]))),128))]),e(W,{type:"primary",plain:"",onClick:D,class:"select-topic-btn",disabled:h.value},{default:t(()=>[...P[3]||(P[3]=[v(" 添加话题 ",-1)])]),_:1},8,["disabled"])]),y.value?(r(),V("div",Qa,[e(I,{title:`已添加 ${u.value.length}/${y.value.topicLimit} 个话题`,type:h.value?"warning":"info",closable:!1,"show-icon":"",class:"topic-alert"},null,8,["title","type"])])):J("",!0),A.value?(r(),V("div",Ya,[e(I,{title:A.value,type:"error",closable:!1,"show-icon":"",class:"error-alert"},null,8,["title"])])):J("",!0),e(B,{modelValue:S.value,"onUpdate:modelValue":P[2]||(P[2]=H=>S.value=H),title:"添加话题",width:"600px",class:"topic-dialog"},{footer:t(()=>[l("div",as,[e(W,{onClick:P[1]||(P[1]=H=>S.value=!1)},{default:t(()=>[...P[7]||(P[7]=[v("取消",-1)])]),_:1}),e(W,{type:"primary",onClick:L},{default:t(()=>[...P[8]||(P[8]=[v("确定",-1)])]),_:1})])]),default:t(()=>[l("div",Za,[l("div",es,[e(d,{modelValue:C.value,"onUpdate:modelValue":P[0]||(P[0]=H=>C.value=H),placeholder:"输入自定义话题",class:"custom-input",onKeyup:Re(g,["enter"])},{prepend:t(()=>[...P[4]||(P[4]=[v("#",-1)])]),_:1},8,["modelValue"]),e(W,{type:"primary",onClick:g},{default:t(()=>[...P[5]||(P[5]=[v("添加",-1)])]),_:1})]),l("div",ts,[P[6]||(P[6]=l("h4",null,"推荐话题",-1)),l("div",ls,[(r(),V(ee,null,te(U,H=>e(W,{key:H,type:u.value.includes(H)?"primary":"default",onClick:Y=>o(H),class:"topic-btn",disabled:u.value.includes(H)&&h.value},{default:t(()=>[v(M(H),1)]),_:2},1032,["type","onClick","disabled"])),64))])])])]),_:1},8,["modelValue"])])}}},os=Z(ss,[["__scopeId","data-v-b3973a1b"]]),ns={class:"schedule-section"},is={class:"schedule-controls"},us={key:0,class:"schedule-settings"},ds={class:"schedule-item"},rs={class:"schedule-item"},cs={class:"time-selectors"},ps={class:"schedule-item"},ms={__name:"ScheduleSettings",props:{scheduleEnabled:{type:Boolean,default:!1},videosPerDay:{type:Number,default:1},dailyTimes:{type:Array,default:()=>["10:00"]},startDays:{type:Number,default:0}},emits:["update:scheduleEnabled","update:videosPerDay","update:dailyTimes","update:startDays"],setup(s,{emit:i}){const n=s,p=i,f=X({get:()=>n.scheduleEnabled,set:C=>p("update:scheduleEnabled",C)}),y=X({get:()=>n.videosPerDay,set:C=>p("update:videosPerDay",C)}),u=X({get:()=>n.dailyTimes,set:C=>p("update:dailyTimes",C)}),h=X({get:()=>n.startDays,set:C=>p("update:startDays",C)}),A=C=>{C||(p("update:videosPerDay",1),p("update:dailyTimes",["10:00"]),p("update:startDays",0))},S=()=>{if(u.value.length<y.value){const C=[...u.value,"10:00"];p("update:dailyTimes",C)}};return(C,U)=>{const D=m("el-switch"),g=m("el-option"),o=m("el-select"),O=m("el-time-select"),L=m("el-button");return r(),V("div",ns,[U[7]||(U[7]=l("h3",null,"定时发布",-1)),l("div",is,[e(D,{modelValue:f.value,"onUpdate:modelValue":U[0]||(U[0]=b=>f.value=b),"active-text":"定时发布","inactive-text":"立即发布",onChange:A},null,8,["modelValue"]),f.value?(r(),V("div",us,[l("div",ds,[U[3]||(U[3]=l("span",{class:"label"},"每天发布视频数：",-1)),e(o,{modelValue:y.value,"onUpdate:modelValue":U[1]||(U[1]=b=>y.value=b),placeholder:"选择发布数量"},{default:t(()=>[(r(),V(ee,null,te(55,b=>e(g,{key:b,label:b,value:b},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),l("div",rs,[U[5]||(U[5]=l("span",{class:"label"},"每天发布时间：",-1)),l("div",cs,[(r(!0),V(ee,null,te(u.value,(b,q)=>(r(),Q(O,{key:q,modelValue:u.value[q],"onUpdate:modelValue":x=>u.value[q]=x,start:"00:00",step:"00:30",end:"23:30",placeholder:"选择时间"},null,8,["modelValue","onUpdate:modelValue"]))),128)),u.value.length<y.value?(r(),Q(L,{key:0,type:"primary",size:"small",onClick:S},{default:t(()=>[...U[4]||(U[4]=[v(" 添加时间 ",-1)])]),_:1})):J("",!0)])]),l("div",ps,[U[6]||(U[6]=l("span",{class:"label"},"开始天数：",-1)),e(o,{modelValue:h.value,"onUpdate:modelValue":U[2]||(U[2]=b=>h.value=b),placeholder:"选择开始天数"},{default:t(()=>[e(g,{label:"明天",value:0}),e(g,{label:"后天",value:1})]),_:1},8,["modelValue"])])])):J("",!0)])])}}},fs=Z(ms,[["__scopeId","data-v-7e1e15aa"]]),vs={class:"publish-center"},_s={class:"publish-content"},gs={class:"tab-content-wrapper"},ys={key:0,class:"publish-status"},hs={class:"action-buttons"},bs={class:"publish-progress"},$s={key:0,class:"current-publishing"},ws={key:1,class:"publish-results"},ks={class:"label"},Vs={class:"message"},Cs={class:"dialog-footer"},As={__name:"PublishCenter",setup(s){const i="http://localhost:5409",n=X(()=>({Authorization:`Bearer ${localStorage.getItem("token")||""}`})),p=F("tab1");let f=1;const y=_e(),u=ke(),h=X(()=>y.materials),A={1:"小红书",2:"视频号",3:"抖音",4:"快手"},S=F(!1);we(async()=>{try{const a=await ye.getValidAccounts({validate:0});a&&a.code===200&&Array.isArray(a.data)&&u.setAccounts(a.data)}catch(a){console.warn("初始化获取账号失败",a)}});const C=de([{name:"tab1",label:A[1],fileList:[],displayFileList:[],selectedAccounts:[],selectedPlatform:1,title:"",selectedTopics:[],scheduleEnabled:!1,videosPerDay:1,dailyTimes:["10:00"],startDays:0,publishStatus:null,validationErrors:{}}]),U=F(!1),D=F(null),g=F(0),o=F([]),O=F(!1),L=()=>{f++;const a={name:`tab${f}`,label:A[1],fileList:[],displayFileList:[],selectedAccounts:[],selectedPlatform:1,title:"",selectedTopics:[],scheduleEnabled:!1,videosPerDay:1,dailyTimes:["10:00"],startDays:0,publishStatus:null,validationErrors:{}};C.push(a),p.value=a.name},b=a=>{const _=C.findIndex(w=>w.name===a);_>-1&&(C.splice(_,1),p.value===a&&C.length>0&&(p.value=C[0].name))},q=a=>{const _=C.find(w=>w.name===p.value);_&&(_.selectedAccounts=[],I(_))},x=(a,_,w)=>{_.valid?delete w.validationErrors[a]:w.validationErrors[a]=_.message},P=(a,_,w)=>{if(a.code===200){const N=a.data.path||a.data,K=N.split("/").pop(),$={name:_.name,url:oe.getMaterialPreviewUrl(K),path:N,size:_.size,type:_.type};w.fileList.push($),w.displayFileList=[...w.fileList.map(R=>({name:R.name,url:R.url}))],k.success("文件上传成功"),console.log("上传成功:",$)}else k.error(a.msg||"上传失败")},G=(a,_)=>{a.forEach(w=>{const N=h.value.find(K=>K.id===w);if(N){const K={name:N.filename,url:oe.getMaterialPreviewUrl(N.file_path.split("/").pop()),path:N.file_path,size:N.filesize*1024*1024,type:"video/mp4"};_.fileList.some(R=>R.path===K.path)||_.fileList.push(K)}}),_.displayFileList=[..._.fileList.map(w=>({name:w.name,url:w.url}))]},W=(a,_)=>{a.fileList.splice(_,1),a.displayFileList=[...a.fileList.map(w=>({name:w.name,url:w.url}))],k.success("文件删除成功")},I=a=>{const _=A[a.selectedPlatform],w=a.selectedAccounts||[];if(_&&w.length>0){const N=u.accounts.find($=>$.id===w[0]),K=(N==null?void 0:N.name)||"";a.label=K?`${_}_${K}`:`${_}`}else if(_)a.label=_;else{const N=C.findIndex(K=>K.name===a.name);a.label=`发布${N+1}`}};Oe(C,()=>{C.forEach(I)},{deep:!0});const d=a=>{k.info("已取消发布")},B=async a=>new Promise((_,w)=>{const N=na(a);if(!N.valid){const $=Object.values(N.errors)[0];k.error($),w(new Error($));return}const K={type:a.selectedPlatform,title:a.title,tags:a.selectedTopics,fileList:a.fileList.map($=>$.path),accountList:a.selectedAccounts.map($=>{const R=u.accounts.find(T=>T.id===$);return R?R.filePath:$}),enableTimer:a.scheduleEnabled?1:0,videosPerDay:a.scheduleEnabled&&a.videosPerDay||1,dailyTimes:a.scheduleEnabled?a.dailyTimes||["10:00"]:["10:00"],startDays:a.scheduleEnabled&&a.startDays||0,category:0};fetch(`${i}/postVideo`,{method:"POST",headers:{"Content-Type":"application/json",...n.value},body:JSON.stringify(K)}).then($=>$.json()).then($=>{$.code===200?(a.publishStatus={message:"发布成功",type:"success"},a.fileList=[],a.displayFileList=[],a.title="",a.selectedTopics=[],a.selectedAccounts=[],a.scheduleEnabled=!1,a.validationErrors={},_()):(a.publishStatus={message:`发布失败：${$.msg||"发布失败"}`,type:"error"},w(new Error($.msg||"发布失败")))}).catch($=>{console.error("发布错误:",$),a.publishStatus={message:"发布失败，请检查网络连接",type:"error"},w($)})}),H=()=>{const a=[];return C.forEach(_=>{const w=[];(!_.fileList||_.fileList.length===0)&&w.push("未上传视频"),(!_.selectedAccounts||_.selectedAccounts.length===0)&&w.push("未选择账号"),w.length&&a.push({tab:_,message:`${_.label}: ${w.join("、")}`})}),a},Y=async()=>{if(S.value)return;const a=H();if(a.length>0){p.value=a[0].tab.name,a[0].tab.publishStatus={message:a[0].message,type:"error"};try{await ce.alert(a.map(_=>_.message).join(`
`),"请完善发布项后再批量发布",{confirmButtonText:"好的"})}catch{}k.error("存在未准备完成的发布项：请为每个发布项上传视频并选择账号");return}S.value=!0,D.value=null,g.value=0,o.value=[],O.value=!1,U.value=!0;try{for(let K=0;K<C.length;K++){if(O.value){o.value.push({label:C[K].label,status:"cancelled",message:"已取消"});continue}const $=C[K];D.value=$,g.value=Math.floor(K/C.length*100);try{await B($),o.value.push({label:$.label,status:"success",message:"发布成功"})}catch(R){o.value.push({label:$.label,status:"error",message:R.message})}}g.value=100;const _=o.value.filter(K=>K.status==="success").length,w=o.value.filter(K=>K.status==="error").length,N=o.value.filter(K=>K.status==="cancelled").length;O.value?k.warning(`发布已取消：${_}个成功，${w}个失败，${N}个未执行`):w>0?k.error(`发布完成：${_}个成功，${w}个失败`):(k.success("所有Tab发布成功"),setTimeout(()=>{U.value=!1},1e3))}catch(_){console.error("批量发布出错:",_),k.error("批量发布出错，请重试")}finally{S.value=!1,O.value=!1}},j=()=>{O.value=!0,k.info("正在取消发布...")};return(a,_)=>{const w=m("el-alert"),N=m("el-button"),K=m("el-progress"),$=m("el-icon"),R=m("el-dialog");return r(),V("div",vs,[e(ma,{tabs:C,"active-tab":p.value,"batch-publishing":S.value,onTabChange:_[0]||(_[0]=T=>p.value=T),onRemoveTab:b,onAddTab:L,onBatchPublish:Y},null,8,["tabs","active-tab","batch-publishing"]),l("div",_s,[l("div",gs,[(r(!0),V(ee,null,te(C,T=>ve((r(),V("div",{key:T.name,class:"tab-content"},[T.publishStatus?(r(),V("div",ys,[e(w,{title:T.publishStatus.message,type:T.publishStatus.type,closable:!1,"show-icon":""},null,8,["title","type"])])):J("",!0),e(Pa,{"file-list":T.fileList,"upload-action":`${E(i)}/upload`,"auth-headers":n.value,materials:h.value,onRemoveFile:z=>W(T,z),onUploadSuccess:(z,le)=>P(z,le,T),onMaterialSelected:z=>G(z,T)},null,8,["file-list","upload-action","auth-headers","materials","onRemoveFile","onUploadSuccess","onMaterialSelected"]),e(La,{modelValue:T.selectedPlatform,"onUpdate:modelValue":z=>T.selectedPlatform=z,onPlatformChange:q},null,8,["modelValue","onUpdate:modelValue"]),e(Na,{modelValue:T.selectedAccounts,"onUpdate:modelValue":z=>T.selectedAccounts=z,"platform-key":T.selectedPlatform},null,8,["modelValue","onUpdate:modelValue","platform-key"]),e(Wa,{modelValue:T.title,"onUpdate:modelValue":z=>T.title=z,"platform-key":T.selectedPlatform,onValidationChange:z=>x("title",z,T)},null,8,["modelValue","onUpdate:modelValue","platform-key","onValidationChange"]),e(os,{modelValue:T.selectedTopics,"onUpdate:modelValue":z=>T.selectedTopics=z,"platform-key":T.selectedPlatform,onValidationChange:z=>x("topics",z,T)},null,8,["modelValue","onUpdate:modelValue","platform-key","onValidationChange"]),e(fs,{"schedule-enabled":T.scheduleEnabled,"onUpdate:scheduleEnabled":z=>T.scheduleEnabled=z,"videos-per-day":T.videosPerDay,"onUpdate:videosPerDay":z=>T.videosPerDay=z,"daily-times":T.dailyTimes,"onUpdate:dailyTimes":z=>T.dailyTimes=z,"start-days":T.startDays,"onUpdate:startDays":z=>T.startDays=z},null,8,["schedule-enabled","onUpdate:scheduleEnabled","videos-per-day","onUpdate:videosPerDay","daily-times","onUpdate:dailyTimes","start-days","onUpdate:startDays"]),l("div",hs,[e(N,{size:"small",onClick:z=>d()},{default:t(()=>[..._[3]||(_[3]=[v("取消",-1)])]),_:1},8,["onClick"]),e(N,{size:"small",type:"primary",onClick:z=>B(T)},{default:t(()=>[..._[4]||(_[4]=[v("发布",-1)])]),_:1},8,["onClick"])])])),[[ge,p.value===T.name]])),128))])]),e(R,{modelValue:U.value,"onUpdate:modelValue":_[2]||(_[2]=T=>U.value=T),title:"批量发布进度",width:"500px","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},{footer:t(()=>[l("div",Cs,[e(N,{onClick:j,disabled:g.value===100},{default:t(()=>[..._[5]||(_[5]=[v(" 取消发布 ",-1)])]),_:1},8,["disabled"]),g.value===100?(r(),Q(N,{key:0,type:"primary",onClick:_[1]||(_[1]=T=>U.value=!1)},{default:t(()=>[..._[6]||(_[6]=[v(" 关闭 ",-1)])]),_:1})):J("",!0)])]),default:t(()=>[l("div",bs,[e(K,{percentage:g.value,status:g.value===100?"success":""},null,8,["percentage","status"]),D.value?(r(),V("div",$s," 正在发布："+M(D.value.label),1)):J("",!0),o.value.length>0?(r(),V("div",ws,[(r(!0),V(ee,null,te(o.value,(T,z)=>(r(),V("div",{key:z,class:se(["result-item",T.status])},[T.status==="success"?(r(),Q($,{key:0},{default:t(()=>[e(E(st))]),_:1})):T.status==="error"?(r(),Q($,{key:1},{default:t(()=>[e(E(xe))]),_:1})):(r(),Q($,{key:2},{default:t(()=>[e(E(ot))]),_:1})),l("span",ks,M(T.label),1),l("span",Vs,M(T.message),1)],2))),128))])):J("",!0)])]),_:1},8,["modelValue"])])}}},Ts=Z(As,[["__scopeId","data-v-0af57281"]]),xs={class:"about"},Ps={__name:"About",setup(s){return(i,n)=>(r(),V("div",xs,[...n[0]||(n[0]=[l("h1",null,"关于我们",-1),l("p",null,"这是关于页面",-1)])]))}},Ss=Z(Ps,[["__scopeId","data-v-cd67ee8e"]]),Ms=[{path:"/",name:"Dashboard",component:Yt},{path:"/account-management",name:"AccountManagement",component:Rl},{path:"/material-management",name:"MaterialManagement",component:aa},{path:"/publish-center",name:"PublishCenter",component:Ts},{path:"/about",name:"About",component:Ss}],Us=Be({history:qe(),routes:Ms}),Ls=Ne(),me=Ke(gt);for(const[s,i]of Object.entries(nt))me.component(s,i);me.use(Us);me.use(Ls);me.use(it);me.mount("#app");
